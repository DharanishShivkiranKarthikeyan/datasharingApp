var U8=Object.defineProperty;var vl=n=>{throw TypeError(n)};var $8=(n,e,t)=>e in n?U8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var f=(n,e,t)=>$8(n,typeof e!="symbol"?e+"":e,t),ca=(n,e,t)=>e.has(n)||vl("Cannot "+t);var z=(n,e,t)=>(ca(n,e,"read from private field"),t?t.call(n):e.get(n)),ae=(n,e,t)=>e.has(n)?vl("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),xe=(n,e,t,r)=>(ca(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),oe=(n,e,t)=>(ca(n,e,"access private method"),t);var ss=(n,e,t,r)=>({set _(s){xe(n,e,s,t)},get _(){return z(n,e,r)}});import{getAuth as H8,onAuthStateChanged as wl,setPersistence as z8,browserLocalPersistence as q8,GoogleAuthProvider as Bd,signInWithPopup as Dd,signOut as V8}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";import{getFirestore as K8,getDocs as Ji,collection as ws,doc as Ft,setDoc as jn,updateDoc as Es,increment as eo,getDoc as Oc,query as to,where as L0,onSnapshot as j8}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";import{getStorage as G8}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";import{initializeApp as W8}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";function Q8(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Y8="modulepreload",Z8=function(n){return"/datasharingApp/"+n},El={},X8=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(c=>{if(c=Z8(c),c in El)return;El[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":Y8,l||(d.as="script"),d.crossOrigin="",d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),l)return new Promise((h,g)=>{d.addEventListener("load",h),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};class J8{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return e6(e).buffer}}function e6(n){let e=0;for(const s of n)e+=s.byteLength;const t=new Uint8Array(e);let r=0;for(const s of n){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);t.set(i,r),r+=s.byteLength}return t}function Id(n){return new t6(n).unpack()}function Pd(n){const e=new r6,t=e.pack(n);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class t6{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let r=0,s="",i,o;for(;r<e;)i=t[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|t[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(t[r+1]&63)<<6|t[r+2]&63,r+=3):(o=(i&7)<<18|(t[r+1]&63)<<12|(t[r+2]&63)<<6|t[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){const t={};for(let r=0;r<e;r++){const s=this.unpack();t[s]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(t===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+t*2**(s-52);return(r===0?1:-1)*o}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class r6{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const r=s=>{if(s<t){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,a=t<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<t.length){const o=t[i];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new J8,this._textEncoder=new TextEncoder}}let Td=!0,Rd=!0;function Ri(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseInt(r[t],10)}function nn(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return s.apply(this,arguments);const c=l=>{const u=t(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(a))return i.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function n6(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Td=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function s6(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Rd=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function Fd(){if(typeof window=="object"){if(Td)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Uc(n,e){Rd&&console.warn(n+" is deprecated, please use "+e+" instead.")}function i6(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=Ri(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=Ri(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Ri(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function Cl(n){return Object.prototype.toString.call(n)==="[object Object]"}function Ld(n){return Cl(n)?Object.keys(n).reduce(function(e,t){const r=Cl(n[t]),s=r?Ld(n[t]):n[t],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[t]:s})},{}):n}function N0(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?N0(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(s=>{N0(n,n.get(s),t)})}))}function _l(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{n.forEach(a=>{a.type===r&&a.trackId===o.id&&N0(n,a,s)})}),s}const Sl=Fd;function Nd(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(h,g){return h?h+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(u.ideal!==void 0){c.optional=c.optional||[];let h={};typeof u.ideal=="number"?(h[d("min",l)]=u.ideal,c.optional.push(h),h={},h[d("max",l)]=u.ideal,c.optional.push(h)):(h[d("",l)]=u.ideal,c.optional.push(h))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(h=>{u[h]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(h,l)]=u[h])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},s=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,h){d in u&&!(h in u)&&(u[h]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(h=>{h=h.filter(p=>p.kind==="videoinput");let g=h.find(p=>d.some(m=>p.label.toLowerCase().includes(m)));return!g&&h.length&&d.includes("back")&&(g=h[h.length-1]),g&&(a.video.deviceId=l.exact?{exact:g.deviceId}:{ideal:g.deviceId}),a.video=r(a.video),Sl("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return Sl("chrome: "+JSON.stringify(a)),c(a)},i=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){s(a,u=>{t.webkitGetUserMedia(u,c,d=>{l&&l(i(d))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return s(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function Md(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function Od(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;n.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;n.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else nn(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Ud(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){let l=s.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){i.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],t.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function $d(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>_l(o,i.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(i=>i._pc=this),s}),nn(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>_l(i,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(a=>{a.track===r&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===r&&(i?o=!0:i=a),a.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Hd(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function zd(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Hd(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new n.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}r.apply(this,[u])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const h=[].slice.call(arguments,1);if(h.length!==1||!h[0].getTracks().find(m=>m===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(m=>m.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[d.id];if(p)p.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const m=new n.MediaStream([u]);this._streams[d.id]=m,this._reverseStreams[m.id]=d,this.addStream(m)}return this.getSenders().find(m=>m.track===u)};function i(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const g=l._reverseStreams[h],p=l._streams[g.id];d=d.replace(new RegExp(p.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(h=>{const g=l._reverseStreams[h],p=l._streams[g.id];d=d.replace(new RegExp(g.id,"g"),p.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=n.RTCPeerConnection.prototype[l],d={[l](){const h=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[p=>{const m=i(this,p);h[0].apply(null,[m])},p=>{h[1]&&h[1].apply(null,p)},arguments[2]]):u.apply(this,arguments).then(p=>i(this,p))}};n.RTCPeerConnection.prototype[l]=d[l]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:i(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let h;Object.keys(this._streams).forEach(g=>{this._streams[g].getTracks().find(m=>u.track===m)&&(h=this._streams[g])}),h&&(h.getTracks().length===1?this.removeStream(this._reverseStreams[h.id]):h.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function M0(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=s[t]})}function qd(n,e){nn(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}const Al=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:qd,shimAddTrackRemoveTrack:zd,shimAddTrackRemoveTrackWithNative:Hd,shimGetSendersWithDtmf:Ud,shimGetUserMedia:Nd,shimMediaStream:Md,shimOnTrack:Od,shimPeerConnection:M0,shimSenderReceiverGetStats:$d},Symbol.toStringTag,{value:"Module"}));function Vd(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(s,i,o){Uc("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const s=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function o6(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function Kd(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function O0(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=n.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=o[s]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,o,a]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(o,a)}}function jd(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Gd(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),nn(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Wd(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){Uc("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Qd(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function Yd(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function Zd(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Xd(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Jd(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const kl=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Yd,shimCreateAnswer:Jd,shimCreateOffer:Xd,shimGetDisplayMedia:o6,shimGetParameters:Zd,shimGetUserMedia:Vd,shimOnTrack:Kd,shimPeerConnection:O0,shimRTCDataChannel:Qd,shimReceiverGetStats:Gd,shimRemoveStream:Wd,shimSenderGetStats:jd},Symbol.toStringTag,{value:"Module"}));function eh(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const s=t.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function th(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function rh(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=t.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],h=r.apply(this,[d]);return u?(h.then(l,u),Promise.resolve()):h};let a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=i.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function nh(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=s=>r(sh(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function sh(n){return n&&n.video!==void 0?Object.assign({},n,{video:Ld(n.video)}):n}function ih(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(Uc("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function oh(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function ah(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function ch(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const Bl=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:ch,shimCallbacksAPI:rh,shimConstraints:sh,shimCreateOfferLegacy:ah,shimGetUserMedia:nh,shimLocalStreamsAPI:eh,shimRTCIceServerUrls:ih,shimRemoteStreamsAPI:th,shimTrackEventTransceiver:oh},Symbol.toStringTag,{value:"Module"}));var J=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function a6(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var lh={exports:{}};(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const s=t.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const i=t.type;return r.push("typ"),r.push(i),i!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const s=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let s;const i=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(t){let r="",s=t.payloadType;if(t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const i=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?i.push(o+"="+t.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",s=t.payloadType;return t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),s={ssrc:parseInt(t.substring(7,r),10)},i=t.indexOf(":",r);return i>-1?(s.attribute=t.substring(r+1,i),s.value=t.substring(i+1)):s.attribute=t.substring(r+1),s},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let s="a=setup:"+r+`\r
`;return t.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const s=e.matchPrefix(t+r,"a=ice-ufrag:")[0],i=e.matchPrefix(t+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(t)[0].split(" ");r.profile=i[2];for(let a=3;a<i.length;a++){const c=i[a],l=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(t,r){let s="";s+="m="+t+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(t){const r=[],s=e.parseRtpParameters(t),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(p=>parseInt(p,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),s.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let g={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&l&&(g.rtx={ssrc:l}),r.push(g),i&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(g))}}),r.length===0&&c&&r.push({ssrc:c});let d=e.matchPrefix(t,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,r.forEach(h=>{h.maxBitrate=d})),r},e.parseRtcpParameters=function(t){const r={},s=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(t,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const s=e.matchPrefix(t,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),s=e.matchPrefix(t,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(t,r){let s=[];return t.protocol!=="DTLS/SCTP"?s=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,s){let i;const o=r!==void 0?r:2;return t?i=t:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const s=e.splitLines(t);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const s=e.splitLines(t)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(t){const s=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},n.exports=e})(lh);var uh=lh.exports;const En=Gn(uh),c6=Q8({__proto__:null,default:En},[uh]);function Fi(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=En.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,nn(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function U0(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||nn(n,"icecandidate",e=>{if(e.candidate){const t=En.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Li(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const c=En.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=En.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},s=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=En.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=r(arguments[0]),l=s(c),u=i(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const h={};Object.defineProperty(h,"maxMessageSize",{get(){return d}}),this._sctp=h}return o.apply(this,arguments)}}function Ni(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=t.apply(this,arguments);return e(s,this),s},nn(n,"datachannel",r=>(e(r.channel,r.target),r))}function $0(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function H0(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return t.apply(this,arguments)}}function Mi(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Oi(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return t.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?t.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}const l6=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:H0,shimAddIceCandidateNullOrEmpty:Mi,shimConnectionState:$0,shimMaxMessageSize:Li,shimParameterlessSetLocalDescription:Oi,shimRTCIceCandidate:Fi,shimRTCIceCandidateRelayProtocol:U0,shimSendThrowTypeError:Ni},Symbol.toStringTag,{value:"Module"}));function u6({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=Fd,r=i6(n),s={browserDetails:r,commonShim:l6,extractVersion:Ri,disableLog:n6,disableWarnings:s6,sdp:c6};switch(r.browser){case"chrome":if(!Al||!M0||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=Al,Mi(n,r),Oi(n),Nd(n,r),Md(n),M0(n,r),Od(n),zd(n,r),Ud(n),$d(n),qd(n,r),Fi(n),U0(n),$0(n),Li(n,r),Ni(n),H0(n,r);break;case"firefox":if(!kl||!O0||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=kl,Mi(n,r),Oi(n),Vd(n,r),O0(n,r),Kd(n),Wd(n),jd(n),Gd(n),Qd(n),Yd(n),Zd(n),Xd(n),Jd(n),Fi(n),$0(n),Li(n,r),Ni(n);break;case"safari":if(!Bl||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=Bl,Mi(n,r),Oi(n),ih(n),ah(n),rh(n),eh(n),th(n),oh(n),nh(n),ch(n),Fi(n),U0(n),Li(n,r),Ni(n),H0(n,r);break;default:t("Unsupported browser!");break}return s}const Dl=u6({window:typeof window>"u"?void 0:window});function sn(n,e,t,r){Object.defineProperty(n,e,{get:t,set:r,enumerable:!0,configurable:!0})}class dh{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),l={__peerData:this._dataCount,n:i,data:c,total:s};t.push(l),o=a,i++}return this._dataCount++,t}}}function d6(n){let e=0;for(const s of n)e+=s.byteLength;const t=new Uint8Array(e);let r=0;for(const s of n)t.set(s,r),r+=s.byteLength;return t}const la=Dl.default||Dl,is=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const n=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(n)?n==="chrome"?e>=this.minChromeVersion:n==="firefox"?e>=this.minFirefoxVersion:n==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return la.browserDetails.browser}getVersion(){return la.browserDetails.version||0}isUnifiedPlanSupported(){const n=this.getBrowser(),e=la.browserDetails.version||0;if(n==="chrome"&&e<this.minChromeVersion)return!1;if(n==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,r=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),r=!0}catch{}finally{t&&t.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},h6=n=>!n||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(n),hh=()=>Math.random().toString(36).slice(2),Il={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class f6 extends dh{noop(){}blobToArrayBuffer(e,t){const r=new FileReader;return r.onload=function(s){s.target&&t(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=Il,this.browser=is.getBrowser(),this.browserVersion=is.getVersion(),this.pack=Pd,this.unpack=Id,this.supports=function(){const t={browser:is.isBrowserSupported(),webRTC:is.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let r;try{r=new RTCPeerConnection(Il),t.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!s.ordered;try{s.binaryType="blob",t.binaryBlob=!is.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return t}(),this.validateId=h6,this.randomToken=hh}}const ct=new f6,p6="PeerJS: ";var Pl;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(Pl||(Pl={}));class g6{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const r=[p6,...t];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var V=new g6,$c={},m6=Object.prototype.hasOwnProperty,st="~";function Cs(){}Object.create&&(Cs.prototype=Object.create(null),new Cs().__proto__||(st=!1));function y6(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function fh(n,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new y6(t,r||n,s),o=st?st+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],i]:n._events[o].push(i):(n._events[o]=i,n._eventsCount++),n}function Ui(n,e){--n._eventsCount===0?n._events=new Cs:delete n._events[e]}function Ze(){this._events=new Cs,this._eventsCount=0}Ze.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)m6.call(t,r)&&e.push(st?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Ze.prototype.listeners=function(e){var t=st?st+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};Ze.prototype.listenerCount=function(e){var t=st?st+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Ze.prototype.emit=function(e,t,r,s,i,o){var a=st?st+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,d;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,s),!0;case 5:return c.fn.call(c.context,t,r,s,i),!0;case 6:return c.fn.call(c.context,t,r,s,i,o),!0}for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c.fn.apply(c.context,u)}else{var h=c.length,g;for(d=0;d<h;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),l){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,r);break;case 4:c[d].fn.call(c[d].context,t,r,s);break;default:if(!u)for(g=1,u=new Array(l-1);g<l;g++)u[g-1]=arguments[g];c[d].fn.apply(c[d].context,u)}}return!0};Ze.prototype.on=function(e,t,r){return fh(this,e,t,r,!1)};Ze.prototype.once=function(e,t,r){return fh(this,e,t,r,!0)};Ze.prototype.removeListener=function(e,t,r,s){var i=st?st+e:e;if(!this._events[i])return this;if(!t)return Ui(this,i),this;var o=this._events[i];if(o.fn)o.fn===t&&(!s||o.once)&&(!r||o.context===r)&&Ui(this,i);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==t||s&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[i]=c.length===1?c[0]:c:Ui(this,i)}return this};Ze.prototype.removeAllListeners=function(e){var t;return e?(t=st?st+e:e,this._events[t]&&Ui(this,t)):(this._events=new Cs,this._eventsCount=0),this};Ze.prototype.off=Ze.prototype.removeListener;Ze.prototype.addListener=Ze.prototype.on;Ze.prefixed=st;Ze.EventEmitter=Ze;$c=Ze;var on={};sn(on,"ConnectionType",()=>Gt);sn(on,"PeerErrorType",()=>ke);sn(on,"BaseConnectionErrorType",()=>_s);sn(on,"DataConnectionErrorType",()=>Ss);sn(on,"SerializationType",()=>Tn);sn(on,"SocketEventType",()=>jt);sn(on,"ServerMessageType",()=>Le);var Gt;(function(n){n.Data="data",n.Media="media"})(Gt||(Gt={}));var ke;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(ke||(ke={}));var _s;(function(n){n.NegotiationFailed="negotiation-failed",n.ConnectionClosed="connection-closed"})(_s||(_s={}));var Ss;(function(n){n.NotOpenYet="not-open-yet",n.MessageToBig="message-too-big"})(Ss||(Ss={}));var Tn;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json",n.None="raw"})(Tn||(Tn={}));var jt;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(jt||(jt={}));var Le;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(Le||(Le={}));var Hc={};Hc=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class x6 extends $c.EventEmitter{constructor(e,t,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+t+":"+r+s+"peerjs?key="+i}start(e,t){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+Hc.version),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),V.log("Server message received:",i)}catch{V.log("Invalid server message",s.data);return}this.emit(jt.Message,i)},this._socket.onclose=s=>{this._disconnected||(V.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(jt.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),V.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){V.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:Le.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(jt.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class ph{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===Gt.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=t.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){V.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;V.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(V.log(`Received ICE candidates for ${t}:`,o.candidate),i.socket.send({type:Le.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":V.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(_s.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":V.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(_s.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":V.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},V.log("Listening for data channel"),e.ondatachannel=o=>{V.log("Received data channel");const a=o.channel;i.getConnection(t,r)._initializeDataChannel(a)},V.log("Listening for remote stream"),e.ontrack=o=>{V.log("Received remote stream");const a=o.streams[0],c=i.getConnection(t,r);if(c.type===Gt.Media){const l=c;this._addStreamToMediaConnection(a,l)}}}cleanup(){V.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(t||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);V.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),V.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Gt.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}t.socket.send({type:Le.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(ke.WebRTC,s),V.log("Failed to setLocalDescription, ",s))}}catch(r){t.emitError(ke.WebRTC,r),V.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createAnswer();V.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),V.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:Le.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){t.emitError(ke.WebRTC,s),V.log("Failed to setLocalDescription, ",s)}}catch(r){t.emitError(ke.WebRTC,r),V.log("Failed to create answer, ",r)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const r=this.connection.peerConnection,s=this.connection.provider;V.log("Setting remote description",t);const i=this;try{await r.setRemoteDescription(t),V.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(ke.WebRTC,o),V.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){V.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),V.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(ke.WebRTC,t),V.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(V.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return V.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){V.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class gh extends $c.EventEmitter{emitError(e,t){V.error("Error:",t),this.emit("error",new b6(`${e}`,t))}}class b6 extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class mh extends gh{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}var Fc;const bs=class bs extends mh{get type(){return Gt.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||bs.ID_PREFIX+ct.randomToken(),this._negotiator=new ph(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{V.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{V.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){V.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,r=e.payload;switch(e.type){case Le.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case Le.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:V.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){V.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Fc=new WeakMap,ae(bs,Fc,bs.ID_PREFIX="mc_");let ro=bs;class v6{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,a=new URL(`${t}://${r}:${s}${i}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",Hc.version),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){V.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==ct.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===ct.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw V.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var Lc,Nc;const zr=class zr extends mh{get type(){return Gt.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||zr.ID_PREFIX+hh(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new ph(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{V.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{V.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{V.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(Ss.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case Le.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case Le.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:V.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};Lc=new WeakMap,Nc=new WeakMap,ae(zr,Lc,zr.ID_PREFIX="dc_"),ae(zr,Nc,zr.MAX_BUFFERED_AMOUNT=8388608);let no=zr;class zc extends no{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>no.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return V.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class ua extends zc{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new dh,this.serialization=Tn.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=Id(e),r=t.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];const s=d6(r.data);this._handleDataMessage({data:s})}}_send(e,t){const r=Pd(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);V.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const r of t)this.send(r,!0)}}class w6 extends zc{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Tn.None}}class E6 extends zc{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=ct.chunkedMTU){this.emitError(Ss.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=Tn.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Mc;const vs=class vs extends gh{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:w6,json:E6,binary:ua,"binary-utf8":ua,default:ua},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:ct.CLOUD_HOST,port:ct.CLOUD_PORT,path:"/",key:vs.DEFAULT_KEY,token:ct.randomToken(),config:ct.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==ct.CLOUD_HOST?this._options.secure=ct.isSecure():this._options.host==ct.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&V.setLogFunction(this._options.logFunction),V.logLevel=this._options.debug||0,this._api=new v6(t),this._socket=this._createServerConnection(),!ct.supports.audioVideo&&!ct.supports.data){this._delayedAbort(ke.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!ct.validateId(r)){this._delayedAbort(ke.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(ke.ServerError,s))}_createServerConnection(){const e=new x6(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(jt.Message,t=>{this._handleMessage(t)}),e.on(jt.Error,t=>{this._abort(ke.SocketError,t)}),e.on(jt.Disconnected,()=>{this.disconnected||(this.emitError(ke.Network,"Lost connection to server."),this.disconnect())}),e.on(jt.Close,()=>{this.disconnected||this._abort(ke.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,r=e.payload,s=e.src;switch(t){case Le.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Le.Error:this._abort(ke.ServerError,r.msg);break;case Le.IdTaken:this._abort(ke.UnavailableID,`ID "${this.id}" is taken`);break;case Le.InvalidKey:this._abort(ke.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case Le.Leave:V.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case Le.Expire:this.emitError(ke.PeerUnavailable,`Could not connect to peer ${s}`);break;case Le.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),V.warn(`Offer received for existing Connection ID:${i}`)),r.type===Gt.Media){const c=new ro(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===Gt.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{V.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(i);for(const c of a)o.handleMessage(c);break}default:{if(!r){V.warn(`You received a malformed message from ${s} of type ${t}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):V.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){V.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(ke.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){V.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(ke.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){V.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new ro(e,this,{...r,_stream:t});return this._addConnection(e,s),s}_addConnection(e,t){V.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const r=t.indexOf(e);r!==-1&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===t)return s;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){V.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(V.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const r of t)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;V.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)V.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)V.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(ke.ServerError,t))}};Mc=new WeakMap,ae(vs,Mc,vs.DEFAULT_KEY="peerjs");let z0=vs;var Tl=z0;const C6=Symbol.for("@libp2p/connection"),q0=Symbol.for("@libp2p/content-routing"),V0=Symbol.for("@libp2p/peer-discovery"),qc=Symbol.for("@libp2p/peer-id");function yh(n){return!!(n!=null&&n[qc])}const K0=Symbol.for("@libp2p/peer-routing"),Vc="keep-alive";var As;(function(n){n[n.FATAL_ALL=0]="FATAL_ALL",n[n.NO_FATAL=1]="NO_FATAL"})(As||(As={}));var T0;let ks=(T0=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},f(T0,"name","AbortError"),T0);class ee extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}f(ee,"name","InvalidParametersError");class Bs extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}f(Bs,"name","InvalidPublicKeyError");class xh extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}f(xh,"name","ConnectionClosingError");class Kc extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}f(Kc,"name","ConnectionClosedError");var R0;let Ir=(R0=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},f(R0,"name","NotFoundError"),R0);class jc extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}f(jc,"name","InvalidPeerIdError");class Fo extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}f(Fo,"name","InvalidMultiaddrError");class bh extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}f(bh,"name","InvalidCIDError");class vh extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}f(vh,"name","InvalidMultihashError");class Gc extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}f(Gc,"name","UnsupportedProtocolError");class or extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}f(or,"name","InvalidMessageError");var F0;let _6=(F0=class extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}},f(F0,"name","TimeoutError"),F0);class Ds extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}f(Ds,"name","NotStartedError");class $i extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}f($i,"name","DialError");class Wc extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}f(Wc,"name","LimitedConnectionError");class wh extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}f(wh,"name","TooManyInboundProtocolStreamsError");class Eh extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}f(Eh,"name","TooManyOutboundProtocolStreamsError");class Lo extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}f(Lo,"name","UnsupportedKeyTypeError");var Vt;class ar extends EventTarget{constructor(){super();ae(this,Vt,new Map)}listenerCount(t){const r=z(this,Vt).get(t);return r==null?0:r.length}addEventListener(t,r,s){super.addEventListener(t,r,s);let i=z(this,Vt).get(t);i==null&&(i=[],z(this,Vt).set(t,i)),i.push({callback:r,once:(s!==!0&&s!==!1&&(s==null?void 0:s.once))??!1})}removeEventListener(t,r,s){super.removeEventListener(t.toString(),r??null,s);let i=z(this,Vt).get(t);i!=null&&(i=i.filter(({callback:o})=>o!==r),z(this,Vt).set(t,i))}dispatchEvent(t){const r=super.dispatchEvent(t);let s=z(this,Vt).get(t.type);return s==null||(s=s.filter(({once:i})=>!i),z(this,Vt).set(t.type,s)),r}safeDispatchEvent(t,r={}){return this.dispatchEvent(new CustomEvent(t,r))}}Vt=new WeakMap;function Qc(n){return n!=null&&typeof n.start=="function"&&typeof n.stop=="function"}async function so(...n){const e=[];for(const t of n)Qc(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function Yc(...n){const e=[];for(const t of n)Qc(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const io=Symbol.for("@libp2p/service-capabilities"),j0=Symbol.for("@libp2p/service-dependencies");function S6(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}function No(n){if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")}function A6(n){return new TextEncoder().encode(n)}function k6(n){return new TextDecoder().decode(n)}function B6(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<n.length;s++){var i=n.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=n.length,c=n.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var m=0,y=0,w=0,v=p.length;w!==v&&p[w]===0;)w++,m++;for(var b=(v-w)*u+1>>>0,x=new Uint8Array(b);w!==v;){for(var E=p[w],C=0,_=b-1;(E!==0||C<y)&&_!==-1;_--,C++)E+=256*x[_]>>>0,x[_]=E%a>>>0,E=E/a>>>0;if(E!==0)throw new Error("Non-zero carry");y=C,w++}for(var A=b-y;A!==b&&x[A]===0;)A++;for(var R=c.repeat(m);A<b;++A)R+=n.charAt(x[A]);return R}function h(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var m=0;if(p[m]!==" "){for(var y=0,w=0;p[m]===c;)y++,m++;for(var v=(p.length-m)*l+1>>>0,b=new Uint8Array(v);p[m];){var x=t[p.charCodeAt(m)];if(x===255)return;for(var E=0,C=v-1;(x!==0||E<w)&&C!==-1;C--,E++)x+=a*b[C]>>>0,b[C]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");w=E,m++}if(p[m]!==" "){for(var _=v-w;_!==v&&b[_]===0;)_++;for(var A=new Uint8Array(y+(v-_)),R=y;_!==v;)A[R++]=b[_++];return A}}}function g(p){var m=h(p);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:h,decode:g}}var D6=B6,I6=D6;class P6{constructor(e,t,r){f(this,"name");f(this,"prefix");f(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class T6{constructor(e,t,r){f(this,"name");f(this,"prefix");f(this,"baseDecode");f(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ch(this,e)}}class R6{constructor(e){f(this,"decoders");this.decoders=e}or(e){return Ch(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r!=null)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function Ch(n,e){return new R6({...n.decoders??{[n.prefix]:n},...e.decoders??{[e.prefix]:e}})}class F6{constructor(e,t,r,s){f(this,"name");f(this,"prefix");f(this,"baseEncode");f(this,"baseDecode");f(this,"encoder");f(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new P6(e,t,r),this.decoder=new T6(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function Mo({name:n,prefix:e,encode:t,decode:r}){return new F6(n,e,t,r)}function Js({name:n,prefix:e,alphabet:t}){const{encode:r,decode:s}=I6(t,n);return Mo({prefix:e,name:n,encode:r,decode:i=>No(s(i))})}function L6(n,e,t,r){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=n.length;for(;n[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[n[u]];if(d===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function N6(n,e,t){const r=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<n.length;++c)for(a=a<<8|n[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),r)for(;i.length*t&7;)i+="=";return i}function qe({name:n,prefix:e,bitsPerChar:t,alphabet:r}){return Mo({prefix:e,name:n,encode(s){return N6(s,r,t)},decode(s){return L6(s,r,t,n)}})}const Ce=Js({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),M6=Js({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),O6=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ce,base58flickr:M6},Symbol.toStringTag,{value:"Module"})),sr=qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),U6=qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$6=qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),H6=qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),z6=qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),q6=qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),V6=qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),K6=qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),j6=qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),G6=Object.freeze(Object.defineProperty({__proto__:null,base32:sr,base32hex:z6,base32hexpad:V6,base32hexpadupper:K6,base32hexupper:q6,base32pad:$6,base32padupper:H6,base32upper:U6,base32z:j6},Symbol.toStringTag,{value:"Module"})),Hi=Js({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),W6=Js({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Q6=Object.freeze(Object.defineProperty({__proto__:null,base36:Hi,base36upper:W6},Symbol.toStringTag,{value:"Module"}));var Y6=_h,Rl=128,Z6=-128,X6=Math.pow(2,31);function _h(n,e,t){e=e||[],t=t||0;for(var r=t;n>=X6;)e[t++]=n&255|Rl,n/=128;for(;n&Z6;)e[t++]=n&255|Rl,n>>>=7;return e[t]=n|0,_h.bytes=t-r+1,e}var J6=G0,e5=128,Fl=127;function G0(n,r){var t=0,r=r||0,s=0,i=r,o,a=n.length;do{if(i>=a)throw G0.bytes=0,new RangeError("Could not decode varint");o=n[i++],t+=s<28?(o&Fl)<<s:(o&Fl)*Math.pow(2,s),s+=7}while(o>=e5);return G0.bytes=i-r,t}var t5=Math.pow(2,7),r5=Math.pow(2,14),n5=Math.pow(2,21),s5=Math.pow(2,28),i5=Math.pow(2,35),o5=Math.pow(2,42),a5=Math.pow(2,49),c5=Math.pow(2,56),l5=Math.pow(2,63),u5=function(n){return n<t5?1:n<r5?2:n<n5?3:n<s5?4:n<i5?5:n<o5?6:n<a5?7:n<c5?8:n<l5?9:10},d5={encode:Y6,decode:J6,encodingLength:u5},oo=d5;function W0(n,e=0){return[oo.decode(n,e),oo.decode.bytes]}function ao(n,e,t=0){return oo.encode(n,e,t),e}function co(n){return oo.encodingLength(n)}function Yr(n,e){const t=e.byteLength,r=co(n),s=r+co(t),i=new Uint8Array(s+t);return ao(n,i,0),ao(t,i,r),i.set(e,s),new Zc(n,t,e,i)}function ft(n){const e=No(n),[t,r]=W0(e),[s,i]=W0(e.subarray(r)),o=e.subarray(r+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Zc(t,s,o,e)}function h5(n,e){if(n===e)return!0;{const t=e;return n.code===t.code&&n.size===t.size&&t.bytes instanceof Uint8Array&&S6(n.bytes,t.bytes)}}class Zc{constructor(e,t,r,s){f(this,"code");f(this,"size");f(this,"digest");f(this,"bytes");this.code=e,this.size=t,this.digest=r,this.bytes=s}}function Ll(n,e){const{bytes:t,version:r}=n;switch(r){case 0:return p5(t,Q0(n),e??Ce.encoder);default:return g5(t,Q0(n),e??sr.encoder)}}const Nl=new WeakMap;function Q0(n){const e=Nl.get(n);if(e==null){const t=new Map;return Nl.set(n,t),t}return e}var ed;class se{constructor(e,t,r,s){f(this,"code");f(this,"version");f(this,"multihash");f(this,"bytes");f(this,"/");f(this,ed,"CID");this.code=t,this.version=e,this.multihash=r,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==os)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==m5)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return se.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Yr(e,t);return se.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return se.equals(this,e)}static equals(e,t){const r=t;return r!=null&&e.code===r.code&&e.version===r.version&&h5(e.multihash,r.multihash)}toString(e){return Ll(this,e)}toJSON(){return{"/":Ll(this)}}link(){return this}[(ed=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof se)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:r,code:s,multihash:i,bytes:o}=t;return new se(r,s,i,o??Ml(r,s,i.bytes))}else if(t[y5]===!0){const{version:r,multihash:s,code:i}=t,o=ft(s);return se.create(r,i,o)}else return null}static create(e,t,r){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==os)throw new Error(`Version 0 CID must use dag-pb (code: ${os}) block encoding`);return new se(e,t,r,r.bytes)}case 1:{const s=Ml(e,t,r.bytes);return new se(e,t,r,s)}default:throw new Error("Invalid version")}}static createV0(e){return se.create(0,os,e)}static createV1(e,t){return se.create(1,e,t)}static decode(e){const[t,r]=se.decodeFirst(e);if(r.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=se.inspectBytes(e),r=t.size-t.multihashSize,s=No(e.subarray(r,r+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new Zc(t.multihashCode,t.digestSize,i,s);return[t.version===0?se.createV0(o):se.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[d,h]=W0(e.subarray(t));return t+=h,d};let s=r(),i=os;if(s===18?(s=0,t=0):i=r(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=r(),c=r(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[r,s]=f5(e,t),i=se.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Q0(i).set(r,e),i}}function f5(n,e){switch(n[0]){case"Q":{const t=e??Ce;return[Ce.prefix,t.decode(`${Ce.prefix}${n}`)]}case Ce.prefix:{const t=e??Ce;return[Ce.prefix,t.decode(n)]}case sr.prefix:{const t=e??sr;return[sr.prefix,t.decode(n)]}case Hi.prefix:{const t=e??Hi;return[Hi.prefix,t.decode(n)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[n[0],e.decode(n)]}}}function p5(n,e,t){const{prefix:r}=t;if(r!==Ce.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(r);if(s==null){const i=t.encode(n).slice(1);return e.set(r,i),i}else return s}function g5(n,e,t){const{prefix:r}=t,s=e.get(r);if(s==null){const i=t.encode(n);return e.set(r,i),i}else return s}const os=112,m5=18;function Ml(n,e,t){const r=co(n),s=r+co(e),i=new Uint8Array(s+t.byteLength);return ao(n,i,0),ao(e,i,r),i.set(t,s),i}const y5=Symbol.for("@ipld/js-cid/CID"),Sh=0,x5="identity",Ah=No;function b5(n){return Yr(Sh,Ah(n))}const Lt={code:Sh,name:x5,encode:Ah,digest:b5};function de(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}function Te(n=0){return new Uint8Array(n)}function Qt(n=0){return new Uint8Array(n)}function Dt(n,e){e==null&&(e=n.reduce((s,i)=>s+i.length,0));const t=Qt(e);let r=0;for(const s of n)t.set(s,r),r+=s.length;return t}const kh=Symbol.for("@achingbrain/uint8arraylist");function Ol(n,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const r of n){const s=t+r.byteLength;if(e<s)return{buf:r,index:e-t};t=s}throw new RangeError("index is out of bounds")}function gi(n){return!!(n!=null&&n[kh])}var td;class Ie{constructor(...e){f(this,"bufs");f(this,"length");f(this,td,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(td=kh,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else if(gi(r))t+=r.byteLength,this.bufs.push(...r.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else if(gi(r))t+=r.byteLength,this.bufs.unshift(...r.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=Ol(this.bufs,e);return t.buf[t.index]}set(e,t){const r=Ol(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else if(gi(e))for(let r=0;r<e.length;r++)this.set(t+r,e.get(r));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:r,length:s}=this._subList(e,t);return Dt(r,s)}subarray(e,t){const{bufs:r,length:s}=this._subList(e,t);return r.length===1?r[0]:Dt(r,s)}sublist(e,t){const{bufs:r,length:s}=this._subList(e,t),i=new Ie;return i.length=s,i.bufs=[...r],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const r=[];let s=0;for(let i=0;i<this.bufs.length;i++){const o=this.bufs[i],a=s,c=a+o.byteLength;if(s=c,e>=c)continue;const l=e>=a&&e<c,u=t>a&&t<=c;if(l&&u){if(e===a&&t===c){r.push(o);break}const d=e-a;r.push(o.subarray(d,d+(t-e)));break}if(l){if(e===0){r.push(o);continue}r.push(o.subarray(e-a));continue}if(u){if(t===c){r.push(o);break}r.push(o.subarray(0,t-a));break}r.push(o)}return{bufs:r,length:t-e}}indexOf(e,t=0){if(!gi(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const r=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const s=r.byteLength;if(s===0)throw new TypeError("search must be at least 1 byte long");const i=256,o=new Int32Array(i);for(let d=0;d<i;d++)o[d]=-1;for(let d=0;d<s;d++)o[r[d]]=d;const a=o,c=this.byteLength-r.byteLength,l=r.byteLength-1;let u;for(let d=t;d<=c;d+=u){u=0;for(let h=l;h>=0;h--){const g=this.get(d+h);if(r[h]!==g){u=Math.max(1,h-a[g]);break}}if(u===0)return d}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const r=Qt(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){const s=Te(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,t,r),this.write(s,e)}getInt32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){const s=Te(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,t,r),this.write(s,e)}getBigInt64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){const s=Te(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,t,r),this.write(s,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const r=Qt(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){const s=Te(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,t,r),this.write(s,e)}getUint32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){const s=Te(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,t,r),this.write(s,e)}getBigUint64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){const s=Te(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,t,r),this.write(s,e)}getFloat32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){const s=Te(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,t,r),this.write(s,e)}getFloat64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){const s=Te(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,t,r),this.write(s,e)}equals(e){if(e==null||!(e instanceof Ie)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!de(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const r=new Ie;return r.bufs=e,t==null&&(t=e.reduce((s,i)=>s+i.byteLength,0)),r.length=t,r}}const v5=Js({prefix:"9",name:"base10",alphabet:"0123456789"}),w5=Object.freeze(Object.defineProperty({__proto__:null,base10:v5},Symbol.toStringTag,{value:"Module"})),E5=qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),C5=qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),_5=Object.freeze(Object.defineProperty({__proto__:null,base16:E5,base16upper:C5},Symbol.toStringTag,{value:"Module"})),S5=qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),A5=Object.freeze(Object.defineProperty({__proto__:null,base2:S5},Symbol.toStringTag,{value:"Module"})),Bh=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),k5=Bh.reduce((n,e,t)=>(n[t]=e,n),[]),B5=Bh.reduce((n,e,t)=>{const r=e.codePointAt(0);if(r==null)throw new Error(`Invalid character: ${e}`);return n[r]=t,n},[]);function D5(n){return n.reduce((e,t)=>(e+=k5[t],e),"")}function I5(n){const e=[];for(const t of n){const r=t.codePointAt(0);if(r==null)throw new Error(`Invalid character: ${t}`);const s=B5[r];if(s==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const P5=Mo({prefix:"🚀",name:"base256emoji",encode:D5,decode:I5}),T5=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:P5},Symbol.toStringTag,{value:"Module"})),Xc=qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),R5=qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Dh=qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),F5=qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),L5=Object.freeze(Object.defineProperty({__proto__:null,base64:Xc,base64pad:R5,base64url:Dh,base64urlpad:F5},Symbol.toStringTag,{value:"Module"})),N5=qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),M5=Object.freeze(Object.defineProperty({__proto__:null,base8:N5},Symbol.toStringTag,{value:"Module"})),O5=Mo({prefix:"\0",name:"identity",encode:n=>k6(n),decode:n=>A6(n)}),U5=Object.freeze(Object.defineProperty({__proto__:null,identity:O5},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const $5=85;function H5({name:n,code:e,encode:t}){return new z5(n,e,t)}class z5{constructor(e,t,r){f(this,"name");f(this,"code");f(this,"encode");this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Yr(this.code,t):t.then(r=>Yr(this.code,r))}else throw Error("Unknown type, must be binary type")}}function q5(n){return async e=>new Uint8Array(await crypto.subtle.digest(n,e))}const at=H5({name:"sha2-256",code:18,encode:q5("SHA-256")}),Is={...U5,...A5,...M5,...w5,..._5,...G6,...Q6,...O6,...L5,...T5};function Ih(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}const Ul=Ih("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),da=Ih("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=Qt(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),Ph={utf8:Ul,"utf-8":Ul,hex:Is.base16,latin1:da,ascii:da,binary:da,...Is};function Y(n,e="utf8"){const t=Ph[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${n}`)}function Q(n,e="utf8"){const t=Ph[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(n).substring(1)}const V5=parseInt("11111",2),Y0=parseInt("10000000",2),K5=parseInt("01111111",2),$l={0:as,1:as,2:j5,3:Q5,4:Y5,5:W5,6:G5,16:as,22:as,48:as};function Oo(n,e={offset:0}){const t=n[e.offset]&V5;if(e.offset++,$l[t]!=null)return $l[t](n,e);throw new Error("No decoder for tag "+t)}function ei(n,e){let t=0;if((n[e.offset]&Y0)===Y0){const r=n[e.offset]&K5;let s="0x";e.offset++;for(let i=0;i<r;i++,e.offset++)s+=n[e.offset].toString(16).padStart(2,"0");t=parseInt(s,16)}else t=n[e.offset],e.offset++;return t}function as(n,e){ei(n,e);const t=[];for(;!(e.offset>=n.byteLength);){const r=Oo(n,e);if(r===null)break;t.push(r)}return t}function j5(n,e){const t=ei(n,e),r=e.offset,s=e.offset+t,i=[];for(let o=r;o<s;o++)o===r&&n[o]===0||i.push(n[o]);return e.offset+=t,Uint8Array.from(i)}function G5(n,e){const t=ei(n,e),r=e.offset+t,s=n[e.offset];e.offset++;let i=0,o=0;s<40?(i=0,o=s):s<80?(i=1,o=s-40):(i=2,o=s-80);let a=`${i}.${o}`,c=[];for(;e.offset<r;){const l=n[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let u=0;for(let d=0;d<c.length;d++)u+=c[d]<<d*7;a+=`.${u}`,c=[]}}return a}function W5(n,e){return e.offset++,null}function Q5(n,e){const t=ei(n,e),r=n[e.offset];e.offset++;const s=n.subarray(e.offset,e.offset+t-1);if(e.offset+=t,r!==0)throw new Error("Unused bits in bit string is unimplemented");return s}function Y5(n,e){const t=ei(n,e),r=n.subarray(e.offset,e.offset+t);return e.offset+=t,r}function Z5(n){let e=n.toString(16);e.length%2===1&&(e="0"+e);const t=new Ie;for(let r=0;r<e.length;r+=2)t.append(Uint8Array.from([parseInt(`${e[r]}${e[r+1]}`,16)]));return t}function Jc(n){if(n.byteLength<128)return Uint8Array.from([n.byteLength]);const e=Z5(n.byteLength);return new Ie(Uint8Array.from([e.byteLength|Y0]),e)}function Z0(n){const e=new Ie,t=128;return(n.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(n),new Ie(Uint8Array.from([2]),Jc(e),e)}function Th(n){const e=Uint8Array.from([0]),t=new Ie(e,n);return new Ie(Uint8Array.from([3]),Jc(t),t)}function hs(n,e=48){const t=new Ie;for(const r of n)t.append(r);return new Ie(Uint8Array.from([e]),Jc(t),t)}async function X5(n,e,t){const r=await crypto.subtle.importKey("jwk",n,{name:"ECDSA",namedCurve:n.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},r,e,t.subarray())}const J5=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),e7=Uint8Array.from([6,5,43,129,4,0,34]),t7=Uint8Array.from([6,5,43,129,4,0,35]),r7={ext:!0,kty:"EC",crv:"P-256"},n7={ext:!0,kty:"EC",crv:"P-384"},s7={ext:!0,kty:"EC",crv:"P-521"},ha=32,fa=48,pa=66;function Rh(n){const e=Oo(n);return i7(e)}function i7(n){const e=n[1][1][0],t=1;let r,s;if(e.byteLength===ha*2+1)return r=Q(e.subarray(t,t+ha),"base64url"),s=Q(e.subarray(t+ha),"base64url"),new ga({...r7,key_ops:["verify"],x:r,y:s});if(e.byteLength===fa*2+1)return r=Q(e.subarray(t,t+fa),"base64url"),s=Q(e.subarray(t+fa),"base64url"),new ga({...n7,key_ops:["verify"],x:r,y:s});if(e.byteLength===pa*2+1)return r=Q(e.subarray(t,t+pa),"base64url"),s=Q(e.subarray(t+pa),"base64url"),new ga({...s7,key_ops:["verify"],x:r,y:s});throw new ee(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function o7(n){return hs([Z0(Uint8Array.from([1])),hs([a7(n.crv)],160),hs([Th(new Ie(Uint8Array.from([4]),Y(n.x??"","base64url"),Y(n.y??"","base64url")))],161)]).subarray()}function a7(n){if(n==="P-256")return J5;if(n==="P-384")return e7;if(n==="P-521")return t7;throw new ee(`Invalid curve ${n}`)}class ga{constructor(e){f(this,"type","ECDSA");f(this,"jwk");f(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=o7(this.jwk)),this._raw}toMultihash(){return Lt.digest(Ar(this))}toCID(){return se.createV1(114,this.toMultihash())}toString(){return Ce.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:de(this.raw,e.raw)}async verify(e,t){return X5(this.jwk,t,e)}}const fn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function c7(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Cn(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function Wn(n,...e){if(!c7(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function Fh(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Cn(n.outputLen),Cn(n.blockLen)}function lo(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function l7(n,e){Wn(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Zr(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}function zi(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function Ut(n,e){return n<<32-e|n>>>e}const u7=async()=>{};async function d7(n,e,t){let r=Date.now();for(let s=0;s<n;s++){t(s);const i=Date.now()-r;i>=0&&i<e||(await u7(),r+=i)}}function Lh(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}function e1(n){return typeof n=="string"&&(n=Lh(n)),Wn(n),n}function Hl(n){return typeof n=="string"&&(n=Lh(n)),Wn(n),n}function h7(...n){let e=0;for(let r=0;r<n.length;r++){const s=n[r];Wn(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<n.length;r++){const i=n[r];t.set(i,s),s+=i.length}return t}function f7(n,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(n,e)}class Nh{}function Mh(n){const e=r=>n().update(e1(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function Uo(n=32){if(fn&&typeof fn.getRandomValues=="function")return fn.getRandomValues(new Uint8Array(n));if(fn&&typeof fn.randomBytes=="function")return Uint8Array.from(fn.randomBytes(n));throw new Error("crypto.getRandomValues must be defined")}function p7(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=r?4:0,l=r?0:4;n.setUint32(e+c,o,r),n.setUint32(e+l,a,r)}function g7(n,e,t){return n&e^~n&t}function m7(n,e,t){return n&e^n&t^e&t}class Oh extends Nh{constructor(e,t,r,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.buffer=new Uint8Array(e),this.view=zi(this.buffer)}update(e){lo(this),e=e1(e),Wn(e);const{view:t,buffer:r,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=zi(e);for(;s<=i-o;o+=s)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){lo(this),l7(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,Zr(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(r,0),o=0);for(let d=o;d<s;d++)t[d]=0;p7(r,s-8,BigInt(this.length*8),i),this.process(r,0);const a=zi(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const pr=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ve=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),mi=BigInt(2**32-1),zl=BigInt(32);function y7(n,e=!1){return e?{h:Number(n&mi),l:Number(n>>zl&mi)}:{h:Number(n>>zl&mi)|0,l:Number(n&mi)|0}}function x7(n,e=!1){const t=n.length;let r=new Uint32Array(t),s=new Uint32Array(t);for(let i=0;i<t;i++){const{h:o,l:a}=y7(n[i],e);[r[i],s[i]]=[o,a]}return[r,s]}const ql=(n,e,t)=>n>>>t,Vl=(n,e,t)=>n<<32-t|e>>>t,pn=(n,e,t)=>n>>>t|e<<32-t,gn=(n,e,t)=>n<<32-t|e>>>t,yi=(n,e,t)=>n<<64-t|e>>>t-32,xi=(n,e,t)=>n>>>t-32|e<<64-t;function Zt(n,e,t,r){const s=(e>>>0)+(r>>>0);return{h:n+t+(s/2**32|0)|0,l:s|0}}const b7=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),v7=(n,e,t,r)=>e+t+r+(n/2**32|0)|0,w7=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0),E7=(n,e,t,r,s)=>e+t+r+s+(n/2**32|0)|0,C7=(n,e,t,r,s)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(s>>>0),_7=(n,e,t,r,s,i)=>e+t+r+s+i+(n/2**32|0)|0,S7=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),gr=new Uint32Array(64);class A7 extends Oh{constructor(e=32){super(64,e,8,!1),this.A=pr[0]|0,this.B=pr[1]|0,this.C=pr[2]|0,this.D=pr[3]|0,this.E=pr[4]|0,this.F=pr[5]|0,this.G=pr[6]|0,this.H=pr[7]|0}get(){const{A:e,B:t,C:r,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,r,s,i,o,a,c]}set(e,t,r,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)gr[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const h=gr[d-15],g=gr[d-2],p=Ut(h,7)^Ut(h,18)^h>>>3,m=Ut(g,17)^Ut(g,19)^g>>>10;gr[d]=m+gr[d-7]+p+gr[d-16]|0}let{A:r,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){const h=Ut(a,6)^Ut(a,11)^Ut(a,25),g=u+h+g7(a,c,l)+S7[d]+gr[d]|0,m=(Ut(r,2)^Ut(r,13)^Ut(r,22))+m7(r,s,i)|0;u=l,l=c,c=a,a=o+g|0,o=i,i=s,s=r,r=g+m|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,s,i,o,a,c,l,u)}roundClean(){Zr(gr)}destroy(){this.set(0,0,0,0,0,0,0,0),Zr(this.buffer)}}const Uh=x7(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),k7=Uh[0],B7=Uh[1],mr=new Uint32Array(80),yr=new Uint32Array(80);class D7 extends Oh{constructor(e=64){super(128,e,16,!1),this.Ah=Ve[0]|0,this.Al=Ve[1]|0,this.Bh=Ve[2]|0,this.Bl=Ve[3]|0,this.Ch=Ve[4]|0,this.Cl=Ve[5]|0,this.Dh=Ve[6]|0,this.Dl=Ve[7]|0,this.Eh=Ve[8]|0,this.El=Ve[9]|0,this.Fh=Ve[10]|0,this.Fl=Ve[11]|0,this.Gh=Ve[12]|0,this.Gl=Ve[13]|0,this.Hh=Ve[14]|0,this.Hl=Ve[15]|0}get(){const{Ah:e,Al:t,Bh:r,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:h,Gh:g,Gl:p,Hh:m,Hl:y}=this;return[e,t,r,s,i,o,a,c,l,u,d,h,g,p,m,y]}set(e,t,r,s,i,o,a,c,l,u,d,h,g,p,m,y){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=h|0,this.Gh=g|0,this.Gl=p|0,this.Hh=m|0,this.Hl=y|0}process(e,t){for(let b=0;b<16;b++,t+=4)mr[b]=e.getUint32(t),yr[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const x=mr[b-15]|0,E=yr[b-15]|0,C=pn(x,E,1)^pn(x,E,8)^ql(x,E,7),_=gn(x,E,1)^gn(x,E,8)^Vl(x,E,7),A=mr[b-2]|0,R=yr[b-2]|0,S=pn(A,R,19)^yi(A,R,61)^ql(A,R,6),k=gn(A,R,19)^xi(A,R,61)^Vl(A,R,6),T=w7(_,k,yr[b-7],yr[b-16]),D=E7(T,C,S,mr[b-7],mr[b-16]);mr[b]=D|0,yr[b]=T|0}let{Ah:r,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:h,Fh:g,Fl:p,Gh:m,Gl:y,Hh:w,Hl:v}=this;for(let b=0;b<80;b++){const x=pn(d,h,14)^pn(d,h,18)^yi(d,h,41),E=gn(d,h,14)^gn(d,h,18)^xi(d,h,41),C=d&g^~d&m,_=h&p^~h&y,A=C7(v,E,_,B7[b],yr[b]),R=_7(A,w,x,C,k7[b],mr[b]),S=A|0,k=pn(r,s,28)^yi(r,s,34)^yi(r,s,39),T=gn(r,s,28)^xi(r,s,34)^xi(r,s,39),D=r&i^r&a^i&a,H=s&o^s&c^o&c;w=m|0,v=y|0,m=g|0,y=p|0,g=d|0,p=h|0,{h:d,l:h}=Zt(l|0,u|0,R|0,S|0),l=a|0,u=c|0,a=i|0,c=o|0,i=r|0,o=s|0;const N=b7(S,T,H);r=v7(N,R,k,D),s=N|0}({h:r,l:s}=Zt(this.Ah|0,this.Al|0,r|0,s|0)),{h:i,l:o}=Zt(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Zt(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Zt(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:h}=Zt(this.Eh|0,this.El|0,d|0,h|0),{h:g,l:p}=Zt(this.Fh|0,this.Fl|0,g|0,p|0),{h:m,l:y}=Zt(this.Gh|0,this.Gl|0,m|0,y|0),{h:w,l:v}=Zt(this.Hh|0,this.Hl|0,w|0,v|0),this.set(r,s,i,o,a,c,l,u,d,h,g,p,m,y,w,v)}roundClean(){Zr(mr,yr)}destroy(){Zr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const $h=Mh(()=>new A7),Hh=Mh(()=>new D7);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const t1=BigInt(0),X0=BigInt(1);function ti(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function r1(n){if(!ti(n))throw new Error("Uint8Array expected")}function Sr(n,e){if(typeof e!="boolean")throw new Error(n+" boolean expected, got "+e)}function bi(n){const e=n.toString(16);return e.length&1?"0"+e:e}function zh(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?t1:BigInt("0x"+n)}const qh=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",I7=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Rn(n){if(r1(n),qh)return n.toHex();let e="";for(let t=0;t<n.length;t++)e+=I7[n[t]];return e}const Xt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Kl(n){if(n>=Xt._0&&n<=Xt._9)return n-Xt._0;if(n>=Xt.A&&n<=Xt.F)return n-(Xt.A-10);if(n>=Xt.a&&n<=Xt.f)return n-(Xt.a-10)}function uo(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);if(qh)return Uint8Array.fromHex(n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=Kl(n.charCodeAt(i)),a=Kl(n.charCodeAt(i+1));if(o===void 0||a===void 0){const c=n[i]+n[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}r[s]=o*16+a}return r}function Gr(n){return zh(Rn(n))}function fs(n){return r1(n),zh(Rn(Uint8Array.from(n).reverse()))}function ri(n,e){return uo(n.toString(16).padStart(e*2,"0"))}function ho(n,e){return ri(n,e).reverse()}function Pe(n,e,t){let r;if(typeof e=="string")try{r=uo(e)}catch(i){throw new Error(n+" must be hex string or Uint8Array, cause: "+i)}else if(ti(e))r=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(n+" of length "+t+" expected, got "+s);return r}function Fn(...n){let e=0;for(let r=0;r<n.length;r++){const s=n[r];r1(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<n.length;r++){const i=n[r];t.set(i,s),s+=i.length}return t}const ma=n=>typeof n=="bigint"&&t1<=n;function n1(n,e,t){return ma(n)&&ma(e)&&ma(t)&&e<=n&&n<t}function Tt(n,e,t,r){if(!n1(e,t,r))throw new Error("expected valid "+n+": "+t+" <= n < "+r+", got "+e)}function P7(n){let e;for(e=0;n>t1;n>>=X0,e+=1);return e}const $o=n=>(X0<<BigInt(n))-X0,ya=n=>new Uint8Array(n),jl=n=>Uint8Array.from(n);function T7(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=ya(n),s=ya(n),i=0;const o=()=>{r.fill(1),s.fill(0),i=0},a=(...d)=>t(s,r,...d),c=(d=ya(0))=>{s=a(jl([0]),d),r=a(),d.length!==0&&(s=a(jl([1]),d),r=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const h=[];for(;d<e;){r=a();const g=r.slice();h.push(g),d+=r.length}return Fn(...h)};return(d,h)=>{o(),c(d);let g;for(;!(g=h(l()));)c();return o(),g}}const R7={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||ti(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function ni(n,e,t={}){const r=(s,i,o)=>{const a=R7[i];if(typeof a!="function")throw new Error("invalid validator function");const c=n[s];if(!(o&&c===void 0)&&!a(c,n))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))r(s,i,!1);for(const[s,i]of Object.entries(t))r(s,i,!0);return n}function fo(n){const e=new WeakMap;return(t,...r)=>{const s=e.get(t);if(s!==void 0)return s;const i=n(t,...r);return e.set(t,i),i}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ut=BigInt(0),ze=BigInt(1),qr=BigInt(2),F7=BigInt(3),Vh=BigInt(4),Kh=BigInt(5),jh=BigInt(8);function Ee(n,e){const t=n%e;return t>=ut?t:e+t}function Be(n,e,t){let r=n;for(;e-- >ut;)r*=r,r%=t;return r}function J0(n,e){if(n===ut)throw new Error("invert: expected non-zero number");if(e<=ut)throw new Error("invert: expected positive modulus, got "+e);let t=Ee(n,e),r=e,s=ut,i=ze;for(;t!==ut;){const a=r/t,c=r%t,l=s-i*a;r=t,t=c,s=i,i=l}if(r!==ze)throw new Error("invert: does not exist");return Ee(s,e)}function Gh(n,e){const t=(n.ORDER+ze)/Vh,r=n.pow(e,t);if(!n.eql(n.sqr(r),e))throw new Error("Cannot find square root");return r}function L7(n,e){const t=(n.ORDER-Kh)/jh,r=n.mul(e,qr),s=n.pow(r,t),i=n.mul(e,s),o=n.mul(n.mul(i,qr),s),a=n.mul(i,n.sub(o,n.ONE));if(!n.eql(n.sqr(a),e))throw new Error("Cannot find square root");return a}function N7(n){if(n<BigInt(3))throw new Error("sqrt is not defined for small field");let e=n-ze,t=0;for(;e%qr===ut;)e/=qr,t++;let r=qr;const s=si(n);for(;Gl(s,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return Gh;let i=s.pow(r,e);const o=(e+ze)/qr;return function(c,l){if(c.is0(l))return l;if(Gl(c,l)!==1)throw new Error("Cannot find square root");let u=t,d=c.mul(c.ONE,i),h=c.pow(l,e),g=c.pow(l,o);for(;!c.eql(h,c.ONE);){if(c.is0(h))return c.ZERO;let p=1,m=c.sqr(h);for(;!c.eql(m,c.ONE);)if(p++,m=c.sqr(m),p===u)throw new Error("Cannot find square root");const y=ze<<BigInt(u-p-1),w=c.pow(d,y);u=p,d=c.sqr(w),h=c.mul(h,d),g=c.mul(g,w)}return g}}function M7(n){return n%Vh===F7?Gh:n%jh===Kh?L7:N7(n)}const O7=(n,e)=>(Ee(n,e)&ze)===ze,U7=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function $7(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=U7.reduce((r,s)=>(r[s]="function",r),e);return ni(n,t)}function H7(n,e,t){if(t<ut)throw new Error("invalid exponent, negatives unsupported");if(t===ut)return n.ONE;if(t===ze)return e;let r=n.ONE,s=e;for(;t>ut;)t&ze&&(r=n.mul(r,s)),s=n.sqr(s),t>>=ze;return r}function s1(n,e,t=!1){const r=new Array(e.length).fill(t?n.ZERO:void 0),s=e.reduce((o,a,c)=>n.is0(a)?o:(r[c]=o,n.mul(o,a)),n.ONE),i=n.inv(s);return e.reduceRight((o,a,c)=>n.is0(a)?o:(r[c]=n.mul(o,r[c]),n.mul(o,a)),i),r}function Gl(n,e){const t=(n.ORDER-ze)/qr,r=n.pow(e,t),s=n.eql(r,n.ONE),i=n.eql(r,n.ZERO),o=n.eql(r,n.neg(n.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function Wh(n,e){e!==void 0&&Cn(e);const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function si(n,e,t=!1,r={}){if(n<=ut)throw new Error("invalid field: expected ORDER > 0, got "+n);const{nBitLength:s,nByteLength:i}=Wh(n,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:n,isLE:t,BITS:s,BYTES:i,MASK:$o(s),ZERO:ut,ONE:ze,create:c=>Ee(c,n),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return ut<=c&&c<n},is0:c=>c===ut,isOdd:c=>(c&ze)===ze,neg:c=>Ee(-c,n),eql:(c,l)=>c===l,sqr:c=>Ee(c*c,n),add:(c,l)=>Ee(c+l,n),sub:(c,l)=>Ee(c-l,n),mul:(c,l)=>Ee(c*l,n),pow:(c,l)=>H7(a,c,l),div:(c,l)=>Ee(c*J0(l,n),n),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>J0(c,n),sqrt:r.sqrt||(c=>(o||(o=M7(n)),o(a,c))),toBytes:c=>t?ho(c,i):ri(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return t?fs(c):Gr(c)},invertBatch:c=>s1(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function Qh(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function Yh(n){const e=Qh(n);return e+Math.ceil(e/2)}function z7(n,e,t=!1){const r=n.length,s=Qh(e),i=Yh(e);if(r<16||r<i||r>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+r);const o=t?fs(n):Gr(n),a=Ee(o,e-ze)+ze;return t?ho(a,s):ri(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Wl=BigInt(0),ec=BigInt(1);function xa(n,e){const t=e.negate();return n?t:e}function Zh(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function ba(n,e){Zh(n,e);const t=Math.ceil(e/n)+1,r=2**(n-1),s=2**n,i=$o(n),o=BigInt(n);return{windows:t,windowSize:r,mask:i,maxNumber:s,shiftBy:o}}function Ql(n,e,t){const{windowSize:r,mask:s,maxNumber:i,shiftBy:o}=t;let a=Number(n&s),c=n>>o;a>r&&(a-=i,c+=ec);const l=e*r,u=l+Math.abs(a)-1,d=a===0,h=a<0,g=e%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:h,isNegF:g,offsetF:l}}function q7(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function V7(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const va=new WeakMap,Xh=new WeakMap;function wa(n){return Xh.get(n)||1}function Jh(n,e){return{constTimeNegate:xa,hasPrecomputes(t){return wa(t)!==1},unsafeLadder(t,r,s=n.ZERO){let i=t;for(;r>Wl;)r&ec&&(s=s.add(i)),i=i.double(),r>>=ec;return s},precomputeWindow(t,r){const{windows:s,windowSize:i}=ba(r,e),o=[];let a=t,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,r,s){let i=n.ZERO,o=n.BASE;const a=ba(t,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:d,isNeg:h,isNegF:g,offsetF:p}=Ql(s,c,a);s=l,d?o=o.add(xa(g,r[p])):i=i.add(xa(h,r[u]))}return{p:i,f:o}},wNAFUnsafe(t,r,s,i=n.ZERO){const o=ba(t,e);for(let a=0;a<o.windows&&s!==Wl;a++){const{nextN:c,offset:l,isZero:u,isNeg:d}=Ql(s,a,o);if(s=c,!u){const h=r[l];i=i.add(d?h.negate():h)}}return i},getPrecomputes(t,r,s){let i=va.get(r);return i||(i=this.precomputeWindow(r,t),t!==1&&va.set(r,s(i))),i},wNAFCached(t,r,s){const i=wa(t);return this.wNAF(i,this.getPrecomputes(i,t,s),r)},wNAFCachedUnsafe(t,r,s,i){const o=wa(t);return o===1?this.unsafeLadder(t,r,i):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),r,i)},setWindowSize(t,r){Zh(r,e),Xh.set(t,r),va.delete(t)}}}function ef(n,e,t,r){q7(t,n),V7(r,e);const s=t.length,i=r.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=n.ZERO,a=P7(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=$o(c),u=new Array(Number(l)+1).fill(o),d=Math.floor((e.BITS-1)/c)*c;let h=o;for(let g=d;g>=0;g-=c){u.fill(o);for(let m=0;m<i;m++){const y=r[m],w=Number(y>>BigInt(g)&l);u[w]=u[w].add(t[m])}let p=o;for(let m=u.length-1,y=o;m>0;m--)y=y.add(u[m]),p=p.add(y);if(h=h.add(p),g!==0)for(let m=0;m<c;m++)h=h.double()}return h}function i1(n){return $7(n.Fp),ni(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Wh(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $t=BigInt(0),tt=BigInt(1),Yl=BigInt(2),K7=BigInt(8),j7={zip215:!0};function G7(n){const e=i1(n);return ni(n,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function W7(n){const e=G7(n),{Fp:t,n:r,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,l=Yl<<BigInt(a*8)-tt,u=t.create,d=si(e.n,e.nBitLength);function h(U,I){const M=t.sqr(U),B=t.sqr(I),P=t.add(t.mul(e.a,M),B),F=t.add(t.ONE,t.mul(e.d,t.mul(M,B)));return t.eql(P,F)}if(!h(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const g=e.uvRatio||((U,I)=>{try{return{isValid:!0,value:t.sqrt(U*t.inv(I))}}catch{return{isValid:!1,value:$t}}}),p=e.adjustScalarBytes||(U=>U),m=e.domain||((U,I,M)=>{if(Sr("phflag",M),I.length||M)throw new Error("Contexts/pre-hash are not supported");return U});function y(U,I,M=!1){const B=M?tt:$t;Tt("coordinate "+U,I,B,l)}function w(U){if(!(U instanceof x))throw new Error("ExtendedPoint expected")}const v=fo((U,I)=>{const{ex:M,ey:B,ez:P}=U,F=U.is0();I==null&&(I=F?K7:t.inv(P));const L=u(M*I),j=u(B*I),W=u(P*I);if(F)return{x:$t,y:tt};if(W!==tt)throw new Error("invZ was invalid");return{x:L,y:j}}),b=fo(U=>{const{a:I,d:M}=e;if(U.is0())throw new Error("bad point: ZERO");const{ex:B,ey:P,ez:F,et:L}=U,j=u(B*B),W=u(P*P),X=u(F*F),G=u(X*X),pe=u(j*I),ve=u(X*u(pe+W)),Re=u(G+u(M*u(j*W)));if(ve!==Re)throw new Error("bad point: equation left != right (1)");const we=u(B*P),he=u(F*L);if(we!==he)throw new Error("bad point: equation left != right (2)");return!0});class x{constructor(I,M,B,P){y("x",I),y("y",M),y("z",B,!0),y("t",P),this.ex=I,this.ey=M,this.ez=B,this.et=P,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(I){if(I instanceof x)throw new Error("extended point not allowed");const{x:M,y:B}=I||{};return y("x",M),y("y",B),new x(M,B,tt,u(M*B))}static normalizeZ(I){const M=s1(t,I.map(B=>B.ez));return I.map((B,P)=>B.toAffine(M[P])).map(x.fromAffine)}static msm(I,M){return ef(x,d,I,M)}_setWindowSize(I){_.setWindowSize(this,I)}assertValidity(){b(this)}equals(I){w(I);const{ex:M,ey:B,ez:P}=this,{ex:F,ey:L,ez:j}=I,W=u(M*j),X=u(F*P),G=u(B*j),pe=u(L*P);return W===X&&G===pe}is0(){return this.equals(x.ZERO)}negate(){return new x(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:I}=e,{ex:M,ey:B,ez:P}=this,F=u(M*M),L=u(B*B),j=u(Yl*u(P*P)),W=u(I*F),X=M+B,G=u(u(X*X)-F-L),pe=W+L,ve=pe-j,Re=W-L,we=u(G*ve),he=u(pe*Re),ge=u(G*Re),Je=u(ve*pe);return new x(we,he,Je,ge)}add(I){w(I);const{a:M,d:B}=e,{ex:P,ey:F,ez:L,et:j}=this,{ex:W,ey:X,ez:G,et:pe}=I,ve=u(P*W),Re=u(F*X),we=u(j*B*pe),he=u(L*G),ge=u((P+F)*(W+X)-ve-Re),Je=he-we,et=he+we,Mr=u(Re-M*ve),Or=u(ge*Je),ts=u(et*Mr),Ur=u(ge*Mr),gt=u(Je*et);return new x(Or,ts,gt,Ur)}subtract(I){return this.add(I.negate())}wNAF(I){return _.wNAFCached(this,I,x.normalizeZ)}multiply(I){const M=I;Tt("scalar",M,tt,r);const{p:B,f:P}=this.wNAF(M);return x.normalizeZ([B,P])[0]}multiplyUnsafe(I,M=x.ZERO){const B=I;return Tt("scalar",B,$t,r),B===$t?C:this.is0()||B===tt?this:_.wNAFCachedUnsafe(this,B,x.normalizeZ,M)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return _.unsafeLadder(this,r).is0()}toAffine(I){return v(this,I)}clearCofactor(){const{h:I}=e;return I===tt?this:this.multiplyUnsafe(I)}static fromHex(I,M=!1){const{d:B,a:P}=e,F=t.BYTES;I=Pe("pointHex",I,F),Sr("zip215",M);const L=I.slice(),j=I[F-1];L[F-1]=j&-129;const W=fs(L),X=M?l:t.ORDER;Tt("pointHex.y",W,$t,X);const G=u(W*W),pe=u(G-tt),ve=u(B*G-P);let{isValid:Re,value:we}=g(pe,ve);if(!Re)throw new Error("Point.fromHex: invalid y coordinate");const he=(we&tt)===tt,ge=(j&128)!==0;if(!M&&we===$t&&ge)throw new Error("Point.fromHex: x=0 and x_0=1");return ge!==he&&(we=u(-we)),x.fromAffine({x:we,y:W})}static fromPrivateKey(I){const{scalar:M}=S(I);return E.multiply(M)}toRawBytes(){const{x:I,y:M}=this.toAffine(),B=ho(M,t.BYTES);return B[B.length-1]|=I&tt?128:0,B}toHex(){return Rn(this.toRawBytes())}}x.BASE=new x(e.Gx,e.Gy,tt,u(e.Gx*e.Gy)),x.ZERO=new x($t,tt,tt,$t);const{BASE:E,ZERO:C}=x,_=Jh(x,a*8);function A(U){return Ee(U,r)}function R(U){return A(fs(U))}function S(U){const I=t.BYTES;U=Pe("private key",U,I);const M=Pe("hashed private key",i(U),2*I),B=p(M.slice(0,I)),P=M.slice(I,2*I),F=R(B);return{head:B,prefix:P,scalar:F}}function k(U){const{head:I,prefix:M,scalar:B}=S(U),P=E.multiply(B),F=P.toRawBytes();return{head:I,prefix:M,scalar:B,point:P,pointBytes:F}}function T(U){return k(U).pointBytes}function D(U=Uint8Array.of(),...I){const M=Fn(...I);return R(i(m(M,Pe("context",U),!!s)))}function H(U,I,M={}){U=Pe("message",U),s&&(U=s(U));const{prefix:B,scalar:P,pointBytes:F}=k(I),L=D(M.context,B,U),j=E.multiply(L).toRawBytes(),W=D(M.context,j,F,U),X=A(L+W*P);Tt("signature.s",X,$t,r);const G=Fn(j,ho(X,t.BYTES));return Pe("result",G,t.BYTES*2)}const N=j7;function O(U,I,M,B=N){const{context:P,zip215:F}=B,L=t.BYTES;U=Pe("signature",U,2*L),I=Pe("message",I),M=Pe("publicKey",M,L),F!==void 0&&Sr("zip215",F),s&&(I=s(I));const j=fs(U.slice(L,2*L));let W,X,G;try{W=x.fromHex(M,F),X=x.fromHex(U.slice(0,L),F),G=E.multiplyUnsafe(j)}catch{return!1}if(!F&&W.isSmallOrder())return!1;const pe=D(P,X.toRawBytes(),W.toRawBytes(),I);return X.add(W.multiplyUnsafe(pe)).subtract(G).clearCofactor().equals(x.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:T,sign:H,verify:O,ExtendedPoint:x,utils:{getExtendedPublicKey:k,randomPrivateKey:()=>o(t.BYTES),precompute(U=8,I=x.BASE){return I._setWindowSize(U),I.multiply(BigInt(3)),I}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const o1=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Zl=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Q7=BigInt(1),Xl=BigInt(2);BigInt(3);const Y7=BigInt(5),Z7=BigInt(8);function X7(n){const e=BigInt(10),t=BigInt(20),r=BigInt(40),s=BigInt(80),i=o1,a=n*n%i*n%i,c=Be(a,Xl,i)*a%i,l=Be(c,Q7,i)*n%i,u=Be(l,Y7,i)*l%i,d=Be(u,e,i)*u%i,h=Be(d,t,i)*d%i,g=Be(h,r,i)*h%i,p=Be(g,s,i)*g%i,m=Be(p,s,i)*g%i,y=Be(m,e,i)*u%i;return{pow_p_5_8:Be(y,Xl,i)*n%i,b2:a}}function J7(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}function e9(n,e){const t=o1,r=Ee(e*e*e,t),s=Ee(r*r*e,t),i=X7(n*s).pow_p_5_8;let o=Ee(n*r*i,t);const a=Ee(e*o*o,t),c=o,l=Ee(o*Zl,t),u=a===n,d=a===Ee(-n,t),h=a===Ee(-n*Zl,t);return u&&(o=c),(d||h)&&(o=l),O7(o,t)&&(o=Ee(-o,t)),{isValid:u||d,value:o}}const Jl=si(o1,void 0,!0),t9={a:Jl.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Jl,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Z7,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Hh,randomBytes:Uo,adjustScalarBytes:J7,uvRatio:e9},cr=W7(t9),tf=32,rf=64,tc=32;function r9(){const n=cr.utils.randomPrivateKey(),e=cr.getPublicKey(n);return{privateKey:i9(n,e),publicKey:e}}function n9(n,e){const t=n.subarray(0,tc);return cr.sign(e instanceof Uint8Array?e:e.subarray(),t)}function s9(n,e,t){return cr.verify(e,t instanceof Uint8Array?t:t.subarray(),n)}function i9(n,e){const t=new Uint8Array(rf);for(let r=0;r<tc;r++)t[r]=n[r],t[tc+r]=e[r];return t}let nf=class{constructor(e){f(this,"type","Ed25519");f(this,"raw");this.raw=a1(e,tf)}toMultihash(){return Lt.digest(Ar(this))}toCID(){return se.createV1(114,this.toMultihash())}toString(){return Ce.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:de(this.raw,e.raw)}verify(e,t){return s9(this.raw,t,e)}},o9=class{constructor(e,t){f(this,"type","Ed25519");f(this,"raw");f(this,"publicKey");this.raw=a1(e,rf),this.publicKey=new nf(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:de(this.raw,e.raw)}sign(e){return n9(this.raw,e)}};function sf(n){return n=a1(n,tf),new nf(n)}async function a9(){const{privateKey:n,publicKey:e}=r9();return new o9(n,e)}function a1(n,e){if(n=Uint8Array.from(n??[]),n.length!==e)throw new ee(`Key must be a Uint8Array of length ${e}, got ${n.length}`);return n}const c9=Math.pow(2,7),l9=Math.pow(2,14),u9=Math.pow(2,21),c1=Math.pow(2,28),l1=Math.pow(2,35),u1=Math.pow(2,42),d1=Math.pow(2,49),le=128,Ke=127;function Et(n){if(n<c9)return 1;if(n<l9)return 2;if(n<u9)return 3;if(n<c1)return 4;if(n<l1)return 5;if(n<u1)return 6;if(n<d1)return 7;if(Number.MAX_SAFE_INTEGER!=null&&n>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function of(n,e,t=0){switch(Et(n)){case 8:e[t++]=n&255|le,n/=128;case 7:e[t++]=n&255|le,n/=128;case 6:e[t++]=n&255|le,n/=128;case 5:e[t++]=n&255|le,n/=128;case 4:e[t++]=n&255|le,n>>>=7;case 3:e[t++]=n&255|le,n>>>=7;case 2:e[t++]=n&255|le,n>>>=7;case 1:{e[t++]=n&255,n>>>=7;break}default:throw new Error("unreachable")}return e}function d9(n,e,t=0){switch(Et(n)){case 8:e.set(t++,n&255|le),n/=128;case 7:e.set(t++,n&255|le),n/=128;case 6:e.set(t++,n&255|le),n/=128;case 5:e.set(t++,n&255|le),n/=128;case 4:e.set(t++,n&255|le),n>>>=7;case 3:e.set(t++,n&255|le),n>>>=7;case 2:e.set(t++,n&255|le),n>>>=7;case 1:{e.set(t++,n&255),n>>>=7;break}default:throw new Error("unreachable")}return e}function af(n,e){let t=n[e],r=0;if(r+=t&Ke,t<le||(t=n[e+1],r+=(t&Ke)<<7,t<le)||(t=n[e+2],r+=(t&Ke)<<14,t<le)||(t=n[e+3],r+=(t&Ke)<<21,t<le)||(t=n[e+4],r+=(t&Ke)*c1,t<le)||(t=n[e+5],r+=(t&Ke)*l1,t<le)||(t=n[e+6],r+=(t&Ke)*u1,t<le)||(t=n[e+7],r+=(t&Ke)*d1,t<le))return r;throw new RangeError("Could not decode varint")}function h9(n,e){let t=n.get(e),r=0;if(r+=t&Ke,t<le||(t=n.get(e+1),r+=(t&Ke)<<7,t<le)||(t=n.get(e+2),r+=(t&Ke)<<14,t<le)||(t=n.get(e+3),r+=(t&Ke)<<21,t<le)||(t=n.get(e+4),r+=(t&Ke)*c1,t<le)||(t=n.get(e+5),r+=(t&Ke)*l1,t<le)||(t=n.get(e+6),r+=(t&Ke)*u1,t<le)||(t=n.get(e+7),r+=(t&Ke)*d1,t<le))return r;throw new RangeError("Could not decode varint")}function Rt(n,e,t=0){return e==null&&(e=Qt(Et(n))),e instanceof Uint8Array?of(n,e,t):d9(n,e,t)}function Fr(n,e=0){return n instanceof Uint8Array?af(n,e):h9(n,e)}const h1=new Float32Array([-0]),_r=new Uint8Array(h1.buffer);function f9(n,e,t){h1[0]=n,e[t]=_r[0],e[t+1]=_r[1],e[t+2]=_r[2],e[t+3]=_r[3]}function p9(n,e){return _r[0]=n[e],_r[1]=n[e+1],_r[2]=n[e+2],_r[3]=n[e+3],h1[0]}const f1=new Float64Array([-0]),je=new Uint8Array(f1.buffer);function g9(n,e,t){f1[0]=n,e[t]=je[0],e[t+1]=je[1],e[t+2]=je[2],e[t+3]=je[3],e[t+4]=je[4],e[t+5]=je[5],e[t+6]=je[6],e[t+7]=je[7]}function m9(n,e){return je[0]=n[e],je[1]=n[e+1],je[2]=n[e+2],je[3]=n[e+3],je[4]=n[e+4],je[5]=n[e+5],je[6]=n[e+6],je[7]=n[e+7],f1[0]}const y9=BigInt(Number.MAX_SAFE_INTEGER),x9=BigInt(Number.MIN_SAFE_INTEGER);class Ge{constructor(e,t){f(this,"lo");f(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let r=~this.hi>>>0;return t===0&&(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let r=~this.hi>>>0;return t===0&&(r=r+1>>>0),-(BigInt(t)+(BigInt(r)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}static fromBigInt(e){if(e===0n)return Wr;if(e<y9&&e>x9)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let r=e>>32n,s=e-(r<<32n);return t&&(r=~r|0n,s=~s|0n,++s>eu&&(s=0n,++r>eu&&(r=0n))),new Ge(Number(s),Number(r))}static fromNumber(e){if(e===0)return Wr;const t=e<0;t&&(e=-e);let r=e>>>0,s=(e-r)/4294967296>>>0;return t&&(s=~s>>>0,r=~r>>>0,++r>4294967295&&(r=0,++s>4294967295&&(s=0))),new Ge(r,s)}static from(e){return typeof e=="number"?Ge.fromNumber(e):typeof e=="bigint"?Ge.fromBigInt(e):typeof e=="string"?Ge.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new Ge(e.low>>>0,e.high>>>0):Wr}}const Wr=new Ge(0,0);Wr.toBigInt=function(){return 0n};Wr.zzEncode=Wr.zzDecode=function(){return this};Wr.length=function(){return 1};const eu=4294967296n;function b9(n){let e=0,t=0;for(let r=0;r<n.length;++r)t=n.charCodeAt(r),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(n.charCodeAt(r+1)&64512)===56320?(++r,e+=4):e+=3;return e}function v9(n,e,t){if(t-e<1)return"";let s;const i=[];let o=0,a;for(;e<t;)a=n[e++],a<128?i[o++]=a:a>191&&a<224?i[o++]=(a&31)<<6|n[e++]&63:a>239&&a<365?(a=((a&7)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,i[o++]=55296+(a>>10),i[o++]=56320+(a&1023)):i[o++]=(a&15)<<12|(n[e++]&63)<<6|n[e++]&63,o>8191&&((s??(s=[])).push(String.fromCharCode.apply(String,i)),o=0);return s!=null?(o>0&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))}function cf(n,e,t){const r=t;let s,i;for(let o=0;o<n.length;++o)s=n.charCodeAt(o),s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&((i=n.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(i&1023),++o,e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128);return t-r}function Pt(n,e){return RangeError(`index out of range: ${n.pos} + ${e??1} > ${n.len}`)}function vi(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}class w9{constructor(e){f(this,"buf");f(this,"pos");f(this,"len");f(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Pt(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Pt(this,4);return vi(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Pt(this,4);return vi(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Pt(this,4);const e=p9(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Pt(this,4);const e=m9(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Pt(this,e);return this.pos+=e,t===r?new Uint8Array(0):this.buf.subarray(t,r)}string(){const e=this.bytes();return v9(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Pt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Pt(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new Ge(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Pt(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Pt(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Pt(this,8);const e=vi(this.buf,this.pos+=4),t=vi(this.buf,this.pos+=4);return new Ge(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=af(this.buf,this.pos);return this.pos+=Et(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function E9(n){return new w9(n instanceof Uint8Array?n:n.subarray())}function We(n,e,t){const r=E9(n);return e.decode(r,void 0,t)}function C9(n){let r,s=8192;return function(o){if(o<1||o>4096)return Qt(o);s+o>8192&&(r=Qt(8192),s=0);const a=r.subarray(s,s+=o);return s&7&&(s=(s|7)+1),a}}class us{constructor(e,t,r){f(this,"fn");f(this,"len");f(this,"next");f(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=r}}function Ea(){}class _9{constructor(e){f(this,"head");f(this,"tail");f(this,"len");f(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const S9=C9();function A9(n){return globalThis.Buffer!=null?Qt(n):S9(n)}class rc{constructor(){f(this,"len");f(this,"head");f(this,"tail");f(this,"states");this.len=0,this.head=new us(Ea,0,0),this.tail=this.head,this.states=null}_push(e,t,r){return this.tail=this.tail.next=new us(e,t,r),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new B9((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(wi,10,Ge.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=Ge.fromBigInt(e);return this._push(wi,t.length(),t)}uint64Number(e){return this._push(of,Et(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=Ge.fromBigInt(e).zzEncode();return this._push(wi,t.length(),t)}sint64Number(e){const t=Ge.fromNumber(e).zzEncode();return this._push(wi,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Ca,1,e?1:0)}fixed32(e){return this._push(cs,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=Ge.fromBigInt(e);return this._push(cs,4,t.lo)._push(cs,4,t.hi)}fixed64Number(e){const t=Ge.fromNumber(e);return this._push(cs,4,t.lo)._push(cs,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(f9,4,e)}double(e){return this._push(g9,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(Ca,1,0):this.uint32(t)._push(D9,t,e)}string(e){const t=b9(e);return t!==0?this.uint32(t)._push(cf,t,e):this._push(Ca,1,0)}fork(){return this.states=new _9(this),this.head=this.tail=new us(Ea,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new us(Ea,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r!==0&&(this.tail.next=e.next,this.tail=t,this.len+=r),this}finish(){let e=this.head.next;const t=A9(this.len);let r=0;for(;e!=null;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t}}function Ca(n,e,t){e[t]=n&255}function k9(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}class B9 extends us{constructor(t,r){super(k9,t,r);f(this,"next");this.next=void 0}}function wi(n,e,t){for(;n.hi!==0;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}function cs(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function D9(n,e,t){e.set(n,t)}globalThis.Buffer!=null&&(rc.prototype.bytes=function(n){const e=n.length>>>0;return this.uint32(e),e>0&&this._push(I9,e,n),this},rc.prototype.string=function(n){const e=globalThis.Buffer.byteLength(n);return this.uint32(e),e>0&&this._push(P9,e,n),this});function I9(n,e,t){e.set(n,t)}function P9(n,e,t){n.length<40?cf(n,e,t):e.utf8Write!=null?e.utf8Write(n,t):e.set(Y(n),t)}function T9(){return new rc}function Qe(n,e){const t=T9();return e.encode(n,t,{lengthDelimited:!1}),t.finish()}var po;(function(n){n[n.VARINT=0]="VARINT",n[n.BIT64=1]="BIT64",n[n.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",n[n.START_GROUP=3]="START_GROUP",n[n.END_GROUP=4]="END_GROUP",n[n.BIT32=5]="BIT32"})(po||(po={}));function lf(n,e,t,r){return{name:n,type:e,encode:t,decode:r}}function Ho(n){function e(s){if(n[s.toString()]==null)throw new Error("Invalid enum value");return n[s]}const t=function(i,o){const a=e(i);o.int32(a)},r=function(i){const o=i.int32();return e(o)};return lf("enum",po.VARINT,t,r)}function Ye(n,e){return lf("message",po.LENGTH_DELIMITED,n,e)}class Ln extends Error{constructor(){super(...arguments);f(this,"code","ERR_MAX_LENGTH");f(this,"name","MaxLengthError")}}class tu extends Error{constructor(){super(...arguments);f(this,"code","ERR_MAX_SIZE");f(this,"name","MaxSizeError")}}var $e;(function(n){n.RSA="RSA",n.Ed25519="Ed25519",n.secp256k1="secp256k1",n.ECDSA="ECDSA"})($e||($e={}));var nc;(function(n){n[n.RSA=0]="RSA",n[n.Ed25519=1]="Ed25519",n[n.secp256k1=2]="secp256k1",n[n.ECDSA=3]="ECDSA"})(nc||(nc={}));(function(n){n.codec=()=>Ho(nc)})($e||($e={}));var Nn;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),$e.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.Type=$e.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(Nn||(Nn={}));var ru;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),$e.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.Type=$e.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(ru||(ru={}));function p1(n){if(isNaN(n)||n<=0)throw new ee("random bytes length must be a Number bigger than 0");return Uo(n)}class nu extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class R9 extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const su={get(n=globalThis){const e=n.crypto;if((e==null?void 0:e.subtle)==null)throw new R9("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}},F9=$h;class L9{constructor(e,t){f(this,"type","RSA");f(this,"jwk");f(this,"_raw");f(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=$9(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return se.createV1(114,this._multihash)}toString(){return Ce.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:de(this.raw,e.raw)}verify(e,t){return q9(this.jwk,t,e)}}const N9=18,M9=1062,O9=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function U9(n){const e=Oo(n[1],{offset:0});return{kty:"RSA",n:Q(e[0],"base64url"),e:Q(e[1],"base64url")}}function $9(n){if(n.n==null||n.e==null)throw new ee("JWK was missing components");return hs([O9,Th(hs([Z0(Y(n.n,"base64url")),Z0(Y(n.e,"base64url"))]))]).subarray()}function H9(n,e){if(n.byteLength>=M9)throw new Bs("Key size is too large");const t=Oo(n,{offset:0});return z9(t,n,e)}function z9(n,e,t){const r=U9(n);if(t==null){const s=F9(Nn.encode({Type:$e.RSA,Data:e}));t=Yr(N9,s)}return new L9(r,t)}async function q9(n,e,t){const r=await su.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return su.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,e,t instanceof Uint8Array?t:t.subarray())}class uf extends Nh{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Fh(e);const r=e1(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?e.create().update(r).digest():r);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Zr(i)}update(e){return lo(this),this.iHash.update(e),this}digestInto(e){lo(this),Wn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const g1=(n,e,t)=>new uf(n,e).update(t).digest();g1.create=(n,e)=>new uf(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function iu(n){n.lowS!==void 0&&Sr("lowS",n.lowS),n.prehash!==void 0&&Sr("prehash",n.prehash)}function V9(n){const e=i1(n);ni(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:t,Fp:r,a:s}=e;if(t){if(!r.eql(s,r.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class K9 extends Error{constructor(e=""){super(e)}}const tr={Err:K9,_tlv:{encode:(n,e)=>{const{Err:t}=tr;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,s=bi(r);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const i=r>127?bi(s.length/2|128):"";return bi(n)+i+s+e},decode(n,e){const{Err:t}=tr;let r=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==n)throw new t("tlv.decode: wrong tlv");const s=e[r++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(r+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(n){const{Err:e}=tr;if(n<nr)throw new e("integer: negative integers are not allowed");let t=bi(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=tr;if(n[0]&128)throw new e("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Gr(n)}},toSig(n){const{Err:e,_int:t,_tlv:r}=tr,s=Pe("signature",n),{v:i,l:o}=r.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,i),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(n){const{_tlv:e,_int:t}=tr,r=e.encode(2,t.encode(n.r)),s=e.encode(2,t.encode(n.s)),i=r+s;return e.encode(48,i)}};function _a(n,e){return Rn(ri(n,e))}const nr=BigInt(0),Fe=BigInt(1);BigInt(2);const Sa=BigInt(3),j9=BigInt(4);function G9(n){const e=V9(n),{Fp:t}=e,r=si(e.n,e.nBitLength),s=e.toBytes||((b,x,E)=>{const C=x.toAffine();return Fn(Uint8Array.from([4]),t.toBytes(C.x),t.toBytes(C.y))}),i=e.fromBytes||(b=>{const x=b.subarray(1),E=t.fromBytes(x.subarray(0,t.BYTES)),C=t.fromBytes(x.subarray(t.BYTES,2*t.BYTES));return{x:E,y:C}});function o(b){const{a:x,b:E}=e,C=t.sqr(b),_=t.mul(C,b);return t.add(t.add(_,t.mul(b,x)),E)}function a(b,x){const E=t.sqr(x),C=o(b);return t.eql(E,C)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=t.mul(t.pow(e.a,Sa),j9),l=t.mul(t.sqr(e.b),BigInt(27));if(t.is0(t.add(c,l)))throw new Error("bad curve params: a or b");function u(b){return n1(b,Fe,e.n)}function d(b){const{allowedPrivateKeyLengths:x,nByteLength:E,wrapPrivateKey:C,n:_}=e;if(x&&typeof b!="bigint"){if(ti(b)&&(b=Rn(b)),typeof b!="string"||!x.includes(b.length))throw new Error("invalid private key");b=b.padStart(E*2,"0")}let A;try{A=typeof b=="bigint"?b:Gr(Pe("private key",b,E))}catch{throw new Error("invalid private key, expected hex or "+E+" bytes, got "+typeof b)}return C&&(A=Ee(A,_)),Tt("private key",A,Fe,_),A}function h(b){if(!(b instanceof m))throw new Error("ProjectivePoint expected")}const g=fo((b,x)=>{const{px:E,py:C,pz:_}=b;if(t.eql(_,t.ONE))return{x:E,y:C};const A=b.is0();x==null&&(x=A?t.ONE:t.inv(_));const R=t.mul(E,x),S=t.mul(C,x),k=t.mul(_,x);if(A)return{x:t.ZERO,y:t.ZERO};if(!t.eql(k,t.ONE))throw new Error("invZ was invalid");return{x:R,y:S}}),p=fo(b=>{if(b.is0()){if(e.allowInfinityPoint&&!t.is0(b.py))return;throw new Error("bad point: ZERO")}const{x,y:E}=b.toAffine();if(!t.isValid(x)||!t.isValid(E))throw new Error("bad point: x or y not FE");if(!a(x,E))throw new Error("bad point: equation left != right");if(!b.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class m{constructor(x,E,C){if(x==null||!t.isValid(x))throw new Error("x required");if(E==null||!t.isValid(E)||t.is0(E))throw new Error("y required");if(C==null||!t.isValid(C))throw new Error("z required");this.px=x,this.py=E,this.pz=C,Object.freeze(this)}static fromAffine(x){const{x:E,y:C}=x||{};if(!x||!t.isValid(E)||!t.isValid(C))throw new Error("invalid affine point");if(x instanceof m)throw new Error("projective point not allowed");const _=A=>t.eql(A,t.ZERO);return _(E)&&_(C)?m.ZERO:new m(E,C,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(x){const E=s1(t,x.map(C=>C.pz));return x.map((C,_)=>C.toAffine(E[_])).map(m.fromAffine)}static fromHex(x){const E=m.fromAffine(i(Pe("pointHex",x)));return E.assertValidity(),E}static fromPrivateKey(x){return m.BASE.multiply(d(x))}static msm(x,E){return ef(m,r,x,E)}_setWindowSize(x){v.setWindowSize(this,x)}assertValidity(){p(this)}hasEvenY(){const{y:x}=this.toAffine();if(t.isOdd)return!t.isOdd(x);throw new Error("Field doesn't support isOdd")}equals(x){h(x);const{px:E,py:C,pz:_}=this,{px:A,py:R,pz:S}=x,k=t.eql(t.mul(E,S),t.mul(A,_)),T=t.eql(t.mul(C,S),t.mul(R,_));return k&&T}negate(){return new m(this.px,t.neg(this.py),this.pz)}double(){const{a:x,b:E}=e,C=t.mul(E,Sa),{px:_,py:A,pz:R}=this;let S=t.ZERO,k=t.ZERO,T=t.ZERO,D=t.mul(_,_),H=t.mul(A,A),N=t.mul(R,R),O=t.mul(_,A);return O=t.add(O,O),T=t.mul(_,R),T=t.add(T,T),S=t.mul(x,T),k=t.mul(C,N),k=t.add(S,k),S=t.sub(H,k),k=t.add(H,k),k=t.mul(S,k),S=t.mul(O,S),T=t.mul(C,T),N=t.mul(x,N),O=t.sub(D,N),O=t.mul(x,O),O=t.add(O,T),T=t.add(D,D),D=t.add(T,D),D=t.add(D,N),D=t.mul(D,O),k=t.add(k,D),N=t.mul(A,R),N=t.add(N,N),D=t.mul(N,O),S=t.sub(S,D),T=t.mul(N,H),T=t.add(T,T),T=t.add(T,T),new m(S,k,T)}add(x){h(x);const{px:E,py:C,pz:_}=this,{px:A,py:R,pz:S}=x;let k=t.ZERO,T=t.ZERO,D=t.ZERO;const H=e.a,N=t.mul(e.b,Sa);let O=t.mul(E,A),$=t.mul(C,R),U=t.mul(_,S),I=t.add(E,C),M=t.add(A,R);I=t.mul(I,M),M=t.add(O,$),I=t.sub(I,M),M=t.add(E,_);let B=t.add(A,S);return M=t.mul(M,B),B=t.add(O,U),M=t.sub(M,B),B=t.add(C,_),k=t.add(R,S),B=t.mul(B,k),k=t.add($,U),B=t.sub(B,k),D=t.mul(H,M),k=t.mul(N,U),D=t.add(k,D),k=t.sub($,D),D=t.add($,D),T=t.mul(k,D),$=t.add(O,O),$=t.add($,O),U=t.mul(H,U),M=t.mul(N,M),$=t.add($,U),U=t.sub(O,U),U=t.mul(H,U),M=t.add(M,U),O=t.mul($,M),T=t.add(T,O),O=t.mul(B,M),k=t.mul(I,k),k=t.sub(k,O),O=t.mul(I,$),D=t.mul(B,D),D=t.add(D,O),new m(k,T,D)}subtract(x){return this.add(x.negate())}is0(){return this.equals(m.ZERO)}wNAF(x){return v.wNAFCached(this,x,m.normalizeZ)}multiplyUnsafe(x){const{endo:E,n:C}=e;Tt("scalar",x,nr,C);const _=m.ZERO;if(x===nr)return _;if(this.is0()||x===Fe)return this;if(!E||v.hasPrecomputes(this))return v.wNAFCachedUnsafe(this,x,m.normalizeZ);let{k1neg:A,k1:R,k2neg:S,k2:k}=E.splitScalar(x),T=_,D=_,H=this;for(;R>nr||k>nr;)R&Fe&&(T=T.add(H)),k&Fe&&(D=D.add(H)),H=H.double(),R>>=Fe,k>>=Fe;return A&&(T=T.negate()),S&&(D=D.negate()),D=new m(t.mul(D.px,E.beta),D.py,D.pz),T.add(D)}multiply(x){const{endo:E,n:C}=e;Tt("scalar",x,Fe,C);let _,A;if(E){const{k1neg:R,k1:S,k2neg:k,k2:T}=E.splitScalar(x);let{p:D,f:H}=this.wNAF(S),{p:N,f:O}=this.wNAF(T);D=v.constTimeNegate(R,D),N=v.constTimeNegate(k,N),N=new m(t.mul(N.px,E.beta),N.py,N.pz),_=D.add(N),A=H.add(O)}else{const{p:R,f:S}=this.wNAF(x);_=R,A=S}return m.normalizeZ([_,A])[0]}multiplyAndAddUnsafe(x,E,C){const _=m.BASE,A=(S,k)=>k===nr||k===Fe||!S.equals(_)?S.multiplyUnsafe(k):S.multiply(k),R=A(this,E).add(A(x,C));return R.is0()?void 0:R}toAffine(x){return g(this,x)}isTorsionFree(){const{h:x,isTorsionFree:E}=e;if(x===Fe)return!0;if(E)return E(m,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:x,clearCofactor:E}=e;return x===Fe?this:E?E(m,this):this.multiplyUnsafe(e.h)}toRawBytes(x=!0){return Sr("isCompressed",x),this.assertValidity(),s(m,this,x)}toHex(x=!0){return Sr("isCompressed",x),Rn(this.toRawBytes(x))}}m.BASE=new m(e.Gx,e.Gy,t.ONE),m.ZERO=new m(t.ZERO,t.ONE,t.ZERO);const{endo:y,nBitLength:w}=e,v=Jh(m,y?Math.ceil(w/2):w);return{CURVE:e,ProjectivePoint:m,normPrivateKeyToScalar:d,weierstrassEquation:o,isWithinCurveOrder:u}}function W9(n){const e=i1(n);return ni(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Q9(n){const e=W9(n),{Fp:t,n:r,nByteLength:s,nBitLength:i}=e,o=t.BYTES+1,a=2*t.BYTES+1;function c(N){return Ee(N,r)}function l(N){return J0(N,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:d,weierstrassEquation:h,isWithinCurveOrder:g}=G9({...e,toBytes(N,O,$){const U=O.toAffine(),I=t.toBytes(U.x),M=Fn;return Sr("isCompressed",$),$?M(Uint8Array.from([O.hasEvenY()?2:3]),I):M(Uint8Array.from([4]),I,t.toBytes(U.y))},fromBytes(N){const O=N.length,$=N[0],U=N.subarray(1);if(O===o&&($===2||$===3)){const I=Gr(U);if(!n1(I,Fe,t.ORDER))throw new Error("Point is not on curve");const M=h(I);let B;try{B=t.sqrt(M)}catch(L){const j=L instanceof Error?": "+L.message:"";throw new Error("Point is not on curve"+j)}const P=(B&Fe)===Fe;return($&1)===1!==P&&(B=t.neg(B)),{x:I,y:B}}else if(O===a&&$===4){const I=t.fromBytes(U.subarray(0,t.BYTES)),M=t.fromBytes(U.subarray(t.BYTES,2*t.BYTES));return{x:I,y:M}}else{const I=o,M=a;throw new Error("invalid Point, expected length of "+I+", or uncompressed "+M+", got "+O)}}});function p(N){const O=r>>Fe;return N>O}function m(N){return p(N)?c(-N):N}const y=(N,O,$)=>Gr(N.slice(O,$));class w{constructor(O,$,U){Tt("r",O,Fe,r),Tt("s",$,Fe,r),this.r=O,this.s=$,U!=null&&(this.recovery=U),Object.freeze(this)}static fromCompact(O){const $=s;return O=Pe("compactSignature",O,$*2),new w(y(O,0,$),y(O,$,2*$))}static fromDER(O){const{r:$,s:U}=tr.toSig(Pe("DER",O));return new w($,U)}assertValidity(){}addRecoveryBit(O){return new w(this.r,this.s,O)}recoverPublicKey(O){const{r:$,s:U,recovery:I}=this,M=_(Pe("msgHash",O));if(I==null||![0,1,2,3].includes(I))throw new Error("recovery id invalid");const B=I===2||I===3?$+e.n:$;if(B>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const P=I&1?"03":"02",F=u.fromHex(P+_a(B,t.BYTES)),L=l(B),j=c(-M*L),W=c(U*L),X=u.BASE.multiplyAndAddUnsafe(F,j,W);if(!X)throw new Error("point at infinify");return X.assertValidity(),X}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return uo(this.toDERHex())}toDERHex(){return tr.hexFromSig(this)}toCompactRawBytes(){return uo(this.toCompactHex())}toCompactHex(){const O=s;return _a(this.r,O)+_a(this.s,O)}}const v={isValidPrivateKey(N){try{return d(N),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const N=Yh(e.n);return z7(e.randomBytes(N),e.n)},precompute(N=8,O=u.BASE){return O._setWindowSize(N),O.multiply(BigInt(3)),O}};function b(N,O=!0){return u.fromPrivateKey(N).toRawBytes(O)}function x(N){if(typeof N=="bigint")return!1;if(N instanceof u)return!0;const $=Pe("key",N).length,U=t.BYTES,I=U+1,M=2*U+1;if(!(e.allowedPrivateKeyLengths||s===I))return $===I||$===M}function E(N,O,$=!0){if(x(N)===!0)throw new Error("first arg must be private key");if(x(O)===!1)throw new Error("second arg must be public key");return u.fromHex(O).multiply(d(N)).toRawBytes($)}const C=e.bits2int||function(N){if(N.length>8192)throw new Error("input is too large");const O=Gr(N),$=N.length*8-i;return $>0?O>>BigInt($):O},_=e.bits2int_modN||function(N){return c(C(N))},A=$o(i);function R(N){return Tt("num < 2^"+i,N,nr,A),ri(N,s)}function S(N,O,$=k){if(["recovered","canonical"].some(pe=>pe in $))throw new Error("sign() legacy options not supported");const{hash:U,randomBytes:I}=e;let{lowS:M,prehash:B,extraEntropy:P}=$;M==null&&(M=!0),N=Pe("msgHash",N),iu($),B&&(N=Pe("prehashed msgHash",U(N)));const F=_(N),L=d(O),j=[R(L),R(F)];if(P!=null&&P!==!1){const pe=P===!0?I(t.BYTES):P;j.push(Pe("extraEntropy",pe))}const W=Fn(...j),X=F;function G(pe){const ve=C(pe);if(!g(ve))return;const Re=l(ve),we=u.BASE.multiply(ve).toAffine(),he=c(we.x);if(he===nr)return;const ge=c(Re*c(X+he*L));if(ge===nr)return;let Je=(we.x===he?0:2)|Number(we.y&Fe),et=ge;return M&&p(ge)&&(et=m(ge),Je^=1),new w(he,et,Je)}return{seed:W,k2sig:G}}const k={lowS:e.lowS,prehash:!1},T={lowS:e.lowS,prehash:!1};function D(N,O,$=k){const{seed:U,k2sig:I}=S(N,O,$),M=e;return T7(M.hash.outputLen,M.nByteLength,M.hmac)(U,I)}u.BASE._setWindowSize(8);function H(N,O,$,U=T){var Je;const I=N;O=Pe("msgHash",O),$=Pe("publicKey",$);const{lowS:M,prehash:B,format:P}=U;if(iu(U),"strict"in U)throw new Error("options.strict was renamed to lowS");if(P!==void 0&&P!=="compact"&&P!=="der")throw new Error("format must be compact or der");const F=typeof I=="string"||ti(I),L=!F&&!P&&typeof I=="object"&&I!==null&&typeof I.r=="bigint"&&typeof I.s=="bigint";if(!F&&!L)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let j,W;try{if(L&&(j=new w(I.r,I.s)),F){try{P!=="compact"&&(j=w.fromDER(I))}catch(et){if(!(et instanceof tr.Err))throw et}!j&&P!=="der"&&(j=w.fromCompact(I))}W=u.fromHex($)}catch{return!1}if(!j||M&&j.hasHighS())return!1;B&&(O=e.hash(O));const{r:X,s:G}=j,pe=_(O),ve=l(G),Re=c(pe*ve),we=c(X*ve),he=(Je=u.BASE.multiplyAndAddUnsafe(W,Re,we))==null?void 0:Je.toAffine();return he?c(he.x)===X:!1}return{CURVE:e,getPublicKey:b,getSharedSecret:E,sign:D,verify:H,ProjectivePoint:u,Signature:w,utils:v}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Y9(n){return{hash:n,hmac:(e,...t)=>g1(n,e,h7(...t)),randomBytes:Uo}}function Z9(n,e){const t=r=>Q9({...n,...Y9(r)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const df=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),ou=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),X9=BigInt(0),J9=BigInt(1),sc=BigInt(2),au=(n,e)=>(n+e/sc)/e;function ep(n){const e=df,t=BigInt(3),r=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=n*n*n%e,u=l*l*n%e,d=Be(u,t,e)*u%e,h=Be(d,t,e)*u%e,g=Be(h,sc,e)*l%e,p=Be(g,s,e)*g%e,m=Be(p,i,e)*p%e,y=Be(m,a,e)*m%e,w=Be(y,c,e)*y%e,v=Be(w,a,e)*m%e,b=Be(v,t,e)*u%e,x=Be(b,o,e)*p%e,E=Be(x,r,e)*l%e,C=Be(E,sc,e);if(!ic.eql(ic.sqr(C),n))throw new Error("Cannot find square root");return C}const ic=si(df,void 0,void 0,{sqrt:ep}),wt=Z9({a:X9,b:BigInt(7),Fp:ic,n:ou,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const e=ou,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-J9*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,o=BigInt("0x100000000000000000000000000000000"),a=au(i*n,e),c=au(-r*n,e);let l=Ee(n-a*t-c*s,e),u=Ee(-a*r-c*i,e);const d=l>o,h=u>o;if(d&&(l=e-l),h&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:d,k1:l,k2neg:h,k2:u}}}},$h);function tp(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}function rp(n,e,t){const r=at.digest(t instanceof Uint8Array?t:t.subarray());if(tp(r))return r.then(({digest:s})=>wt.verify(e,s,n)).catch(s=>{throw new nu(String(s))});try{return wt.verify(e,r.digest,n)}catch(s){throw new nu(String(s))}}let np=class{constructor(e){f(this,"type","secp256k1");f(this,"raw");f(this,"_key");this._key=ip(e),this.raw=sp(this._key)}toMultihash(){return Lt.digest(Ar(this))}toCID(){return se.createV1(114,this.toMultihash())}toString(){return Ce.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:de(this.raw,e.raw)}verify(e,t){return rp(this._key,t,e)}};function hf(n){return new np(n)}function sp(n){return wt.ProjectivePoint.fromHex(n).toRawBytes(!0)}function ip(n){try{return wt.ProjectivePoint.fromHex(n),n}catch(e){throw new Bs(String(e))}}async function op(n,e){return a9()}function ii(n,e){const{Type:t,Data:r}=Nn.decode(n),s=r??new Uint8Array;switch(t){case $e.RSA:return H9(s,e);case $e.Ed25519:return sf(s);case $e.secp256k1:return hf(s);case $e.ECDSA:return Rh(s);default:throw new Lo}}function ap(n){const{Type:e,Data:t}=Nn.decode(n.digest),r=t??new Uint8Array;switch(e){case $e.Ed25519:return sf(r);case $e.secp256k1:return hf(r);case $e.ECDSA:return Rh(r);default:throw new Lo}}function Ar(n){return Nn.encode({Type:$e[n.type],Data:n.raw})}const ff=Symbol.for("nodejs.util.inspect.custom"),cp=114;var rd;let m1=class{constructor(e){f(this,"type");f(this,"multihash");f(this,"publicKey");f(this,"string");f(this,rd,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Ce.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return se.createV1(cp,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return de(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return de(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(rd=qc,ff)](){return`PeerId(${this.toString()})`}};class pf extends m1{constructor(t){super({...t,type:"RSA"});f(this,"type","RSA");f(this,"publicKey");this.publicKey=t.publicKey}}class gf extends m1{constructor(t){super({...t,type:"Ed25519"});f(this,"type","Ed25519");f(this,"publicKey");this.publicKey=t.publicKey}}class mf extends m1{constructor(t){super({...t,type:"secp256k1"});f(this,"type","secp256k1");f(this,"publicKey");this.publicKey=t.publicKey}}const lp=2336;var nd,sd;class yf{constructor(e){f(this,"type","url");f(this,"multihash");f(this,"publicKey");f(this,"url");f(this,nd,!0);this.url=e.toString(),this.multihash=Lt.digest(Y(this.url))}[(sd=ff,nd=qc,sd)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return se.createV1(lp,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=Q(e)),e.toString()===this.toString())}}const up=114,cu=2336;function Xr(n,e){let t;if(n.charAt(0)==="1"||n.charAt(0)==="Q")t=ft(Ce.decode(`z${n}`));else{if(n.startsWith("k51qzi5uqu5")||n.startsWith("kzwfwjn5ji4")||n.startsWith("k2k4r8")||n.startsWith("bafz"))return x1(se.parse(n));throw new ee('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return lr(t)}function y1(n){if(n.type==="Ed25519")return new gf({multihash:n.toCID().multihash,publicKey:n});if(n.type==="secp256k1")return new mf({multihash:n.toCID().multihash,publicKey:n});if(n.type==="RSA")return new pf({multihash:n.toCID().multihash,publicKey:n});throw new Lo}function dp(n){return y1(n.publicKey)}function lr(n){if(fp(n))return new pf({multihash:n});if(hp(n))try{const e=ap(n);if(e.type==="Ed25519")return new gf({multihash:n,publicKey:e});if(e.type==="secp256k1")return new mf({multihash:n,publicKey:e})}catch{const t=Q(n.digest);return new yf(new URL(t))}throw new vh("Supplied PeerID Multihash is invalid")}function x1(n){if((n==null?void 0:n.multihash)==null||n.version==null||n.version===1&&n.code!==up&&n.code!==cu)throw new bh("Supplied PeerID CID is invalid");if(n.code===cu){const e=Q(n.multihash.digest);return new yf(new URL(e))}return lr(n.multihash)}function hp(n){return n.code===Lt.code}function fp(n){return n.code===at.code}class bt extends Event{constructor(t,r){super(t);f(this,"type");f(this,"detail");this.type=t,this.detail=r}}var xf={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function i(c,l,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var g=new s(u,d||c,h),p=t?t+l:l;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],g]:c._events[p].push(g):(c._events[p]=g,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,d;if(this._eventsCount===0)return l;for(d in u=this._events)e.call(u,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=t?t+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,g=d.length,p=new Array(g);h<g;h++)p[h]=d[h].fn;return p},a.prototype.listenerCount=function(l){var u=t?t+l:l,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,u,d,h,g,p){var m=t?t+l:l;if(!this._events[m])return!1;var y=this._events[m],w=arguments.length,v,b;if(y.fn){switch(y.once&&this.removeListener(l,y.fn,void 0,!0),w){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,u),!0;case 3:return y.fn.call(y.context,u,d),!0;case 4:return y.fn.call(y.context,u,d,h),!0;case 5:return y.fn.call(y.context,u,d,h,g),!0;case 6:return y.fn.call(y.context,u,d,h,g,p),!0}for(b=1,v=new Array(w-1);b<w;b++)v[b-1]=arguments[b];y.fn.apply(y.context,v)}else{var x=y.length,E;for(b=0;b<x;b++)switch(y[b].once&&this.removeListener(l,y[b].fn,void 0,!0),w){case 1:y[b].fn.call(y[b].context);break;case 2:y[b].fn.call(y[b].context,u);break;case 3:y[b].fn.call(y[b].context,u,d);break;case 4:y[b].fn.call(y[b].context,u,d,h);break;default:if(!v)for(E=1,v=new Array(w-1);E<w;E++)v[E-1]=arguments[E];y[b].fn.apply(y[b].context,v)}}return!0},a.prototype.on=function(l,u,d){return i(this,l,u,d,!1)},a.prototype.once=function(l,u,d){return i(this,l,u,d,!0)},a.prototype.removeListener=function(l,u,d,h){var g=t?t+l:l;if(!this._events[g])return this;if(!u)return o(this,g),this;var p=this._events[g];if(p.fn)p.fn===u&&(!h||p.once)&&(!d||p.context===d)&&o(this,g);else{for(var m=0,y=[],w=p.length;m<w;m++)(p[m].fn!==u||h&&!p[m].once||d&&p[m].context!==d)&&y.push(p[m]);y.length?this._events[g]=y.length===1?y[0]:y:o(this,g)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(xf);var pp=xf.exports;const gp=Gn(pp);class bf extends Error{constructor(e){super(e),this.name="TimeoutError"}}let mp=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const lu=n=>globalThis.DOMException===void 0?new mp(n):new DOMException(n),uu=n=>{const e=n.reason===void 0?lu("This operation was aborted."):n.reason;return e instanceof Error?e:lu(e)};function b1(n,e){const{milliseconds:t,fallback:r,message:s,customTimers:i={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((u,d)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:g}=e;g.aborted&&d(uu(g)),a=()=>{d(uu(g))},g.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){n.then(u,d);return}const h=new bf;o=i.setTimeout.call(void 0,()=>{if(r){try{u(r())}catch(g){d(g)}return}typeof n.cancel=="function"&&n.cancel(),s===!1?u():s instanceof Error?d(s):(h.message=s??`Promise timed out after ${t} milliseconds`,d(h))},t),(async()=>{try{u(await n)}catch(g){d(g)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},l}function yp(n,e,t){let r=0,s=n.length;for(;s>0;){const i=Math.trunc(s/2);let o=r+i;t(n[o],e)<=0?(r=++o,s-=i+1):s=i}return r}var St,id;let xp=(id=class{constructor(){ae(this,St,[])}enqueue(e,t){t={priority:0,...t};const r={priority:t.priority,id:t.id,run:e};if(this.size===0||z(this,St)[this.size-1].priority>=t.priority){z(this,St).push(r);return}const s=yp(z(this,St),r,(i,o)=>o.priority-i.priority);z(this,St).splice(s,0,r)}setPriority(e,t){const r=z(this,St).findIndex(i=>i.id===e);if(r===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[s]=z(this,St).splice(r,1);this.enqueue(s.run,{priority:t,id:e})}dequeue(){const e=z(this,St).shift();return e==null?void 0:e.run}filter(e){return z(this,St).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return z(this,St).length}},St=new WeakMap,id);var Sn,An,Er,js,kn,Gs,At,Bn,rt,Ws,kt,Dn,rr,Qs,Ro,ie,vf,wf,Ef,Cf,_f,qi,ac,cc,Vi,Sf,Ki;class oc extends gp{constructor(t){var r,s;super();ae(this,ie);ae(this,Sn);ae(this,An);ae(this,Er,0);ae(this,js);ae(this,kn);ae(this,Gs,0);ae(this,At);ae(this,Bn);ae(this,rt);ae(this,Ws);ae(this,kt,0);ae(this,Dn);ae(this,rr);ae(this,Qs);ae(this,Ro,1n);f(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:xp,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((r=t.intervalCap)==null?void 0:r.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((s=t.interval)==null?void 0:s.toString())??""}\` (${typeof t.interval})`);xe(this,Sn,t.carryoverConcurrencyCount),xe(this,An,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),xe(this,js,t.intervalCap),xe(this,kn,t.interval),xe(this,rt,new t.queueClass),xe(this,Ws,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,xe(this,Qs,t.throwOnTimeout===!0),xe(this,rr,t.autoStart===!1)}get concurrency(){return z(this,Dn)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);xe(this,Dn,t),oe(this,ie,Vi).call(this)}setPriority(t,r){z(this,rt).setPriority(t,r)}async add(t,r={}){return r.id??(r.id=(ss(this,Ro)._++).toString()),r={timeout:this.timeout,throwOnTimeout:z(this,Qs),...r},new Promise((s,i)=>{z(this,rt).enqueue(async()=>{var o;ss(this,kt)._++,ss(this,Er)._++;try{(o=r.signal)==null||o.throwIfAborted();let a=t({signal:r.signal});r.timeout&&(a=b1(Promise.resolve(a),{milliseconds:r.timeout})),r.signal&&(a=Promise.race([a,oe(this,ie,Sf).call(this,r.signal)]));const c=await a;s(c),this.emit("completed",c)}catch(a){if(a instanceof bf&&!r.throwOnTimeout){s();return}i(a),this.emit("error",a)}finally{oe(this,ie,Ef).call(this)}},r),this.emit("add"),oe(this,ie,qi).call(this)})}async addAll(t,r){return Promise.all(t.map(async s=>this.add(s,r)))}start(){return z(this,rr)?(xe(this,rr,!1),oe(this,ie,Vi).call(this),this):this}pause(){xe(this,rr,!0)}clear(){xe(this,rt,new(z(this,Ws)))}async onEmpty(){z(this,rt).size!==0&&await oe(this,ie,Ki).call(this,"empty")}async onSizeLessThan(t){z(this,rt).size<t||await oe(this,ie,Ki).call(this,"next",()=>z(this,rt).size<t)}async onIdle(){z(this,kt)===0&&z(this,rt).size===0||await oe(this,ie,Ki).call(this,"idle")}get size(){return z(this,rt).size}sizeBy(t){return z(this,rt).filter(t).length}get pending(){return z(this,kt)}get isPaused(){return z(this,rr)}}Sn=new WeakMap,An=new WeakMap,Er=new WeakMap,js=new WeakMap,kn=new WeakMap,Gs=new WeakMap,At=new WeakMap,Bn=new WeakMap,rt=new WeakMap,Ws=new WeakMap,kt=new WeakMap,Dn=new WeakMap,rr=new WeakMap,Qs=new WeakMap,Ro=new WeakMap,ie=new WeakSet,vf=function(){return z(this,An)||z(this,Er)<z(this,js)},wf=function(){return z(this,kt)<z(this,Dn)},Ef=function(){ss(this,kt)._--,oe(this,ie,qi).call(this),this.emit("next")},Cf=function(){oe(this,ie,cc).call(this),oe(this,ie,ac).call(this),xe(this,Bn,void 0)},_f=function(){const t=Date.now();if(z(this,At)===void 0){const r=z(this,Gs)-t;if(r<0)xe(this,Er,z(this,Sn)?z(this,kt):0);else return z(this,Bn)===void 0&&xe(this,Bn,setTimeout(()=>{oe(this,ie,Cf).call(this)},r)),!0}return!1},qi=function(){if(z(this,rt).size===0)return z(this,At)&&clearInterval(z(this,At)),xe(this,At,void 0),this.emit("empty"),z(this,kt)===0&&this.emit("idle"),!1;if(!z(this,rr)){const t=!z(this,ie,_f);if(z(this,ie,vf)&&z(this,ie,wf)){const r=z(this,rt).dequeue();return r?(this.emit("active"),r(),t&&oe(this,ie,ac).call(this),!0):!1}}return!1},ac=function(){z(this,An)||z(this,At)!==void 0||(xe(this,At,setInterval(()=>{oe(this,ie,cc).call(this)},z(this,kn))),xe(this,Gs,Date.now()+z(this,kn)))},cc=function(){z(this,Er)===0&&z(this,kt)===0&&z(this,At)&&(clearInterval(z(this,At)),xe(this,At,void 0)),xe(this,Er,z(this,Sn)?z(this,kt):0),oe(this,ie,Vi).call(this)},Vi=function(){for(;oe(this,ie,qi).call(this););},Sf=async function(t){return new Promise((r,s)=>{t.addEventListener("abort",()=>{s(t.reason)},{once:!0})})},Ki=async function(t,r){return new Promise(s=>{const i=()=>{r&&!r()||(this.off(t,i),s())};this.on(t,i)})};function Af(n){const e=[Pr.A];return n==null?e:Array.isArray(n)?n.length===0?e:n:[n]}const kf=60;function Bf(n){return{Status:n.Status??0,TC:n.TC??n.flag_tc??!1,RD:n.RD??n.flag_rd??!1,RA:n.RA??n.flag_ra??!1,AD:n.AD??n.flag_ad??!1,CD:n.CD??n.flag_cd??!1,Question:(n.Question??n.questions??[]).map(e=>({name:e.name,type:Pr[e.type]})),Answer:(n.Answer??n.answers??[]).map(e=>({name:e.name,type:Pr[e.type],TTL:e.TTL??e.ttl??kf,data:e.data instanceof Uint8Array?Q(e.data):e.data}))}}const bp=4;function du(n,e={}){const t=new oc({concurrency:e.queryConcurrency??bp});return async(r,s={})=>{var a;const i=new URLSearchParams;i.set("name",r),Af(s.types).forEach(c=>{i.append("type",Pr[c])}),(a=s.onProgress)==null||a.call(s,new bt("dns:query",{detail:r}));const o=await t.add(async()=>{var u;const c=await fetch(`${n}?${i}`,{headers:{accept:"application/dns-json"},signal:s==null?void 0:s.signal});if(c.status!==200)throw new Error(`Unexpected HTTP status: ${c.status} - ${c.statusText}`);const l=Bf(await c.json());return(u=s.onProgress)==null||u.call(s,new bt("dns:response",{detail:l})),l},{signal:s.signal});if(o==null)throw new Error("No DNS response received");return o}}function vp(){return[du("https://cloudflare-dns.com/dns-query"),du("https://dns.google/resolve")]}var wp=function(n){if(!n)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),r=Object.create(null);function s(i,o){t[i]=o,e++,e>=n&&(e=0,r=t,t=Object.create(null))}return{has:function(i){return t[i]!==void 0||r[i]!==void 0},remove:function(i){t[i]!==void 0&&(t[i]=void 0),r[i]!==void 0&&(r[i]=void 0)},get:function(i){var o=t[i];if(o!==void 0)return o;if((o=r[i])!==void 0)return s(i,o),o},set:function(i,o){t[i]!==void 0?t[i]=o:s(i,o)},clear:function(){t=Object.create(null),r=Object.create(null)}}};const Ep=Gn(wp);class Cp{constructor(e){f(this,"lru");this.lru=Ep(e)}get(e,t){let r=!0;const s=[];for(const i of t){const o=this.getAnswers(e,i);if(o.length===0){r=!1;break}s.push(...o)}if(r)return Bf({answers:s})}getAnswers(e,t){const r=`${e.toLowerCase()}-${t}`,s=this.lru.get(r);if(s!=null){const i=s.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:Pr[a.type]}));return i.length===0&&this.lru.remove(r),i}return[]}add(e,t){const r=`${e.toLowerCase()}-${t.type}`,s=this.lru.get(r)??[];s.push({expires:Date.now()+(t.TTL??kf)*1e3,value:t}),this.lru.set(r,s)}remove(e,t){const r=`${e.toLowerCase()}-${t}`;this.lru.remove(r)}clear(){this.lru.clear()}}function _p(n){return new Cp(n)}const Sp=1e3;class Ap{constructor(e){f(this,"resolvers");f(this,"cache");this.resolvers={},this.cache=_p(e.cacheSize??Sp),Object.entries(e.resolvers??{}).forEach(([t,r])=>{Array.isArray(r)||(r=[r]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=r}),this.resolvers["."]==null&&(this.resolvers["."]=vp())}async query(e,t={}){var c,l,u;const r=Af(t.types),s=t.cached!==!1?this.cache.get(e,r):void 0;if(s!=null)return(c=t.onProgress)==null||c.call(t,new bt("dns:cache",{detail:s})),s;const i=`${e.split(".").pop()}.`,o=(this.resolvers[i]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const d of o){if(((l=t.signal)==null?void 0:l.aborted)===!0)break;try{const h=await d(e,{...t,types:r});for(const g of h.Answer)this.cache.add(e,g);return h}catch(h){a.push(h),(u=t.onProgress)==null||u.call(t,new bt("dns:error",{detail:h}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${r} failed`)}}var Pr;(function(n){n[n.A=1]="A",n[n.CNAME=5]="CNAME",n[n.TXT=16]="TXT",n[n.AAAA=28]="AAAA"})(Pr||(Pr={}));function kp(n={}){return new Ap(n)}class Bp{constructor(){f(this,"index",0);f(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,r=e();return r===void 0&&(this.index=t),r}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,r){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return r()})}readNumber(e,t,r,s){return this.readAtomically(()=>{let i=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*s)-1;for(;;){const u=this.readAtomically(()=>{const d=this.readChar();if(d===void 0)return;const h=Number.parseInt(d,e);if(!Number.isNaN(h))return h});if(u===void 0)break;if(i*=e,i+=u,i>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!r&&c&&o>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const r=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(r===void 0)return;e[t]=r}return e})}readIPv6Addr(){const e=t=>{for(let r=0;r<t.length/2;r++){const s=r*2;if(r<t.length-3){const o=this.readSeparator(":",r,()=>this.readIPv4Addr());if(o!==void 0)return t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3],[s+4,!0]}const i=this.readSeparator(":",r,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[s,!1];t[s]=i>>8,t[s+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[r,s]=e(t);if(r===16)return t;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const i=new Uint8Array(14),o=16-(r+2),[a]=e(i.subarray(0,o));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const Df=45,Dp=15,Mn=new Bp;function If(n){if(!(n.length>Dp))return Mn.new(n).parseWith(()=>Mn.readIPv4Addr())}function Pf(n){if(n.includes("%")&&(n=n.split("%")[0]),!(n.length>Df))return Mn.new(n).parseWith(()=>Mn.readIPv6Addr())}function go(n,e=!1){if(n.includes("%")&&(n=n.split("%")[0]),n.length>Df)return;const t=Mn.new(n).parseWith(()=>Mn.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function Ip(n,e,t){let r=0;for(const s of n)if(!(r<e)){if(r>t)break;if(s!==255)return!1;r++}return!0}function Pp(n,e,t,r){let s=0;for(const i of n)if(!(s<t)){if(s>r)break;if(i!==e[s])return!1;s++}return!0}function Tp(n){switch(n.length){case Ps:return n.join(".");case Ts:{const e=[];for(let t=0;t<n.length;t++)t%2===0&&e.push(n[t].toString(16).padStart(2,"0")+n[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function Rp(n){let e=0;for(let[t,r]of n.entries()){if(r===255){e+=8;continue}for(;r&128;)e++,r=r<<1;if(r&128)return-1;for(let s=t+1;s<n.length;s++)if(n[s]!=0)return-1;break}return e}function Fp(n){let e="0x";for(const t of n)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const Ps=4,Ts=16,Lp=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function Tf(n,e){e.length===Ts&&n.length===Ps&&Ip(e,0,11)&&(e=e.slice(12)),e.length===Ps&&n.length===Ts&&Pp(n,Lp,0,11)&&(n=n.slice(12));const t=n.length;if(t!=e.length)throw new Error("Failed to mask ip");const r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=n[s]&e[s];return r}function Np(n,e){if(typeof e=="string"&&(e=go(e)),e==null)throw new Error("Invalid ip");if(e.length!==n.network.length)return!1;for(let t=0;t<e.length;t++)if((n.network[t]&n.mask[t])!==(e[t]&n.mask[t]))return!1;return!0}function Mp(n){const[e,t]=n.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+n);let r=Ps,s=If(e);if(s==null&&(r=Ts,s=Pf(e),s==null))throw new Error("Failed to parse given CIDR: "+n);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>r*8)throw new Error("Failed to parse given CIDR: "+n);const o=Rf(i,8*r);return{network:Tf(s,o),mask:o}}function Rf(n,e){if(e!==8*Ps&&e!==8*Ts)throw new Error("Invalid CIDR mask");if(n<0||n>e)throw new Error("Invalid CIDR mask");const t=e/8,r=new Uint8Array(t);for(let s=0;s<t;s++){if(n>=8){r[s]=255,n-=8;continue}r[s]=255-(255>>n),n=0}return r}class Op{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=Mp(e));else{const r=go(e);if(r==null)throw new Error("Failed to parse network");t=String(t);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>r.length*8){const i=go(t);if(i==null)throw new Error("Failed to parse mask");this.mask=i}else this.mask=Rf(s,8*r.length);this.network=Tf(r,this.mask)}}contains(e){return Np({network:this.network,mask:this.mask},e)}toString(){const e=Rp(this.mask),t=e!==-1?String(e):Fp(this.mask);return Tp(this.network)+"/"+t}}function On(n){return!!If(n)}function v1(n){return!!Pf(n)}function Ff(n){return!!go(n)}const hu=On,Up=v1,Lf=function(n){let e=0;if(n=n.toString().trim(),hu(n)){const t=new Uint8Array(e+4);return n.split(/\./g).forEach(r=>{t[e++]=parseInt(r,10)&255}),t}if(Up(n)){const t=n.split(":",8);let r;for(r=0;r<t.length;r++){const i=hu(t[r]);let o;i&&(o=Lf(t[r]),t[r]=Q(o.slice(0,2),"base16")),o!=null&&++r<8&&t.splice(r,0,Q(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(r=0;r<t.length&&t[r]!=="";r++);const i=[r,1];for(r=9-t.length;r>0;r--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(r=0;r<t.length;r++){const i=parseInt(t[r],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},$p=function(n,e=0,t){e=~~e,t=t??n.length-e;const r=new DataView(n.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(n[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(r.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},yt=-1,Rs={},lc={},Hp=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,yt,"ip6zone"],[43,8,"ipcidr"],[53,yt,"dns",!0],[54,yt,"dns4",!0],[55,yt,"dns6",!0],[56,yt,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,yt,"unix",!1,!0],[421,yt,"ipfs"],[421,yt,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,yt,"garlic64"],[448,0,"tls"],[449,yt,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,yt,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,yt,"http-path"],[777,yt,"memory"]];Hp.forEach(n=>{const e=zp(...n);lc[e.code]=e,Rs[e.name]=e});function zp(n,e,t,r,s){return{code:n,size:e,name:t,resolvable:!!r,path:!!s}}function me(n){if(typeof n=="number"){if(lc[n]!=null)return lc[n];throw new Error(`no protocol with code: ${n}`)}else if(typeof n=="string"){if(Rs[n]!=null)return Rs[n];throw new Error(`no protocol with name: ${n}`)}throw new Error(`invalid protocol id type: ${typeof n}`)}const qp=me("ip4"),Vp=me("ip6"),Kp=me("ipcidr");function Nf(n,e){switch(me(n).code){case 4:case 41:return Wp(e);case 42:return Ba(e);case 43:return Q(e,"base10");case 6:case 273:case 33:case 132:return Mf(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Ba(e);case 421:return Xp(e);case 444:return gu(e);case 445:return gu(e);case 466:return Zp(e);case 481:return globalThis.encodeURIComponent(Ba(e));default:return Q(e,"base16")}}function fu(n,e){switch(me(n).code){case 4:return pu(e);case 41:return pu(e);case 42:return ka(e);case 43:return Y(e,"base10");case 6:case 273:case 33:case 132:return w1(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return ka(e);case 421:return Qp(e);case 444:return Jp(e);case 445:return eg(e);case 466:return Yp(e);case 481:return ka(globalThis.decodeURIComponent(e));default:return Y(e,"base16")}}function jp(n){let e,t;if(n.stringTuples().forEach(([r,s])=>{(r===qp.code||r===Vp.code)&&(t=s),r===Kp.code&&(e=s)}),e==null||t==null)throw new Error("Invalid multiaddr");return new Op(t,e)}const Aa=Object.values(Is).map(n=>n.decoder),Gp=function(){let n=Aa[0].or(Aa[1]);return Aa.slice(2).forEach(e=>n=n.or(e)),n}();function pu(n){if(!Ff(n))throw new Error("invalid ip address");return Lf(n)}function Wp(n){const e=$p(n,0,n.length);if(e==null)throw new Error("ipBuff is required");if(!Ff(e))throw new Error("invalid ip address");return e}function w1(n){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,n),new Uint8Array(e)}function Mf(n){return new DataView(n.buffer).getUint16(n.byteOffset)}function ka(n){const e=Y(n),t=Uint8Array.from(Rt(e.length));return Dt([t,e],t.length+e.length)}function Ba(n){const e=Fr(n);if(n=n.slice(Et(e)),n.length!==e)throw new Error("inconsistent lengths");return Q(n)}function Qp(n){let e;n[0]==="Q"||n[0]==="1"?e=ft(Ce.decode(`z${n}`)).bytes:e=se.parse(n).multihash.bytes;const t=Uint8Array.from(Rt(e.length));return Dt([t,e],t.length+e.length)}function Yp(n){const e=Gp.decode(n),t=Uint8Array.from(Rt(e.length));return Dt([t,e],t.length+e.length)}function Zp(n){const e=Fr(n),t=n.slice(Et(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+Q(t,"base64url")}function Xp(n){const e=Fr(n),t=n.slice(Et(e));if(t.length!==e)throw new Error("inconsistent lengths");return Q(t,"base58btc")}function Jp(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=sr.decode("b"+e[0]),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=w1(r);return Dt([t,s],t.length+s.length)}function eg(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=sr.decode(`b${e[0]}`),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=w1(r);return Dt([t,s],t.length+s.length)}function gu(n){const e=n.slice(0,n.length-2),t=n.slice(n.length-2),r=Q(e,"base32"),s=Mf(t);return`${r}:${s}`}function tg(n){n=uc(n);const e=[],t=[];let r=null;const s=n.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<s.length;i++){const o=s[i],a=me(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(i++,i>=s.length)throw new E1("invalid address: "+n);if(a.path===!0){r=uc(s.slice(i).join("/")),e.push([a.code,fu(a.code,r)]),t.push([a.code,r]);break}const c=fu(a.code,s[i]);e.push([a.code,c]),t.push([a.code,Nf(a.code,c)])}return{string:Of(t),bytes:Uf(e),tuples:e,stringTuples:t,path:r}}function mu(n){const e=[],t=[];let r=null,s=0;for(;s<n.length;){const i=Fr(n,s),o=Et(i),a=me(i),c=rg(a,n.slice(s+o));if(c===0){e.push([i]),t.push([i]),s+=o;continue}const l=n.slice(s+o,s+o+c);if(s+=c+o,s>n.length)throw new E1("Invalid address Uint8Array: "+Q(n,"base16"));e.push([i,l]);const u=Nf(i,l);if(t.push([i,u]),a.path===!0){r=u;break}}return{bytes:Uint8Array.from(n),string:Of(t),tuples:e,stringTuples:t,path:r}}function Of(n){const e=[];return n.map(t=>{const r=me(t[0]);return e.push(r.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),uc(e.join("/"))}function Uf(n){return Dt(n.map(e=>{const t=me(e[0]);let r=Uint8Array.from(Rt(t.code));return e.length>1&&e[1]!=null&&(r=Dt([r,e[1]])),r}))}function rg(n,e){if(n.size>0)return n.size/8;if(n.size===0)return 0;{const t=Fr(e instanceof Uint8Array?e:Uint8Array.from(e));return t+Et(t)}}function uc(n){return"/"+n.trim().split("/").filter(e=>e).join("/")}class E1 extends Error{constructor(t){super(`Error parsing address: ${t}`);f(this,"name","ParseError")}}f(E1,"name","ParseError");const ng=Symbol.for("nodejs.util.inspect.custom"),$f=Symbol.for("@multiformats/js-multiaddr/multiaddr"),sg=[me("dns").code,me("dns4").code,me("dns6").code,me("dnsaddr").code];class ig extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}var od,In,Cr,Ys,Zs;const vn=class vn{constructor(e){f(this,"bytes");ae(this,In);ae(this,Cr);ae(this,Ys);ae(this,Zs);f(this,od,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=mu(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=tg(e)}else if(zo(e))t=mu(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,xe(this,In,t.string),xe(this,Cr,t.tuples),xe(this,Ys,t.stringTuples),xe(this,Zs,t.path)}toString(){return z(this,In)}toJSON(){return this.toString()}toOptions(){let e,t,r,s,i="";const o=me("tcp"),a=me("udp"),c=me("ip4"),l=me("ip6"),u=me("dns6"),d=me("ip6zone");for(const[g,p]of this.stringTuples())g===d.code&&(i=`%${p??""}`),sg.includes(g)&&(t=o.name==="tcp"?"tcp":"udp",s=443,r=`${p??""}${i}`,e=g===u.code?6:4),(g===o.code||g===a.code)&&(t=me(g).name==="tcp"?"tcp":"udp",s=parseInt(p??"")),(g===c.code||g===l.code)&&(t=me(g).name==="tcp"?"tcp":"udp",r=`${p??""}${i}`,e=g===l.code?6:4);if(e==null||t==null||r==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:s}}protos(){return z(this,Cr).map(([e])=>Object.assign({},me(e)))}protoCodes(){return z(this,Cr).map(([e])=>e)}protoNames(){return z(this,Cr).map(([e])=>me(e).name)}tuples(){return z(this,Cr).map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return z(this,Ys).map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new vn(e),new vn(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),s=r.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new vn(r.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new vn(Uf(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([r,s])=>{r===Rs.p2p.code&&e.push([r,s]),r===Rs["p2p-circuit"].code&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const r=t[1];return r[0]==="Q"||r[0]==="1"?Q(Ce.decode(`z${r}`),"base58btc"):Q(se.parse(r).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return z(this,Zs)}equals(e){return de(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const r=C1.get(t.name);if(r==null)throw new ig(`no available resolver for ${t.name}`);return(await r(this,e)).map(i=>be(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(od=$f,ng)](){return`Multiaddr(${z(this,In)})`}};In=new WeakMap,Cr=new WeakMap,Ys=new WeakMap,Zs=new WeakMap;let dc=vn;const C1=new Map;function zo(n){return!!(n!=null&&n[$f])}function be(n){return new dc(n)}const og=32,{code:ag}=me("dnsaddr");class cg extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const Hf=async function(e,t={}){const r=t.maxRecursiveDepth??og;if(r===0)throw new cg("Max recursive depth reached");const[,s]=e.stringTuples().find(([l])=>l===ag)??[],o=await((t==null?void 0:t.dns)??kp()).query(`_dnsaddr.${s}`,{signal:t==null?void 0:t.signal,types:[Pr.TXT]}),a=e.getPeerId(),c=[];for(const l of o.Answer){const u=l.data.replace(/["']/g,"").trim().split("=")[1];if(u==null||a!=null&&!u.includes(a))continue;const d=be(u);if(u.startsWith("/dnsaddr")){const h=await d.resolve({...t,maxRecursiveDepth:r-1});c.push(...h.map(g=>g.toString()))}else c.push(d.toString())}return c};var lg=n=>{if(Object.prototype.toString.call(n)!=="[object Object]")return!1;const e=Object.getPrototypeOf(n);return e===null||e===Object.prototype};const mo=lg,{hasOwnProperty:zf}=Object.prototype,{propertyIsEnumerable:ug}=Object,Un=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),dg=J,yu={concatArrays:!1,ignoreUndefined:!1},qo=n=>{const e=[];for(const t in n)zf.call(n,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(n);for(const r of t)ug.call(n,r)&&e.push(r)}return e};function Qn(n){return Array.isArray(n)?hg(n):mo(n)?fg(n):n}function hg(n){const e=n.slice(0,0);return qo(n).forEach(t=>{Un(e,t,Qn(n[t]))}),e}function fg(n){const e=Object.getPrototypeOf(n)===null?Object.create(null):{};return qo(n).forEach(t=>{Un(e,t,Qn(n[t]))}),e}const qf=(n,e,t,r)=>(t.forEach(s=>{typeof e[s]>"u"&&r.ignoreUndefined||(s in n&&n[s]!==Object.getPrototypeOf(n)?Un(n,s,hc(n[s],e[s],r)):Un(n,s,Qn(e[s])))}),n),pg=(n,e,t)=>{let r=n.slice(0,0),s=0;return[n,e].forEach(i=>{const o=[];for(let a=0;a<i.length;a++)zf.call(i,a)&&(o.push(String(a)),i===n?Un(r,s++,i[a]):Un(r,s++,Qn(i[a])));r=qf(r,i,qo(i).filter(a=>!o.includes(a)),t)}),r};function hc(n,e,t){return t.concatArrays&&Array.isArray(n)&&Array.isArray(e)?pg(n,e,t):!mo(e)||!mo(n)?Qn(e):qf(n,e,qo(e),t)}var gg=function(...n){const e=hc(Qn(yu),this!==dg&&this||{},yu);let t={_:{}};for(const r of n)if(r!==void 0){if(!mo(r))throw new TypeError("`"+r+"` is not an Option Object");t=hc(t,{_:r},e)}return t._};const Vf=Gn(gg),mg={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:n=>n},connectionManager:{resolvers:{dnsaddr:Hf}},transportManager:{faultTolerance:As.FATAL_ALL}};async function yg(n){var t,r;const e=Vf(mg,n);if(e.connectionProtector===null&&((r=(t=globalThis.process)==null?void 0:t.env)==null?void 0:r.LIBP2P_FORCE_PNET)!=null)throw new ee("Private network is enforced, but no protector was provided");return e}const $n=1e3,Hn=$n*60,zn=Hn*60,Jr=zn*24,xg=Jr*7,bg=Jr*365.25;function Kf(n,e){try{if(typeof n=="string"&&n.length>0)return vg(n);if(typeof n=="number"&&isFinite(n))return e!=null&&e.long?Eg(n):wg(n);throw new Error("Value is not a string or number.")}catch(t){const r=Cg(t)?`${t.message}. value=${JSON.stringify(n)}`:"An unknown error has occured.";throw new Error(r)}}function vg(n){if(n=String(n),n.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(!e)return NaN;const t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*bg;case"weeks":case"week":case"w":return t*xg;case"days":case"day":case"d":return t*Jr;case"hours":case"hour":case"hrs":case"hr":case"h":return t*zn;case"minutes":case"minute":case"mins":case"min":case"m":return t*Hn;case"seconds":case"second":case"secs":case"sec":case"s":return t*$n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${r} was matched, but no matching case exists.`)}}function wg(n){const e=Math.abs(n);return e>=Jr?`${Math.round(n/Jr)}d`:e>=zn?`${Math.round(n/zn)}h`:e>=Hn?`${Math.round(n/Hn)}m`:e>=$n?`${Math.round(n/$n)}s`:`${n}ms`}function Eg(n){const e=Math.abs(n);return e>=Jr?Ei(n,e,Jr,"day"):e>=zn?Ei(n,e,zn,"hour"):e>=Hn?Ei(n,e,Hn,"minute"):e>=$n?Ei(n,e,$n,"second"):`${n} ms`}function Ei(n,e,t,r){const s=e>=t*1.5;return`${Math.round(n/t)} ${r}${s?"s":""}`}function Cg(n){return typeof n=="object"&&n!==null&&"message"in n}function _g(n){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=s,t.enabled=o,t.humanize=Kf,t.destroy=l,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let h=0;h<u.length;h++)d=(d<<5)-d+u.charCodeAt(h),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,h=null,g,p;function m(...y){if(!m.enabled)return;const w=m,v=Number(new Date),b=v-(d||v);w.diff=b,w.prev=d,w.curr=v,d=v,y[0]=t.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let x=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(C,_)=>{if(C==="%%")return"%";x++;const A=t.formatters[_];if(typeof A=="function"){const R=y[x];C=A.call(w,R),y.splice(x,1),x--}return C}),t.formatArgs.call(w,y),(w.log||t.log).apply(w,y)}return m.namespace=u,m.useColors=t.useColors(),m.color=t.selectColor(u),m.extend=r,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>h!==null?h:(g!==t.namespaces&&(g=t.namespaces,p=t.enabled(u)),p),set:y=>{h=y}}),typeof t.init=="function"&&t.init(m),m}function r(u,d){const h=t(this.namespace+(typeof d>"u"?":":d)+u);return h.log=this.log,h}function s(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let d;const h=(typeof u=="string"?u:"").split(/[\s,]+/),g=h.length;for(d=0;d<g;d++)h[d]&&(u=h[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function i(){const u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let d,h;for(d=0,h=t.skips.length;d<h;d++)if(t.skips[d].test(u))return!1;for(d=0,h=t.names.length;d<h;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack??u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var Sg={};const Kt=Tg(),Ag=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function kg(){var n,e,t,r,s;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((s=navigator.userAgent)==null?void 0:s.toLowerCase().match(/applewebkit\/(\d+)/))}function Bg(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+Kf(this.diff),!this.useColors)return;const e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(r=t))}),n.splice(r,0,e)}const Dg=console.debug??console.log??(()=>{});function Ig(n){try{n?Kt==null||Kt.setItem("debug",n):Kt==null||Kt.removeItem("debug")}catch{}}function Pg(){let n;try{n=Kt==null?void 0:Kt.getItem("debug")}catch{}return!n&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(n=Sg.DEBUG),n}function Tg(){try{return localStorage}catch{}}function Rg(n){n.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const vt=_g({formatArgs:Bg,save:Ig,load:Pg,useColors:kg,setupFormatters:Rg,colors:Ag,storage:Kt,log:Dg});vt.formatters.b=n=>n==null?"undefined":Ce.baseEncode(n);vt.formatters.t=n=>n==null?"undefined":sr.baseEncode(n);vt.formatters.m=n=>n==null?"undefined":Xc.baseEncode(n);vt.formatters.p=n=>n==null?"undefined":n.toString();vt.formatters.c=n=>n==null?"undefined":n.toString();vt.formatters.k=n=>n==null?"undefined":n.toString();vt.formatters.a=n=>n==null?"undefined":n.toString();vt.formatters.e=n=>n==null?"undefined":xu(n.stack)??xu(n.message)??n.toString();function Fg(n){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=n,e.destroy=()=>!0,e.extend=()=>e,e}function jf(){return{forComponent(n){return Lg(n)}}}function Lg(n){let e=Fg(`${n}:trace`);return vt.enabled(`${n}:trace`)&&vt.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=vt(`${n}:trace`)),Object.assign(vt(n),{error:vt(`${n}:error`),trace:e})}function xu(n){if(n!=null&&(n=n.trim(),n.length!==0))return n}function ps(n,e){const t={[Symbol.iterator]:()=>t,next:()=>{const r=n.next(),s=r.value;return r.done===!0||s==null?{done:!0,value:void 0}:{done:!1,value:e(s)}}};return t}function Da(n){const e=ft(Ce.decode(`z${n}`));return lr(e)}class oi{constructor(e){f(this,"map");if(this.map=new Map,e!=null)for(const[t,r]of e.entries())this.map.set(t.toString(),{key:t,value:r})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return ps(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,r)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return ps(this.map.values(),e=>e.key)}values(){return ps(this.map.values(),e=>e.value)}get size(){return this.map.size}}class Wt{constructor(e){f(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return ps(this.set.entries(),e=>{const t=Da(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const r=Da(t);e(r,r,this)})}has(e){return this.set.has(e.toString())}values(){return ps(this.set.values(),e=>Da(e))}intersection(e){const t=new Wt;for(const r of e)this.has(r)&&t.add(r);return t}difference(e){const t=new Wt;for(const r of this)e.has(r)||t.add(r);return t}union(e){const t=new Wt;for(const r of e)t.add(r);for(const r of this)t.add(r);return t}}function Ng(n,e,t,r){Fh(n);const s=f7({dkLen:32,asyncTick:10},r),{c:i,dkLen:o,asyncTick:a}=s;if(Cn(i),Cn(o),Cn(a),i<1)throw new Error("iterations (c) should be >= 1");const c=Hl(e),l=Hl(t),u=new Uint8Array(o),d=g1.create(n,c),h=d._cloneInto().update(l);return{c:i,dkLen:o,asyncTick:a,DK:u,PRF:d,PRFSalt:h}}function Mg(n,e,t,r,s){return n.destroy(),e.destroy(),r&&r.destroy(),Zr(s),t}async function Og(n,e,t,r){const{c:s,dkLen:i,asyncTick:o,DK:a,PRF:c,PRFSalt:l}=Ng(n,e,t,r);let u;const d=new Uint8Array(4),h=zi(d),g=new Uint8Array(c.outputLen);for(let p=1,m=0;m<i;p++,m+=c.outputLen){const y=a.subarray(m,m+c.outputLen);h.setInt32(0,p,!1),(u=l._cloneInto(u)).update(d).digestInto(g),y.set(g.subarray(0,y.length)),await d7(s-1,o,()=>{c._cloneInto(u).update(g).digestInto(g);for(let w=0;w<y.length;w++)y[w]^=g[w]})}return Mg(c,l,a,u,g)}const Ug=Hh,_1={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},Gf={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},Wf=new globalThis.TextEncoder;function $g(n,e){const t=_1[e];let r=Gf[e];for(let s=0;s<n.length;s++)r^=BigInt(n[s]),r=BigInt.asUintN(e,r*t);return r}function Hg(n,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const r=_1[e];let s=Gf[e],i=n;for(;i.length>0;){const o=Wf.encodeInto(i,t);i=i.slice(o.read);for(let a=0;a<o.written;a++)s^=BigInt(t[a]),s=BigInt.asUintN(e,s*r)}return s}function zg(n,{size:e=32,utf8Buffer:t}={}){if(!_1[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof n=="string"){if(t)return Hg(n,e,t);n=Wf.encode(n)}return $g(n,e)}const S1={hash:n=>Number(zg(n,{size:32})),hashV:(n,e)=>qg(S1.hash(n,e))};function qg(n){let e=n.toString(16);return e.length%2===1&&(e=`0${e}`),Y(e,"base16")}const Qf=64;class Vr{constructor(e,t,r,s=2){f(this,"fp");f(this,"h");f(this,"seed");if(s>Qf)throw new TypeError("Invalid Fingerprint Size");const i=t.hashV(e,r),o=Te(s);for(let a=0;a<o.length;a++)o[a]=i[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=r}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?de(this.fp,e.fp):!1}}function yo(n,e){return Math.floor(Math.random()*(e-n))+n}class Ci{constructor(e){f(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof Vr))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof Vr))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof Vr))throw new TypeError("Invalid Fingerprint");const t=yo(0,this.contents.length-1),r=this.contents[t];return this.contents[t]=e,r}remove(e){if(!(e instanceof Vr))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(r=>e.equals(r));return t>-1?(this.contents[t]=null,!0):!1}}const Vg=500;class bu{constructor(e){f(this,"bucketSize");f(this,"filterSize");f(this,"fingerprintSize");f(this,"buckets");f(this,"count");f(this,"hash");f(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??S1,this.seed=e.seed??yo(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=Y(e));const t=new Vr(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,s=(r^t.hash())%this.filterSize;if(this.buckets[r]==null&&(this.buckets[r]=new Ci(this.bucketSize)),this.buckets[s]==null&&(this.buckets[s]=new Ci(this.bucketSize)),this.buckets[r].add(t)||this.buckets[s].add(t))return this.count++,!0;const i=[r,s];let o=i[yo(0,i.length-1)];this.buckets[o]==null&&(this.buckets[o]=new Ci(this.bucketSize));for(let a=0;a<Vg;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new Ci(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=Y(e));const t=new Vr(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,s=((o=this.buckets[r])==null?void 0:o.has(t))??!1;if(s)return s;const i=(r^t.hash())%this.filterSize;return((a=this.buckets[i])==null?void 0:a.has(t))??!1}remove(e){var a,c;typeof e=="string"&&(e=Y(e));const t=new Vr(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,s=((a=this.buckets[r])==null?void 0:a.remove(t))??!1;if(s)return this.count--,s;const i=(r^t.hash())%this.filterSize,o=((c=this.buckets[i])==null?void 0:c.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const Kg={1:.5,2:.84,4:.95,8:.98};function jg(n=.001){return n>.002?2:n>1e-5?4:8}function Gg(n,e=.001){const t=jg(e),r=Kg[t],s=Math.round(n/r),i=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),Qf);return{filterSize:s,bucketSize:t,fingerprintSize:i}}class Wg{constructor(e){f(this,"filterSize");f(this,"bucketSize");f(this,"fingerprintSize");f(this,"scale");f(this,"filterSeries");f(this,"hash");f(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??S1,this.seed=e.seed??yo(0,Math.pow(2,10)),this.filterSeries=[new bu({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=Y(e)),this.has(e))return!0;let t=this.filterSeries.find(r=>r.reliable);if(t==null){const r=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new bu({filterSize:r,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=Y(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=Y(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function Yf(n,e=.001,t){return new Wg({...Gg(n,e)})}var xo;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(r.uint32(10),r.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(r.uint32(18),r.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(r.uint32(26),r.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(r.uint32(42),r.bytes(t.signature)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={publicKey:Te(0),payloadType:Te(0),payload:Te(0),signature:Te(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=t.bytes();break}case 5:{i.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(xo||(xo={}));class Qg extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const br=class br{constructor(e){f(this,"publicKey");f(this,"payloadType");f(this,"payload");f(this,"signature");f(this,"marshaled");const{publicKey:t,payloadType:r,payload:s,signature:i}=e;this.publicKey=t,this.payloadType=r,this.payload=s,this.signature=i}marshal(){return this.marshaled==null&&(this.marshaled=xo.encode({publicKey:Ar(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return de(this.marshal(),e.marshal())}async validate(e){const t=vu(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}};f(br,"createFromProtobuf",async e=>{const t=xo.decode(e),r=ii(t.publicKey);return new br({publicKey:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),f(br,"seal",async(e,t)=>{if(t==null)throw new Error("Missing private key");const r=e.domain,s=e.codec,i=e.marshal(),o=vu(r,s,i),a=await t.sign(o.subarray());return new br({publicKey:t.publicKey,payloadType:s,payload:i,signature:a})}),f(br,"openAndCertify",async(e,t)=>{const r=await br.createFromProtobuf(e);if(!await r.validate(t))throw new Qg("Envelope signature is not valid for the given domain");return r});let bo=br;const vu=(n,e,t)=>{const r=Y(n),s=Rt(r.byteLength),i=Rt(e.length),o=Rt(t.length);return new Ie(s,r,i,e,o,t)};function Yg(n,e){const t=(r,s)=>r.toString().localeCompare(s.toString());return n.length!==e.length?!1:(e.sort(t),n.sort(t).every((r,s)=>e[s].equals(r)))}const Zg="libp2p-peer-record",Xg=Uint8Array.from([3,1]);var vo;(function(n){(function(t){let r;t.codec=()=>(r==null&&(r=Ye((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(s.multiaddr)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={multiaddr:Te(0)},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.multiaddr=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),r),t.encode=s=>Qe(s,t.codec()),t.decode=(s,i)=>We(s,t.codec(),i)})(n.AddressInfo||(n.AddressInfo={}));let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{if(s.lengthDelimited!==!1&&r.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(r.uint32(10),r.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(r.uint32(16),r.uint64(t.seq)),t.addresses!=null)for(const i of t.addresses)r.uint32(26),n.AddressInfo.codec().encode(i,r);s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{var a,c;const i={peerId:Te(0),seq:0n,addresses:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{i.peerId=t.bytes();break}case 2:{i.seq=t.uint64();break}case 3:{if(((a=s.limits)==null?void 0:a.addresses)!=null&&i.addresses.length===s.limits.addresses)throw new Ln('Decode error - map field "addresses" had too many elements');i.addresses.push(n.AddressInfo.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.addresses$}));break}default:{t.skipType(l&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(vo||(vo={}));const er=class er{constructor(e){f(this,"peerId");f(this,"multiaddrs");f(this,"seqNumber");f(this,"domain",er.DOMAIN);f(this,"codec",er.CODEC);f(this,"marshaled");const{peerId:t,multiaddrs:r,seqNumber:s}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=s??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=vo.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof er)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!Yg(this.multiaddrs,e.multiaddrs))}};f(er,"createFromProtobuf",e=>{const t=vo.decode(e),r=lr(ft(t.peerId)),s=(t.addresses??[]).map(o=>be(o.multiaddr)),i=t.seq;return new er({peerId:r,multiaddrs:s,seqNumber:i})}),f(er,"DOMAIN",Zg),f(er,"CODEC",Xg);let gs=er;function Jg(n){return n[Symbol.asyncIterator]!=null}function wo(n){if(Jg(n))return(async()=>{const t=[];for await(const r of n)t.push(r);return t})();const e=[];for(const t of n)e.push(t);return e}const kr={},en=n=>{n.addEventListener("message",e=>{en.dispatchEvent("message",n,e)}),n.port!=null&&n.port.addEventListener("message",e=>{en.dispatchEvent("message",n,e)})};en.addEventListener=(n,e)=>{kr[n]==null&&(kr[n]=[]),kr[n].push(e)};en.removeEventListener=(n,e)=>{kr[n]!=null&&(kr[n]=kr[n].filter(t=>t===e))};en.dispatchEvent=function(n,e,t){kr[n]!=null&&kr[n].forEach(r=>r(e,t))};const wu="lock:worker:request-read",Eu="lock:worker:release-read",Cu="lock:master:grant-read",_u="lock:worker:request-write",Su="lock:worker:release-write",Au="lock:master:grant-write",em=(n=21)=>Math.random().toString().substring(2),ku=(n,e,t,r,s)=>(i,o)=>{if(o.data.type!==t)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};n.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{i.postMessage({type:s,name:a.name,identifier:a.identifier}),await new Promise(c=>{const l=u=>{if((u==null?void 0:u.data)==null)return;const d={type:u.data.type,name:u.data.name,identifier:u.data.identifier};d.type===r&&d.identifier===a.identifier&&(i.removeEventListener("message",l),c())};i.addEventListener("message",l)})}}}))},Bu=(n,e,t,r)=>async()=>{const s=em();return globalThis.postMessage({type:e,identifier:s,name:n}),new Promise(i=>{const o=a=>{if((a==null?void 0:a.data)==null)return;const c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===s&&(globalThis.removeEventListener("message",o),i(()=>{globalThis.postMessage({type:r,identifier:s,name:n})}))};globalThis.addEventListener("message",o)})},tm={singleProcess:!1},rm=n=>{if(n=Object.assign({},tm,n),!!globalThis.document||n.singleProcess){const t=new EventTarget;return en.addEventListener("message",ku(t,"requestReadLock",wu,Eu,Cu)),en.addEventListener("message",ku(t,"requestWriteLock",_u,Su,Au)),t}return{isWorker:!0,readLock:t=>Bu(t,wu,Cu,Eu),writeLock:t=>Bu(t,_u,Au,Su)}},$r={};let vr;async function Ia(n,e){let t;const r=new Promise(s=>{t=s});return n.add(async()=>b1((async()=>{await new Promise(s=>{t(()=>{s()})})})(),{milliseconds:e.timeout})),r}const nm=(n,e)=>{if(vr.isWorker===!0)return{readLock:vr.readLock(n,e),writeLock:vr.writeLock(n,e)};const t=new oc({concurrency:1});let r;return{async readLock(){if(r!=null)return Ia(r,e);r=new oc({concurrency:e.concurrency,autoStart:!1});const s=r,i=Ia(r,e);return t.add(async()=>{s.start(),await s.onIdle().then(()=>{r===s&&(r=null)})}),i},async writeLock(){return r=null,Ia(t,e)}}},sm={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function Zf(n){const e=Object.assign({},sm,n);return vr==null&&(vr=rm(e),vr.isWorker!==!0&&(vr.addEventListener("requestReadLock",t=>{$r[t.data.name]!=null&&$r[t.data.name].readLock().then(async r=>t.data.handler().finally(()=>{r()}))}),vr.addEventListener("requestWriteLock",async t=>{$r[t.data.name]!=null&&$r[t.data.name].writeLock().then(async r=>t.data.handler().finally(()=>{r()}))}))),$r[e.name]==null&&($r[e.name]=nm(e.name,e)),$r[e.name]}const im=36e5,om=216e5;var Kr;(function(n){(function(t){let r;t.codec=()=>(r==null&&(r=Ye((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.key!=null&&s.key!==""&&(i.uint32(10),i.string(s.key)),s.value!=null&&s.value.byteLength>0&&(i.uint32(18),i.bytes(s.value)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={key:"",value:Te(0)},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.key=s.string();break}case 2:{a.value=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),r),t.encode=s=>Qe(s,t.codec()),t.decode=(s,i)=>We(s,t.codec(),i)})(n.Peer$metadataEntry||(n.Peer$metadataEntry={})),function(t){let r;t.codec=()=>(r==null&&(r=Ye((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.key!=null&&s.key!==""&&(i.uint32(10),i.string(s.key)),s.value!=null&&(i.uint32(18),Co.codec().encode(s.value,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{var l;const a={key:""},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const u=s.uint32();switch(u>>>3){case 1:{a.key=s.string();break}case 2:{a.value=Co.codec().decode(s,s.uint32(),{limits:(l=o.limits)==null?void 0:l.value});break}default:{s.skipType(u&7);break}}}return a})),r),t.encode=s=>Qe(s,t.codec()),t.decode=(s,i)=>We(s,t.codec(),i)}(n.Peer$tagsEntry||(n.Peer$tagsEntry={}));let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{if(s.lengthDelimited!==!1&&r.fork(),t.addresses!=null)for(const i of t.addresses)r.uint32(10),Eo.codec().encode(i,r);if(t.protocols!=null)for(const i of t.protocols)r.uint32(18),r.string(i);if(t.publicKey!=null&&(r.uint32(34),r.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(r.uint32(42),r.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[i,o]of t.metadata.entries())r.uint32(50),n.Peer$metadataEntry.codec().encode({key:i,value:o},r);if(t.tags!=null&&t.tags.size!==0)for(const[i,o]of t.tags.entries())r.uint32(58),n.Peer$tagsEntry.codec().encode({key:i,value:o},r);t.updated!=null&&(r.uint32(64),r.uint64Number(t.updated)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{var a,c,l,u,d,h;const i={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const g=t.uint32();switch(g>>>3){case 1:{if(((a=s.limits)==null?void 0:a.addresses)!=null&&i.addresses.length===s.limits.addresses)throw new Ln('Decode error - map field "addresses" had too many elements');i.addresses.push(Eo.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.addresses$}));break}case 2:{if(((l=s.limits)==null?void 0:l.protocols)!=null&&i.protocols.length===s.limits.protocols)throw new Ln('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break}case 4:{i.publicKey=t.bytes();break}case 5:{i.peerRecordEnvelope=t.bytes();break}case 6:{if(((u=s.limits)==null?void 0:u.metadata)!=null&&i.metadata.size===s.limits.metadata)throw new tu('Decode error - map field "metadata" had too many elements');const p=n.Peer$metadataEntry.codec().decode(t,t.uint32());i.metadata.set(p.key,p.value);break}case 7:{if(((d=s.limits)==null?void 0:d.tags)!=null&&i.tags.size===s.limits.tags)throw new tu('Decode error - map field "tags" had too many elements');const p=n.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(h=s.limits)==null?void 0:h.tags$value}});i.tags.set(p.key,p.value);break}case 8:{i.updated=t.uint64Number();break}default:{t.skipType(g&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(Kr||(Kr={}));var Eo;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(r.uint32(10),r.bytes(t.multiaddr)),t.isCertified!=null&&(r.uint32(16),r.bool(t.isCertified)),t.observed!=null&&(r.uint32(24),r.uint64Number(t.observed)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={multiaddr:Te(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.multiaddr=t.bytes();break}case 2:{i.isCertified=t.bool();break}case 3:{i.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(Eo||(Eo={}));var Co;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.value!=null&&t.value!==0&&(r.uint32(8),r.uint32(t.value)),t.expiry!=null&&(r.uint32(16),r.uint64(t.expiry)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={value:0},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.value=t.uint32();break}case 2:{i.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(Co||(Co={}));function am(n,e){if(n.publicKey!=null||e.publicKey==null)return n;let t;if(n.type==="RSA"){const s=Ce.decode(`z${n}`);t=ft(s)}const r=ii(e.publicKey,t);return y1(r)}function fc(n,e,t){const r=Kr.decode(e);return pc(n,r,t)}function pc(n,e,t){const r=new Map,s=BigInt(Date.now());for(const[i,o]of e.tags.entries())o.expiry!=null&&o.expiry<s||r.set(i,o);return{...e,id:am(n,e),addresses:e.addresses.filter(({observed:i})=>i!=null&&i>Date.now()-t).map(({multiaddr:i,isCertified:o})=>({multiaddr:be(i),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:r}}function cm(n,e){return lm(n.addresses,e.addresses)&&um(n.protocols,e.protocols)&&dm(n.publicKey,e.publicKey)&&hm(n.peerRecordEnvelope,e.peerRecordEnvelope)&&fm(n.metadata,e.metadata)&&pm(n.tags,e.tags)}function lm(n,e){return Jf(n,e,(t,r)=>!(t.isCertified!==r.isCertified||!de(t.multiaddr,r.multiaddr)))}function um(n,e){return Jf(n,e,(t,r)=>t===r)}function dm(n,e){return Xf(n,e)}function hm(n,e){return Xf(n,e)}function fm(n,e){return e3(n,e,(t,r)=>de(t,r))}function pm(n,e){return e3(n,e,(t,r)=>t.value===r.value&&t.expiry===r.expiry)}function Xf(n,e){return n==null&&e==null?!0:n!=null&&e!=null?de(n,e):!1}function Jf(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!t(n[r],e[r]))return!1;return!0}function e3(n,e,t){if(n.size!==e.size)return!1;for(const[r,s]of n.entries()){const i=e.get(r);if(i==null||!t(s,i))return!1}return!0}const Jt="/",t3=new TextEncoder().encode(Jt),_i=t3[0];class Oe{constructor(e,t){f(this,"_buf");if(typeof e=="string")this._buf=Y(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==_i)throw new Error("Invalid key")}toString(e="utf8"){return Q(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Oe(e.join(Jt))}static random(){return new Oe(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Oe(e):typeof e.uint8Array=="function"?new Oe(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=t3),this._buf[0]!==_i){const e=new Uint8Array(this._buf.byteLength+1);e.fill(_i,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===_i;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let s=0;s<t.length;s++){if(r.length<s+1)return!1;const i=t[s],o=r[s];if(i<o)return!0;if(i>o)return!1}return t.length<r.length}reverse(){return Oe.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Jt).slice(1)}type(){return gm(this.baseNamespace())}name(){return mm(this.baseNamespace())}instance(e){return new Oe(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Jt)||(e+=Jt),e+=this.type(),new Oe(e)}parent(){const e=this.list();return e.length===1?new Oe(Jt):new Oe(e.slice(0,-1).join(Jt))}child(e){return this.toString()===Jt?e:e.toString()===Jt?this:new Oe(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Oe.withNamespaces([...this.namespaces(),...ym(e.map(t=>t.namespaces()))])}}function gm(n){const e=n.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function mm(n){const e=n.split(":");return e[e.length-1]}function ym(n){return[].concat(...n)}const r3="/peers/";function Si(n){if(!yh(n)||n.type==null)throw new ee("Invalid PeerId");const e=n.toCID().toString();return new Oe(`${r3}${e}`)}async function xm(n,e,t,r){const s=new Map;for(const i of t){if(i==null)continue;if(i.multiaddr instanceof Uint8Array&&(i.multiaddr=be(i.multiaddr)),!zo(i.multiaddr))throw new ee("Multiaddr was invalid");if(!await e(n,i.multiaddr))continue;const o=i.isCertified??!1,a=i.multiaddr.toString(),c=s.get(a);c!=null?i.isCertified=c.isCertified||o:s.set(a,{multiaddr:i.multiaddr,isCertified:o})}return[...s.values()].sort((i,o)=>i.multiaddr.toString().localeCompare(o.multiaddr.toString())).map(({isCertified:i,multiaddr:o})=>({isCertified:i,multiaddr:o.bytes}))}async function Pa(n,e,t,r){var h,g;if(e==null)throw new ee("Invalid PeerData");if(e.publicKey!=null&&n.publicKey!=null&&!e.publicKey.equals(n.publicKey))throw new ee("publicKey bytes do not match peer id publicKey bytes");const s=(h=r.existingPeer)==null?void 0:h.peer;if(s!=null&&!n.equals(s.id))throw new ee("peer id did not match existing peer id");let i=(s==null?void 0:s.addresses)??[],o=new Set((s==null?void 0:s.protocols)??[]),a=(s==null?void 0:s.metadata)??new Map,c=(s==null?void 0:s.tags)??new Map,l=s==null?void 0:s.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(i=[],e.multiaddrs!=null&&i.push(...e.multiaddrs.map(p=>({isCertified:!1,multiaddr:p}))),e.addresses!=null&&i.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const p=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=Ai(p,{validate:Du})}if(e.tags!=null){const p=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=Ai(p,{validate:Iu,map:Pu})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&i.push(...e.multiaddrs.map(p=>({isCertified:!1,multiaddr:p}))),e.addresses!=null&&i.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const p=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[m,y]of p)y==null?a.delete(m):a.set(m,y);a=Ai([...a.entries()],{validate:Du})}if(e.tags!=null){const p=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),m=new Map(c);for(const[y,w]of p)w==null?m.delete(y):m.set(y,w);c=Ai([...m.entries()],{validate:Iu,map:Pu})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let u;(s==null?void 0:s.id.publicKey)!=null?u=Ar(s.id.publicKey):e.publicKey!=null?u=Ar(e.publicKey):n.publicKey!=null&&(u=Ar(n.publicKey));const d={addresses:await xm(n,r.addressFilter??(async()=>!0),i,(g=r.existingPeer)==null?void 0:g.peerPB.addresses),protocols:[...o.values()].sort((p,m)=>p.localeCompare(m)),metadata:a,tags:c,publicKey:u,peerRecordEnvelope:l};return d.addresses.forEach(p=>{var m,y,w;p.observed=((w=(y=(m=r.existingPeer)==null?void 0:m.peerPB.addresses)==null?void 0:y.find(v=>de(v.multiaddr,v.multiaddr)))==null?void 0:w.observed)??Date.now()}),n.type!=="RSA"&&delete d.publicKey,d}function Ai(n,e){var r;const t=new Map;for(const[s,i]of n)i!=null&&e.validate(s,i);for(const[s,i]of n.sort(([o],[a])=>o.localeCompare(a)))i!=null&&t.set(s,((r=e.map)==null?void 0:r.call(e,s,i))??i);return t}function Du(n,e){if(typeof n!="string")throw new ee("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new ee("Metadata value must be a Uint8Array")}function Iu(n,e){if(typeof n!="string")throw new ee("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new ee("Tag value must be an integer");if(e.value<0||e.value>100)throw new ee("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new ee("Tag ttl must be an integer");if(e.ttl<0)throw new ee("Tag ttl must be between greater than 0")}}function Pu(n,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function n3(n){const e=n.toString().split("/")[2],t=se.parse(e,sr);return x1(t)}function Ta(n,e,t){const r=n3(n);return fc(r,e,t)}function bm(n,e){return{prefix:r3,filters:(n.filters??[]).map(t=>({key:r,value:s})=>t(Ta(r,s,e))),orders:(n.orders??[]).map(t=>(r,s)=>t(Ta(r.key,r.value,e),Ta(s.key,s.value,e)))}}var dt,ji,Gi,Wi;class vm{constructor(e,t={}){ae(this,dt);f(this,"peerId");f(this,"datastore");f(this,"lock");f(this,"addressFilter");f(this,"log");f(this,"maxAddressAge");f(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=Zf({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??im,this.maxPeerAge=t.maxPeerAge??om}async has(e){try{return await this.load(e),!0}catch(t){if(t.name!=="NotFoundError")throw t}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete(Si(e))}async load(e){const t=Si(e),r=await this.datastore.get(t),s=Kr.decode(r);if(oe(this,dt,Wi).call(this,e,s))throw await this.datastore.delete(t),new Ir;return pc(e,s,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){const r=await oe(this,dt,ji).call(this,e),s=await Pa(e,t,"patch",{addressFilter:this.addressFilter});return oe(this,dt,Gi).call(this,e,s,r)}async patch(e,t){const r=await oe(this,dt,ji).call(this,e),s=await Pa(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:r});return oe(this,dt,Gi).call(this,e,s,r)}async merge(e,t){const r=await oe(this,dt,ji).call(this,e),s=await Pa(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:r});return oe(this,dt,Gi).call(this,e,s,r)}async*all(e){for await(const{key:t,value:r}of this.datastore.query(bm(e??{},this.maxAddressAge))){const s=n3(t);if(s.equals(this.peerId))continue;const i=Kr.decode(r);if(oe(this,dt,Wi).call(this,s,i)){await this.datastore.delete(t);continue}yield pc(s,i,this.peerId.equals(s)?1/0:this.maxAddressAge)}}}dt=new WeakSet,ji=async function(e){try{const t=Si(e),r=await this.datastore.get(t),s=Kr.decode(r);if(oe(this,dt,Wi).call(this,e,s))throw await this.datastore.delete(t),new Ir;return{peerPB:s,peer:fc(e,r,this.maxAddressAge)}}catch(t){t.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",t)}},Gi=async function(e,t,r){t.updated=Date.now();const s=Kr.encode(t);return await this.datastore.put(Si(e),s),{peer:fc(e,s,this.maxAddressAge),previous:r==null?void 0:r.peer,updated:r==null||!cm(t,r.peerPB)}},Wi=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const r=t.updated<Date.now()-this.maxPeerAge,s=Date.now()-this.maxAddressAge,i=t.addresses.filter(o=>o.observed!=null&&o.observed>s);return r&&i.length===0};var ad,Pn,Qi;ad=Symbol.toStringTag;class wm{constructor(e,t={}){ae(this,Pn);f(this,"store");f(this,"events");f(this,"peerId");f(this,"log");f(this,ad,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new vm(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const r=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const s of this.store.all(t))e(s)}finally{this.log.trace("forEach release read lock"),r()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await wo(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const r=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const s=await this.store.save(e,t);return oe(this,Pn,Qi).call(this,e,s),s.peer}finally{this.log.trace("save release write lock"),r()}}async patch(e,t){this.log.trace("patch await write lock");const r=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const s=await this.store.patch(e,t);return oe(this,Pn,Qi).call(this,e,s),s.peer}finally{this.log.trace("patch release write lock"),r()}}async merge(e,t){this.log.trace("merge await write lock");const r=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const s=await this.store.merge(e,t);return oe(this,Pn,Qi).call(this,e,s),s.peer}finally{this.log.trace("merge release write lock"),r()}}async consumePeerRecord(e,t){const r=await bo.openAndCertify(e,gs.DOMAIN),s=x1(r.publicKey.toCID());if((t==null?void 0:t.equals(s))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,s),!1;const i=gs.createFromProtobuf(r.payload);let o;try{o=await this.get(s)}catch(a){if(a.name!=="NotFoundError")throw a}if((o==null?void 0:o.peerRecordEnvelope)!=null){const a=await bo.createFromProtobuf(o.peerRecordEnvelope),c=gs.createFromProtobuf(a.payload);if(c.seqNumber>=i.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",c.seqNumber,i.seqNumber),!1}return await this.patch(i.peerId,{peerRecordEnvelope:e,addresses:i.multiaddrs.map(a=>({isCertified:!0,multiaddr:a}))}),!0}}Pn=new WeakSet,Qi=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function Em(n,e={}){return new wm(n,e)}const wn=class wn extends Error{constructor(t="Not Found"){super(t);f(this,"name",wn.name);f(this,"code",wn.code)}};f(wn,"name","NotFoundError"),f(wn,"code","ERR_NOT_FOUND");let gc=wn;function Cm(n){return n[Symbol.asyncIterator]!=null}function Fs(n){if(Cm(n))return(async()=>{for await(const e of n);})();for(const e of n);}function s3(n){const[e,t]=n[Symbol.asyncIterator]!=null?[n[Symbol.asyncIterator](),Symbol.asyncIterator]:[n[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>e.next(),push:s=>{r.push(s)},next:()=>r.length>0?{done:!1,value:r.shift()}:e.next(),[t](){return this}}}function _m(n){return n[Symbol.asyncIterator]!=null}function mn(n,e){let t=0;if(_m(n))return async function*(){for await(const c of n)await e(c,t++)&&(yield c)}();const r=s3(n),{value:s,done:i}=r.next();if(i===!0)return function*(){}();const o=e(s,t++);if(typeof o.then=="function")return async function*(){await o&&(yield s);for await(const c of r)await e(c,t++)&&(yield c)}();const a=e;return function*(){o===!0&&(yield s);for(const c of r)a(c,t++)&&(yield c)}()}function Sm(n){return n[Symbol.asyncIterator]!=null}function Tu(n,e){return Sm(n)?async function*(){yield*(await wo(n)).sort(e)}():function*(){yield*wo(n).sort(e)}()}function Am(n){return n[Symbol.asyncIterator]!=null}function mc(n,e){return Am(n)?async function*(){let t=0;if(!(e<1)){for await(const r of n)if(yield r,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const r of n)if(yield r,t++,t===e)return}}()}class km{put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:s}of e)await this.put(r,s,t),yield r}async*getMany(e,t={}){for await(const r of e)yield{key:r,value:await this.get(r,t)}}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(r,s){e.push({key:r,value:s})},delete(r){t.push(r)},commit:async r=>{await Fs(this.putMany(e,r)),e=[],await Fs(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(e.prefix!=null){const s=e.prefix;r=mn(r,i=>i.key.toString().startsWith(s))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((s,i)=>mn(s,i),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((s,i)=>Tu(s,i),r)),e.offset!=null){let s=0;const i=e.offset;r=mn(r,()=>s++>=i)}return e.limit!=null&&(r=mc(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(e.prefix!=null){const s=e.prefix;r=mn(r,i=>i.toString().startsWith(s))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((s,i)=>mn(s,i),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((s,i)=>Tu(s,i),r)),e.offset!=null){const s=e.offset;let i=0;r=mn(r,()=>i++>=s)}return e.limit!=null&&(r=mc(r,e.limit)),r}}class Bm extends km{constructor(){super();f(this,"data");this.data=new Map}put(t,r){return this.data.set(t.toString(),r),t}get(t){const r=this.data.get(t.toString());if(r==null)throw new gc;return r}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,r]of this.data.entries())yield{key:new Oe(t),value:r}}*_allKeys(){for(const t of this.data.keys())yield new Oe(t)}}function Dm(n,e){let t;const r=function(){const s=function(){t=void 0,n()};clearTimeout(t),t=setTimeout(s,e)};return r.start=()=>{},r.stop=()=>{clearTimeout(t)},r}var i3;(function(){var n,e,t,r,s,i,o,a;a=function(c){var l,u,d,h;return l=(c&255<<24)>>>24,u=(c&255<<16)>>>16,d=(c&65280)>>>8,h=c&255,[l,u,d,h].join(".")},o=function(c){var l,u,d,h,g,p;for(l=[],d=h=0;h<=3&&c.length!==0;d=++h){if(d>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}p=e(c),g=p[0],u=p[1],c=c.substring(u),l.push(g)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},r=t("0"),i=t("a"),s=t("A"),e=function(c){var l,u,d,h,g;for(h=0,l=10,u="9",d=0,c.length>1&&c[d]==="0"&&(c[d+1]==="x"||c[d+1]==="X"?(d+=2,l=16):"0"<=c[d+1]&&c[d+1]<="9"&&(d++,l=8,u="7")),g=d;d<c.length;){if("0"<=c[d]&&c[d]<=u)h=h*l+(t(c[d])-r)>>>0;else if(l===16)if("a"<=c[d]&&c[d]<="f")h=h*l+(10+t(c[d])-i)>>>0;else if("A"<=c[d]&&c[d]<="F")h=h*l+(10+t(c[d])-s)>>>0;else break;else break;if(h>4294967295)throw new Error("too large");d++}if(d===g)throw new Error("empty octet");return[h,d]},n=function(){function c(l,u){var d,h,g;if(typeof l!="string")throw new Error("Missing `net' parameter");if(u||(g=l.split("/",2),l=g[0],u=g[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=o(u)}catch{throw new Error("Invalid mask: "+u)}for(d=h=32;h>=0;d=--h)if(this.maskLong===4294967295<<32-d>>>0){this.bitmask=d;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var u,d,h;for(h=o(this.first),d=o(this.last),u=0;h<=d;)l(a(h),h,u),u++,h++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),i3=n}).call(J);const Im=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],Pm=Im.map(n=>new i3(n));function A1(n){for(const e of Pm)if(e.contains(n))return!0;return!1}function Tm(n){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(n)}function Rm(n){const e=n.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),r=e[e.length-2].padStart(4,"0"),s=`${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return A1(s)}function Fm(n){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)}function Lm(n){const e=n.split(":"),t=e[e.length-1];return A1(t)}function Nm(n){return/^::$/.test(n)||/^::1$/.test(n)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(n)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(n)||/^ff([0-9a-fA-F]{2,2}):/i.test(n)}function Yn(n){return On(n)?A1(n):Tm(n)?Rm(n):Fm(n)?Lm(n):v1(n)?Nm(n):void 0}const Mm=n=>n.toString().split("/").slice(1),ai=n=>({match:e=>e.length<1?!1:n(e[0])?e.slice(1):!1,pattern:"fn"}),te=n=>({match:e=>ai(t=>t===n).match(e),pattern:n}),Zn=()=>({match:n=>ai(e=>typeof e=="string").match(n),pattern:"{string}"}),Ls=()=>({match:n=>ai(e=>!isNaN(parseInt(e))).match(n),pattern:"{number}"}),fe=()=>({match:n=>{if(n.length<2||n[0]!=="p2p"&&n[0]!=="ipfs")return!1;if(n[1].startsWith("Q")||n[1].startsWith("1"))try{Ce.decode(`z${n[1]}`)}catch{return!1}else return!1;return n.slice(2)},pattern:"/p2p/{peerid}"}),_o=()=>({match:n=>{if(n.length<2||n[0]!=="certhash")return!1;try{Dh.decode(n[1])}catch{return!1}return n.slice(2)},pattern:"/certhash/{certhash}"}),ue=n=>({match:e=>{const t=n.match(e);return t===!1?e:t},pattern:`optional(${n.pattern})`}),it=(...n)=>({match:e=>{let t;for(const r of n){const s=r.match(e);s!==!1&&(t==null||s.length<t.length)&&(t=s)}return t??!1},pattern:`or(${n.map(e=>e.pattern).join(", ")})`}),ne=(...n)=>({match:e=>{for(const t of n){const r=t.match(e);if(r===!1)return!1;e=r}return e},pattern:`and(${n.map(e=>e.pattern).join(", ")})`});function Ae(...n){function e(s){let i=Mm(s);for(const o of n){const a=o.match(i);if(a===!1)return!1;i=a}return i}function t(s){return e(s)!==!1}function r(s){const i=e(s);return i===!1?!1:i.length===0}return{matchers:n,matches:t,exactMatch:r}}const Om=fe(),Um=Ae(Om),Vo=ne(te("dns4"),Zn()),Ko=ne(te("dns6"),Zn()),jo=ne(te("dnsaddr"),Zn()),k1=ne(te("dns"),Zn());Ae(Vo,ue(fe()));Ae(Ko,ue(fe()));Ae(jo,ue(fe()));Ae(it(k1,jo,Vo,Ko),ue(fe()));const o3=ne(te("ip4"),ai(On)),a3=ne(te("ip6"),ai(v1)),B1=it(o3,a3),ir=it(B1,k1,Vo,Ko,jo);Ae(it(B1,ne(it(k1,jo,Vo,Ko),ue(fe()))));const Ru=Ae(o3),Fu=Ae(a3);Ae(B1);const D1=ne(ir,te("tcp"),Ls()),ci=ne(ir,te("udp"),Ls()),yc=Ae(ne(D1,ue(fe())));Ae(ci);const I1=ne(ci,te("quic"),ue(fe())),Go=ne(ci,te("quic-v1"),ue(fe())),$m=it(I1,Go);Ae(I1);const Hm=Ae(Go),xc=it(ir,D1,ci,I1,Go),c3=it(ne(xc,te("ws"),ue(fe()))),So=Ae(c3),l3=it(ne(xc,te("wss"),ue(fe())),ne(xc,te("tls"),ue(ne(te("sni"),Zn())),te("ws"),ue(fe()))),bc=Ae(l3),u3=ne(ci,te("webrtc-direct"),ue(_o()),ue(_o()),ue(fe())),Lu=Ae(u3),d3=ne(Go,te("webtransport"),ue(_o()),ue(_o()),ue(fe())),Nu=Ae(d3),Ao=it(c3,l3,ne(D1,ue(fe())),ne($m,ue(fe())),ne(ir,ue(fe())),u3,d3,fe());Ae(Ao);const zm=ne(Ao,te("p2p-circuit"),fe()),vc=Ae(zm),qm=it(ne(Ao,te("p2p-circuit"),te("webrtc"),ue(fe())),ne(Ao,te("webrtc"),ue(fe())),ne(te("webrtc"),ue(fe()))),Mu=Ae(qm),Vm=it(ne(ir,te("tcp"),Ls(),te("http"),ue(fe())),ne(ir,te("http"),ue(fe())));Ae(Vm);const Km=it(ne(ir,te("tcp"),it(ne(te("443"),te("http")),ne(Ls(),te("https")),ne(Ls(),te("tls"),te("http"))),ue(fe())),ne(ir,te("tls"),te("http"),ue(fe())),ne(ir,te("https"),ue(fe())));Ae(Km);const jm=it(ne(te("memory"),Zn(),ue(fe())));Ae(jm);const Ou=864e13,Gm=448,Ra=449,Wm=53,Qm=54,Ym=55,Zm=56;class Xm{constructor(e,t={}){f(this,"log");f(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){const t=this.findHost(e);for(const r of this.mappings.values())if(r.domain===t)return!0;return!1}add(e,t){t.forEach(r=>{this.log("add DNS mapping %s to %s",r,e);const s=Yn(r)===!0;this.mappings.set(r,{domain:e,verified:s,expires:s?Ou-Date.now():0,lastVerified:s?Ou-Date.now():void 0})})}remove(e){const t=this.findHost(e);let r=!1;for(const[s,i]of this.mappings.entries())i.domain===t&&(this.log("removing %s to %s DNS mapping %e",s,i.domain,new Error("where")),this.mappings.delete(s),r=r||i.verified);return r}getAll(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r].multiaddr.stringTuples(),o=i[0][1];if(o!=null)for(const[a,c]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(i,c.domain)&&(e.splice(r,1),r--,t.push({multiaddr:be(`/${i.map(u=>[me(u[0]).name,u[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){var r;for(let s=0;s<e.length;s++)if(e[s][0]===Gm&&((r=e[s+1])==null?void 0:r[0])!==Ra)return e.splice(s+1,0,[Ra,t]),!0;return!1}confirm(e,t){const r=this.findHost(e);let s=!1;for(const[i,o]of this.mappings.entries())o.domain===r&&(this.log("marking %s to %s DNS mapping as verified",i,o.domain),s=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return s}unconfirm(e,t){const r=this.findHost(e);let s=!1;for(const[i,o]of this.mappings.entries())o.domain===r&&(this.log("removing verification of %s to %s DNS mapping",i,o.domain),s=s||o.verified,o.verified=!1,o.expires=Date.now()+t);return s}findHost(e){for(const t of e.stringTuples())if(t[0]===Ra||t[0]===Wm||t[0]===Qm||t[0]===Ym||t[0]===Zm)return t[1]}}const Fa=4,La=41,Na=6,Jm=273;class ey{constructor(e,t={}){f(this,"log");f(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){const t=e.stringTuples();for(const r of this.mappings.values())for(const s of r)if(s.externalIp===t[0][1])return!0;return!1}add(e,t,r,s=t,i="tcp"){const o=`${e}-${t}-${i}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:r,externalPort:s,externalFamily:On(r)?4:6,protocol:i,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),r=t[0][1]??"",s=t[1][0]===Na?"tcp":"udp",i=parseInt(t[1][1]??"0");let o=!1;for(const[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){const u=c[l];u.externalIp===r&&u.externalPort===i&&u.protocol===s&&(this.log("removing %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,r,i,s),o=o||u.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:r}of e){const s=r.stringTuples();let i;if((s[0][0]===Fa||s[0][0]===La)&&s[1][0]===Na?i=`${s[0][1]}-${s[1][1]}-tcp`:(s[0][0]===Fa||s[0][0]===La)&&s[1][0]===Jm&&(i=`${s[0][1]}-${s[1][1]}-udp`),i==null)continue;const o=this.mappings.get(i);if(o!=null)for(const a of o)s[0][0]=a.externalFamily===4?Fa:La,s[0][1]=a.externalIp,s[1][1]=`${a.externalPort}`,t.push({multiaddr:be(`/${s.map(c=>[me(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const s=e.stringTuples()[0][1];let i=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===s&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),i=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return i}unconfirm(e,t){const r=e.stringTuples(),s=r[0][1]??"",i=r[1][0]===Na?"tcp":"udp",o=parseInt(r[1][1]??"0");let a=!1;for(const c of this.mappings.values())for(let l=0;l<c.length;l++){const u=c[l];u.externalIp===s&&u.externalPort===o&&u.protocol===i&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,s,o,i),a=a||u.verified,u.verified=!1,u.expires=Date.now()+t)}return a}}const ty=4,ry=41;function ny(n){try{const[[e,t]]=n.stringTuples();if(t==null)return!1;if(e===ty)return t.startsWith("169.254.");if(e===ry)return t.toLowerCase().startsWith("fe80")}catch{}return!1}const sy=4,iy=41;function h3(n){try{const[[e]]=n.stringTuples();return e===sy||e===iy}catch{}return!1}function ko(n){try{if(!h3(n))return!1;const[[,e]]=n.stringTuples();return e==null?!1:Yn(e)??!1}catch{}return!0}const oy={maxObservedAddresses:10};class ay{constructor(e,t={}){f(this,"log");f(this,"addresses");f(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??oy.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(ko(e)||ny(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:be(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var r;const t=((r=this.addresses.get(e.toString()))==null?void 0:r.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const r=e.toString(),s=this.addresses.get(r)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},i=s.verified;return s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now(),this.log("marking observed address %a as verified",r),this.addresses.set(r,s),i}}const cy=4,ly=41,uy=53,dy=54,hy=55,fy=56,py=[cy,ly,uy,dy,hy,fy];function Uu(n){try{const[[e]]=n.stringTuples();return py.includes(e)}catch{}return!1}const gy={maxObservedAddresses:10};class my{constructor(e,t={}){f(this,"log");f(this,"addresses");f(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??gy.maxObservedAddresses}get(e,t){if(ko(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const r=this.toKey(e);let s=this.addresses.get(r);return s==null&&(s={verified:!Uu(e),expires:0},this.addresses.set(r,s)),{multiaddr:e,verified:s.verified,type:"transport",expires:s.expires,lastVerified:s.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var s;const t=this.toKey(e),r=((s=this.addresses.get(t))==null?void 0:s.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),r}confirm(e,t){const r=this.toKey(e),s=this.addresses.get(r)??{verified:!1,expires:0,lastVerified:0},i=s.verified;return s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now(),this.addresses.set(r,s),i}unconfirm(e,t){const r=this.toKey(e),s=this.addresses.get(r)??{verified:!1,expires:0},i=s.verified;return s.verified=!1,s.expires=Date.now()+t,this.addresses.set(r,s),i}toKey(e){if(Uu(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const $u=6e4,Hu={addressVerificationTTL:$u*10,addressVerificationRetry:$u*5},yy=n=>n;function Ma(n,e){const t=n.getPeerId();return t!=null&&Xr(t).equals(e)&&(n=n.decapsulate(be(`/p2p/${e.toString()}`))),n}var cd;cd=Symbol.toStringTag;class xy{constructor(e,t={}){f(this,"log");f(this,"components");f(this,"listen");f(this,"announce");f(this,"appendAnnounce");f(this,"announceFilter");f(this,"observed");f(this,"dnsMappings");f(this,"ipMappings");f(this,"transportAddresses");f(this,"observedAddressFilter");f(this,"addressVerificationTTL");f(this,"addressVerificationRetry");f(this,cd,"@libp2p/address-manager");const{listen:r=[],announce:s=[],appendAnnounce:i=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=r.map(o=>o.toString()),this.announce=new Set(s.map(o=>o.toString())),this.appendAnnounce=new Set(i.map(o=>o.toString())),this.observed=new ay(e,t),this.dnsMappings=new Xm(e,t),this.ipMappings=new ey(e,t),this.transportAddresses=new my(e,t),this.announceFilter=t.announceFilter??yy,this.observedAddressFilter=Yf(1024),this.addressVerificationTTL=t.addressVerificationTTL??Hu.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??Hu.addressVerificationRetry,this._updatePeerStoreAddresses=Dm(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>be(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>be(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>be(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),r=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(r)||(this.observedAddressFilter.add(r),e=Ma(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=Ma(e,this.components.peerId);let r=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),r=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1)),r||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=Ma(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(r=>{if(!r.verified)return!1;const s=r.multiaddr.toString();return e.has(s)?!1:(e.add(s),!0)}).map(r=>r.multiaddr);return this.announceFilter(t.map(r=>{var i;const s=be(r);return((i=s.protos().pop())==null?void 0:i.path)===!0||s.getPeerId()===this.components.peerId.toString()?s:s.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(s=>{s.updateAnnounceAddrs(e)}),e.map(s=>({multiaddr:s,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(s=>this.transportAddresses.get(s,this.addressVerificationTTL)));const r=this.getAppendAnnounceAddrs();return r.length>0&&(this.components.transportManager.getListeners().forEach(s=>{s.updateAnnounceAddrs(r)}),t=t.concat(r.map(s=>({multiaddr:s,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(be(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,r,s=t,i="tcp"){this.ipMappings.add(e,t,r,s,i),this.observed.removePrefixed(`/ip${On(r)?4:6}/${r}/${i}/${s}`)}removePublicAddressMapping(e,t,r,s=t,i="tcp"){this.ipMappings.remove(be(`/ip${On(r)?4:6}/${r}/${i}/${s}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||Yn(t.host)===!0)return!1;const r=this.components.transportManager.getListeners(),s=[i=>So.exactMatch(i)||bc.exactMatch(i),i=>yc.exactMatch(i),i=>Hm.exactMatch(i)];for(const i of s){if(!i(e))continue;const o=r.filter(l=>l.getAddrs().filter(u=>u.toOptions().family===4&&i(u)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}}var zu;(function(n){n.NOT_STARTED_YET="The libp2p node is not started yet",n.NOT_FOUND="Not found"})(zu||(zu={}));class by extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class vy extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class Oa extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class qu extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class wy extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class Ey extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class Cy extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class Vu extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class _y extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class Sy extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class Ay extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class ky extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class By extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class ki extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class Bi extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class Dy extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class Iy{constructor(e={}){f(this,"components",{});f(this,"_started",!1);this.components={};for(const[t,r]of Object.entries(e))this.components[t]=r;this.components.logger==null&&(this.components.logger=jf())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>Qc(t)).map(async t=>{var r;await((r=t[e])==null?void 0:r.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const Py=["metrics","connectionProtector","dns"],Ty=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function Ry(n={}){const e=new Iy(n);return new Proxy(e,{get(r,s,i){if(typeof s=="string"&&!Ty.includes(s)){const o=e.components[s];if(o==null&&!Py.includes(s))throw new by(`${s} not set`);return o}return Reflect.get(r,s,i)},set(r,s,i){return typeof s=="string"?e.components[s]=i:Reflect.set(r,s,i),!0}})}function Fy(n){const e={};for(const t of Object.values(n.components))for(const r of Ly(t))e[r]=!0;for(const t of Object.values(n.components))for(const r of Ny(t))if(e[r]!==!0)throw new vy(`Service "${My(t)}" required capability "${r}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function Ly(n){return Array.isArray(n==null?void 0:n[io])?n[io]:[]}function Ny(n){return Array.isArray(n==null?void 0:n[j0])?n[j0]:[]}function My(n){return(n==null?void 0:n[Symbol.toStringTag])??(n==null?void 0:n.toString())??"unknown"}const Oy=4,Uy=41;function $y(n={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(So.matches(e))return!1;const t=e.stringTuples();return t[0][0]===Oy||t[0][0]===Uy?!!Yn(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...n}}const Ku=()=>{const n=new Error("Delay aborted");return n.name="AbortError",n},Hy=new WeakMap;function zy({clearTimeout:n,setTimeout:e}={}){return(t,{value:r,signal:s}={})=>{if(s!=null&&s.aborted)return Promise.reject(Ku());let i,o,a;const c=n??clearTimeout,l=()=>{c(i),a(Ku())},u=()=>{s&&s.removeEventListener("abort",l)},d=new Promise((h,g)=>{o=()=>{u(),h(r)},a=g,i=(e??setTimeout)(o,t)});return s&&s.addEventListener("abort",l,{once:!0}),Hy.set(d,()=>{c(i),i=null,o()}),d}}const qy=zy();class Vy extends Error{constructor(t="Rate limit exceeded",r){super(t);f(this,"remainingPoints");f(this,"msBeforeNext");f(this,"consumedPoints");f(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=r.remainingPoints,this.msBeforeNext=r.msBeforeNext,this.consumedPoints=r.consumedPoints,this.isFirstInDuration=r.isFirstInDuration}}class f3 extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}f(f3,"name","QueueFullError");class Ky{constructor(e={}){f(this,"memoryStorage");f(this,"points");f(this,"duration");f(this,"blockDuration");f(this,"execEvenly");f(this,"execEvenlyMinDelayMs");f(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new jy}async consume(e,t=1,r={}){const s=this.getKey(e),i=this._getKeySecDuration(r);let o=this.memoryStorage.incrby(s,t,i);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(s,o.consumedPoints,this.blockDuration)),new Vy("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await qy(a)}return o}penalty(e,t=1,r={}){const s=this.getKey(e),i=this._getKeySecDuration(r),o=this.memoryStorage.incrby(s,t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,r={}){const s=this.getKey(e),i=this._getKeySecDuration(r),o=this.memoryStorage.incrby(s,-t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const r=t*1e3,s=this.points+1;return this.memoryStorage.set(this.getKey(e),s,t),{remainingPoints:0,msBeforeNext:r===0?-1:r,consumedPoints:s,isFirstInDuration:!1}}set(e,t,r=0){const s=(r>=0?r:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,r),{remainingPoints:0,msBeforeNext:s===0?-1:s,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class jy{constructor(){f(this,"storage");this.storage=new Map}incrby(e,t,r){const s=this.storage.get(e);if(s!=null){const i=s.expiresAt!=null?s.expiresAt.getTime()-new Date().getTime():-1;return s.expiresAt==null||i>0?(s.value+=t,{remainingPoints:0,msBeforeNext:i,consumedPoints:s.value,isFirstInDuration:!1}):this.set(e,t,r)}return this.set(e,t,r)}set(e,t,r){const s=r*1e3,i=this.storage.get(e);i!=null&&clearTimeout(i.timeoutId);const o={value:t,expiresAt:s>0?new Date(Date.now()+s):void 0};return this.storage.set(e,o),s>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},s),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:s===0?-1:s,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}function p3(n){if(yh(n))return{peerId:n,multiaddrs:[]};let e=Array.isArray(n)?n:[n],t;if(e.length>0){const r=e[0].getPeerId();t=r==null?void 0:Xr(r),e.forEach(s=>{if(!zo(s))throw new Fo("Invalid multiaddr");const i=s.getPeerId();if(i==null){if(t!=null)throw new ee("Multiaddrs must all have the same peer id or have no peer id")}else{const o=Xr(i);if((t==null?void 0:t.equals(o))!==!0)throw new ee("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(r=>!Um.exactMatch(r)),{peerId:t,multiaddrs:e}}const Gy=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function Wy(n,e){var s;const t=((s=n==null?void 0:n.streams)==null?void 0:s.map(i=>i.protocol))??[],r=(e==null?void 0:e.closableProtocols)??Gy;if(!(t.filter(i=>i!=null&&!r.includes(i)).length>0))try{await(n==null?void 0:n.close(e))}catch(i){n==null||n.abort(i)}}const g3=1e4,Qy=1e4,ju=1e4,m3=25,Yy=5,Zy=10,Xy=5,Jy="last-dial-failure",ex="last-dial-success",y3=500,x3=100,b3=50;async function tx(n,e){let t=!1;for(const s of C1.keys())if(t=n.protoNames().includes(s),t)break;if(!t)return[n];const r=await n.resolve(e);return e.log("resolved %s to",n,r.map(s=>s.toString())),r}function wc(n){try{let e;if(typeof n=="string"?e=be(n):e=n,!e.protoNames().includes("ipcidr")){const r=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(r)}return jp(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${n}`)}}const rx={maxConnections:x3};class nx{constructor(e,t={}){f(this,"maxConnections");f(this,"connectionManager");f(this,"peerStore");f(this,"allow");f(this,"events");f(this,"log");this.maxConnections=t.maxConnections??rx.maxConnections,this.allow=(t.allow??[]).map(r=>wc(r)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const r=new oi;for(const a of e){const c=a.remotePeer;if(!r.has(c)){r.set(c,0);try{const l=await this.peerStore.get(c);r.set(c,[...l.tags.values()].reduce((u,d)=>u+d.value,0))}catch(l){l.name!=="NotFoundError"&&this.log.error("error loading peer tags",l)}}}const s=this.sortConnections(e,r),i=Math.max(t-this.maxConnections,0),o=[];for(const a of s)if(this.log("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(l=>l.contains(a.remoteAddr.nodeAddress().address))||o.push(a),o.length===i)break;await Promise.all(o.map(async a=>{await Wy(a,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((r,s)=>{const i=r.timeline.open,o=s.timeline.open;return i<o?1:i>o?-1:0}).sort((r,s)=>r.direction==="outbound"&&s.direction==="inbound"?1:r.direction==="inbound"&&s.direction==="outbound"?-1:0).sort((r,s)=>r.streams.length>s.streams.length?1:r.streams.length<s.streams.length?-1:0).sort((r,s)=>{const i=t.get(r.remotePeer)??0,o=t.get(s.remotePeer)??0;return i>o?1:i<o?-1:0})}}function He(){const n={};return n.promise=new Promise((e,t)=>{n.resolve=e,n.reject=t}),n}class Gu{constructor(e){f(this,"buffer");f(this,"mask");f(this,"top");f(this,"btm");f(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class Ua{constructor(e={}){f(this,"size");f(this,"hwm");f(this,"head");f(this,"tail");this.hwm=e.splitLimit??16,this.head=new Gu(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new Gu(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let sx=class extends Error{constructor(t,r){super(t??"The operation was aborted");f(this,"type");f(this,"code");this.type="aborted",this.code=r??"ABORT_ERR"}};function v3(n={}){return ix(t=>{const r=t.shift();if(r==null)return{done:!0};if(r.error!=null)throw r.error;return{done:r.done===!0,value:r.value}},n)}function ix(n,e){e=e??{};let t=e.onEnd,r=new Ua,s,i,o,a=He();const c=async()=>{try{return r.isEmpty()?o?{done:!0}:await new Promise((y,w)=>{i=v=>{i=null,r.push(v);try{y(n(r))}catch(b){w(b)}return s}}):n(r)}finally{r.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=He()})}},l=y=>i!=null?i(y):(r.push(y),s),u=y=>(r=new Ua,i!=null?i({error:y}):(r.push({error:y}),s)),d=y=>{if(o)return s;if((e==null?void 0:e.objectMode)!==!0&&(y==null?void 0:y.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:y})},h=y=>o?s:(o=!0,y!=null?u(y):l({done:!0})),g=()=>(r=new Ua,h(),{done:!0}),p=y=>(h(y),{done:!0});if(s={[Symbol.asyncIterator](){return this},next:c,return:g,throw:p,push:d,end:h,get readableLength(){return r.size},onEmpty:async y=>{const w=y==null?void 0:y.signal;if(w==null||w.throwIfAborted(),r.isEmpty())return;let v,b;w!=null&&(v=new Promise((x,E)=>{b=()=>{E(new sx)},w.addEventListener("abort",b)}));try{await Promise.race([a.promise,v])}finally{b!=null&&w!=null&&(w==null||w.removeEventListener("abort",b))}}},t==null)return s;const m=s;return s={[Symbol.asyncIterator](){return this},next(){return m.next()},throw(y){return m.throw(y),t!=null&&(t(y),t=void 0),{done:!0}},return(){return m.return(),t!=null&&(t(),t=void 0),{done:!0}},push:d,end(y){return m.end(y),t!=null&&(t(y),t=void 0),s},get readableLength(){return m.readableLength},onEmpty:y=>m.onEmpty(y)},s}let ox=class extends Error{constructor(t,r){super(t??"The operation was aborted");f(this,"type");f(this,"code");this.type="aborted",this.name="AbortError",this.code=r??"ABORT_ERR"}};async function Yi(n,e,t,r){const s=new ox(r==null?void 0:r.errorMessage,r==null?void 0:r.errorCode);return(t==null?void 0:t.aborted)===!0?Promise.reject(s):new Promise((i,o)=>{function a(){t==null||t.removeEventListener("abort",u),n.removeEventListener(e,c),(r==null?void 0:r.errorEvent)!=null&&n.removeEventListener(r.errorEvent,l)}const c=d=>{var h;try{if(((h=r==null?void 0:r.filter)==null?void 0:h.call(r,d))===!1)return}catch(g){a(),o(g);return}a(),i(d)},l=d=>{a(),o(d.detail)},u=()=>{a(),o(s)};t==null||t.addEventListener("abort",u),n.addEventListener(e,c),(r==null?void 0:r.errorEvent)!=null&&n.addEventListener(r.errorEvent,l)})}let Wu=class extends Error{constructor(t,r,s){super(t??"The operation was aborted");f(this,"type");f(this,"code");this.type="aborted",this.name=s??"AbortError",this.code=r??"ABORT_ERR"}};async function tn(n,e,t){if(e==null)return n;if(e.aborted)return n.catch(()=>{}),Promise.reject(new Wu(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let r;const s=new Wu(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([n,new Promise((i,o)=>{r=()=>{o(s)},e.addEventListener("abort",r)})])}finally{r!=null&&e.removeEventListener("abort",r)}}class ax{constructor(e){f(this,"deferred");f(this,"signal");var t;this.signal=e,this.deferred=He(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new ks)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function cx(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class lx{constructor(e,t){f(this,"id");f(this,"fn");f(this,"options");f(this,"recipients");f(this,"status");f(this,"timeline");f(this,"controller");this.id=cx(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,r)=>{var s;return t&&((s=r.signal)==null?void 0:s.aborted)===!0},!0)&&(this.controller.abort(new ks),this.cleanup())}async join(e={}){var r;const t=new ax(e.signal);return this.recipients.push(t),(r=e.signal)==null||r.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await tn(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}class Wo extends ar{constructor(t={}){var r;super();f(this,"concurrency");f(this,"maxSize");f(this,"queue");f(this,"pending");f(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((r=t.metrics)==null||r.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(const r of this.queue)if(r.status==="queued"){t=r;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let r=0;r<this.queue.length;r++)if(this.queue[r]===t){this.queue.splice(r,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,r){var i;if((i=r==null?void 0:r.signal)==null||i.throwIfAborted(),this.size===this.maxSize)throw new f3;const s=new lx(t,r);return this.enqueue(s),this.safeDispatchEvent("add"),this.tryToStartAnother(),s.join(r).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:s,result:o}}),o)).catch(o=>{if(s.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===s){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:s,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new ks)}),this.clear()}async onEmpty(t){this.size!==0&&await Yi(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,r){this.size<t||await Yi(this,"next",r==null?void 0:r.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Yi(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,u,d;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const r=v3({objectMode:!0}),s=h=>{h!=null?this.abort():this.clear(),r.end(h)},i=h=>{h.detail!=null&&r.push(h.detail)},o=h=>{s(h.detail)},a=()=>{s()},c=()=>{s(new ks("Queue aborted"))};this.addEventListener("completed",i),this.addEventListener("error",o),this.addEventListener("idle",a),(u=t==null?void 0:t.signal)==null||u.addEventListener("abort",c);try{yield*r}finally{this.removeEventListener("completed",i),this.removeEventListener("error",o),this.removeEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.removeEventListener("abort",c),s()}}}class ux extends Wo{constructor(e={}){super({...e,sort:(t,r)=>t.options.priority>r.options.priority?-1:t.options.priority<r.options.priority?1:0})}}function Yt(n){const e=new globalThis.AbortController;function t(){e.abort();for(const i of n)(i==null?void 0:i.removeEventListener)!=null&&i.removeEventListener("abort",t)}for(const i of n){if((i==null?void 0:i.aborted)===!0){t();break}(i==null?void 0:i.addEventListener)!=null&&i.addEventListener("abort",t)}function r(){for(const i of n)(i==null?void 0:i.removeEventListener)!=null&&i.removeEventListener("abort",t)}const s=e.signal;return s.clear=r,s}function dx(n){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(n)||/^::1$/.test(n)}function Qu(n){if(!h3(n))return!1;const{address:e}=n.nodeAddress();return dx(e)}function hx(n,e){const t=yc.exactMatch(n.multiaddr),r=yc.exactMatch(e.multiaddr);if(t&&!r)return-1;if(!t&&r)return 1;const s=bc.exactMatch(n.multiaddr),i=bc.exactMatch(e.multiaddr);if(s&&!i)return-1;if(!s&&i)return 1;const o=So.exactMatch(n.multiaddr),a=So.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=Mu.exactMatch(n.multiaddr),l=Mu.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const u=Lu.exactMatch(n.multiaddr),d=Lu.exactMatch(e.multiaddr);if(u&&!d)return-1;if(!u&&d)return 1;const h=Nu.exactMatch(n.multiaddr),g=Nu.exactMatch(e.multiaddr);return h&&!g?-1:!h&&g?1:0}function fx(n,e){const t=Qu(n.multiaddr),r=Qu(e.multiaddr);return t&&!r?1:!t&&r?-1:0}function px(n,e){const t=ko(n.multiaddr),r=ko(e.multiaddr);return t&&!r?1:!t&&r?-1:0}function gx(n,e){return n.isCertified&&!e.isCertified?-1:!n.isCertified&&e.isCertified?1:0}function mx(n,e){const t=vc.exactMatch(n.multiaddr),r=vc.exactMatch(e.multiaddr);return t&&!r?1:!t&&r?-1:0}function yx(n){return n.sort(hx).sort(gx).sort(mx).sort(px).sort(fx)}const Di={maxParallelDials:b3,maxDialQueueLength:y3,maxPeerAddrsToDial:m3,dialTimeout:g3};class xx{constructor(e,t={}){f(this,"queue");f(this,"components");f(this,"addressSorter");f(this,"maxPeerAddrsToDial");f(this,"maxDialQueueLength");f(this,"dialTimeout");f(this,"shutDownController");f(this,"connections");f(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??Di.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??Di.maxDialQueueLength,this.dialTimeout=t.dialTimeout??Di.dialTimeout,this.connections=t.connections??new oi,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[r,s]of Object.entries(t.resolvers??{}))C1.set(r,s);this.queue=new ux({concurrency:t.maxParallelDials??Di.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",r=>{var s;((s=r.detail)==null?void 0:s.name)!==ks.name&&this.log.error("error in dial queue - %e",r.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,c,l;const{peerId:r,multiaddrs:s}=p3(e),i=Array.from(this.connections.values()).flat().find(u=>t.force===!0?!1:u.remotePeer.equals(r)?!0:s.find(d=>d.equals(u.remoteAddr)));if((i==null?void 0:i.status)==="open")return this.log("already connected to %a",i.remoteAddr),(a=t.onProgress)==null||a.call(t,new bt("dial-queue:already-connected")),i;const o=this.queue.queue.find(u=>{if((r==null?void 0:r.equals(u.options.peerId))===!0)return!0;const d=u.options.multiaddrs;if(d==null)return!1;for(const h of s)if(d.has(h.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",r);for(const u of s)o.options.multiaddrs.add(u.toString());return(c=t.onProgress)==null||c.call(t,new bt("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new $i("Dial queue is full");return this.log("creating dial target for %p",r,s.map(u=>u.toString())),(l=t.onProgress)==null||l.call(t,new bt("dial-queue:add-to-dial-queue")),this.queue.add(async u=>{var h;(h=u.onProgress)==null||h.call(u,new bt("dial-queue:start-dial"));const d=Yt([this.shutDownController.signal,u.signal]);try{return await this.dialPeer(u,d)}finally{d.clear()}},{peerId:r,priority:t.priority??E3,multiaddrs:new Set(s.map(u=>u.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var u;const r=e.peerId,s=e.multiaddrs,i=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",r);o||s.size>0;){c++,o=!1;const d=[],h=new Set(e.multiaddrs);s.clear(),this.log("calculating addrs to dial %p from %s",r,[...h]);const g=await this.calculateMultiaddrs(r,h,{...e,signal:t});for(const p of g){if(i.has(p.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",p.multiaddr,r);continue}d.push(p)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",r,d.map(p=>p.multiaddr.toString())),(u=e==null?void 0:e.onProgress)==null||u.call(e,new bt("dial-queue:calculated-addresses",d));for(const p of d){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new $i("Peer had more than maxPeerAddrsToDial");a++;try{const m=await this.components.transportManager.dial(p.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",p.multiaddr);try{await this.components.peerStore.merge(m.remotePeer,{multiaddrs:[m.remoteAddr],metadata:{[ex]:Y(Date.now().toString())}})}catch(y){this.log.error("could not update last dial failure key for %p",r,y)}return m}catch(m){if(this.log.error("dial failed to %a",p.multiaddr,m),i.add(p.multiaddr.toString()),r!=null)try{await this.components.peerStore.merge(r,{metadata:{[Jy]:Y(Date.now().toString())}})}catch(y){this.log.error("could not update last dial failure key for %p",r,y)}if(t.aborted)throw new _6(m.message);l.push(m)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,r={}){var d,h;const s=[...t].map(g=>({multiaddr:be(g),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new $i("Tried to dial self");if(await((h=(d=this.components.connectionGater).denyDialPeer)==null?void 0:h.call(d,e))===!0)throw new Vu("The dial request is blocked by gater.allowDialPeer");if(s.length===0){this.log("loading multiaddrs for %p",e);try{const g=await this.components.peerStore.get(e);s.push(...g.addresses),this.log("loaded multiaddrs for %p",e,s.map(({multiaddr:p})=>p.toString()))}catch(g){if(g.name!=="NotFoundError")throw g}}if(s.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const g=await this.components.peerRouting.findPeer(e,r);this.log("found multiaddrs for %p in the peer routing",e,s.map(({multiaddr:p})=>p.toString())),s.push(...g.multiaddrs.map(p=>({multiaddr:p,isCertified:!1})))}catch(g){g.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,g)}}}let i=(await Promise.all(s.map(async g=>{const p=await tx(g.multiaddr,{dns:this.components.dns,...r,log:this.log});return p.length===1&&p[0].equals(g.multiaddr)?g:p.map(m=>({multiaddr:m,isCertified:!1}))}))).flat();if(e!=null){const g=`/p2p/${e.toString()}`;i=i.map(p=>{const m=p.multiaddr.protos().pop();return(m==null?void 0:m.path)===!0?p:p.multiaddr.getPeerId()==null?{multiaddr:p.multiaddr.encapsulate(g),isCertified:p.isCertified}:p})}const o=i.filter(g=>{if(this.components.transportManager.dialTransportForMultiaddr(g.multiaddr)==null)return!1;const p=g.multiaddr.getPeerId();return e!=null&&p!=null?e.equals(p):!0}),a=new Map;for(const g of o){const p=g.multiaddr.toString(),m=a.get(p);if(m!=null){m.isCertified=m.isCertified||g.isCertified||!1;continue}a.set(p,g)}const c=[...a.values()];if(c.length===0)throw new Ay("The dial request has no valid addresses");const l=[];for(const g of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(g.multiaddr)||l.push(g);const u=this.addressSorter==null?yx(l):l.sort(this.addressSorter);if(u.length===0)throw new Vu("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",i.map(({multiaddr:g})=>g.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",u.map(({multiaddr:g})=>g.toString())),u}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const r=await this.calculateMultiaddrs(void 0,new Set(e.map(s=>s.toString())),t);return t.runOnLimitedConnection===!1?r.find(s=>!vc.matches(s.multiaddr))!=null:!0}catch(r){this.log.trace("error calculating if multiaddr(s) were dialable",r)}return!1}}class Ec extends Wo{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}var w3={};function It(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var bx=It;It.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};It.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};It.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};It.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};It.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};It.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};It.prototype.start=It.prototype.try;It.prototype.errors=function(){return this._errors};It.prototype.attempts=function(){return this._attempts};It.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],i=s.message,o=(n[i]||0)+1;n[i]=o,o>=t&&(e=s,t=o)}return e};(function(n){var e=bx;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],o=0;o<r.retries;o++)i.push(this.createTimeout(o,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(o,r)),i.sort(function(a,c){return a-c}),i},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var o=0;o<s.length;o++){var a=s[o],c=t[a];t[a]=(function(u){var d=n.operation(r),h=Array.prototype.slice.call(arguments,1),g=h.pop();h.push(function(p){d.retry(p)||(p&&(arguments[0]=d.mainError()),g.apply(this,arguments))}),d.attempt(function(){u.apply(t,h)})}).bind(t,c),t[a].options=r}}})(w3);var vx=w3;const wx=Gn(vx),Ex=Object.prototype.toString,Cx=n=>Ex.call(n)==="[object Error]",_x=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function Sx(n){return n&&Cx(n)&&n.name==="TypeError"&&typeof n.message=="string"?n.message==="Load failed"?n.stack===void 0:_x.has(n.message):!1}class Ax extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Yu=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n};async function kx(n,e){return new Promise((t,r)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const s=wx.operation(e),i=()=>{var a;s.stop(),r((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",i,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",i),s.stop()};s.attempt(async a=>{try{const c=await n(a);o(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof Ax)throw c.originalError;if(c instanceof TypeError&&!Sx(c))throw c;if(Yu(c,a,e),await e.shouldRetry(c)||(s.stop(),r(c)),await e.onFailedAttempt(c),!s.retry(c))throw s.mainError()}catch(l){Yu(l,a,e),o(),r(l)}}})})}class Bx{constructor(e,t={}){f(this,"log");f(this,"queue");f(this,"started");f(this,"peerStore");f(this,"retries");f(this,"retryInterval");f(this,"backoffFactor");f(this,"connectionManager");f(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new Ec({concurrency:t.maxParallelReconnects??Xy,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",r=>{this.maybeReconnect(r.detail).catch(s=>{this.log.error("failed to maybe reconnect to %p - %e",r.detail,s)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);Zu(t)&&(this.queue.has(e)||this.queue.add(async r=>{await kx(async s=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:r==null?void 0:r.signal})}catch(i){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,s,this.retries,i),i}},{signal:r==null?void 0:r.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async r=>{this.log.error("failed to reconnect to %p - %e",e,r);const s={};[...t.tags.keys()].forEach(i=>{i.startsWith(Vc)&&(s[i]=void 0)}),await this.peerStore.merge(e,{tags:s}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async r=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,r)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>Zu(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(r=>{this.log.error(r)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function Zu(n){for(const e of n.tags.keys())if(e.startsWith(Vc))return!0;return!1}const E3=50,$a={maxConnections:x3,inboundConnectionThreshold:Yy,maxIncomingPendingConnections:Zy};var ld;ld=Symbol.toStringTag;class Dx{constructor(e,t={}){f(this,"started");f(this,"connections");f(this,"allow");f(this,"deny");f(this,"maxIncomingPendingConnections");f(this,"incomingPendingConnections");f(this,"outboundPendingConnections");f(this,"maxConnections");f(this,"dialQueue");f(this,"reconnectQueue");f(this,"connectionPruner");f(this,"inboundConnectionRateLimiter");f(this,"peerStore");f(this,"metrics");f(this,"events");f(this,"log");f(this,"peerId");f(this,ld,"@libp2p/connection-manager");var r;if(this.maxConnections=t.maxConnections??$a.maxConnections,this.maxConnections<1)throw new ee("Connection Manager maxConnections must be greater than 0");this.connections=new oi,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(s=>wc(s)),this.deny=(t.deny??[]).map(s=>wc(s)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??$a.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new Ky({points:t.inboundConnectionThreshold??$a.inboundConnectionThreshold,duration:1}),this.connectionPruner=new nx({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:(r=t.allow)==null?void 0:r.map(s=>be(s))}),this.dialQueue=new xx(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??b3,maxDialQueueLength:t.maxDialQueueLength??y3,maxPeerAddrsToDial:t.maxPeerAddrsToDial??m3,dialTimeout:t.dialTimeout??g3,resolvers:t.resolvers??{dnsaddr:Hf},connections:this.connections}),this.reconnectQueue=new Bx({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,r;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const s={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const i of this.connections.values())for(const o of i)s[o.direction]++;return s}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const s={};for(const i of this.connections.values())for(const o of i)for(const a of o.streams){const c=`${a.direction} ${a.protocol??"unnegotiated"}`;s[c]=(s[c]??0)+1}return s}}),(r=this.metrics)==null||r.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const s={};for(const o of this.connections.values())for(const a of o){const c={};for(const l of a.streams){const u=`${l.direction} ${l.protocol??"unnegotiated"}`;c[u]=(c[u]??0)+1}for(const[l,u]of Object.entries(c))s[l]=s[l]??[],s[l].push(u)}const i={};for(let[o,a]of Object.entries(s)){a=a.sort((l,u)=>l-u);const c=Math.floor(a.length*.9);i[o]=a[c]}return i}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await so(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await Yc(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const r of t)e.push((async()=>{try{await r.close()}catch(s){this.log.error(s)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const r=t.remotePeer,s=!this.connections.has(r),i=this.connections.get(r)??[];i.push(t),this.connections.set(r,i),r.publicKey!=null&&r.type==="RSA"&&await this.peerStore.patch(r,{publicKey:r.publicKey}),s&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,r=t.remotePeer,i=(this.connections.get(r)??[]).filter(o=>o.id!==t.id);this.connections.set(r,i),i.length===0&&(this.log("onDisconnect remove all connections for peer %p",r),this.connections.delete(r),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const r of this.connections.values())t=t.concat(r);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var r,s;if(!this.started)throw new Ds("Not started");this.outboundPendingConnections++;try{(r=t.signal)==null||r.throwIfAborted();const{peerId:i}=p3(e);if(this.peerId.equals(i))throw new jc("Can not dial self");if(i!=null&&t.force!==!0){this.log("dial %p",i);const l=this.getConnections(i).find(u=>u.limits==null);if(l!=null)return this.log("had an existing non-limited connection to %p",i),(s=t.onProgress)==null||s.call(t,new bt("dial-queue:already-connected")),l}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??E3});if(o.status!=="open")throw new Kc("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let c=!1;for(const l of a)if(l.id===o.id&&(c=!0),t.force!==!0&&l.id!==o.id&&l.remoteAddr.equals(o.remoteAddr))return o.abort(new Fo("Duplicate multiaddr connection")),l;return c||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const r=this.connections.get(e)??[];await Promise.all(r.map(async s=>{try{await s.close(t)}catch(i){s.abort(i)}}))}async acceptIncomingConnection(e){if(this.deny.some(s=>s.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(s=>s.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const s=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(s,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,s),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(r=>be(r))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}class Ha{constructor(e){f(this,"movingAverage");f(this,"variance");f(this,"deviation");f(this,"forecast");f(this,"timeSpan");f(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const r=this.alpha(t,this.previousTime),s=e-this.movingAverage,i=r*s;this.movingAverage=r*e+(1-r)*this.movingAverage,this.variance=(1-r)*(this.variance+s*i),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+r*s}else this.movingAverage=e;this.previousTime=t}}const Ix=1.2,Px=2,Tx=2e3;class Ns{constructor(e={}){f(this,"success");f(this,"failure");f(this,"next");f(this,"metric");f(this,"timeoutMultiplier");f(this,"failureMultiplier");f(this,"minTimeout");var t;this.success=new Ha(e.interval??5e3),this.failure=new Ha(e.interval??5e3),this.next=new Ha(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??Px,this.timeoutMultiplier=e.timeoutMultiplier??Ix,this.minTimeout=e.minTimeout??Tx,e.metricName!=null&&(this.metric=(t=e.metrics)==null?void 0:t.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),r=AbortSignal.timeout(t),s=Yt([e.signal,r]);return s.start=Date.now(),s.timeout=t,s}cleanUp(e){var r,s;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(r=this.metric)==null||r.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(s=this.metric)==null||s.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class Rx{constructor(){f(this,"readNext");f(this,"haveNext");f(this,"ended");f(this,"nextResult");f(this,"error");this.ended=!1,this.readNext=He(),this.haveNext=He()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=He(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=He(),await tn(this.readNext.promise,t==null?void 0:t.signal,t)}}function C3(){return new Rx}let Fx=class extends Error{constructor(){super(...arguments);f(this,"name","UnexpectedEOFError");f(this,"code","ERR_UNEXPECTED_EOF")}};function _3(n,e){const t=C3();n.sink(t).catch(async o=>{await t.end(o)}),n.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let r=n.source;n.source[Symbol.iterator]!=null?r=n.source[Symbol.iterator]():n.source[Symbol.asyncIterator]!=null&&(r=n.source[Symbol.asyncIterator]());const s=new Ie;return{read:async o=>{var c;if((c=o==null?void 0:o.signal)==null||c.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:l,value:u}=await tn(r.next(),o==null?void 0:o.signal);return l===!0?null:u}for(;s.byteLength<o.bytes;){const{value:l,done:u}=await tn(r.next(),o==null?void 0:o.signal);if(u===!0)throw new Fx("unexpected end of input");s.append(l)}const a=s.sublist(0,o.bytes);return s.consume(o.bytes),a},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(s.byteLength>0){const o=n.source;n.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield s:yield*s,yield*o}()}return n}}}const Lx=1e4,Nx="1.0.0",Mx="ping",Ox="ipfs",Xu=32,Ux=!0;var ud,dd;dd=Symbol.toStringTag,ud=io;class $x{constructor(e,t={}){f(this,"protocol");f(this,"components");f(this,"log");f(this,"heartbeatInterval");f(this,"pingIntervalMs");f(this,"abortController");f(this,"timeout");f(this,"abortConnectionOnPingFailure");f(this,dd,"@libp2p/connection-monitor");f(this,ud,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??Ox}/${Mx}/${Nx}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??Lx,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??Ux,this.timeout=new Ns({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var r;let t=Date.now();try{const s=this.timeout.getTimeoutSignal({signal:(r=this.abortController)==null?void 0:r.signal}),i=await e.newStream(this.protocol,{signal:s,runOnLimitedConnection:!0}),o=_3(i);t=Date.now(),await Promise.all([o.write(p1(Xu),{signal:s}),o.read({bytes:Xu,signal:s})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:s})}catch(s){if(s.name!=="UnsupportedProtocolError")throw s;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}function Hx(n){return n[Symbol.asyncIterator]!=null}async function zx(n,e,t){try{await Promise.all(n.map(async r=>{for await(const s of r)await e.push(s,{signal:t}),t.throwIfAborted()})),await e.end(void 0,{signal:t})}catch(r){await e.end(r,{signal:t}).catch(()=>{})}}async function*qx(n){const e=new AbortController,t=C3();zx(n,t,e.signal).catch(()=>{});try{yield*t}finally{e.abort()}}function*Vx(n){for(const e of n)yield*e}function Ms(...n){const e=[];for(const t of n)Hx(t)||e.push(t);return e.length===n.length?Vx(e):qx(n)}var hd;hd=Symbol.toStringTag;class Kx{constructor(e,t){f(this,"routers");f(this,"started");f(this,"components");f(this,hd,"@libp2p/content-routing");var r,s,i,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((r=e.metrics)==null?void 0:r.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()}),getAttributesFromYieldedValue:(c,l)=>({...l,providers:[...Array.isArray(l.providers)?l.providers:[],c.id.toString()]})}))??this.findProviders,this.provide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.provide,this.cancelReprovide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([c])=>({key:Q(c,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([c])=>({key:Q(c,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new Oa("No content routers available");const r=this,s=new Wt;for await(const i of Ms(...r.routers.map(o=>o.findProviders(e,t))))i!=null&&(i.multiaddrs.length>0&&await this.components.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),!s.has(i.id)&&(s.add(i.id),yield i))}async provide(e,t={}){if(this.routers.length===0)throw new Oa("No content routers available");await Promise.all(this.routers.map(async r=>{await r.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new Oa("No content routers available");await Promise.all(this.routers.map(async r=>{await r.cancelReprovide(e,t)}))}async put(e,t,r){if(!this.isStarted())throw new Ds;await Promise.all(this.routers.map(async s=>{await s.put(e,t,r)}))}async get(e,t){if(!this.isStarted())throw new Ds;return Promise.any(this.routers.map(async r=>r.get(e,t)))}}const Ii=globalThis.CustomEvent??Event;async function*Qo(n,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const r=e.ordered??!1,s=new EventTarget,i=[];let o=He(),a=He(),c=!1,l,u=!1;s.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const p of n){if(i.length===t&&(o=He(),await o.promise),u)break;const m={done:!1};i.push(m),p().then(y=>{m.done=!0,m.ok=!0,m.value=y,s.dispatchEvent(new Ii("task-complete"))},y=>{m.done=!0,m.err=y,s.dispatchEvent(new Ii("task-complete"))})}c=!0,s.dispatchEvent(new Ii("task-complete"))}catch(p){l=p,s.dispatchEvent(new Ii("task-complete"))}});function d(){var p;return r?(p=i[0])==null?void 0:p.done:!!i.find(m=>m.done)}function*h(){for(;i.length>0&&i[0].done;){const p=i[0];if(i.shift(),p.ok)yield p.value;else throw u=!0,o.resolve(),p.err;o.resolve()}}function*g(){for(;d();)for(let p=0;p<i.length;p++)if(i[p].done){const m=i[p];if(i.splice(p,1),p--,m.ok)yield m.value;else throw u=!0,o.resolve(),m.err;o.resolve()}}for(;;){if(d()||(a=He(),await a.promise),l!=null||(r?yield*h():yield*g(),l!=null))throw l;if(c&&i.length===0)break}}var fd;fd=Symbol.toStringTag;class jx{constructor(e,t={}){f(this,"log");f(this,"peerId");f(this,"peerStore");f(this,"routers");f(this,fd,"@libp2p/peer-routing");var r,s;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((r=e.metrics)==null?void 0:r.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([i],o)=>({...o,peer:i.toString()})}))??this.findPeer,this.getClosestPeers=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([i],o)=>({...o,key:Q(i,"base36")}),getAttributesFromYieldedValue:(i,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],i.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new qu("No peer routers available");if(e.toString()===this.peerId.toString())throw new wy("Should not try to find self");const r=this,s=Ms(...this.routers.map(i=>async function*(){try{yield await i.findPeer(e,t)}catch(o){r.log.error(o)}}()));for await(const i of s)if(i!=null)return i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),i;throw new Ir}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new qu("No peer routers available");const r=this,s=Yf(1024);for await(const i of Qo(async function*(){const o=Ms(...r.routers.map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await r.findPeer(a.id,{...t,useCache:!1})}catch(c){r.log.error("could not find peer multiaddrs",c);return}return a}}()))i!=null&&(i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),!s.has(i.id.toMultihash().bytes)&&(s.add(i.id.toMultihash().bytes),yield i))}}var pd,gd;class Gx extends(gd=ar,pd=Symbol.toStringTag,gd){constructor(t){super();f(this,"peerRouting");f(this,"log");f(this,"walking");f(this,"walkers");f(this,"shutdownController");f(this,"walkController");f(this,"needNext");f(this,pd,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var s,i;this.walking||this.startWalk(),this.walkers++;const r=Yt([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(s=this.needNext)==null||s.resolve(),this.needNext=He(),yield(await Yi(this,"walk:peer",r,{errorEvent:"walk:error"})).detail}finally{r.clear(),this.walkers--,this.walkers===0&&((i=this.walkController)==null||i.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=Yt([this.walkController.signal,this.shutdownController.signal]),r=Date.now();let s=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const i=p1(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(i,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),s++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await tn(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",i,this.walkers,s)}catch(i){this.log.error("random walk errored",i),this.safeDispatchEvent("walk:error",{detail:i})}this.log("no walkers left, ended walk")}).catch(i=>{this.log.error("random walk errored",i)}).finally(()=>{this.log("finished walk, found %d peers after %dms",s,Date.now()-r),this.walking=!1})}}const S3=32,A3=64;var md;md=Symbol.toStringTag;class Wx{constructor(e){f(this,"log");f(this,"topologies");f(this,"handlers");f(this,"components");f(this,md,"@libp2p/registrar");this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new Ey(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,r){if(this.handlers.has(e)&&(r==null?void 0:r.force)!==!0)throw new Cy(`Handler already registered for protocol ${e}`);const s=Vf.bind({ignoreUndefined:!0})({maxInboundStreams:S3,maxOutboundStreams:A3},r);this.handlers.set(e,{handler:t,options:s}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(r=>{this.handlers.delete(r)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new ee("invalid topology");const r=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let s=this.topologies.get(e);return s==null&&(s=new Map,this.topologies.set(e,s)),s.set(r,t),r}unregister(e){for(const[t,r]of this.topologies.entries())r.has(e)&&(r.delete(e),r.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(r=>{var s,i,o;for(const a of r.protocols){const c=this.topologies.get(a);if(c!=null)for(const l of c.values())((s=l.filter)==null?void 0:s.has(t))!==!1&&((i=l.filter)==null||i.remove(t),(o=l.onDisconnect)==null||o.call(l,t))}}).catch(r=>{r.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,r)})}_onPeerUpdate(e){var i,o,a;const{peer:t,previous:r}=e.detail,s=((r==null?void 0:r.protocols)??[]).filter(c=>!t.protocols.includes(c));for(const c of s){const l=this.topologies.get(c);if(l!=null)for(const u of l.values())((i=u.filter)==null?void 0:i.has(t.id))!==!1&&((o=u.filter)==null||o.remove(t.id),(a=u.onDisconnect)==null||a.call(u,t.id))}}_onPeerIdentify(e){var i,o,a;const t=e.detail.protocols,r=e.detail.connection,s=e.detail.peerId;for(const c of t){const l=this.topologies.get(c);if(l!=null)for(const u of l.values())r.limits!=null&&u.notifyOnLimitedConnection!==!0||((i=u.filter)==null?void 0:i.has(s))!==!0&&((o=u.filter)==null||o.add(s),(a=u.onConnect)==null||a.call(u,s,r))}}}class Qx extends Map{constructor(t){super();f(this,"metric");const{name:r,metrics:s}=t;this.metric=s.registerMetric(r),this.updateComponentMetric()}set(t,r){return super.set(t,r),this.updateComponentMetric(),this}delete(t){const r=super.delete(t);return this.updateComponentMetric(),r}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function Yx(n){const{name:e,metrics:t}=n;let r;return t!=null?r=new Qx({name:e,metrics:t}):r=new Map,r}var yd;yd=Symbol.toStringTag;class Zx{constructor(e,t={}){f(this,"log");f(this,"components");f(this,"transports");f(this,"listeners");f(this,"faultTolerance");f(this,"started");f(this,yd,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=Yx({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??As.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new ee("Transport must have a valid tag");if(this.transports.has(t))throw new ee(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,r]of this.listeners)for(this.log("closing listeners for %s",t);r.length>0;){const s=r.pop();s!=null&&e.push(s.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var s;const r=this.dialTransportForMultiaddr(e);if(r==null)throw new Dy(`No transport available for address ${String(e)}`);return(s=t==null?void 0:t.onProgress)==null||s.call(t,new bt("transport-manager:selected-transport",r[Symbol.toStringTag])),r.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Ds("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(i=>{t.errors.set(i.toString(),new _y)});const r=[];for(const[i,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",i,c);const l=o.createListener({upgrader:this.components.upgrader});let u=this.listeners.get(i)??[];u==null&&(u=[],this.listeners.set(i,u)),u.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const d=u.findIndex(h=>h===l);u.splice(d,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),Ru.matches(c)?t.ipv4.attempts++:Fu.matches(c)&&t.ipv6.attempts++,r.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),Ru.matches(c)&&t.ipv4.success++,Fu.matches(c)&&t.ipv6.success++},d=>{throw this.log.error("transport %s could not listen on address %a - %e",i,c,d),t.errors.set(c.toString(),d),d}))}}const s=await Promise.allSettled(r);if(!(s.length>0&&s.every(i=>i.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===As.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new Sy(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([i,o])=>`
  ${i}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,r=e.ipv6.success===0;return t&&r}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const r=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const s=t.pop();s!=null&&r.push(s.close())}await Promise.all(r),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const lt="/multistream/1.0.0",P1=1024;let Xx=class extends Error{constructor(){super(...arguments);f(this,"name","InvalidMessageLengthError");f(this,"code","ERR_INVALID_MSG_LENGTH")}},Jx=class extends Error{constructor(){super(...arguments);f(this,"name","InvalidDataLengthError");f(this,"code","ERR_MSG_DATA_TOO_LONG")}},eb=class extends Error{constructor(){super(...arguments);f(this,"name","InvalidDataLengthLengthError");f(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function Yo(n,e={}){const t=_3(n,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=Et(e.maxDataLength));const r=(e==null?void 0:e.lengthDecoder)??Fr,s=(e==null?void 0:e.lengthEncoder)??Rt;return{read:async o=>{let a=-1;const c=new Ie;for(;;){c.append(await t.read({...o,bytes:1}));try{a=r(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new Xx("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new eb("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new Jx("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new Ie(s(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new Ie(...o.flatMap(l=>[s(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}const tb=Y(`
`);async function ds(n,e,t){await n.write(e,t)}async function rb(n,e,t){await n.writeV(e,t)}async function nb(n,e){const t=await n.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==tb[0])throw e.log.error("Invalid mss message - missing newline",t),new or("Missing newline");return t.sublist(0,-1)}async function _n(n,e){const t=await nb(n,e);return Q(t.subarray())}async function za(n,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return sb(n,e[0],t);const r=Yo(n,{...t,maxDataLength:P1}),s=e.shift();if(s==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',lt,s);const i=Y(`${lt}
`),o=Y(`${s}
`);await rb(r,[i,o],t),t.log.trace("select: reading multistream-select header");let a=await _n(r,t);if(t.log.trace('select: read "%s"',a),a===lt&&(t.log.trace("select: reading protocol response"),a=await _n(r,t),t.log.trace('select: read "%s"',a)),a===s)return{stream:r.unwrap(),protocol:s};for(const c of e){t.log.trace('select: write "%s"',c),await ds(r,Y(`${c}
`),t),t.log.trace("select: reading protocol response");const l=await _n(r,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:r.unwrap(),protocol:c}}throw new Gc("protocol selection failed")}function sb(n,e,t){const r=n.sink.bind(n),s=n.source;let i=!1,o=!1;const a=He();let c=!1,l=!1;const u=He();let d=!1,h=!1;const g=He(),p=Yo({sink:r,source:s},{...t,maxDataLength:P1});n.sink=async v=>{const{sink:b}=p.unwrap();await b(async function*(){let x=!1;for await(const E of v){if(l&&await u.promise,c)yield E;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',lt,e,E.byteLength);const C=`${e}
`;yield new Ie(Uint8Array.from([19]),Y(`${lt}
`),Rt(C.length),Y(C),E).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',lt,e,E.byteLength),c=!0,l=!1,u.resolve(),m().catch(_=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,_)})}x=!0}x||await m()}())};async function m(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),await y()),d||(t.log.trace("optimistic: doing read protocol for %s stream",e),await w())}finally{o=!1,i=!0,a.resolve()}}async function y(){if(l){await u.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',lt,e),await p.writeV([Y(`${lt}
`),Y(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',lt,e)}finally{c=!0,l=!1,u.resolve()}}async function w(){if(h){await g.promise;return}h=!0;try{t.log.trace("optimistic: reading multistream select header");let v=await _n(p,t);if(t.log.trace('optimistic: read multistream select header "%s"',v),v===lt&&(v=await _n(p,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',v,e),v!==e)throw new Gc("protocol selection failed")}finally{d=!0,h=!1,g.resolve()}}if(n.source=async function*(){await m(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*p.unwrap().source}(),n.closeRead!=null){const v=n.closeRead.bind(n);n.closeRead=async b=>{i||await m().catch(x=>{t.log.error("could not negotiate protocol before close read",x)}),await v(b)}}if(n.closeWrite!=null){const v=n.closeWrite.bind(n);n.closeWrite=async b=>{i||await m().catch(x=>{t.log.error("could not negotiate protocol before close write",x)}),await v(b)}}if(n.close!=null){const v=n.close.bind(n);n.close=async b=>{const x=[];l&&x.push(u.promise),h&&x.push(g.promise),x.length>0?await tn(Promise.all(x),b==null?void 0:b.signal):(i=!0,o=!1,a.resolve()),await v(b)}}return{stream:n,protocol:e}}const ib=8,T1=1024*1024*4;class ob extends Error{constructor(){super(...arguments);f(this,"name","InvalidMessageLengthError");f(this,"code","ERR_INVALID_MSG_LENGTH")}}class k3 extends Error{constructor(){super(...arguments);f(this,"name","InvalidDataLengthError");f(this,"code","ERR_MSG_DATA_TOO_LONG")}}class ab extends Error{constructor(){super(...arguments);f(this,"name","InvalidDataLengthLengthError");f(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}class Ju extends Error{constructor(){super(...arguments);f(this,"name","UnexpectedEOFError");f(this,"code","ERR_UNEXPECTED_EOF")}}function B3(n){return n[Symbol.asyncIterator]!=null}function D3(n,e){if(n.byteLength>e)throw new k3("Message length too long")}const Zo=n=>{const e=Et(n),t=Qt(e);return Rt(n,t),Zo.bytes=e,t};Zo.bytes=0;function R1(n,e){e=e??{};const t=e.lengthEncoder??Zo,r=(e==null?void 0:e.maxDataLength)??T1;function*s(i){D3(i,r);const o=t(i.byteLength);o instanceof Uint8Array?yield o:yield*o,i instanceof Uint8Array?yield i:yield*i}return B3(n)?async function*(){for await(const i of n)yield*s(i)}():function*(){for(const i of n)yield*s(i)}()}R1.single=(n,e)=>{e=e??{};const t=e.lengthEncoder??Zo,r=(e==null?void 0:e.maxDataLength)??T1;return D3(n,r),new Ie(t(n.byteLength),n)};var Hr;(function(n){n[n.LENGTH=0]="LENGTH",n[n.DATA=1]="DATA"})(Hr||(Hr={}));const F1=n=>{const e=Fr(n);return F1.bytes=Et(e),e};F1.bytes=0;function Cc(n,e){const t=new Ie;let r=Hr.LENGTH,s=-1;const i=(e==null?void 0:e.lengthDecoder)??F1,o=(e==null?void 0:e.maxLengthLength)??ib,a=(e==null?void 0:e.maxDataLength)??T1;function*c(){for(;t.byteLength>0;){if(r===Hr.LENGTH)try{if(s=i(t),s<0)throw new ob("Invalid message length");if(s>a)throw new k3("Message length too long");const l=i.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(s),r=Hr.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new ab("Message length length too long");break}throw l}if(r===Hr.DATA){if(t.byteLength<s)break;const l=t.sublist(0,s);t.consume(s),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,r=Hr.LENGTH}}}return B3(n)?async function*(){for await(const l of n)t.append(l),yield*c();if(t.byteLength>0)throw new Ju("Unexpected end of input")}():function*(){for(const l of n)t.append(l),yield*c();if(t.byteLength>0)throw new Ju("Unexpected end of input")}()}Cc.fromReader=(n,e)=>{let t=1;const r=async function*(){for(;;)try{const{done:i,value:o}=await n.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return Cc(r,{...e??{},onLength:i=>{t=i}})};async function qa(n,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const r=Yo(n,{...t,maxDataLength:P1,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const s=await _n(r,t);if(t.log.trace('handle: read "%s"',s),s===lt){t.log.trace('handle: respond with "%s" for "%s"',lt,s),await ds(r,Y(`${lt}
`),t),t.log.trace('handle: responded with "%s" for "%s"',lt,s);continue}if(e.includes(s))return t.log.trace('handle: respond with "%s" for "%s"',s,s),await ds(r,Y(`${s}
`),t),t.log.trace('handle: responded with "%s" for "%s"',s,s),{stream:r.unwrap(),protocol:s};if(s==="ls"){const i=new Ie(...e.map(o=>R1.single(Y(`${o}
`))),Y(`
`));t.log.trace('handle: respond with "%s" for %s',e,s),await ds(r,i,t),t.log.trace('handle: responded with "%s" for %s',e,s);continue}t.log.trace('handle: respond with "na" for "%s"',s),await ds(r,Y(`na
`),t),t.log('handle: responded with "na" for "%s"',s)}}const cb=500;var xd,bd;bd=Symbol.toStringTag,xd=C6;class lb{constructor(e){f(this,"id");f(this,"remoteAddr");f(this,"remotePeer");f(this,"direction");f(this,"timeline");f(this,"multiplexer");f(this,"encryption");f(this,"status");f(this,"limits");f(this,"log");f(this,"tags");f(this,"_newStream");f(this,"_close");f(this,"_abort");f(this,"_getStreams");f(this,bd,"Connection");f(this,xd,!0);const{remoteAddr:t,remotePeer:r,newStream:s,close:i,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=r,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=s,this._close=i,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new xh("the connection is being closed");if(this.status==="closed")throw new Kc("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new Wc("Cannot open protocol stream on limited connection");const r=await this._newStream(e,t);return r.direction="outbound",r}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(cb);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function ub(n){return new lb(n)}function db(n,e){try{const{options:t}=e.getHandler(n);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return S3}function hb(n,e,t={}){try{const{options:r}=e.getHandler(n);if(r.maxOutboundStreams!=null)return r.maxOutboundStreams}catch(r){if(r.name!=="UnhandledProtocolError")throw r}return t.maxOutboundStreams??A3}function e2(n,e,t){let r=0;return t.streams.forEach(s=>{s.direction===e&&s.protocol===n&&r++}),r}var vd;vd=Symbol.toStringTag;class fb{constructor(e,t){f(this,"components");f(this,"connectionEncrypters");f(this,"streamMuxers");f(this,"inboundUpgradeTimeout");f(this,"inboundStreamProtocolNegotiationTimeout");f(this,"outboundStreamProtocolNegotiationTimeout");f(this,"events");f(this,"metrics");f(this,vd,"@libp2p/upgrader");var r,s;this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(i=>{this.connectionEncrypters.set(i.protocol,i)}),this.streamMuxers=new Map,t.streamMuxers.forEach(i=>{this.streamMuxers.set(i.protocol,i)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??Qy,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??ju,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??ju,this.events=e.events,this.metrics={dials:(r=e.metrics)==null?void 0:r.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(s=e.metrics)==null?void 0:s.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}async shouldBlockConnection(e,...t){const r=this.components.connectionGater[e];if(r==null)return;if(await r.apply(this.components.connectionGater,t)===!0)throw new ky(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return Yt([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var i,o;let r=!1;const s=this.createInboundAbortSignal(t.signal);try{if((i=this.metrics.dials)==null||i.increment({inbound:!0}),r=await this.components.connectionManager.acceptIncomingConnection(e),!r)throw new By("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:s})}catch(a){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),a}finally{s.clear(),r&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var r,s;try{(r=this.metrics.dials)==null||r.increment({outbound:!0});const i=e.remoteAddr.getPeerId();let o;i!=null&&(o=Xr(i),await this.shouldBlockConnection("denyOutboundConnection",o,e));let a="outbound";return t.initiator===!1&&(a="inbound"),await this._performUpgrade(e,a,t)}catch(i){throw(s=this.metrics.errors)==null||s.increment({outbound:!0}),i}}async _performUpgrade(e,t,r){var u,d,h;let s,i,o,a,c;(u=this.components.metrics)==null||u.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if((r==null?void 0:r.skipProtection)!==!0){const g=this.components.connectionProtector;g!=null&&(e.log("protecting the %s connection",t),l=await g.protect(e,r))}try{if(s=l,(r==null?void 0:r.skipEncryption)!==!0){(d=r==null?void 0:r.onProgress)==null||d.call(r,new bt(`upgrader:encrypt-${t}-connection`)),{conn:s,remotePeer:i,protocol:c,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(l,r):this._encryptOutbound(l,r));const g={...l,...s};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",i,g)}else{const g=e.remoteAddr.getPeerId();if(g==null)throw new Fo(`${t} connection that skipped encryption must have a peer id`);const p=Xr(g);c="native",i=p}if(i.equals(this.components.peerId)){const g=new jc("Can not dial self");throw e.abort(g),g}if(o=s,(r==null?void 0:r.muxerFactory)!=null)a=r.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(h=r==null?void 0:r.onProgress)==null||h.call(r,new bt(`upgrader:multiplex-${t}-connection`));const g=await(t==="inbound"?this._multiplexInbound({...l,...s},this.streamMuxers,r):this._multiplexOutbound({...l,...s},this.streamMuxers,r));a=g.muxerFactory,o=g.stream}}catch(g){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,g),g}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",i,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:i,limits:r==null?void 0:r.limits})}_createConnection(e){const{cryptoProtocol:t,direction:r,maConn:s,upgradedConn:i,remotePeer:o,muxerFactory:a,limits:c}=e;let l,u,d;a!=null&&(l=a.createStreamMuxer({direction:r,onIncomingStream:p=>{d!=null&&Promise.resolve().then(async()=>{var E;const m=this.components.registrar.getProtocols(),y=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:w,protocol:v}=await qa(p,m,{signal:y,log:p.log,yieldBytes:!1});if(d==null)return;d.log("incoming stream opened on %s",v);const b=db(v,this.components.registrar);if(e2(v,"inbound",d)===b){const C=new wh(`Too many inbound protocol streams for protocol "${v}" - limit ${b}`);throw p.abort(C),C}p.source=w.source,p.sink=w.sink,p.protocol=v,w.closeWrite!=null&&(p.closeWrite=w.closeWrite),w.closeRead!=null&&(p.closeRead=w.closeRead),w.close!=null&&(p.close=w.close),await this.components.peerStore.merge(o,{protocols:[v]}),(E=this.components.metrics)==null||E.trackProtocolStream(p,d),this._onStream({connection:d,stream:p,protocol:v})}).catch(async m=>{d.log.error("error handling incoming stream id %s - %e",p.id,m),p.timeline.close==null&&await p.close()})}}),u=async(p,m={})=>{var w;if(l==null)throw new ki("Connection is not multiplexed");d.log.trace("starting new stream for protocols %s",p);const y=await l.newStream();d.log.trace("started new stream %s for protocols %s",y.id,p);try{if(m.signal==null){y.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",p);const C=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);m={...m,signal:C}}y.log.trace("selecting protocol from protocols %s",p);const{stream:v,protocol:b}=await za(y,p,{...m,log:y.log,yieldBytes:!0});y.log.trace("selected protocol %s",b);const x=hb(b,this.components.registrar,m),E=e2(b,"outbound",d);if(E>=x){const C=new Eh(`Too many outbound protocol streams for protocol "${b}" - ${E}/${x}`);throw y.abort(C),C}return await this.components.peerStore.merge(o,{protocols:[b]}),y.source=v.source,y.sink=v.sink,y.protocol=b,v.closeWrite!=null&&(y.closeWrite=v.closeWrite),v.closeRead!=null&&(y.closeRead=v.closeRead),v.close!=null&&(y.close=v.close),(w=this.components.metrics)==null||w.trackProtocolStream(y,d),y}catch(v){throw d.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",r==="inbound"?"from":"to",e.maConn.remoteAddr,p,v),y.timeline.close==null&&y.abort(v),v}},Promise.all([l.sink(i.source),i.sink(l.source)]).catch(p=>{d.log.error("error piping data through muxer - %e",p)}));const h=s.timeline;s.timeline=new Proxy(h,{set:(...p)=>(p[1]==="close"&&p[2]!=null&&h.close==null&&(async()=>{try{d.status==="open"&&await d.close()}catch(m){d.log.error("error closing connection after timeline close %e",m)}finally{this.events.safeDispatchEvent("connection:close",{detail:d})}})().catch(m=>{d.log.error("error thrown while dispatching connection:close event %e",m)}),Reflect.set(...p))}),s.timeline.upgraded=Date.now();const g=()=>{throw new ki("Connection is not multiplexed")};return d=ub({remoteAddr:s.remoteAddr,remotePeer:o,status:"open",direction:r,timeline:s.timeline,multiplexer:l==null?void 0:l.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:u??g,getStreams:()=>(l==null?void 0:l.streams)??[],close:async p=>{await(l==null?void 0:l.close(p)),await s.close(p)},abort:p=>{s.abort(p),l==null||l.abort(p)}}),this.events.safeDispatchEvent("connection:open",{detail:d}),d.__maConnTimeline=h,d}_onStream(e){const{connection:t,stream:r,protocol:s}=e,{handler:i,options:o}=this.components.registrar.getHandler(s);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new Wc("Cannot open protocol stream on limited connection");i({connection:t,stream:r})}async _encryptInbound(e,t){const r=Array.from(this.connectionEncrypters.keys());try{const{stream:s,protocol:i}=await qa(e,r,{...t,log:e.log}),o=this.connectionEncrypters.get(i);if(o==null)throw new Bi(`no crypto module found for ${i}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,i),{...await o.secureInbound(s,t),protocol:i}}catch(s){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,s),new Bi(s.message)}}async _encryptOutbound(e,t){const r=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",r);const{stream:s,protocol:i}=await za(e,r,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(i);if(o==null)throw new Bi(`no crypto module found for ${i}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,i),{...await o.secureOutbound(s,t),protocol:i}}catch(s){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,s),new Bi(s.message)}}async _multiplexOutbound(e,t,r){const s=Array.from(t.keys());e.log("outbound selecting muxer %s",s);try{e.log.trace("selecting stream muxer from %s",s);const{stream:i,protocol:o}=await za(e,s,{...r,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing outbound connection",i),new ki(String(i))}}async _multiplexInbound(e,t,r){const s=Array.from(t.keys());e.log("inbound handling muxers %s",s);try{const{stream:i,protocol:o}=await qa(e,s,{...r,log:e.log}),a=t.get(o);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing inbound connection",i),new ki(String(i))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}const I3="2.8.5",P3="js-libp2p";function pb(n,e){return`${n??P3}/${e??I3} browser/${globalThis.navigator.userAgent}`}var Xs,_c;class gb extends ar{constructor(t){var u,d,h,g,p,m,y,w,v,b,x,E;super();ae(this,Xs);f(this,"peerId");f(this,"peerStore");f(this,"contentRouting");f(this,"peerRouting");f(this,"metrics");f(this,"services");f(this,"logger");f(this,"status");f(this,"components");f(this,"log");this.status="stopped";const r=new ar,s=r.dispatchEvent.bind(r);r.dispatchEvent=C=>{const _=s(C),A=this.dispatchEvent(new CustomEvent(C.type,{detail:C.detail}));return _||A},this.peerId=t.peerId,this.logger=t.logger??jf(),this.log=this.logger.forComponent("libp2p"),this.services={};const i=((u=t.nodeInfo)==null?void 0:u.name)??P3,o=((d=t.nodeInfo)==null?void 0:d.version)??I3,a=this.components=Ry({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:i,version:o,userAgent:((h=t.nodeInfo)==null?void 0:h.userAgent)??pb(i,o)},logger:this.logger,events:r,datastore:t.datastore??new Bm,connectionGater:$y(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",Em(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),a.events.addEventListener("peer:update",C=>{if(C.detail.previous==null){const _={id:C.detail.peer.id,multiaddrs:C.detail.peer.addresses.map(A=>A.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:_})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new fb(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map((C,_)=>this.configureComponent(`connection-encryption-${_}`,C(this.components))),streamMuxers:(t.streamMuxers??[]).map((C,_)=>this.configureComponent(`stream-muxers-${_}`,C(this.components))),inboundUpgradeTimeout:(g=t.connectionManager)==null?void 0:g.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((p=t.connectionManager)==null?void 0:p.inboundStreamProtocolNegotiationTimeout)??((m=t.connectionManager)==null?void 0:m.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((y=t.connectionManager)==null?void 0:y.outboundStreamProtocolNegotiationTimeout)??((w=t.connectionManager)==null?void 0:w.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new Zx(this.components,t.transportManager)),this.configureComponent("connectionManager",new Dx(this.components,t.connectionManager)),((v=t.connectionMonitor)==null?void 0:v.enabled)!==!1&&this.configureComponent("connectionMonitor",new $x(this.components,t.connectionMonitor)),this.configureComponent("registrar",new Wx(this.components)),this.configureComponent("addressManager",new xy(this.components,t.addresses));const c=(t.peerRouters??[]).map((C,_)=>this.configureComponent(`peer-router-${_}`,C(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new jx(this.components,{routers:c}));const l=(t.contentRouters??[]).map((C,_)=>this.configureComponent(`content-router-${_}`,C(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new Kx(this.components,{routers:l})),this.configureComponent("randomWalk",new Gx(this.components)),(t.peerDiscovery??[]).forEach((C,_)=>{this.configureComponent(`peer-discovery-${_}`,C(this.components)).addEventListener("peer",R=>{oe(this,Xs,_c).call(this,R)})}),(b=t.transports)==null||b.forEach((C,_)=>{this.components.transportManager.add(this.configureComponent(`transport-${_}`,C(this.components)))}),t.services!=null)for(const C of Object.keys(t.services)){const _=t.services[C],A=_(this.components);if(A==null){this.log.error("service factory %s returned null or undefined instance",C);continue}this.services[C]=A,this.configureComponent(C,A),A[q0]!=null&&(this.log("registering service %s for content routing",C),l.push(A[q0])),A[K0]!=null&&(this.log("registering service %s for peer routing",C),c.push(A[K0])),A[V0]!=null&&(this.log("registering service %s for peer discovery",C),(E=(x=A[V0]).addEventListener)==null||E.call(x,"peer",R=>{oe(this,Xs,_c).call(this,R)}))}Fy(a)}configureComponent(t,r){return r==null&&this.log.error("component %s was null or undefined",t),this.components[t]=r,r}async start(){var t,r,s,i;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((r=(t=this.components).beforeStart)==null?void 0:r.call(t)),await this.components.start(),await((i=(s=this.components).afterStart)==null?void 0:i.call(s)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,r,s,i;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((r=(t=this.components).beforeStop)==null?void 0:r.call(t)),await this.components.stop(),await((i=(s=this.components).afterStop)==null?void 0:i.call(s)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new Wt;for(const r of this.components.connectionManager.getConnections())t.add(r.remotePeer);return Array.from(t)}async dial(t,r={}){return this.components.connectionManager.openConnection(t,{priority:75,...r})}async dialProtocol(t,r,s={}){if(r==null)throw new ee("no protocols were provided to open a stream");if(r=Array.isArray(r)?r:[r],r.length===0)throw new ee("no protocols were provided to open a stream");return(await this.dial(t,s)).newStream(r,s)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,r={}){zo(t)&&(t=Xr(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,r)}async getPublicKey(t,r={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const s=Dt([Y("/pk/"),t.toMultihash().bytes]),i=await this.contentRouting.get(s,r),o=ii(i);return await this.peerStore.patch(t,{publicKey:o}),o}async handle(t,r,s){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async i=>{await this.components.registrar.handle(i,r,s)}))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async r=>{await this.components.registrar.unhandle(r)}))}async register(t,r){return this.components.registrar.register(t,r)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,r={}){return this.components.connectionManager.isDialable(t,r)}}Xs=new WeakSet,_c=function(t){const{detail:r}=t;if(r.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(r.id,{multiaddrs:r.multiaddrs}).catch(s=>{this.log.error(s)})};async function mb(n={}){n.privateKey??(n.privateKey=await op());const e=new gb({...await yg(n),peerId:dp(n.privateKey)});return n.start!==!1&&await e.start(),e}const li=1e3,L1=60*li,Xo=60*L1,yb=36*Xo,xb="/ipfs/kad/1.0.0",bb=48*Xo,vb=24*Xo,wb=10,Eb=16384,Cb=Xo,T3=20,N1=3,_b=5*L1,Sb=li,Ab=5*li,kb=5*L1,Bb=30*li,Db=180*li,t2=`${Vc}-kad-dht`;var Bo;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.key!=null&&t.key.byteLength>0&&(r.uint32(10),r.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(r.uint32(18),r.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(r.uint32(42),r.string(t.timeReceived)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={key:Te(0),value:Te(0),timeReceived:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(Bo||(Bo={}));function Ib(n){const e=n.getUTCFullYear(),t=String(n.getUTCMonth()+1).padStart(2,"0"),r=String(n.getUTCDate()).padStart(2,"0"),s=String(n.getUTCHours()).padStart(2,"0"),i=String(n.getUTCMinutes()).padStart(2,"0"),o=String(n.getUTCSeconds()).padStart(2,"0"),a=n.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${r}T${s}:${i}:${o}.${c}Z`}function Pb(n){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(n).trim().match(e);if(t==null)throw new Error("Invalid format");const r=parseInt(t[1],10),s=parseInt(t[2],10)-1,i=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(r,s,i,o,a,c,l))}class Bt{constructor(e,t,r){f(this,"key");f(this,"value");f(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=r}serialize(){return Bo.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Ib(this.timeReceived)}}static deserialize(e){const t=Bo.decode(e);return new Bt(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=Pb(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Bt(e.key,e.value,t)}}function Tb(n){return n[Symbol.asyncIterator]!=null}function Jo(n,e){let t=0;if(Tb(n))return async function*(){for await(const c of n)yield e(c,t++)}();const r=s3(n),{value:s,done:i}=r.next();if(i===!0)return function*(){}();const o=e(s,t++);if(typeof o.then=="function")return async function*(){yield await o;for await(const c of r)yield e(c,t++)}();const a=e;return function*(){yield o;for(const c of r)yield a(c,t++)}()}function ea(n,...e){if(n==null)throw new Error("Empty pipeline");if(Va(n)){const r=n;n=()=>r.source}else if(F3(n)||R3(n)){const r=n;n=()=>r}const t=[n,...e];if(t.length>1&&Va(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let r=1;r<t.length-1;r++)Va(t[r])&&(t[r]=Fb(t[r]));return Rb(...t)}const Rb=(...n)=>{let e;for(;n.length>0;)e=n.shift()(e);return e},R3=n=>(n==null?void 0:n[Symbol.asyncIterator])!=null,F3=n=>(n==null?void 0:n[Symbol.iterator])!=null,Va=n=>n==null?!1:n.sink!=null&&n.source!=null,Fb=n=>e=>{const t=n.sink(e);if((t==null?void 0:t.then)!=null){const r=v3({objectMode:!0});t.then(()=>{r.end()},o=>{r.end(o)});let s;const i=n.source;if(R3(i))s=async function*(){yield*i,r.end()};else if(F3(i))s=function*(){yield*i,r.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Ms(r,s())}return n.source};class Do extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class Lb extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class Nb extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class Mb extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var r2;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.key!=null&&(r.uint32(10),r.bytes(t.key)),t.value!=null&&(r.uint32(18),r.bytes(t.value)),t.author!=null&&(r.uint32(26),r.bytes(t.author)),t.signature!=null&&(r.uint32(34),r.bytes(t.signature)),t.timeReceived!=null&&(r.uint32(42),r.string(t.timeReceived)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 3:{i.author=t.bytes();break}case 4:{i.signature=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(r2||(r2={}));var _e;(function(n){n.PUT_VALUE="PUT_VALUE",n.GET_VALUE="GET_VALUE",n.ADD_PROVIDER="ADD_PROVIDER",n.GET_PROVIDERS="GET_PROVIDERS",n.FIND_NODE="FIND_NODE",n.PING="PING"})(_e||(_e={}));var Io;(function(n){n[n.PUT_VALUE=0]="PUT_VALUE",n[n.GET_VALUE=1]="GET_VALUE",n[n.ADD_PROVIDER=2]="ADD_PROVIDER",n[n.GET_PROVIDERS=3]="GET_PROVIDERS",n[n.FIND_NODE=4]="FIND_NODE",n[n.PING=5]="PING"})(Io||(Io={}));(function(n){n.codec=()=>Ho(Io)})(_e||(_e={}));var qn;(function(n){n.NOT_CONNECTED="NOT_CONNECTED",n.CONNECTED="CONNECTED",n.CAN_CONNECT="CAN_CONNECT",n.CANNOT_CONNECT="CANNOT_CONNECT"})(qn||(qn={}));var Sc;(function(n){n[n.NOT_CONNECTED=0]="NOT_CONNECTED",n[n.CONNECTED=1]="CONNECTED",n[n.CAN_CONNECT=2]="CAN_CONNECT",n[n.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(Sc||(Sc={}));(function(n){n.codec=()=>Ho(Sc)})(qn||(qn={}));var xn;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{if(s.lengthDelimited!==!1&&r.fork(),t.id!=null&&t.id.byteLength>0&&(r.uint32(10),r.bytes(t.id)),t.multiaddrs!=null)for(const i of t.multiaddrs)r.uint32(18),r.bytes(i);t.connection!=null&&(r.uint32(24),qn.codec().encode(t.connection,r)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{var a;const i={id:Te(0),multiaddrs:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{i.id=t.bytes();break}case 2:{if(((a=s.limits)==null?void 0:a.multiaddrs)!=null&&i.multiaddrs.length===s.limits.multiaddrs)throw new Ln('Decode error - map field "multiaddrs" had too many elements');i.multiaddrs.push(t.bytes());break}case 3:{i.connection=qn.codec().decode(t);break}default:{t.skipType(c&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(xn||(xn={}));var Qr;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{if(s.lengthDelimited!==!1&&r.fork(),t.type!=null&&Io[t.type]!==0&&(r.uint32(8),_e.codec().encode(t.type,r)),t.clusterLevel!=null&&(r.uint32(80),r.int32(t.clusterLevel)),t.key!=null&&(r.uint32(18),r.bytes(t.key)),t.record!=null&&(r.uint32(26),r.bytes(t.record)),t.closer!=null)for(const i of t.closer)r.uint32(66),xn.codec().encode(i,r);if(t.providers!=null)for(const i of t.providers)r.uint32(74),xn.codec().encode(i,r);s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{var a,c,l,u;const i={type:_e.PUT_VALUE,closer:[],providers:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const d=t.uint32();switch(d>>>3){case 1:{i.type=_e.codec().decode(t);break}case 10:{i.clusterLevel=t.int32();break}case 2:{i.key=t.bytes();break}case 3:{i.record=t.bytes();break}case 8:{if(((a=s.limits)==null?void 0:a.closer)!=null&&i.closer.length===s.limits.closer)throw new Ln('Decode error - map field "closer" had too many elements');i.closer.push(xn.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.closer$}));break}case 9:{if(((l=s.limits)==null?void 0:l.providers)!=null&&i.providers.length===s.limits.providers)throw new Ln('Decode error - map field "providers" had too many elements');i.providers.push(xn.codec().decode(t,t.uint32(),{limits:(u=s.limits)==null?void 0:u.providers$}));break}default:{t.skipType(d&7);break}}}return i})),e),n.encode=t=>Qe(t,n.codec()),n.decode=(t,r)=>We(t,n.codec(),r)})(Qr||(Qr={}));function n2(n,e={}){var r;const t={...n,name:"SEND_QUERY",type:0,messageName:n.type,messageType:n.type};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function Ac(n,e={}){var r;const t={...n,name:"PEER_RESPONSE",type:1,messageName:n.messageType,closer:n.closer??[],providers:n.providers??[]};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function Ka(n,e={}){var r;const t={...n,name:"FINAL_PEER",type:2};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function Tr(n,e={}){var r;const t={...n,name:"QUERY_ERROR",type:3};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function s2(n,e={}){var r;const t={...n,name:"PROVIDER",type:4};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:provider",{detail:t})),t}function kc(n,e={}){var r;const t={...n,name:"VALUE",type:5};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:value",{detail:t})),t}function i2(n,e={}){var r;const t={...n,name:"DIAL_PEER",type:7};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function Ob(n,e,t){if(t.length===0)throw new ee("No records given");const s=Q(e).split("/");if(s.length<3)throw new ee("Record key does not have a selector function");const i=n[s[1].toString()];if(i==null)throw new Mb(`No selector function configured for key type "${s[1]}"`);return t.length===1?0:i(e,t)}function Ub(n,e){return 0}const $b={pk:Ub};async function M1(n,e){const t=e.key,s=Q(t).split("/");if(s.length<3)return;const i=n[s[1].toString()];if(i==null)throw new ee(`No validator available for key type "${s[1]}"`);await i(t,e.value)}const Hb=async(n,e)=>{if(!(n instanceof Uint8Array))throw new ee('"key" must be a Uint8Array');if(n.byteLength<5)throw new ee("Invalid public key record");if(Q(n.subarray(0,4))!=="/pk/")throw new ee("key was not prefixed with /pk/");const r=ii(e),s=n.slice(4);if(!de(s,r.toMultihash().bytes))throw new ee("public key does not match passed in key")},zb={pk:Hb},qb=Y("/pk/");function Vb(n){return{...n,multiaddrs:n.multiaddrs.filter(e=>{const[[t,r]]=e.stringTuples();if(t===53||t===54||t===55)return r!=="localhost";if(t!==4&&t!==6||r==null)return!1;const s=Yn(r);return s==null?!0:!s})}}async function Os(n){return(await at.digest(n)).digest}async function Nt(n){return Os(n.toMultihash().bytes)}function ms(n,e){return new Oe(`${n}/${Q(e,"base32")}`,!1)}function Kb(n){return Dt([qb,n.toMultihash().bytes])}function jb(n){return Q(n.subarray(0,4))==="/pk/"}function Gb(n){const e=ft(n.subarray(4));return lr(e)}function o2(n,e){const t=new Date;return new Bt(n,e,t).serialize()}const Wb=290,Qb=54,Yb=55,Zb=56,Xb=4,Jb=41;function ev(n){const e=n.stringTuples();for(const t of e)if(t[0]===Wb)return!1;if(e[0][0]===Qb||e[0][0]===Yb||e[0][0]===Zb)return!0;if(e[0][0]===Xb||e[0][0]===Jb){const t=Yn(`${e[0][1]}`);return t==null||!t}return!1}function L3(n){const e=n.toString().split("/"),t=e.pop(),r=e.pop();if(t==null||r==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${n.toString()}`);return{cid:se.createV1($5,ft(Y(r,"base32"))),peerId:Xr(t)}}function ja(n,e,t){const r=typeof e=="string"?e:Q(e.multihash.bytes,"base32"),s=[n,r];return t!=null&&s.push(t.toString()),new Oe(s.join("/"))}function N3(n){return new Date(Fr(n))}function yn(n,e,t){return async function*(...r){var a,c,l,u,d;const s=(a=e.queryTime)==null?void 0:a.timer(t),i=(c=e.errorTime)==null?void 0:c.timer(t);let o=!1;try{(l=e.queries)==null||l.increment({[t]:!0}),yield*n(...r)}catch(h){throw o=!0,i==null||i(),(u=e.errors)==null||u.increment({[t]:!0}),h}finally{(d=e.queries)==null||d.decrement({[t]:!0}),o||s==null||s()}}}function M3(n,e,t){return async function(...r){var a,c,l,u,d;const s=(a=e==null?void 0:e.queryTime)==null?void 0:a.timer(t),i=(c=e==null?void 0:e.errorTime)==null?void 0:c.timer(t);let o=!1;try{return(l=e.queries)==null||l.increment({[t]:!0}),await n(...r)}catch(h){throw o=!0,i==null||i(),(u=e.errors)==null||u.increment({[t]:!0}),h}finally{(d=e.queries)==null||d.decrement({[t]:!0}),o||s==null||s()}}}class tv{constructor(e,t){f(this,"log");f(this,"components");f(this,"validators");f(this,"selectors");f(this,"peerRouting");f(this,"queryManager");f(this,"network");f(this,"datastorePrefix");var l,u;const{validators:r,selectors:s,peerRouting:i,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=r,this.selectors=s,this.peerRouting=i,this.queryManager=o,this.network=a,this.get=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.put=((u=e.metrics)==null?void 0:u.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2}))??this.put}async getLocal(e){this.log("getLocal %b",e);const t=ms(this.datastorePrefix,e);this.log("fetching record for key %k",t);const r=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const s=Bt.deserialize(r);return await M1(this.validators,s),s}async*sendCorrectionRecord(e,t,r,s={}){this.log("sendCorrection for %b",e);const i=o2(e,r);for(const{value:o,from:a}of t){if(de(o,r)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const u=ms(this.datastorePrefix,e);this.log(`Storing corrected record for key ${u.toString()}`),await this.components.datastore.put(u,i.subarray())}catch(u){this.log.error("Failed error correcting self",u)}continue}let c=!1;const l={type:_e.PUT_VALUE,key:e,record:i};for await(const u of this.network.sendRequest(a,l,s))u.name==="PEER_RESPONSE"&&u.record!=null&&de(u.record.value,Bt.deserialize(i).value)&&(c=!0),yield u;c||(yield Tr({from:a,error:new Do("Value not put correctly")},s)),this.log.error("Failed error correcting entry")}}async*put(e,t,r={}){this.log("put key %b value %b",e,t);const s=o2(e,t),i=ms(this.datastorePrefix,e);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,s.subarray()),yield*ea(this.peerRouting.getClosestPeers(e,{...r,signal:r.signal}),o=>Jo(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:_e.PUT_VALUE,key:e,record:s};this.log("send put to %p",a.peer.id);for await(const u of this.network.sendRequest(a.peer.id,l,r))c.push(u),u.name==="PEER_RESPONSE"&&(u.record!=null&&de(u.record.value,Bt.deserialize(s).value)||c.push(Tr({from:a.peer.id,error:new Do("Value not put correctly")},r)));return c}),o=>Qo(o,{ordered:!1,concurrency:N1}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const r=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&r.push(a),yield a;if(r.length===0)return;const s=r.map(a=>a.value);let i=0;try{i=Ob(this.selectors,e,s)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=s[i];if(this.log("GetValue %b %b",e,o),o==null)throw new Ir("Best value was not found");yield*this.sendCorrectionRecord(e,r,o,t),yield r[i]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const i=await this.getLocal(e);yield kc({value:i.value,from:this.components.peerId},t)}catch(i){this.log("error getting local value for %b",e,i)}const r=this,s=async function*({peer:i,signal:o}){for await(const a of r.peerRouting.getValueOrPeers(i,e,{...t,signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield kc({from:i,value:a.record.value},t))};yield*this.queryManager.run(e,s,t)}}function rv(n,e){return{id:n.id.toMultihash().bytes,multiaddrs:(n.multiaddrs??[]).map(r=>r.bytes),connection:e}}function Pi(n){if(n.id==null)throw new Error("Invalid peer in message");const e=ft(n.id);return{id:lr(e),multiaddrs:(n.multiaddrs??[]).map(t=>be(t))}}class nv{constructor(e,t){f(this,"log");f(this,"components");f(this,"network");f(this,"peerRouting");f(this,"queryManager");f(this,"routingTable");f(this,"providers");var l,u;const{network:r,peerRouting:s,queryManager:i,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=r,this.peerRouting=s,this.queryManager=i,this.routingTable=o,this.providers=a,this.findProviders=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(d,h)=>(d.name==="PROVIDER"&&(h.providers??(h.providers=[]),h.providers.push(...d.providers.map(g=>g.id.toString()))),h)}))??this.findProviders,this.provide=((u=e.metrics)==null?void 0:u.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(d,h)=>(d.name==="PEER_RESPONSE"&&d.messageName==="ADD_PROVIDER"&&(h.providers??(h.providers=[]),h.providers.push(d.from.toString())),h)}))??this.provide}async*provide(e,t,r={}){this.log("provide %s",e);const s=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const i={type:_e.ADD_PROVIDER,key:s,providers:[rv({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=c=>async()=>{if(c.name!=="FINAL_PEER")return[c];const l=[];this.log("putProvider %s to %p",e,c.peer.id);try{this.log("sending provider record for %s to %p",e,c.peer.id);for await(const u of this.network.sendMessage(c.peer.id,i,r))u.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,c.peer.id),o++),l.push(u)}catch(u){this.log.error("error sending provide record to peer %p",c.peer.id,u),l.push(Tr({from:c.peer.id,error:u},r))}return l};yield*ea(this.peerRouting.getClosestPeers(s,r),c=>Jo(c,l=>a(l)),c=>Qo(c,{ordered:!1,concurrency:N1}),async function*(c){for await(const l of c)yield*l}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const r=this.routingTable.kBucketSize;let s=0;const i=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const u=[];for(const d of a.slice(0,r))try{const h=await this.components.peerStore.get(d);u.push({id:d,multiaddrs:h.addresses.map(({multiaddr:g})=>g)})}catch(h){if(h.name!=="NotFoundError")throw h;this.log("no peer store entry for %p",d)}if(yield Ac({from:this.components.peerId,messageType:_e.GET_PROVIDERS,providers:u},t),yield s2({from:this.components.peerId,providers:u},t),s+=u.length,s>=r)return}const c=async function*({peer:u,signal:d}){const h={type:_e.GET_PROVIDERS,key:i};yield*o.network.sendRequest(u,h,{...t,signal:d})},l=new Wt(a);for await(const u of this.queryManager.run(i,c,t))if(yield u,u.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",u.providers.length,e,u.closer.length);const d=[];for(const h of u.providers)l.has(h.id)||(l.add(h.id),d.push(h));if(d.length>0&&(yield s2({from:u.from,providers:d},t),s+=d.length,s>=r))return}}}function a2(n,e){const t=Yo(n,e),r={read:async(s,i)=>{const o=await t.read(i);return s.decode(o)},write:async(s,i,o)=>{await t.write(i.encode(s),o)},writeV:async(s,i,o)=>{await t.writeV(s.map(a=>i.encode(a)),o)},pb:s=>({read:async i=>r.read(s,i),write:async(i,o)=>r.write(i,s,o),writeV:async(i,o)=>r.writeV(i,s,o),unwrap:()=>r}),unwrap:()=>t.unwrap()};return r}class sv extends ar{constructor(t,r){var s,i,o,a;super();f(this,"log");f(this,"protocol");f(this,"running");f(this,"components");f(this,"timeout");f(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${r.logPrefix}:network`),this.running=!1,this.protocol=r.protocol,this.timeout=new Ns({...r.timeout??{},metrics:t.metrics,metricName:`${r.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:(s=t.metrics)==null?void 0:s.registerCounterGroup(`${r.metricsPrefix}_outbound_rpc_requests_total`),errors:(i=t.metrics)==null?void 0:i.registerCounterGroup(`${r.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=((o=t.metrics)==null?void 0:o.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],u){return{...u,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((u,d)=>{l[`providers-${d}`]=u.id.toString()}),c.closer.length>0&&c.closer.forEach((u,d)=>{l[`closer-${d}`]=u.id.toString()})),l)}))??this.sendRequest,this.sendMessage=((a=t.metrics)==null?void 0:a.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],u){return{...u,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((u,d)=>{l[`providers-${d}`]=u.id.toString()}),c.closer.length>0&&c.closer.forEach((u,d)=>{l[`closer-${d}`]=u.id.toString()})),l)}))??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,r,s={}){var c,l,u;if(!this.running)return;const i=r.type;if(i==null)throw new ee("Message type was missing");this.log("sending %s to %p",r.type,t),yield i2({peer:t},s),yield n2({to:t,type:i},s);let o;const a=this.timeout.getTimeoutSignal(s);s={...s,signal:a};try{(c=this.metrics.operations)==null||c.increment({[i]:!0}),o=await(await this.components.connectionManager.openConnection(t,s)).newStream(this.protocol,s);const h=await this._writeReadMessage(o,r,s);o.close(s).catch(g=>{this.log.error("error closing stream to %p",t,g),o==null||o.abort(g)}),yield Ac({from:t,messageType:h.type,closer:h.closer.map(Pi),providers:h.providers.map(Pi),record:h.record==null?void 0:Bt.deserialize(h.record)},s)}catch(d){(l=this.metrics.errors)==null||l.increment({[i]:!0}),o==null||o.abort(d),((u=s.signal)==null?void 0:u.aborted)!==!0&&this.log.error("could not send %s to %p - %e",r.type,t,d),yield Tr({from:t,error:d},s)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,r,s={}){var c,l;if(!this.running)return;const i=r.type;if(i==null)throw new ee("Message type was missing");this.log("sending %s to %p",r.type,t),yield i2({peer:t},s),yield n2({to:t,type:i},s);let o;const a=this.timeout.getTimeoutSignal(s);s={...s,signal:a};try{(c=this.metrics.operations)==null||c.increment({[i]:!0}),o=await(await this.components.connectionManager.openConnection(t,s)).newStream(this.protocol,s),await this._writeMessage(o,r,s),o.close(s).catch(d=>{this.log.error("error closing stream to %p",t,d),o==null||o.abort(d)}),yield Ac({from:t,messageType:i},s)}catch(u){(l=this.metrics.errors)==null||l.increment({[i]:!0}),o==null||o.abort(u),yield Tr({from:t,error:u},s)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,r,s){await a2(t).write(r,Qr,s)}async _writeReadMessage(t,r,s){const i=a2(t);await i.write(r,Qr,s);const o=await i.read(Qr,s);return o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:Pi(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:Pi(a)})}),o}}function Rr(n,e){if(n.length!==e.length)throw new Error("Inputs should have the same length");const t=Qt(n.length);for(let r=0;r<n.length;r++)t[r]=n[r]^e[r];return t}function Us(n,e){if(n.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return n[t]<e[t]?-1:1;return 0}class O1{constructor(e,t){f(this,"originDhtKey");f(this,"capacity");f(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await Nt(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(this.peerDistances.find(i=>i.peer.id.equals(e.id))!=null)return;const r={peer:e,distance:Rr(this.originDhtKey,t)};let s=!1;for(let i=0;i<this.peerDistances.length;i++){const o=Us(this.peerDistances[i].distance,r.distance);if(o===0||o===1){s=!0,this.peerDistances.splice(i,0,r);break}}s||this.peerDistances.push(r),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await Nt(e),r=Rr(t,this.originDhtKey),s=this.peerDistances[this.peerDistances.length-1].distance;return Us(r,s)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class iv{constructor(e,t){f(this,"log");f(this,"routingTable");f(this,"network");f(this,"validators");f(this,"queryManager");f(this,"peerStore");f(this,"peerId");var r,s;this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=((r=e.metrics)==null?void 0:r.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async findPeerLocal(e){let t;const r=await this.routingTable.find(e);if(r!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(r)}catch(s){if(s.name!=="NotFoundError")throw s}}if(t==null)try{t=await this.peerStore.get(e)}catch(s){if(s.name!=="NotFoundError")throw s}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(s=>s.multiaddr)}}async*_getValueSingle(e,t,r={}){const s={type:_e.GET_VALUE,key:t};yield*this.network.sendRequest(e,s,r)}async*getPublicKeyFromNode(e,t={}){const r=Kb(e);for await(const s of this._getValueSingle(e,r,t))if(yield s,s.name==="PEER_RESPONSE"&&s.record!=null){const i=ii(s.record.value),o=y1(i);if(!o.equals(e))throw new Bs("public key does not match id");if(o.publicKey==null)throw new Bs("public key missing");yield kc({from:e,value:s.record.value},t)}throw new Do(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const s=await this.findPeerLocal(e);if(s!=null){this.log("found local"),yield Ka({from:this.peerId,peer:s},t);return}}let r=!1;if(t.useNetwork!==!1){const s=this,i=async function*({peer:o,signal:a}){const c={type:_e.FIND_NODE,key:e.toMultihash().bytes};for await(const l of s.network.sendRequest(o,c,{...t,signal:a}))if(yield l,l.name==="PEER_RESPONSE"){const u=l.closer.find(d=>d.id.equals(e));u!=null&&(yield Ka({from:l.from,peer:u},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,i,t))o.name==="FINAL_PEER"&&(r=!0),yield o}r||(yield Tr({from:this.peerId,error:new Ir("Not found")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const r=await Os(e),s=this.routingTable.closestPeers(r),i=this,o=new O1(r,this.routingTable.kBucketSize);await Promise.all(s.map(async c=>{await o.add({id:c,multiaddrs:[]})}));const a=async function*({peer:c,signal:l}){i.log("closerPeersSingle %s from %p",Q(e,"base32"),c);const u={type:_e.FIND_NODE,key:e};yield*i.network.sendRequest(c,u,{...t,signal:l})};for await(const c of this.queryManager.run(e,a,t))c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async l=>{await o.add(l)})),yield c;this.log("found %d peers close to %b",o.length,e);for(const c of o.peers)yield Ka({from:this.peerId,peer:c},t)}async*getValueOrPeers(e,t,r={}){for await(const s of this._getValueSingle(e,t,r)){if(s.name==="PEER_RESPONSE"&&s.record!=null)try{await this._verifyRecordOnline(s.record)}catch{const o="invalid record received, discarded";this.log(o),yield Tr({from:s.from,error:new Do(o)},r);continue}yield s}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new Nb("invalid record received");await M1(this.validators,new Bt(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const r=[];try{const c=ft(e),l=lr(c),u=await this.peerStore.get(l);r.push({id:u.id,multiaddrs:u.addresses.map(({multiaddr:d})=>d)})}catch{}const s=await Os(e),i=this.routingTable.closestPeers(s),o=await Nt(t),a=Rr(o,s);for(const c of i){const l=await Nt(c),u=Rr(l,s);if(Us(u,a)===-1)try{const d=await this.peerStore.get(c);r.push({id:c,multiaddrs:d.addresses.map(({multiaddr:h})=>h)})}catch(d){if(d.name!=="NotFoundError")throw d}}return r.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",r.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),r}}class ov{constructor(e,t){f(this,"log");f(this,"datastore");f(this,"datastorePrefix");f(this,"lock");this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){const r=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{r()}}async removeProvider(e,t){const r=await this.lock.writeLock();try{const s=ja(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(s)}finally{r()}}async getProviders(e){const t=await this.lock.readLock();try{this.log("get providers for %c",e);const r=await this.loadProviders(e);return this.log("got %d providers for %c",r.size,e),[...r.keys()]}finally{t()}}async writeProviderEntry(e,t,r=new Date){const s=ja(this.datastorePrefix,e,t),i=Rt(r.getTime());await this.datastore.put(s,i)}async loadProviders(e){const t=new oi,r=ja(this.datastorePrefix,e);for await(const s of this.datastore.query({prefix:r.toString()})){const{peerId:i}=L3(s.key);t.set(i,N3(s.value))}return t}}async function*av(n){const{key:e,startingPeer:t,ourPeerId:r,signal:s,query:i,alpha:o,pathIndex:a,numPaths:c,queryFuncTimeout:l,log:u,peersSeen:d,connectionManager:h}=n,g=new Wo({concurrency:o,sort:(y,w)=>Us(y.options.distance,w.options.distance)}),p=await Os(e);function m(y,w){if(y==null)return;d.add(y);const v=Rr(w,p);g.add(async()=>{const b=[s];l!=null&&b.push(AbortSignal.timeout(l));const x=Yt(b);try{for await(const E of i({...n,key:e,peer:y,signal:x,pathIndex:a,numPaths:c})){if(x.aborted)return;if(E.name==="PEER_RESPONSE")for(const C of E.closer){if(d.has(C.id)){u.trace("already seen %p in query",C.id);continue}if(r.equals(C.id)){u("not querying ourselves");continue}if(!await h.isDialable(C.multiaddrs)){u("not querying undialable peer");continue}const _=await Nt(C.id),A=Rr(_,p);if(Us(A,v)!==-1){u.trace("skipping %p as they are not closer to %b than %p",C.id,e,y);continue}u.trace("querying closer peer %p",C.id),m(C.id,_)}g.safeDispatchEvent("completed",{detail:E})}}catch(E){if(!s.aborted)return Tr({from:y,error:E},n)}finally{x.clear()}},{distance:v}).catch(b=>{u.error(b)})}m(t,await Nt(t));try{for await(const y of g.toGenerator({signal:s}))y!=null&&(yield y)}catch(y){throw s.aborted?new Lb("Query aborted"):y}}class cv{constructor(e,t){f(this,"disjointPaths");f(this,"alpha");f(this,"shutDownController");f(this,"running");f(this,"logger");f(this,"peerId");f(this,"connectionManager");f(this,"routingTable");f(this,"initialQuerySelfHasRun");f(this,"logPrefix");this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??T3,this.alpha=t.alpha??N1,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,r={}){if(!this.running)throw new Error("QueryManager not started");if(r.signal==null){const c=AbortSignal.timeout(Db);r={...r,signal:c}}const s=new AbortController,i=Yt([this.shutDownController.signal,s.signal,r.signal]);s.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+Q(e,"base58btc"));let a=!1;try{r.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial query-self query before continuing"),await tn(this.initialQuerySelfHasRun.promise,i),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await Os(e),l=this.routingTable.closestPeers(c),u=l.slice(0,Math.min(this.disjointPaths,l.length));if(l.length===0){o.error("Running query with no peers");return}const d=new Wt,h=u.map((g,p)=>av({...r,key:e,startingPeer:g,ourPeerId:this.peerId,signal:i,query:t,pathIndex:p,numPaths:u.length,alpha:this.alpha,queryFuncTimeout:r.queryFuncTimeout,log:o,peersSeen:d,onProgress:r.onProgress,connectionManager:this.connectionManager}));for await(const g of Ms(...h)){if(g.name==="QUERY_ERROR"&&o.error("query error",g.error),g.name==="PEER_RESPONSE")for(const p of[...g.closer,...g.providers])await this.connectionManager.isDialable(p.multiaddrs)&&await this.routingTable.add(p.id);yield g}a=!0}catch(c){if(!(!this.running&&c.name==="QueryAbortedError"))throw c}finally{a||(o("query exited early"),s.abort()),i.clear(),o("query:done")}}}function lv(n){return n[Symbol.asyncIterator]!=null}function O3(n){if(lv(n))return(async()=>{let e=0;for await(const t of n)e++;return e})();{let e=0;for(const t of n)e++;return e}}const uv=n=>{const e=n.addEventListener||n.on||n.addListener,t=n.removeEventListener||n.off||n.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(n),removeListener:t.bind(n)}};function dv(n,e,t){let r;const s=new Promise((i,o)=>{var g;if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");(g=t.signal)==null||g.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:u}=uv(n),d=(...p)=>{const m=t.multiArgs?p:p[0];t.filter&&!t.filter(m)||(c.push(m),t.count===c.length&&(r(),i(c)))},h=p=>{r(),o(p)};r=()=>{for(const p of a)u(p,d);for(const p of t.rejectionEvents)u(p,h)};for(const p of a)l(p,d);for(const p of t.rejectionEvents)l(p,h);t.signal&&t.signal.addEventListener("abort",()=>{h(t.signal.reason)},{once:!0}),t.resolveImmediately&&i(c)});if(s.cancel=r,typeof t.timeout=="number"){const i=b1(s,{milliseconds:t.timeout});return i.cancel=r,i}return s}function hv(n,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const r=dv(n,e,t),s=r.then(i=>i[0]);return s.cancel=r.cancel,s}class fv{constructor(e,t){f(this,"log");f(this,"peerId");f(this,"peerRouting");f(this,"routingTable");f(this,"count");f(this,"interval");f(this,"initialInterval");f(this,"queryTimeout");f(this,"running");f(this,"timeoutId");f(this,"controller");f(this,"initialQuerySelfHasRun");f(this,"querySelfPromise");this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??T3,this.interval=t.interval??_b,this.initialInterval=t.initialInterval??Sb,this.queryTimeout=t.queryTimeout??Ab,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=M3(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=He(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const r=AbortSignal.timeout(this.queryTimeout);e.push(r)}const t=Yt(e);this.controller.signal;try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await hv(this.routingTable,"peer:add",{signal:t,filter:i=>!this.peerId.equals(i.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const r=Date.now(),s=await ea(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),i=>mc(i,this.count),async i=>O3(i));this.log("self-query found %d peers in %dms",s,Date.now()-r)}catch(r){this.log.error("self-query error",r)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class pv extends ar{constructor(t,r){super();f(this,"log");f(this,"reprovideQueue");f(this,"maxQueueSize");f(this,"datastore");f(this,"timeout");f(this,"reprovideTimeout");f(this,"running");f(this,"shutdownController");f(this,"reprovideThreshold");f(this,"contentRouting");f(this,"datastorePrefix");f(this,"addressManager");f(this,"validity");f(this,"interval");f(this,"lock");f(this,"peerId");this.log=t.logger.forComponent(`${r.logPrefix}:reprovider`),this.peerId=t.peerId,this.reprovideQueue=new Wo({concurrency:r.concurrency??wb,metrics:t.metrics,metricName:`${r.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new Ns({...r.timeout??{},metrics:t.metrics,metricName:`${r.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=t.datastore,this.addressManager=t.addressManager,this.datastorePrefix=`${r.datastorePrefix}/provider`,this.reprovideThreshold=r.threshold??vb,this.maxQueueSize=r.maxQueueSize??Eb,this.validity=r.validity??bb,this.interval=r.interval??Cb,this.contentRouting=r.contentRouting,this.lock=r.lock,this.running=!1,this.reprovide=M3(this.reprovide.bind(this),r.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(t=>{this.log.error("error running reprovide/cleanup - %e",t)})},this.interval))}stop(){var t;this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),(t=this.shutdownController)==null||t.abort()}async cleanUp(){const t=await this.lock.writeLock();try{this.safeDispatchEvent("reprovide:start");for await(const r of this.datastore.query({prefix:this.datastorePrefix}))try{const{cid:s,peerId:i}=L3(r.key),o=N3(r.value).getTime(),a=o+this.validity,c=Date.now(),l=c>a;this.log.trace("comparing: %d < %d = %s %s",o,c-this.validity,l,l?"(expired)":""),l&&await this.datastore.delete(r.key),this.peerId.equals(i)&&c-a<this.reprovideThreshold&&this.queueReprovide(s).catch(u=>{this.log.error("could not reprovide %c - %e",s,u)})}catch(s){this.log.error("error processing datastore key %s - %e",r.key,s.message)}this.log("reprovide/cleanup successful")}finally{t(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(r=>{this.log.error("error running re-provide - %e",r)})},this.interval))}}async queueReprovide(t){var s;if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",t),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);const r=this.reprovideQueue.queue.find(i=>i.options.cid.equals(t));if(r!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",t),r.join();this.log.trace("adding %c to re-provide queue",t),this.reprovideQueue.add(async i=>{var a;if((a=i.signal)==null||a.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",t);const o=this.reprovideTimeout.getTimeoutSignal(i);try{await this.reprovide(i.cid,i)}finally{this.reprovideTimeout.cleanUp(o)}this.log.trace("re-provided %c",t)},{signal:(s=this.shutdownController)==null?void 0:s.signal,cid:t}).catch(i=>{this.log.error("could not re-provide key %c - %e",t,i)})}async reprovide(t,r){await Fs(this.contentRouting.provide(t,this.addressManager.getAddresses(),r))}}const gv=20,mv=5e3,yv="kad-close",xv=50;class bv{constructor(e,t){f(this,"routingTable");f(this,"components");f(this,"closestPeers");f(this,"newPeers");f(this,"refreshInterval");f(this,"peerSetSize");f(this,"timeout");f(this,"closeTagName");f(this,"closeTagValue");f(this,"log");f(this,"running");this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??mv,this.peerSetSize=t.peerSetSize??gv,this.closeTagName=t.closeTagName??yv,this.closeTagValue=t.closeTagValue??xv,this.closestPeers=new Wt,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await Nt(this.components.peerId);this.newPeers=new O1(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){var t;(t=this.newPeers)==null||t.add({id:e.detail,multiaddrs:[]}).catch(r=>{this.log.error("error adding peer to distance list - %e",r)})}async updatePeerTags(){var s;const e=new Wt((s=this.newPeers)==null?void 0:s.peers.map(i=>i.id)),t=e.difference(this.closestPeers),r=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async i=>{await this.components.peerStore.merge(i,{tags:{[this.closeTagName]:{value:this.closeTagValue},[t2]:{value:1}}})}),...[...r].map(async i=>{await this.components.peerStore.merge(i,{tags:{[this.closeTagName]:void 0,[t2]:void 0}})})])}}function Zi(n){return Array.isArray(n==null?void 0:n.peers)}class vv{constructor(e){f(this,"root");f(this,"localPeer");f(this,"prefixLength");f(this,"splitThreshold");f(this,"kBucketSize");f(this,"numberOfNodesToPing");f(this,"lastPingThreshold");f(this,"ping");f(this,"verify");f(this,"onAdd");f(this,"onRemove");f(this,"onMove");f(this,"addingPeerMap");this.prefixLength=e.prefixLength??Cv,this.kBucketSize=e.kBucketSize??U3,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??Av,this.lastPingThreshold=e.lastPingThreshold??Iv,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new oi,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await Nt(e),lastPing:Date.now()}}async add(e,t){const r={peerId:e,kadId:await Nt(e),lastPing:0},s=this.addingPeerMap.get(e);if(s!=null)return s;try{const i=this._add(r,t);this.addingPeerMap.set(e,i),await i}finally{this.addingPeerMap.delete(e)}}async _add(e,t){var o;const r=this._determineBucket(e.kadId);if(this._indexOf(r,e.kadId)>-1)return;if(r.peers.length===this.splitThreshold&&r.depth<this.prefixLength){await this._split(r),await this._add(e,t);return}if(r.peers.length<this.kBucketSize){if(!Ev(e,this.lastPingThreshold)){r.peers.push(e),await((o=this.onAdd)==null?void 0:o.call(this,e,r));return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const s=r.peers.filter(a=>{var c;return!(a.peerId.equals((c=this.localPeer)==null?void 0:c.peerId)||a.lastPing>Date.now()-this.lastPingThreshold)}).sort((a,c)=>a.lastPing<c.lastPing?-1:a.lastPing>c.lastPing?1:0).slice(0,this.numberOfNodesToPing);let i=!1;for await(const a of this.ping(s,t))i=!0,await this.remove(a.kadId);i&&await this._add(e,t)}*closest(e,t=this.kBucketSize){const r=new O1(e,t);for(const s of this.toIterable())r.addWithKadId({id:s.peerId,multiaddrs:[]},s.kadId);yield*Jo(r.peers,s=>s.id)}count(){function e(t){if(Zi(t))return t.peers.length;let r=0;return t.left!=null&&(r+=e(t.left)),t.right!=null&&(r+=e(t.right)),r}return e(this.root)}get(e){const t=this._determineBucket(e),r=this._indexOf(t,e);return t.peers[r]}async remove(e){var s;const t=this._determineBucket(e),r=this._indexOf(t,e);if(r>-1){const i=t.peers.splice(r,1)[0];await((s=this.onRemove)==null?void 0:s.call(this,i,t))}}*toIterable(){function*e(t){if(Zi(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+Q(Rr(e,t),"base16"))}_determineBucket(e){const t=Q(e,"base2");function r(s,i=0){return Zi(s)?s:t[i]==="0"?r(s.left,i+1):r(s.right,i+1)}return r(this.root)}_indexOf(e,t){return e.peers.findIndex(r=>de(r.kadId,t))}async _split(e){var s,i;const t={prefix:"0",depth:e.depth+1,peers:[]},r={prefix:"1",depth:e.depth+1,peers:[]};for(const o of e.peers)Q(o.kadId,"base2")[e.depth]==="0"?(t.peers.push(o),await((s=this.onMove)==null?void 0:s.call(this,o,e,t))):(r.peers.push(o),await((i=this.onMove)==null?void 0:i.call(this,o,e,r)));wv(e,t,r)}}function wv(n,e,t){return delete n.peers,n.left=e,n.right=t,n.prefix===""&&(delete n.depth,delete n.prefix),!0}function Ev(n,e){return n.lastPing<Date.now()-e}const U3=20,Cv=6,_v=20,Sv=100,Av=3,kv=20,Bv=100,c2="kad-peer",Dv=1,Iv=6e5,Pv=!0,Tv=1e3;class Rv extends ar{constructor(t,r){super();f(this,"kBucketSize");f(this,"kb");f(this,"network");f(this,"closestPeerTagger");f(this,"log");f(this,"components");f(this,"running");f(this,"pingNewContactTimeout");f(this,"pingNewContactQueue");f(this,"pingOldContactTimeout");f(this,"pingOldContactQueue");f(this,"populateFromDatastoreOnStart");f(this,"populateFromDatastoreLimit");f(this,"protocol");f(this,"peerTagName");f(this,"peerTagValue");f(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${r.logPrefix}:routing-table`),this.kBucketSize=r.kBucketSize??U3,this.running=!1,this.protocol=r.protocol,this.network=r.network,this.peerTagName=r.peerTagName??c2,this.peerTagValue=r.peerTagValue??Dv,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=r.populateFromDatastoreOnStart??Pv,this.populateFromDatastoreLimit=r.populateFromDatastoreLimit??Tv,this.pingOldContactQueue=new Ec({concurrency:r.pingOldContactConcurrency??kv,metricName:`${r.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:r.pingOldContactMaxQueueSize??Bv}),this.pingOldContactTimeout=new Ns({...r.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${r.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new Ec({concurrency:r.pingNewContactConcurrency??_v,metricName:`${r.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:r.pingNewContactMaxQueueSize??Sv}),this.pingNewContactTimeout=new Ns({...r.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${r.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new vv({kBucketSize:r.kBucketSize,prefixLength:r.prefixLength,splitThreshold:r.splitThreshold,numberOfOldContactsToPing:r.numberOfOldContactsToPing,lastPingThreshold:r.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new bv(this.components,{logPrefix:r.logPrefix,routingTable:this,peerSetSize:r.closestPeerSetSize,refreshInterval:r.closestPeerSetRefreshInterval,closeTagName:r.closeTagName,closeTagValue:r.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${r.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await so(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let t=0;for(const r of await this.components.peerStore.all({filters:[s=>s.protocols.includes(this.protocol)&&s.tags.has(c2)],limit:this.populateFromDatastoreLimit})){if(!this.running)return;try{await this.add(r.id),t++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(r.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",t)}).catch(t=>{this.log.error("error adding peer store peers to the routing table %e",t)})}async stop(){this.running=!1,await Yc(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(t,r){var s;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),(s=this.metrics)==null||s.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:t.peerId})}async peerRemoved(t,r){var s;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),(s=this.metrics)==null||s.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:t.peerId})}async*pingOldContacts(t,r){var i;if(!this.running)return;const s=[];for(const o of t){if(this.kb.get(o.kadId)==null){this.log("asked to ping contact %p that was not in routing table",o.peerId);continue}(i=this.metrics)==null||i.kadBucketEvents.increment({ping_old_contact:!0}),s.push(async()=>{const a=this.pingOldContactQueue.find(o.peerId);if(a!=null)return this.log("asked to ping contact %p was already being pinged",o.peerId),await a.join(r)?void 0:o;if(!await this.pingOldContactQueue.add(async l=>{var h;const u=this.pingOldContactTimeout.getTimeoutSignal(),d=Yt([u,l==null?void 0:l.signal]);try{return await this.pingContact(o,l)}catch{return(h=this.metrics)==null||h.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(u),d.clear()}},{peerId:o.peerId,signal:r==null?void 0:r.signal}))return o})}for await(const o of Qo(s))o!=null&&(yield o)}async verifyNewContact(t,r){var o;const s=this.pingNewContactTimeout.getTimeoutSignal(),i=Yt([s,r==null?void 0:r.signal]);try{const a=this.pingNewContactQueue.find(t.peerId);return a!=null?(this.log("joining existing ping to add new peer %p to routing table",t.peerId),await a.join({signal:i})):await this.pingNewContactQueue.add(async c=>{var l;return(l=this.metrics)==null||l.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",t.peerId),this.pingContact(t,c)},{peerId:t.peerId,signal:i})}catch{return this.log.trace("tried to add peer %p but they were not online",t.peerId),(o=this.metrics)==null||o.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(s),i.clear()}}async pingContact(t,r){try{return this.log("pinging contact %p",t.peerId),await this.components.ping.ping(t.peerId,r),this.log("contact %p ping ok",t.peerId),this.safeDispatchEvent("peer:ping",{detail:t.peerId}),!0}catch(s){return this.log("error pinging old contact %p - %e",t.peerId,s),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(t){var s;const r=await Nt(t);return(s=this.kb.get(r))==null?void 0:s.peerId}closestPeer(t){const r=this.closestPeers(t,1);if(r.length>0)return r[0]}closestPeers(t,r=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(t,r)]}async add(t,r){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(t,r)}async remove(t){if(this.kb==null)throw new Error("RoutingTable is not started");const r=await Nt(t);await this.kb.remove(r)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,r=0,s=0,i=20,o=0;function a(c){if(Zi(c)){c.depth>s&&(s=c.depth),r++,t+=c.peers.length,c.peers.length<i&&(i=c.peers.length),c.peers.length>o&&(o=c.peers.length);return}a(c.left),a(c.right)}a(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(r),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/r)),this.metrics.routingTableKadBucketMinOccupancy.update(i),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(s)}}const Fv=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],Ti=15;class Lv{constructor(e,t){f(this,"log");f(this,"peerRouting");f(this,"routingTable");f(this,"refreshInterval");f(this,"refreshQueryTimeout");f(this,"commonPrefixLengthRefreshedAt");f(this,"refreshTimeoutId");const{peerRouting:r,routingTable:s,refreshInterval:i,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=r,this.routingTable=s,this.refreshInterval=i??kb,this.refreshQueryTimeout=o??Bb,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),r=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${r.map(s=>s.toISOString()).join(", ")} ]`),Promise.all(r.map(async(s,i)=>{try{if(await this._refreshCommonPrefixLength(i,s,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(i+1),r.length-1);for(let a=i+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,s,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(s=>{this.log.error(s)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(s=>{this.log.error(s)})}async _refreshCommonPrefixLength(e,t,r){if(!r&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const s=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,s,this.routingTable.size);const i=AbortSignal.timeout(this.refreshQueryTimeout),o=await O3(this.peerRouting.getClosestPeers(s.toMultihash().bytes,{signal:i}));this.log(`found ${o} peers that were close to imaginary peer %p`,s),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,s,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>Ti&&(e=Ti);const t=[];for(let r=0;r<=e;r++)t[r]=this.commonPrefixLengthRefreshedAt[r]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=p1(2),r=(t[1]<<8)+t[0],s=await this._makePeerId(this.routingTable.kb.localPeer.kadId,r,e),i=ft(s);return lr(i)}async _makePeerId(e,t,r){if(r>Ti)throw new Error(`Cannot generate peer ID for common prefix length greater than ${Ti}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>r,a=65535<<16-(r+1),c=o&a|t&~a,l=Fv[c],u=new ArrayBuffer(34),d=new DataView(u,0,u.byteLength);return d.setUint8(0,at.code),d.setUint8(1,32),d.setUint32(2,l,!1),new Uint8Array(d.buffer,d.byteOffset,d.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const r of this._prefixLengths())r===e&&t++;return t}*_prefixLengths(){var e;if(((e=this.routingTable.kb)==null?void 0:e.localPeer)!=null)for(const{kadId:t}of this.routingTable.kb.toIterable()){const r=Rr(this.routingTable.kb.localPeer.kadId,t);let s=0;for(const i of r)if(i===0)s++;else break;yield s}}}class Nv{constructor(e,t){f(this,"peerId");f(this,"providers");f(this,"peerStore");f(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new or("Missing key");let r;try{r=se.decode(t.key)}catch{throw new or("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,r),await Promise.all(t.providers.map(async s=>{const i=ft(s.id),o=lr(i),a=s.multiaddrs.map(c=>be(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",s.id,e);return}if(s.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,r,a),await this.providers.addProvider(r,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class Mv{constructor(e,t){f(this,"peerRouting");f(this,"peerInfoMapper");f(this,"peerId");f(this,"addressManager");f(this,"log");const{peerRouting:r,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=r,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new or("Invalid FIND_NODE message received - key was missing");const r=await this.peerRouting.getCloserPeersOffline(t.key,e);de(this.peerId.toMultihash().bytes,t.key)&&r.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(i=>i.decapsulateCode(me("p2p").code))});const s={type:_e.FIND_NODE,clusterLevel:t.clusterLevel,closer:r.map(this.peerInfoMapper).filter(({multiaddrs:i})=>i.length).map(i=>({id:i.id.toMultihash().bytes,multiaddrs:i.multiaddrs.map(o=>o.bytes)})),providers:[]};return s.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),s}}class Ov{constructor(e,t){f(this,"peerId");f(this,"peerRouting");f(this,"providers");f(this,"peerStore");f(this,"peerInfoMapper");f(this,"log");const{peerRouting:r,providers:s,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=r,this.providers=s,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new or("Invalid GET_PROVIDERS message received - key was missing");let r;try{r=se.decode(t.key)}catch{throw new or("Invalid CID")}this.log("%p asking for providers for %s",e,r);const[s,i]=await Promise.all([wo(Jo(await this.providers.getProviders(r),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:u})=>u)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),o={type:_e.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class Uv{constructor(e,t){f(this,"peerStore");f(this,"datastore");f(this,"peerRouting");f(this,"log");f(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const r=t.key;if(this.log("%p asked for key %b",e,r),r==null||r.length===0)throw new or("Invalid key");const s={type:_e.GET_VALUE,key:r,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(jb(r)){this.log("is public key");const a=Gb(r);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new Ir("No public key found in key book");c=Ar(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),s.record=new Bt(r,c,new Date).serialize(),s}const[i,o]=await Promise.all([this._checkLocalDatastore(r),this.peerRouting.getCloserPeersOffline(r,e)]);return i!=null&&(this.log("had record for %b in local datastore",r),s.record=i.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),s.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),s}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=ms(this.datastorePrefix,e);let r;try{r=await this.datastore.get(t)}catch(i){if(i.name==="NotFoundError")return;throw i}const s=Bt.deserialize(r);if(s.timeReceived==null||Date.now()-s.timeReceived.getTime()>yb){await this.datastore.delete(t);return}return s}}class $v{constructor(e,t){f(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class Hv{constructor(e,t){f(this,"components");f(this,"validators");f(this,"log");f(this,"datastorePrefix");const{validators:r}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=r}async handle(e,t){const r=t.key;if(this.log("%p asked us to store value for key %b",e,r),t.record==null){const s=`Empty record from: ${e.toString()}`;throw this.log.error(s),new or(s)}try{const s=Bt.deserialize(t.record);await M1(this.validators,s),s.timeReceived=new Date;const i=ms(this.datastorePrefix,s.key);await this.components.datastore.put(i,s.serialize().subarray()),this.log("put record for %b into datastore under key %k",r,i)}catch(s){this.log("did not put record for key %b into datastore %o",r,s)}return t}}class zv{constructor(e,t){f(this,"handlers");f(this,"routingTable");f(this,"log");f(this,"metrics");var r,s;this.metrics={operations:(r=e.metrics)==null?void 0:r.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:(s=e.metrics)==null?void 0:s.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[_e.GET_VALUE.toString()]:new Uv(e,t),[_e.PUT_VALUE.toString()]:new Hv(e,t),[_e.FIND_NODE.toString()]:new Mv(e,t),[_e.ADD_PROVIDER.toString()]:new Nv(e,t),[_e.GET_PROVIDERS.toString()]:new Ov(e,t),[_e.PING.toString()]:new $v(e,t)}}async handleMessage(e,t){var s,i;const r=this.handlers[t.type];if(r==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return(s=this.metrics.operations)==null||s.increment({[t.type]:!0}),await r.handle(e,t)}catch{(i=this.metrics.errors)==null||i.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{const{stream:r,connection:s}=e,i=s.remotePeer,o=this;await ea(r,a=>Cc(a),async function*(a){for await(const c of a){const l=Qr.decode(c);t=l.type,o.log("incoming %s from %p",l.type,i);const u=await o.handleMessage(i,l);u!=null&&(yield Qr.encode(u))}},a=>R1(a),r)}).catch(r=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,r)})}}class qv extends ar{constructor(t,r){super();f(this,"log");f(this,"components");f(this,"protocol");f(this,"running");f(this,"registrarId");const{protocol:s,logPrefix:i}=r;this.components=t,this.log=t.logger.forComponent(`${i}:topology-listener`),this.running=!1,this.protocol=s}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class Vv{constructor(e){f(this,"dht");this.dht=e}async provide(e,t={}){await Fs(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const r of this.dht.findProviders(e,t))r.name==="PROVIDER"&&(yield*r.providers)}async put(e,t,r){await Fs(this.dht.put(e,t,r))}async get(e,t){for await(const r of this.dht.get(e,t))if(r.name==="VALUE")return r.value;throw new Ir("Could not find value for key")}}class Kv{constructor(e){f(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const r of this.dht.findPeer(e,t))if(r.name==="FINAL_PEER")return r.peer;throw new Ir("Peer not found")}async*getClosestPeers(e,t={}){for await(const r of this.dht.getClosestPeers(e,t))r.name==="FINAL_PEER"&&(yield r.peer)}}const jv=32,Gv=64;var wd,Ed,Cd;class Wv extends ar{constructor(t,r={}){var u,d,h,g;super();f(this,"protocol");f(this,"routingTable");f(this,"providers");f(this,"network");f(this,"peerRouting");f(this,"components");f(this,"log");f(this,"running");f(this,"kBucketSize");f(this,"clientMode");f(this,"validators");f(this,"selectors");f(this,"queryManager");f(this,"contentFetching");f(this,"contentRouting");f(this,"routingTableRefresh");f(this,"rpc");f(this,"topologyListener");f(this,"querySelf");f(this,"maxInboundStreams");f(this,"maxOutboundStreams");f(this,"dhtContentRouting");f(this,"dhtPeerRouting");f(this,"peerInfoMapper");f(this,"reprovider");f(this,Cd,"@libp2p/kad-dht");f(this,Ed,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"]);f(this,wd,["@libp2p/identify","@libp2p/ping"]);const s=r.logPrefix??"libp2p:kad-dht",i=r.datastorePrefix??"/dht",o=r.metricsPrefix??"libp2p_kad_dht",a={queries:(u=t.metrics)==null?void 0:u.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:(d=t.metrics)==null?void 0:d.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:(h=t.metrics)==null?void 0:h.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:(g=t.metrics)==null?void 0:g.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=t,this.log=t.logger.forComponent(s),this.protocol=r.protocol??xb,this.kBucketSize=r.kBucketSize??20,this.clientMode=r.clientMode??!0,this.maxInboundStreams=r.maxInboundStreams??jv,this.maxOutboundStreams=r.maxOutboundStreams??Gv,this.peerInfoMapper=r.peerInfoMapper??Vb;const c=Zf();this.providers=new ov(t,{...r.providers,logPrefix:s,datastorePrefix:i,lock:c}),this.validators={...zb,...r.validators},this.selectors={...$b,...r.selectors},this.network=new sv(t,{protocol:this.protocol,logPrefix:s,metricsPrefix:o}),this.routingTable=new Rv(t,{kBucketSize:r.kBucketSize,pingOldContactTimeout:r.pingOldContactTimeout,pingOldContactConcurrency:r.pingOldContactConcurrency,pingOldContactMaxQueueSize:r.pingOldContactMaxQueueSize,pingNewContactTimeout:r.pingNewContactTimeout,pingNewContactConcurrency:r.pingNewContactConcurrency,pingNewContactMaxQueueSize:r.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:s,metricsPrefix:o,prefixLength:r.prefixLength,splitThreshold:r.kBucketSplitThreshold,network:this.network});const l=He();r.allowQueryWithZeroPeers===!0&&l.resolve(),this.queryManager=new cv(t,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:s,metricsPrefix:o,initialQuerySelfHasRun:l,routingTable:this.routingTable}),this.peerRouting=new iv(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:s}),this.contentFetching=new tv(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:s,datastorePrefix:i}),this.contentRouting=new nv(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:s}),this.routingTableRefresh=new Lv(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:s}),this.rpc=new zv(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:s,metricsPrefix:o,datastorePrefix:i,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new qv(t,{protocol:this.protocol,logPrefix:s}),this.querySelf=new fv(t,{peerRouting:this.peerRouting,interval:r.querySelfInterval,initialInterval:r.initialQuerySelfInterval,logPrefix:s,initialQuerySelfHasRun:l,routingTable:this.routingTable,operationMetrics:a}),this.reprovider=new pv(t,{...r.reprovide,logPrefix:s,metricsPrefix:o,datastorePrefix:i,contentRouting:this.contentRouting,lock:c,operationMetrics:a}),this.network.addEventListener("peer",p=>{const m=p.detail;this.onPeerConnect(m).catch(y=>{this.log.error("could not add %p to routing table",m.id,y)}),this.dispatchEvent(new CustomEvent("peer",{detail:m}))}),this.topologyListener.addEventListener("peer",p=>{const m=p.detail;Promise.resolve().then(async()=>{const y=await this.components.peerStore.get(m),w={id:m,multiaddrs:y.addresses.map(({multiaddr:v})=>v),protocols:y.protocols};await this.onPeerConnect(w)}).catch(y=>{this.log.error("could not add %p to routing table - %e",m,y)})}),this.dhtPeerRouting=new Kv(this),this.dhtContentRouting=new Vv(this),r.clientMode==null&&t.events.addEventListener("self:peer:update",p=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const m=p.detail.peer.addresses.some(({multiaddr:w})=>ev(w)),y=this.getMode();m&&y==="client"?await this.setMode("server"):y==="server"&&!m&&await this.setMode("client")}).catch(m=>{this.log.error("error setting dht server mode",m)})}),this.get=yn(this.get.bind(this),a,"GET_VALUE"),this.findProviders=yn(this.findProviders.bind(this),a,"FIND_PROVIDERS"),this.findPeer=yn(this.findPeer.bind(this),a,"FIND_PEER"),this.getClosestPeers=yn(this.getClosestPeers.bind(this),a,"GET_CLOSEST_PEERS"),this.provide=yn(this.provide.bind(this),a,"PROVIDE"),this.put=yn(this.put.bind(this),a,"PUT_VALUE")}get[(Cd=Symbol.toStringTag,Ed=io,wd=j0,q0)](){return this.dhtContentRouting}get[K0](){return this.dhtPeerRouting}get[V0](){return this}async onPeerConnect(t){if(this.log.trace("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(r=>r.toString()));return}try{await this.routingTable.add(t.id)}catch(r){this.log.error("could not add %p to routing table",t.id,r)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t,r=!1){if(t===this.getMode()&&!r){this.log("already in %s mode",t);return}if(await this.components.registrar.unhandle(this.protocol),t===this.getMode()&&!r){this.log("already in %s mode",t);return}t==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await so(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await so(this.querySelf))}async stop(){this.running=!1,await Yc(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(t,r,s={}){yield*this.contentFetching.put(t,r,s)}async*get(t,r={}){yield*this.contentFetching.get(t,r)}async*provide(t,r={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),r)}async cancelReprovide(t){await this.providers.removeProvider(t,this.components.peerId)}async*findProviders(t,r={}){yield*this.contentRouting.findProviders(t,r)}async*findPeer(t,r={}){yield*this.peerRouting.findPeer(t,r)}async*getClosestPeers(t,r={}){yield*this.peerRouting.getClosestPeers(t,r)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var l2;(function(n){n[n.SEND_QUERY=0]="SEND_QUERY",n[n.PEER_RESPONSE=1]="PEER_RESPONSE",n[n.FINAL_PEER=2]="FINAL_PEER",n[n.QUERY_ERROR=3]="QUERY_ERROR",n[n.PROVIDER=4]="PROVIDER",n[n.VALUE=5]="VALUE",n[n.ADD_PEER=6]="ADD_PEER",n[n.DIAL_PEER=7]="DIAL_PEER"})(l2||(l2={}));function Qv(n={}){return e=>new Wv(e,n)}var $3={exports:{}};function Yv(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ga={exports:{}};const Zv={},Xv=Object.freeze(Object.defineProperty({__proto__:null,default:Zv},Symbol.toStringTag,{value:"Module"})),Jv=a6(Xv);var u2;function re(){return u2||(u2=1,function(n,e){(function(t,r){n.exports=r()})(J,function(){var t=t||function(r,s){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof J<"u"&&J.crypto&&(i=J.crypto),!i&&typeof Yv=="function")try{i=Jv}catch{}var o=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function v(){}return function(b){var x;return v.prototype=b,x=new v,v.prototype=null,x}}(),c={},l=c.lib={},u=l.Base=function(){return{extend:function(v){var b=a(this);return v&&b.mixIn(v),(!b.hasOwnProperty("init")||this.init===b.init)&&(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var v=this.extend();return v.init.apply(v,arguments),v},init:function(){},mixIn:function(v){for(var b in v)v.hasOwnProperty(b)&&(this[b]=v[b]);v.hasOwnProperty("toString")&&(this.toString=v.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=l.WordArray=u.extend({init:function(v,b){v=this.words=v||[],b!=s?this.sigBytes=b:this.sigBytes=v.length*4},toString:function(v){return(v||g).stringify(this)},concat:function(v){var b=this.words,x=v.words,E=this.sigBytes,C=v.sigBytes;if(this.clamp(),E%4)for(var _=0;_<C;_++){var A=x[_>>>2]>>>24-_%4*8&255;b[E+_>>>2]|=A<<24-(E+_)%4*8}else for(var R=0;R<C;R+=4)b[E+R>>>2]=x[R>>>2];return this.sigBytes+=C,this},clamp:function(){var v=this.words,b=this.sigBytes;v[b>>>2]&=4294967295<<32-b%4*8,v.length=r.ceil(b/4)},clone:function(){var v=u.clone.call(this);return v.words=this.words.slice(0),v},random:function(v){for(var b=[],x=0;x<v;x+=4)b.push(o());return new d.init(b,v)}}),h=c.enc={},g=h.Hex={stringify:function(v){for(var b=v.words,x=v.sigBytes,E=[],C=0;C<x;C++){var _=b[C>>>2]>>>24-C%4*8&255;E.push((_>>>4).toString(16)),E.push((_&15).toString(16))}return E.join("")},parse:function(v){for(var b=v.length,x=[],E=0;E<b;E+=2)x[E>>>3]|=parseInt(v.substr(E,2),16)<<24-E%8*4;return new d.init(x,b/2)}},p=h.Latin1={stringify:function(v){for(var b=v.words,x=v.sigBytes,E=[],C=0;C<x;C++){var _=b[C>>>2]>>>24-C%4*8&255;E.push(String.fromCharCode(_))}return E.join("")},parse:function(v){for(var b=v.length,x=[],E=0;E<b;E++)x[E>>>2]|=(v.charCodeAt(E)&255)<<24-E%4*8;return new d.init(x,b)}},m=h.Utf8={stringify:function(v){try{return decodeURIComponent(escape(p.stringify(v)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(v){return p.parse(unescape(encodeURIComponent(v)))}},y=l.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(v){typeof v=="string"&&(v=m.parse(v)),this._data.concat(v),this._nDataBytes+=v.sigBytes},_process:function(v){var b,x=this._data,E=x.words,C=x.sigBytes,_=this.blockSize,A=_*4,R=C/A;v?R=r.ceil(R):R=r.max((R|0)-this._minBufferSize,0);var S=R*_,k=r.min(S*4,C);if(S){for(var T=0;T<S;T+=_)this._doProcessBlock(E,T);b=E.splice(0,S),x.sigBytes-=k}return new d.init(b,k)},clone:function(){var v=u.clone.call(this);return v._data=this._data.clone(),v},_minBufferSize:0});l.Hasher=y.extend({cfg:u.extend(),init:function(v){this.cfg=this.cfg.extend(v),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(v){return this._append(v),this._process(),this},finalize:function(v){v&&this._append(v);var b=this._doFinalize();return b},blockSize:16,_createHelper:function(v){return function(b,x){return new v.init(x).finalize(b)}},_createHmacHelper:function(v){return function(b,x){return new w.HMAC.init(v,x).finalize(b)}}});var w=c.algo={};return c}(Math);return t})}(Ga)),Ga.exports}var Wa={exports:{}},d2;function ta(){return d2||(d2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){return function(r){var s=t,i=s.lib,o=i.Base,a=i.WordArray,c=s.x64={};c.Word=o.extend({init:function(l,u){this.high=l,this.low=u}}),c.WordArray=o.extend({init:function(l,u){l=this.words=l||[],u!=r?this.sigBytes=u:this.sigBytes=l.length*8},toX32:function(){for(var l=this.words,u=l.length,d=[],h=0;h<u;h++){var g=l[h];d.push(g.high),d.push(g.low)}return a.create(d,this.sigBytes)},clone:function(){for(var l=o.clone.call(this),u=l.words=this.words.slice(0),d=u.length,h=0;h<d;h++)u[h]=u[h].clone();return l}})}(),t})}(Wa)),Wa.exports}var Qa={exports:{}},h2;function ew(){return h2||(h2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){return function(){if(typeof ArrayBuffer=="function"){var r=t,s=r.lib,i=s.WordArray,o=i.init,a=i.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var l=c.byteLength,u=[],d=0;d<l;d++)u[d>>>2]|=c[d]<<24-d%4*8;o.call(this,u,l)}else o.apply(this,arguments)};a.prototype=i}}(),t.lib.WordArray})}(Qa)),Qa.exports}var Ya={exports:{}},f2;function tw(){return f2||(f2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.enc;o.Utf16=o.Utf16BE={stringify:function(c){for(var l=c.words,u=c.sigBytes,d=[],h=0;h<u;h+=2){var g=l[h>>>2]>>>16-h%4*8&65535;d.push(String.fromCharCode(g))}return d.join("")},parse:function(c){for(var l=c.length,u=[],d=0;d<l;d++)u[d>>>1]|=c.charCodeAt(d)<<16-d%2*16;return i.create(u,l*2)}},o.Utf16LE={stringify:function(c){for(var l=c.words,u=c.sigBytes,d=[],h=0;h<u;h+=2){var g=a(l[h>>>2]>>>16-h%4*8&65535);d.push(String.fromCharCode(g))}return d.join("")},parse:function(c){for(var l=c.length,u=[],d=0;d<l;d++)u[d>>>1]|=a(c.charCodeAt(d)<<16-d%2*16);return i.create(u,l*2)}};function a(c){return c<<8&4278255360|c>>>8&16711935}}(),t.enc.Utf16})}(Ya)),Ya.exports}var Za={exports:{}},p2;function an(){return p2||(p2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.enc;o.Base64={stringify:function(c){var l=c.words,u=c.sigBytes,d=this._map;c.clamp();for(var h=[],g=0;g<u;g+=3)for(var p=l[g>>>2]>>>24-g%4*8&255,m=l[g+1>>>2]>>>24-(g+1)%4*8&255,y=l[g+2>>>2]>>>24-(g+2)%4*8&255,w=p<<16|m<<8|y,v=0;v<4&&g+v*.75<u;v++)h.push(d.charAt(w>>>6*(3-v)&63));var b=d.charAt(64);if(b)for(;h.length%4;)h.push(b);return h.join("")},parse:function(c){var l=c.length,u=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var h=0;h<u.length;h++)d[u.charCodeAt(h)]=h}var g=u.charAt(64);if(g){var p=c.indexOf(g);p!==-1&&(l=p)}return a(c,l,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function a(c,l,u){for(var d=[],h=0,g=0;g<l;g++)if(g%4){var p=u[c.charCodeAt(g-1)]<<g%4*2,m=u[c.charCodeAt(g)]>>>6-g%4*2,y=p|m;d[h>>>2]|=y<<24-h%4*8,h++}return i.create(d,h)}}(),t.enc.Base64})}(Za)),Za.exports}var Xa={exports:{}},g2;function rw(){return g2||(g2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.enc;o.Base64url={stringify:function(c,l){l===void 0&&(l=!0);var u=c.words,d=c.sigBytes,h=l?this._safe_map:this._map;c.clamp();for(var g=[],p=0;p<d;p+=3)for(var m=u[p>>>2]>>>24-p%4*8&255,y=u[p+1>>>2]>>>24-(p+1)%4*8&255,w=u[p+2>>>2]>>>24-(p+2)%4*8&255,v=m<<16|y<<8|w,b=0;b<4&&p+b*.75<d;b++)g.push(h.charAt(v>>>6*(3-b)&63));var x=h.charAt(64);if(x)for(;g.length%4;)g.push(x);return g.join("")},parse:function(c,l){l===void 0&&(l=!0);var u=c.length,d=l?this._safe_map:this._map,h=this._reverseMap;if(!h){h=this._reverseMap=[];for(var g=0;g<d.length;g++)h[d.charCodeAt(g)]=g}var p=d.charAt(64);if(p){var m=c.indexOf(p);m!==-1&&(u=m)}return a(c,u,h)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function a(c,l,u){for(var d=[],h=0,g=0;g<l;g++)if(g%4){var p=u[c.charCodeAt(g-1)]<<g%4*2,m=u[c.charCodeAt(g)]>>>6-g%4*2,y=p|m;d[h>>>2]|=y<<24-h%4*8,h++}return i.create(d,h)}}(),t.enc.Base64url})}(Xa)),Xa.exports}var Ja={exports:{}},m2;function cn(){return m2||(m2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.algo,l=[];(function(){for(var m=0;m<64;m++)l[m]=r.abs(r.sin(m+1))*4294967296|0})();var u=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(m,y){for(var w=0;w<16;w++){var v=y+w,b=m[v];m[v]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360}var x=this._hash.words,E=m[y+0],C=m[y+1],_=m[y+2],A=m[y+3],R=m[y+4],S=m[y+5],k=m[y+6],T=m[y+7],D=m[y+8],H=m[y+9],N=m[y+10],O=m[y+11],$=m[y+12],U=m[y+13],I=m[y+14],M=m[y+15],B=x[0],P=x[1],F=x[2],L=x[3];B=d(B,P,F,L,E,7,l[0]),L=d(L,B,P,F,C,12,l[1]),F=d(F,L,B,P,_,17,l[2]),P=d(P,F,L,B,A,22,l[3]),B=d(B,P,F,L,R,7,l[4]),L=d(L,B,P,F,S,12,l[5]),F=d(F,L,B,P,k,17,l[6]),P=d(P,F,L,B,T,22,l[7]),B=d(B,P,F,L,D,7,l[8]),L=d(L,B,P,F,H,12,l[9]),F=d(F,L,B,P,N,17,l[10]),P=d(P,F,L,B,O,22,l[11]),B=d(B,P,F,L,$,7,l[12]),L=d(L,B,P,F,U,12,l[13]),F=d(F,L,B,P,I,17,l[14]),P=d(P,F,L,B,M,22,l[15]),B=h(B,P,F,L,C,5,l[16]),L=h(L,B,P,F,k,9,l[17]),F=h(F,L,B,P,O,14,l[18]),P=h(P,F,L,B,E,20,l[19]),B=h(B,P,F,L,S,5,l[20]),L=h(L,B,P,F,N,9,l[21]),F=h(F,L,B,P,M,14,l[22]),P=h(P,F,L,B,R,20,l[23]),B=h(B,P,F,L,H,5,l[24]),L=h(L,B,P,F,I,9,l[25]),F=h(F,L,B,P,A,14,l[26]),P=h(P,F,L,B,D,20,l[27]),B=h(B,P,F,L,U,5,l[28]),L=h(L,B,P,F,_,9,l[29]),F=h(F,L,B,P,T,14,l[30]),P=h(P,F,L,B,$,20,l[31]),B=g(B,P,F,L,S,4,l[32]),L=g(L,B,P,F,D,11,l[33]),F=g(F,L,B,P,O,16,l[34]),P=g(P,F,L,B,I,23,l[35]),B=g(B,P,F,L,C,4,l[36]),L=g(L,B,P,F,R,11,l[37]),F=g(F,L,B,P,T,16,l[38]),P=g(P,F,L,B,N,23,l[39]),B=g(B,P,F,L,U,4,l[40]),L=g(L,B,P,F,E,11,l[41]),F=g(F,L,B,P,A,16,l[42]),P=g(P,F,L,B,k,23,l[43]),B=g(B,P,F,L,H,4,l[44]),L=g(L,B,P,F,$,11,l[45]),F=g(F,L,B,P,M,16,l[46]),P=g(P,F,L,B,_,23,l[47]),B=p(B,P,F,L,E,6,l[48]),L=p(L,B,P,F,T,10,l[49]),F=p(F,L,B,P,I,15,l[50]),P=p(P,F,L,B,S,21,l[51]),B=p(B,P,F,L,$,6,l[52]),L=p(L,B,P,F,A,10,l[53]),F=p(F,L,B,P,N,15,l[54]),P=p(P,F,L,B,C,21,l[55]),B=p(B,P,F,L,D,6,l[56]),L=p(L,B,P,F,M,10,l[57]),F=p(F,L,B,P,k,15,l[58]),P=p(P,F,L,B,U,21,l[59]),B=p(B,P,F,L,R,6,l[60]),L=p(L,B,P,F,O,10,l[61]),F=p(F,L,B,P,_,15,l[62]),P=p(P,F,L,B,H,21,l[63]),x[0]=x[0]+B|0,x[1]=x[1]+P|0,x[2]=x[2]+F|0,x[3]=x[3]+L|0},_doFinalize:function(){var m=this._data,y=m.words,w=this._nDataBytes*8,v=m.sigBytes*8;y[v>>>5]|=128<<24-v%32;var b=r.floor(w/4294967296),x=w;y[(v+64>>>9<<4)+15]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,y[(v+64>>>9<<4)+14]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360,m.sigBytes=(y.length+1)*4,this._process();for(var E=this._hash,C=E.words,_=0;_<4;_++){var A=C[_];C[_]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360}return E},clone:function(){var m=a.clone.call(this);return m._hash=this._hash.clone(),m}});function d(m,y,w,v,b,x,E){var C=m+(y&w|~y&v)+b+E;return(C<<x|C>>>32-x)+y}function h(m,y,w,v,b,x,E){var C=m+(y&v|w&~v)+b+E;return(C<<x|C>>>32-x)+y}function g(m,y,w,v,b,x,E){var C=m+(y^w^v)+b+E;return(C<<x|C>>>32-x)+y}function p(m,y,w,v,b,x,E){var C=m+(w^(y|~v))+b+E;return(C<<x|C>>>32-x)+y}s.MD5=a._createHelper(u),s.HmacMD5=a._createHmacHelper(u)}(Math),t.MD5})}(Ja)),Ja.exports}var e0={exports:{}},y2;function H3(){return y2||(y2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=s.Hasher,a=r.algo,c=[],l=a.SHA1=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(u,d){for(var h=this._hash.words,g=h[0],p=h[1],m=h[2],y=h[3],w=h[4],v=0;v<80;v++){if(v<16)c[v]=u[d+v]|0;else{var b=c[v-3]^c[v-8]^c[v-14]^c[v-16];c[v]=b<<1|b>>>31}var x=(g<<5|g>>>27)+w+c[v];v<20?x+=(p&m|~p&y)+1518500249:v<40?x+=(p^m^y)+1859775393:v<60?x+=(p&m|p&y|m&y)-1894007588:x+=(p^m^y)-899497514,w=y,y=m,m=p<<30|p>>>2,p=g,g=x}h[0]=h[0]+g|0,h[1]=h[1]+p|0,h[2]=h[2]+m|0,h[3]=h[3]+y|0,h[4]=h[4]+w|0},_doFinalize:function(){var u=this._data,d=u.words,h=this._nDataBytes*8,g=u.sigBytes*8;return d[g>>>5]|=128<<24-g%32,d[(g+64>>>9<<4)+14]=Math.floor(h/4294967296),d[(g+64>>>9<<4)+15]=h,u.sigBytes=d.length*4,this._process(),this._hash},clone:function(){var u=o.clone.call(this);return u._hash=this._hash.clone(),u}});r.SHA1=o._createHelper(l),r.HmacSHA1=o._createHmacHelper(l)}(),t.SHA1})}(e0)),e0.exports}var t0={exports:{}},x2;function U1(){return x2||(x2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.algo,l=[],u=[];(function(){function g(w){for(var v=r.sqrt(w),b=2;b<=v;b++)if(!(w%b))return!1;return!0}function p(w){return(w-(w|0))*4294967296|0}for(var m=2,y=0;y<64;)g(m)&&(y<8&&(l[y]=p(r.pow(m,1/2))),u[y]=p(r.pow(m,1/3)),y++),m++})();var d=[],h=c.SHA256=a.extend({_doReset:function(){this._hash=new o.init(l.slice(0))},_doProcessBlock:function(g,p){for(var m=this._hash.words,y=m[0],w=m[1],v=m[2],b=m[3],x=m[4],E=m[5],C=m[6],_=m[7],A=0;A<64;A++){if(A<16)d[A]=g[p+A]|0;else{var R=d[A-15],S=(R<<25|R>>>7)^(R<<14|R>>>18)^R>>>3,k=d[A-2],T=(k<<15|k>>>17)^(k<<13|k>>>19)^k>>>10;d[A]=S+d[A-7]+T+d[A-16]}var D=x&E^~x&C,H=y&w^y&v^w&v,N=(y<<30|y>>>2)^(y<<19|y>>>13)^(y<<10|y>>>22),O=(x<<26|x>>>6)^(x<<21|x>>>11)^(x<<7|x>>>25),$=_+O+D+u[A]+d[A],U=N+H;_=C,C=E,E=x,x=b+$|0,b=v,v=w,w=y,y=$+U|0}m[0]=m[0]+y|0,m[1]=m[1]+w|0,m[2]=m[2]+v|0,m[3]=m[3]+b|0,m[4]=m[4]+x|0,m[5]=m[5]+E|0,m[6]=m[6]+C|0,m[7]=m[7]+_|0},_doFinalize:function(){var g=this._data,p=g.words,m=this._nDataBytes*8,y=g.sigBytes*8;return p[y>>>5]|=128<<24-y%32,p[(y+64>>>9<<4)+14]=r.floor(m/4294967296),p[(y+64>>>9<<4)+15]=m,g.sigBytes=p.length*4,this._process(),this._hash},clone:function(){var g=a.clone.call(this);return g._hash=this._hash.clone(),g}});s.SHA256=a._createHelper(h),s.HmacSHA256=a._createHmacHelper(h)}(Math),t.SHA256})}(t0)),t0.exports}var r0={exports:{}},b2;function nw(){return b2||(b2=1,function(n,e){(function(t,r,s){n.exports=r(re(),U1())})(J,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.algo,a=o.SHA256,c=o.SHA224=a.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var l=a._doFinalize.call(this);return l.sigBytes-=4,l}});r.SHA224=a._createHelper(c),r.HmacSHA224=a._createHmacHelper(c)}(),t.SHA224})}(r0)),r0.exports}var n0={exports:{}},v2;function z3(){return v2||(v2=1,function(n,e){(function(t,r,s){n.exports=r(re(),ta())})(J,function(t){return function(){var r=t,s=r.lib,i=s.Hasher,o=r.x64,a=o.Word,c=o.WordArray,l=r.algo;function u(){return a.create.apply(a,arguments)}var d=[u(1116352408,3609767458),u(1899447441,602891725),u(3049323471,3964484399),u(3921009573,2173295548),u(961987163,4081628472),u(1508970993,3053834265),u(2453635748,2937671579),u(2870763221,3664609560),u(3624381080,2734883394),u(310598401,1164996542),u(607225278,1323610764),u(1426881987,3590304994),u(1925078388,4068182383),u(2162078206,991336113),u(2614888103,633803317),u(3248222580,3479774868),u(3835390401,2666613458),u(4022224774,944711139),u(264347078,2341262773),u(604807628,2007800933),u(770255983,1495990901),u(1249150122,1856431235),u(1555081692,3175218132),u(1996064986,2198950837),u(2554220882,3999719339),u(2821834349,766784016),u(2952996808,2566594879),u(3210313671,3203337956),u(3336571891,1034457026),u(3584528711,2466948901),u(113926993,3758326383),u(338241895,168717936),u(666307205,1188179964),u(773529912,1546045734),u(1294757372,1522805485),u(1396182291,2643833823),u(1695183700,2343527390),u(1986661051,1014477480),u(2177026350,1206759142),u(2456956037,344077627),u(2730485921,1290863460),u(2820302411,3158454273),u(3259730800,3505952657),u(3345764771,106217008),u(3516065817,3606008344),u(3600352804,1432725776),u(4094571909,1467031594),u(275423344,851169720),u(430227734,3100823752),u(506948616,1363258195),u(659060556,3750685593),u(883997877,3785050280),u(958139571,3318307427),u(1322822218,3812723403),u(1537002063,2003034995),u(1747873779,3602036899),u(1955562222,1575990012),u(2024104815,1125592928),u(2227730452,2716904306),u(2361852424,442776044),u(2428436474,593698344),u(2756734187,3733110249),u(3204031479,2999351573),u(3329325298,3815920427),u(3391569614,3928383900),u(3515267271,566280711),u(3940187606,3454069534),u(4118630271,4000239992),u(116418474,1914138554),u(174292421,2731055270),u(289380356,3203993006),u(460393269,320620315),u(685471733,587496836),u(852142971,1086792851),u(1017036298,365543100),u(1126000580,2618297676),u(1288033470,3409855158),u(1501505948,4234509866),u(1607167915,987167468),u(1816402316,1246189591)],h=[];(function(){for(var p=0;p<80;p++)h[p]=u()})();var g=l.SHA512=i.extend({_doReset:function(){this._hash=new c.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(p,m){for(var y=this._hash.words,w=y[0],v=y[1],b=y[2],x=y[3],E=y[4],C=y[5],_=y[6],A=y[7],R=w.high,S=w.low,k=v.high,T=v.low,D=b.high,H=b.low,N=x.high,O=x.low,$=E.high,U=E.low,I=C.high,M=C.low,B=_.high,P=_.low,F=A.high,L=A.low,j=R,W=S,X=k,G=T,pe=D,ve=H,Re=N,we=O,he=$,ge=U,Je=I,et=M,Mr=B,Or=P,ts=F,Ur=L,gt=0;gt<80;gt++){var _t,hr,pi=h[gt];if(gt<16)hr=pi.high=p[m+gt*2]|0,_t=pi.low=p[m+gt*2+1]|0;else{var cl=h[gt-15],dn=cl.high,rs=cl.low,A8=(dn>>>1|rs<<31)^(dn>>>8|rs<<24)^dn>>>7,ll=(rs>>>1|dn<<31)^(rs>>>8|dn<<24)^(rs>>>7|dn<<25),ul=h[gt-2],hn=ul.high,ns=ul.low,k8=(hn>>>19|ns<<13)^(hn<<3|ns>>>29)^hn>>>6,dl=(ns>>>19|hn<<13)^(ns<<3|hn>>>29)^(ns>>>6|hn<<26),hl=h[gt-7],B8=hl.high,D8=hl.low,fl=h[gt-16],I8=fl.high,pl=fl.low;_t=ll+D8,hr=A8+B8+(_t>>>0<ll>>>0?1:0),_t=_t+dl,hr=hr+k8+(_t>>>0<dl>>>0?1:0),_t=_t+pl,hr=hr+I8+(_t>>>0<pl>>>0?1:0),pi.high=hr,pi.low=_t}var P8=he&Je^~he&Mr,gl=ge&et^~ge&Or,T8=j&X^j&pe^X&pe,R8=W&G^W&ve^G&ve,F8=(j>>>28|W<<4)^(j<<30|W>>>2)^(j<<25|W>>>7),ml=(W>>>28|j<<4)^(W<<30|j>>>2)^(W<<25|j>>>7),L8=(he>>>14|ge<<18)^(he>>>18|ge<<14)^(he<<23|ge>>>9),N8=(ge>>>14|he<<18)^(ge>>>18|he<<14)^(ge<<23|he>>>9),yl=d[gt],M8=yl.high,xl=yl.low,mt=Ur+N8,fr=ts+L8+(mt>>>0<Ur>>>0?1:0),mt=mt+gl,fr=fr+P8+(mt>>>0<gl>>>0?1:0),mt=mt+xl,fr=fr+M8+(mt>>>0<xl>>>0?1:0),mt=mt+_t,fr=fr+hr+(mt>>>0<_t>>>0?1:0),bl=ml+R8,O8=F8+T8+(bl>>>0<ml>>>0?1:0);ts=Mr,Ur=Or,Mr=Je,Or=et,Je=he,et=ge,ge=we+mt|0,he=Re+fr+(ge>>>0<we>>>0?1:0)|0,Re=pe,we=ve,pe=X,ve=G,X=j,G=W,W=mt+bl|0,j=fr+O8+(W>>>0<mt>>>0?1:0)|0}S=w.low=S+W,w.high=R+j+(S>>>0<W>>>0?1:0),T=v.low=T+G,v.high=k+X+(T>>>0<G>>>0?1:0),H=b.low=H+ve,b.high=D+pe+(H>>>0<ve>>>0?1:0),O=x.low=O+we,x.high=N+Re+(O>>>0<we>>>0?1:0),U=E.low=U+ge,E.high=$+he+(U>>>0<ge>>>0?1:0),M=C.low=M+et,C.high=I+Je+(M>>>0<et>>>0?1:0),P=_.low=P+Or,_.high=B+Mr+(P>>>0<Or>>>0?1:0),L=A.low=L+Ur,A.high=F+ts+(L>>>0<Ur>>>0?1:0)},_doFinalize:function(){var p=this._data,m=p.words,y=this._nDataBytes*8,w=p.sigBytes*8;m[w>>>5]|=128<<24-w%32,m[(w+128>>>10<<5)+30]=Math.floor(y/4294967296),m[(w+128>>>10<<5)+31]=y,p.sigBytes=m.length*4,this._process();var v=this._hash.toX32();return v},clone:function(){var p=i.clone.call(this);return p._hash=this._hash.clone(),p},blockSize:1024/32});r.SHA512=i._createHelper(g),r.HmacSHA512=i._createHmacHelper(g)}(),t.SHA512})}(n0)),n0.exports}var s0={exports:{}},w2;function sw(){return w2||(w2=1,function(n,e){(function(t,r,s){n.exports=r(re(),ta(),z3())})(J,function(t){return function(){var r=t,s=r.x64,i=s.Word,o=s.WordArray,a=r.algo,c=a.SHA512,l=a.SHA384=c.extend({_doReset:function(){this._hash=new o.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var u=c._doFinalize.call(this);return u.sigBytes-=16,u}});r.SHA384=c._createHelper(l),r.HmacSHA384=c._createHmacHelper(l)}(),t.SHA384})}(s0)),s0.exports}var i0={exports:{}},E2;function iw(){return E2||(E2=1,function(n,e){(function(t,r,s){n.exports=r(re(),ta())})(J,function(t){return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.x64,l=c.Word,u=s.algo,d=[],h=[],g=[];(function(){for(var y=1,w=0,v=0;v<24;v++){d[y+5*w]=(v+1)*(v+2)/2%64;var b=w%5,x=(2*y+3*w)%5;y=b,w=x}for(var y=0;y<5;y++)for(var w=0;w<5;w++)h[y+5*w]=w+(2*y+3*w)%5*5;for(var E=1,C=0;C<24;C++){for(var _=0,A=0,R=0;R<7;R++){if(E&1){var S=(1<<R)-1;S<32?A^=1<<S:_^=1<<S-32}E&128?E=E<<1^113:E<<=1}g[C]=l.create(_,A)}})();var p=[];(function(){for(var y=0;y<25;y++)p[y]=l.create()})();var m=u.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var y=this._state=[],w=0;w<25;w++)y[w]=new l.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(y,w){for(var v=this._state,b=this.blockSize/2,x=0;x<b;x++){var E=y[w+2*x],C=y[w+2*x+1];E=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360;var _=v[x];_.high^=C,_.low^=E}for(var A=0;A<24;A++){for(var R=0;R<5;R++){for(var S=0,k=0,T=0;T<5;T++){var _=v[R+5*T];S^=_.high,k^=_.low}var D=p[R];D.high=S,D.low=k}for(var R=0;R<5;R++)for(var H=p[(R+4)%5],N=p[(R+1)%5],O=N.high,$=N.low,S=H.high^(O<<1|$>>>31),k=H.low^($<<1|O>>>31),T=0;T<5;T++){var _=v[R+5*T];_.high^=S,_.low^=k}for(var U=1;U<25;U++){var S,k,_=v[U],I=_.high,M=_.low,B=d[U];B<32?(S=I<<B|M>>>32-B,k=M<<B|I>>>32-B):(S=M<<B-32|I>>>64-B,k=I<<B-32|M>>>64-B);var P=p[h[U]];P.high=S,P.low=k}var F=p[0],L=v[0];F.high=L.high,F.low=L.low;for(var R=0;R<5;R++)for(var T=0;T<5;T++){var U=R+5*T,_=v[U],j=p[U],W=p[(R+1)%5+5*T],X=p[(R+2)%5+5*T];_.high=j.high^~W.high&X.high,_.low=j.low^~W.low&X.low}var _=v[0],G=g[A];_.high^=G.high,_.low^=G.low}},_doFinalize:function(){var y=this._data,w=y.words;this._nDataBytes*8;var v=y.sigBytes*8,b=this.blockSize*32;w[v>>>5]|=1<<24-v%32,w[(r.ceil((v+1)/b)*b>>>5)-1]|=128,y.sigBytes=w.length*4,this._process();for(var x=this._state,E=this.cfg.outputLength/8,C=E/8,_=[],A=0;A<C;A++){var R=x[A],S=R.high,k=R.low;S=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,k=(k<<8|k>>>24)&16711935|(k<<24|k>>>8)&4278255360,_.push(k),_.push(S)}return new o.init(_,E)},clone:function(){for(var y=a.clone.call(this),w=y._state=this._state.slice(0),v=0;v<25;v++)w[v]=w[v].clone();return y}});s.SHA3=a._createHelper(m),s.HmacSHA3=a._createHmacHelper(m)}(Math),t.SHA3})}(i0)),i0.exports}var o0={exports:{}},C2;function ow(){return C2||(C2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.algo,l=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),u=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),h=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),g=o.create([0,1518500249,1859775393,2400959708,2840853838]),p=o.create([1352829926,1548603684,1836072691,2053994217,0]),m=c.RIPEMD160=a.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(C,_){for(var A=0;A<16;A++){var R=_+A,S=C[R];C[R]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}var k=this._hash.words,T=g.words,D=p.words,H=l.words,N=u.words,O=d.words,$=h.words,U,I,M,B,P,F,L,j,W,X;F=U=k[0],L=I=k[1],j=M=k[2],W=B=k[3],X=P=k[4];for(var G,A=0;A<80;A+=1)G=U+C[_+H[A]]|0,A<16?G+=y(I,M,B)+T[0]:A<32?G+=w(I,M,B)+T[1]:A<48?G+=v(I,M,B)+T[2]:A<64?G+=b(I,M,B)+T[3]:G+=x(I,M,B)+T[4],G=G|0,G=E(G,O[A]),G=G+P|0,U=P,P=B,B=E(M,10),M=I,I=G,G=F+C[_+N[A]]|0,A<16?G+=x(L,j,W)+D[0]:A<32?G+=b(L,j,W)+D[1]:A<48?G+=v(L,j,W)+D[2]:A<64?G+=w(L,j,W)+D[3]:G+=y(L,j,W)+D[4],G=G|0,G=E(G,$[A]),G=G+X|0,F=X,X=W,W=E(j,10),j=L,L=G;G=k[1]+M+W|0,k[1]=k[2]+B+X|0,k[2]=k[3]+P+F|0,k[3]=k[4]+U+L|0,k[4]=k[0]+I+j|0,k[0]=G},_doFinalize:function(){var C=this._data,_=C.words,A=this._nDataBytes*8,R=C.sigBytes*8;_[R>>>5]|=128<<24-R%32,_[(R+64>>>9<<4)+14]=(A<<8|A>>>24)&16711935|(A<<24|A>>>8)&4278255360,C.sigBytes=(_.length+1)*4,this._process();for(var S=this._hash,k=S.words,T=0;T<5;T++){var D=k[T];k[T]=(D<<8|D>>>24)&16711935|(D<<24|D>>>8)&4278255360}return S},clone:function(){var C=a.clone.call(this);return C._hash=this._hash.clone(),C}});function y(C,_,A){return C^_^A}function w(C,_,A){return C&_|~C&A}function v(C,_,A){return(C|~_)^A}function b(C,_,A){return C&A|_&~A}function x(C,_,A){return C^(_|~A)}function E(C,_){return C<<_|C>>>32-_}s.RIPEMD160=a._createHelper(m),s.HmacRIPEMD160=a._createHmacHelper(m)}(),t.RIPEMD160})}(o0)),o0.exports}var a0={exports:{}},_2;function $1(){return _2||(_2=1,function(n,e){(function(t,r){n.exports=r(re())})(J,function(t){(function(){var r=t,s=r.lib,i=s.Base,o=r.enc,a=o.Utf8,c=r.algo;c.HMAC=i.extend({init:function(l,u){l=this._hasher=new l.init,typeof u=="string"&&(u=a.parse(u));var d=l.blockSize,h=d*4;u.sigBytes>h&&(u=l.finalize(u)),u.clamp();for(var g=this._oKey=u.clone(),p=this._iKey=u.clone(),m=g.words,y=p.words,w=0;w<d;w++)m[w]^=1549556828,y[w]^=909522486;g.sigBytes=p.sigBytes=h,this.reset()},reset:function(){var l=this._hasher;l.reset(),l.update(this._iKey)},update:function(l){return this._hasher.update(l),this},finalize:function(l){var u=this._hasher,d=u.finalize(l);u.reset();var h=u.finalize(this._oKey.clone().concat(d));return h}})})()})}(a0)),a0.exports}var c0={exports:{}},S2;function aw(){return S2||(S2=1,function(n,e){(function(t,r,s){n.exports=r(re(),U1(),$1())})(J,function(t){return function(){var r=t,s=r.lib,i=s.Base,o=s.WordArray,a=r.algo,c=a.SHA256,l=a.HMAC,u=a.PBKDF2=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,h){for(var g=this.cfg,p=l.create(g.hasher,d),m=o.create(),y=o.create([1]),w=m.words,v=y.words,b=g.keySize,x=g.iterations;w.length<b;){var E=p.update(h).finalize(y);p.reset();for(var C=E.words,_=C.length,A=E,R=1;R<x;R++){A=p.finalize(A),p.reset();for(var S=A.words,k=0;k<_;k++)C[k]^=S[k]}m.concat(E),v[0]++}return m.sigBytes=b*4,m}});r.PBKDF2=function(d,h,g){return u.create(g).compute(d,h)}}(),t.PBKDF2})}(c0)),c0.exports}var l0={exports:{}},A2;function Lr(){return A2||(A2=1,function(n,e){(function(t,r,s){n.exports=r(re(),H3(),$1())})(J,function(t){return function(){var r=t,s=r.lib,i=s.Base,o=s.WordArray,a=r.algo,c=a.MD5,l=a.EvpKDF=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:1}),init:function(u){this.cfg=this.cfg.extend(u)},compute:function(u,d){for(var h,g=this.cfg,p=g.hasher.create(),m=o.create(),y=m.words,w=g.keySize,v=g.iterations;y.length<w;){h&&p.update(h),h=p.update(u).finalize(d),p.reset();for(var b=1;b<v;b++)h=p.finalize(h),p.reset();m.concat(h)}return m.sigBytes=w*4,m}});r.EvpKDF=function(u,d,h){return l.create(h).compute(u,d)}}(),t.EvpKDF})}(l0)),l0.exports}var u0={exports:{}},k2;function Me(){return k2||(k2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Lr())})(J,function(t){t.lib.Cipher||function(r){var s=t,i=s.lib,o=i.Base,a=i.WordArray,c=i.BufferedBlockAlgorithm,l=s.enc;l.Utf8;var u=l.Base64,d=s.algo,h=d.EvpKDF,g=i.Cipher=c.extend({cfg:o.extend(),createEncryptor:function(S,k){return this.create(this._ENC_XFORM_MODE,S,k)},createDecryptor:function(S,k){return this.create(this._DEC_XFORM_MODE,S,k)},init:function(S,k,T){this.cfg=this.cfg.extend(T),this._xformMode=S,this._key=k,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(S){return this._append(S),this._process()},finalize:function(S){S&&this._append(S);var k=this._doFinalize();return k},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function S(k){return typeof k=="string"?R:C}return function(k){return{encrypt:function(T,D,H){return S(D).encrypt(k,T,D,H)},decrypt:function(T,D,H){return S(D).decrypt(k,T,D,H)}}}}()});i.StreamCipher=g.extend({_doFinalize:function(){var S=this._process(!0);return S},blockSize:1});var p=s.mode={},m=i.BlockCipherMode=o.extend({createEncryptor:function(S,k){return this.Encryptor.create(S,k)},createDecryptor:function(S,k){return this.Decryptor.create(S,k)},init:function(S,k){this._cipher=S,this._iv=k}}),y=p.CBC=function(){var S=m.extend();S.Encryptor=S.extend({processBlock:function(T,D){var H=this._cipher,N=H.blockSize;k.call(this,T,D,N),H.encryptBlock(T,D),this._prevBlock=T.slice(D,D+N)}}),S.Decryptor=S.extend({processBlock:function(T,D){var H=this._cipher,N=H.blockSize,O=T.slice(D,D+N);H.decryptBlock(T,D),k.call(this,T,D,N),this._prevBlock=O}});function k(T,D,H){var N,O=this._iv;O?(N=O,this._iv=r):N=this._prevBlock;for(var $=0;$<H;$++)T[D+$]^=N[$]}return S}(),w=s.pad={},v=w.Pkcs7={pad:function(S,k){for(var T=k*4,D=T-S.sigBytes%T,H=D<<24|D<<16|D<<8|D,N=[],O=0;O<D;O+=4)N.push(H);var $=a.create(N,D);S.concat($)},unpad:function(S){var k=S.words[S.sigBytes-1>>>2]&255;S.sigBytes-=k}};i.BlockCipher=g.extend({cfg:g.cfg.extend({mode:y,padding:v}),reset:function(){var S;g.reset.call(this);var k=this.cfg,T=k.iv,D=k.mode;this._xformMode==this._ENC_XFORM_MODE?S=D.createEncryptor:(S=D.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==S?this._mode.init(this,T&&T.words):(this._mode=S.call(D,this,T&&T.words),this._mode.__creator=S)},_doProcessBlock:function(S,k){this._mode.processBlock(S,k)},_doFinalize:function(){var S,k=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(k.pad(this._data,this.blockSize),S=this._process(!0)):(S=this._process(!0),k.unpad(S)),S},blockSize:128/32});var b=i.CipherParams=o.extend({init:function(S){this.mixIn(S)},toString:function(S){return(S||this.formatter).stringify(this)}}),x=s.format={},E=x.OpenSSL={stringify:function(S){var k,T=S.ciphertext,D=S.salt;return D?k=a.create([1398893684,1701076831]).concat(D).concat(T):k=T,k.toString(u)},parse:function(S){var k,T=u.parse(S),D=T.words;return D[0]==1398893684&&D[1]==1701076831&&(k=a.create(D.slice(2,4)),D.splice(0,4),T.sigBytes-=16),b.create({ciphertext:T,salt:k})}},C=i.SerializableCipher=o.extend({cfg:o.extend({format:E}),encrypt:function(S,k,T,D){D=this.cfg.extend(D);var H=S.createEncryptor(T,D),N=H.finalize(k),O=H.cfg;return b.create({ciphertext:N,key:T,iv:O.iv,algorithm:S,mode:O.mode,padding:O.padding,blockSize:S.blockSize,formatter:D.format})},decrypt:function(S,k,T,D){D=this.cfg.extend(D),k=this._parse(k,D.format);var H=S.createDecryptor(T,D).finalize(k.ciphertext);return H},_parse:function(S,k){return typeof S=="string"?k.parse(S,this):S}}),_=s.kdf={},A=_.OpenSSL={execute:function(S,k,T,D,H){if(D||(D=a.random(64/8)),H)var N=h.create({keySize:k+T,hasher:H}).compute(S,D);else var N=h.create({keySize:k+T}).compute(S,D);var O=a.create(N.words.slice(k),T*4);return N.sigBytes=k*4,b.create({key:N,iv:O,salt:D})}},R=i.PasswordBasedCipher=C.extend({cfg:C.cfg.extend({kdf:A}),encrypt:function(S,k,T,D){D=this.cfg.extend(D);var H=D.kdf.execute(T,S.keySize,S.ivSize,D.salt,D.hasher);D.iv=H.iv;var N=C.encrypt.call(this,S,k,H.key,D);return N.mixIn(H),N},decrypt:function(S,k,T,D){D=this.cfg.extend(D),k=this._parse(k,D.format);var H=D.kdf.execute(T,S.keySize,S.ivSize,k.salt,D.hasher);D.iv=H.iv;var N=C.decrypt.call(this,S,k,H.key,D);return N}})}()})}(u0)),u0.exports}var d0={exports:{}},B2;function cw(){return B2||(B2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return t.mode.CFB=function(){var r=t.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize;s.call(this,i,o,c,a),this._prevBlock=i.slice(o,o+c)}}),r.Decryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize,l=i.slice(o,o+c);s.call(this,i,o,c,a),this._prevBlock=l}});function s(i,o,a,c){var l,u=this._iv;u?(l=u.slice(0),this._iv=void 0):l=this._prevBlock,c.encryptBlock(l,0);for(var d=0;d<a;d++)i[o+d]^=l[d]}return r}(),t.mode.CFB})}(d0)),d0.exports}var h0={exports:{}},D2;function lw(){return D2||(D2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return t.mode.CTR=function(){var r=t.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize,l=this._iv,u=this._counter;l&&(u=this._counter=l.slice(0),this._iv=void 0);var d=u.slice(0);a.encryptBlock(d,0),u[c-1]=u[c-1]+1|0;for(var h=0;h<c;h++)i[o+h]^=d[h]}});return r.Decryptor=s,r}(),t.mode.CTR})}(h0)),h0.exports}var f0={exports:{}},I2;function uw(){return I2||(I2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var r=t.lib.BlockCipherMode.extend();function s(a){if((a>>24&255)===255){var c=a>>16&255,l=a>>8&255,u=a&255;c===255?(c=0,l===255?(l=0,u===255?u=0:++u):++l):++c,a=0,a+=c<<16,a+=l<<8,a+=u}else a+=1<<24;return a}function i(a){return(a[0]=s(a[0]))===0&&(a[1]=s(a[1])),a}var o=r.Encryptor=r.extend({processBlock:function(a,c){var l=this._cipher,u=l.blockSize,d=this._iv,h=this._counter;d&&(h=this._counter=d.slice(0),this._iv=void 0),i(h);var g=h.slice(0);l.encryptBlock(g,0);for(var p=0;p<u;p++)a[c+p]^=g[p]}});return r.Decryptor=o,r}(),t.mode.CTRGladman})}(f0)),f0.exports}var p0={exports:{}},P2;function dw(){return P2||(P2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return t.mode.OFB=function(){var r=t.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize,l=this._iv,u=this._keystream;l&&(u=this._keystream=l.slice(0),this._iv=void 0),a.encryptBlock(u,0);for(var d=0;d<c;d++)i[o+d]^=u[d]}});return r.Decryptor=s,r}(),t.mode.OFB})}(p0)),p0.exports}var g0={exports:{}},T2;function hw(){return T2||(T2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return t.mode.ECB=function(){var r=t.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(s,i){this._cipher.encryptBlock(s,i)}}),r.Decryptor=r.extend({processBlock:function(s,i){this._cipher.decryptBlock(s,i)}}),r}(),t.mode.ECB})}(g0)),g0.exports}var m0={exports:{}},R2;function fw(){return R2||(R2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return t.pad.AnsiX923={pad:function(r,s){var i=r.sigBytes,o=s*4,a=o-i%o,c=i+a-1;r.clamp(),r.words[c>>>2]|=a<<24-c%4*8,r.sigBytes+=a},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},t.pad.Ansix923})}(m0)),m0.exports}var y0={exports:{}},F2;function pw(){return F2||(F2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return t.pad.Iso10126={pad:function(r,s){var i=s*4,o=i-r.sigBytes%i;r.concat(t.lib.WordArray.random(o-1)).concat(t.lib.WordArray.create([o<<24],1))},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},t.pad.Iso10126})}(y0)),y0.exports}var x0={exports:{}},L2;function gw(){return L2||(L2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return t.pad.Iso97971={pad:function(r,s){r.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(r,s)},unpad:function(r){t.pad.ZeroPadding.unpad(r),r.sigBytes--}},t.pad.Iso97971})}(x0)),x0.exports}var b0={exports:{}},N2;function mw(){return N2||(N2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return t.pad.ZeroPadding={pad:function(r,s){var i=s*4;r.clamp(),r.sigBytes+=i-(r.sigBytes%i||i)},unpad:function(r){for(var s=r.words,i=r.sigBytes-1,i=r.sigBytes-1;i>=0;i--)if(s[i>>>2]>>>24-i%4*8&255){r.sigBytes=i+1;break}}},t.pad.ZeroPadding})}(b0)),b0.exports}var v0={exports:{}},M2;function yw(){return M2||(M2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(v0)),v0.exports}var w0={exports:{}},O2;function xw(){return O2||(O2=1,function(n,e){(function(t,r,s){n.exports=r(re(),Me())})(J,function(t){return function(r){var s=t,i=s.lib,o=i.CipherParams,a=s.enc,c=a.Hex,l=s.format;l.Hex={stringify:function(u){return u.ciphertext.toString(c)},parse:function(u){var d=c.parse(u);return o.create({ciphertext:d})}}}(),t.format.Hex})}(w0)),w0.exports}var E0={exports:{}},U2;function bw(){return U2||(U2=1,function(n,e){(function(t,r,s){n.exports=r(re(),an(),cn(),Lr(),Me())})(J,function(t){return function(){var r=t,s=r.lib,i=s.BlockCipher,o=r.algo,a=[],c=[],l=[],u=[],d=[],h=[],g=[],p=[],m=[],y=[];(function(){for(var b=[],x=0;x<256;x++)x<128?b[x]=x<<1:b[x]=x<<1^283;for(var E=0,C=0,x=0;x<256;x++){var _=C^C<<1^C<<2^C<<3^C<<4;_=_>>>8^_&255^99,a[E]=_,c[_]=E;var A=b[E],R=b[A],S=b[R],k=b[_]*257^_*16843008;l[E]=k<<24|k>>>8,u[E]=k<<16|k>>>16,d[E]=k<<8|k>>>24,h[E]=k;var k=S*16843009^R*65537^A*257^E*16843008;g[_]=k<<24|k>>>8,p[_]=k<<16|k>>>16,m[_]=k<<8|k>>>24,y[_]=k,E?(E=A^b[b[b[S^A]]],C^=b[b[C]]):E=C=1}})();var w=[0,1,2,4,8,16,32,64,128,27,54],v=o.AES=i.extend({_doReset:function(){var b;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var x=this._keyPriorReset=this._key,E=x.words,C=x.sigBytes/4,_=this._nRounds=C+6,A=(_+1)*4,R=this._keySchedule=[],S=0;S<A;S++)S<C?R[S]=E[S]:(b=R[S-1],S%C?C>6&&S%C==4&&(b=a[b>>>24]<<24|a[b>>>16&255]<<16|a[b>>>8&255]<<8|a[b&255]):(b=b<<8|b>>>24,b=a[b>>>24]<<24|a[b>>>16&255]<<16|a[b>>>8&255]<<8|a[b&255],b^=w[S/C|0]<<24),R[S]=R[S-C]^b);for(var k=this._invKeySchedule=[],T=0;T<A;T++){var S=A-T;if(T%4)var b=R[S];else var b=R[S-4];T<4||S<=4?k[T]=b:k[T]=g[a[b>>>24]]^p[a[b>>>16&255]]^m[a[b>>>8&255]]^y[a[b&255]]}}},encryptBlock:function(b,x){this._doCryptBlock(b,x,this._keySchedule,l,u,d,h,a)},decryptBlock:function(b,x){var E=b[x+1];b[x+1]=b[x+3],b[x+3]=E,this._doCryptBlock(b,x,this._invKeySchedule,g,p,m,y,c);var E=b[x+1];b[x+1]=b[x+3],b[x+3]=E},_doCryptBlock:function(b,x,E,C,_,A,R,S){for(var k=this._nRounds,T=b[x]^E[0],D=b[x+1]^E[1],H=b[x+2]^E[2],N=b[x+3]^E[3],O=4,$=1;$<k;$++){var U=C[T>>>24]^_[D>>>16&255]^A[H>>>8&255]^R[N&255]^E[O++],I=C[D>>>24]^_[H>>>16&255]^A[N>>>8&255]^R[T&255]^E[O++],M=C[H>>>24]^_[N>>>16&255]^A[T>>>8&255]^R[D&255]^E[O++],B=C[N>>>24]^_[T>>>16&255]^A[D>>>8&255]^R[H&255]^E[O++];T=U,D=I,H=M,N=B}var U=(S[T>>>24]<<24|S[D>>>16&255]<<16|S[H>>>8&255]<<8|S[N&255])^E[O++],I=(S[D>>>24]<<24|S[H>>>16&255]<<16|S[N>>>8&255]<<8|S[T&255])^E[O++],M=(S[H>>>24]<<24|S[N>>>16&255]<<16|S[T>>>8&255]<<8|S[D&255])^E[O++],B=(S[N>>>24]<<24|S[T>>>16&255]<<16|S[D>>>8&255]<<8|S[H&255])^E[O++];b[x]=U,b[x+1]=I,b[x+2]=M,b[x+3]=B},keySize:256/32});r.AES=i._createHelper(v)}(),t.AES})}(E0)),E0.exports}var C0={exports:{}},$2;function vw(){return $2||($2=1,function(n,e){(function(t,r,s){n.exports=r(re(),an(),cn(),Lr(),Me())})(J,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=s.BlockCipher,a=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],l=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],u=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],h=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],g=a.DES=o.extend({_doReset:function(){for(var w=this._key,v=w.words,b=[],x=0;x<56;x++){var E=c[x]-1;b[x]=v[E>>>5]>>>31-E%32&1}for(var C=this._subKeys=[],_=0;_<16;_++){for(var A=C[_]=[],R=u[_],x=0;x<24;x++)A[x/6|0]|=b[(l[x]-1+R)%28]<<31-x%6,A[4+(x/6|0)]|=b[28+(l[x+24]-1+R)%28]<<31-x%6;A[0]=A[0]<<1|A[0]>>>31;for(var x=1;x<7;x++)A[x]=A[x]>>>(x-1)*4+3;A[7]=A[7]<<5|A[7]>>>27}for(var S=this._invSubKeys=[],x=0;x<16;x++)S[x]=C[15-x]},encryptBlock:function(w,v){this._doCryptBlock(w,v,this._subKeys)},decryptBlock:function(w,v){this._doCryptBlock(w,v,this._invSubKeys)},_doCryptBlock:function(w,v,b){this._lBlock=w[v],this._rBlock=w[v+1],p.call(this,4,252645135),p.call(this,16,65535),m.call(this,2,858993459),m.call(this,8,16711935),p.call(this,1,1431655765);for(var x=0;x<16;x++){for(var E=b[x],C=this._lBlock,_=this._rBlock,A=0,R=0;R<8;R++)A|=d[R][((_^E[R])&h[R])>>>0];this._lBlock=_,this._rBlock=C^A}var S=this._lBlock;this._lBlock=this._rBlock,this._rBlock=S,p.call(this,1,1431655765),m.call(this,8,16711935),m.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),w[v]=this._lBlock,w[v+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function p(w,v){var b=(this._lBlock>>>w^this._rBlock)&v;this._rBlock^=b,this._lBlock^=b<<w}function m(w,v){var b=(this._rBlock>>>w^this._lBlock)&v;this._lBlock^=b,this._rBlock^=b<<w}r.DES=o._createHelper(g);var y=a.TripleDES=o.extend({_doReset:function(){var w=this._key,v=w.words;if(v.length!==2&&v.length!==4&&v.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var b=v.slice(0,2),x=v.length<4?v.slice(0,2):v.slice(2,4),E=v.length<6?v.slice(0,2):v.slice(4,6);this._des1=g.createEncryptor(i.create(b)),this._des2=g.createEncryptor(i.create(x)),this._des3=g.createEncryptor(i.create(E))},encryptBlock:function(w,v){this._des1.encryptBlock(w,v),this._des2.decryptBlock(w,v),this._des3.encryptBlock(w,v)},decryptBlock:function(w,v){this._des3.decryptBlock(w,v),this._des2.encryptBlock(w,v),this._des1.decryptBlock(w,v)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=o._createHelper(y)}(),t.TripleDES})}(C0)),C0.exports}var _0={exports:{}},H2;function ww(){return H2||(H2=1,function(n,e){(function(t,r,s){n.exports=r(re(),an(),cn(),Lr(),Me())})(J,function(t){return function(){var r=t,s=r.lib,i=s.StreamCipher,o=r.algo,a=o.RC4=i.extend({_doReset:function(){for(var u=this._key,d=u.words,h=u.sigBytes,g=this._S=[],p=0;p<256;p++)g[p]=p;for(var p=0,m=0;p<256;p++){var y=p%h,w=d[y>>>2]>>>24-y%4*8&255;m=(m+g[p]+w)%256;var v=g[p];g[p]=g[m],g[m]=v}this._i=this._j=0},_doProcessBlock:function(u,d){u[d]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var u=this._S,d=this._i,h=this._j,g=0,p=0;p<4;p++){d=(d+1)%256,h=(h+u[d])%256;var m=u[d];u[d]=u[h],u[h]=m,g|=u[(u[d]+u[h])%256]<<24-p*8}return this._i=d,this._j=h,g}r.RC4=i._createHelper(a);var l=o.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var u=this.cfg.drop;u>0;u--)c.call(this)}});r.RC4Drop=i._createHelper(l)}(),t.RC4})}(_0)),_0.exports}var S0={exports:{}},z2;function Ew(){return z2||(z2=1,function(n,e){(function(t,r,s){n.exports=r(re(),an(),cn(),Lr(),Me())})(J,function(t){return function(){var r=t,s=r.lib,i=s.StreamCipher,o=r.algo,a=[],c=[],l=[],u=o.Rabbit=i.extend({_doReset:function(){for(var h=this._key.words,g=this.cfg.iv,p=0;p<4;p++)h[p]=(h[p]<<8|h[p]>>>24)&16711935|(h[p]<<24|h[p]>>>8)&4278255360;var m=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],y=this._C=[h[2]<<16|h[2]>>>16,h[0]&4294901760|h[1]&65535,h[3]<<16|h[3]>>>16,h[1]&4294901760|h[2]&65535,h[0]<<16|h[0]>>>16,h[2]&4294901760|h[3]&65535,h[1]<<16|h[1]>>>16,h[3]&4294901760|h[0]&65535];this._b=0;for(var p=0;p<4;p++)d.call(this);for(var p=0;p<8;p++)y[p]^=m[p+4&7];if(g){var w=g.words,v=w[0],b=w[1],x=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,E=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,C=x>>>16|E&4294901760,_=E<<16|x&65535;y[0]^=x,y[1]^=C,y[2]^=E,y[3]^=_,y[4]^=x,y[5]^=C,y[6]^=E,y[7]^=_;for(var p=0;p<4;p++)d.call(this)}},_doProcessBlock:function(h,g){var p=this._X;d.call(this),a[0]=p[0]^p[5]>>>16^p[3]<<16,a[1]=p[2]^p[7]>>>16^p[5]<<16,a[2]=p[4]^p[1]>>>16^p[7]<<16,a[3]=p[6]^p[3]>>>16^p[1]<<16;for(var m=0;m<4;m++)a[m]=(a[m]<<8|a[m]>>>24)&16711935|(a[m]<<24|a[m]>>>8)&4278255360,h[g+m]^=a[m]},blockSize:128/32,ivSize:64/32});function d(){for(var h=this._X,g=this._C,p=0;p<8;p++)c[p]=g[p];g[0]=g[0]+1295307597+this._b|0,g[1]=g[1]+3545052371+(g[0]>>>0<c[0]>>>0?1:0)|0,g[2]=g[2]+886263092+(g[1]>>>0<c[1]>>>0?1:0)|0,g[3]=g[3]+1295307597+(g[2]>>>0<c[2]>>>0?1:0)|0,g[4]=g[4]+3545052371+(g[3]>>>0<c[3]>>>0?1:0)|0,g[5]=g[5]+886263092+(g[4]>>>0<c[4]>>>0?1:0)|0,g[6]=g[6]+1295307597+(g[5]>>>0<c[5]>>>0?1:0)|0,g[7]=g[7]+3545052371+(g[6]>>>0<c[6]>>>0?1:0)|0,this._b=g[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var m=h[p]+g[p],y=m&65535,w=m>>>16,v=((y*y>>>17)+y*w>>>15)+w*w,b=((m&4294901760)*m|0)+((m&65535)*m|0);l[p]=v^b}h[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,h[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,h[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,h[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,h[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,h[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,h[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,h[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}r.Rabbit=i._createHelper(u)}(),t.Rabbit})}(S0)),S0.exports}var A0={exports:{}},q2;function Cw(){return q2||(q2=1,function(n,e){(function(t,r,s){n.exports=r(re(),an(),cn(),Lr(),Me())})(J,function(t){return function(){var r=t,s=r.lib,i=s.StreamCipher,o=r.algo,a=[],c=[],l=[],u=o.RabbitLegacy=i.extend({_doReset:function(){var h=this._key.words,g=this.cfg.iv,p=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],m=this._C=[h[2]<<16|h[2]>>>16,h[0]&4294901760|h[1]&65535,h[3]<<16|h[3]>>>16,h[1]&4294901760|h[2]&65535,h[0]<<16|h[0]>>>16,h[2]&4294901760|h[3]&65535,h[1]<<16|h[1]>>>16,h[3]&4294901760|h[0]&65535];this._b=0;for(var y=0;y<4;y++)d.call(this);for(var y=0;y<8;y++)m[y]^=p[y+4&7];if(g){var w=g.words,v=w[0],b=w[1],x=(v<<8|v>>>24)&16711935|(v<<24|v>>>8)&4278255360,E=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,C=x>>>16|E&4294901760,_=E<<16|x&65535;m[0]^=x,m[1]^=C,m[2]^=E,m[3]^=_,m[4]^=x,m[5]^=C,m[6]^=E,m[7]^=_;for(var y=0;y<4;y++)d.call(this)}},_doProcessBlock:function(h,g){var p=this._X;d.call(this),a[0]=p[0]^p[5]>>>16^p[3]<<16,a[1]=p[2]^p[7]>>>16^p[5]<<16,a[2]=p[4]^p[1]>>>16^p[7]<<16,a[3]=p[6]^p[3]>>>16^p[1]<<16;for(var m=0;m<4;m++)a[m]=(a[m]<<8|a[m]>>>24)&16711935|(a[m]<<24|a[m]>>>8)&4278255360,h[g+m]^=a[m]},blockSize:128/32,ivSize:64/32});function d(){for(var h=this._X,g=this._C,p=0;p<8;p++)c[p]=g[p];g[0]=g[0]+1295307597+this._b|0,g[1]=g[1]+3545052371+(g[0]>>>0<c[0]>>>0?1:0)|0,g[2]=g[2]+886263092+(g[1]>>>0<c[1]>>>0?1:0)|0,g[3]=g[3]+1295307597+(g[2]>>>0<c[2]>>>0?1:0)|0,g[4]=g[4]+3545052371+(g[3]>>>0<c[3]>>>0?1:0)|0,g[5]=g[5]+886263092+(g[4]>>>0<c[4]>>>0?1:0)|0,g[6]=g[6]+1295307597+(g[5]>>>0<c[5]>>>0?1:0)|0,g[7]=g[7]+3545052371+(g[6]>>>0<c[6]>>>0?1:0)|0,this._b=g[7]>>>0<c[7]>>>0?1:0;for(var p=0;p<8;p++){var m=h[p]+g[p],y=m&65535,w=m>>>16,v=((y*y>>>17)+y*w>>>15)+w*w,b=((m&4294901760)*m|0)+((m&65535)*m|0);l[p]=v^b}h[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,h[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,h[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,h[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,h[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,h[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,h[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,h[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}r.RabbitLegacy=i._createHelper(u)}(),t.RabbitLegacy})}(A0)),A0.exports}var k0={exports:{}},V2;function _w(){return V2||(V2=1,function(n,e){(function(t,r,s){n.exports=r(re(),an(),cn(),Lr(),Me())})(J,function(t){return function(){var r=t,s=r.lib,i=s.BlockCipher,o=r.algo;const a=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],l=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var u={pbox:[],sbox:[]};function d(y,w){let v=w>>24&255,b=w>>16&255,x=w>>8&255,E=w&255,C=y.sbox[0][v]+y.sbox[1][b];return C=C^y.sbox[2][x],C=C+y.sbox[3][E],C}function h(y,w,v){let b=w,x=v,E;for(let C=0;C<a;++C)b=b^y.pbox[C],x=d(y,b)^x,E=b,b=x,x=E;return E=b,b=x,x=E,x=x^y.pbox[a],b=b^y.pbox[a+1],{left:b,right:x}}function g(y,w,v){let b=w,x=v,E;for(let C=a+1;C>1;--C)b=b^y.pbox[C],x=d(y,b)^x,E=b,b=x,x=E;return E=b,b=x,x=E,x=x^y.pbox[1],b=b^y.pbox[0],{left:b,right:x}}function p(y,w,v){for(let _=0;_<4;_++){y.sbox[_]=[];for(let A=0;A<256;A++)y.sbox[_][A]=l[_][A]}let b=0;for(let _=0;_<a+2;_++)y.pbox[_]=c[_]^w[b],b++,b>=v&&(b=0);let x=0,E=0,C=0;for(let _=0;_<a+2;_+=2)C=h(y,x,E),x=C.left,E=C.right,y.pbox[_]=x,y.pbox[_+1]=E;for(let _=0;_<4;_++)for(let A=0;A<256;A+=2)C=h(y,x,E),x=C.left,E=C.right,y.sbox[_][A]=x,y.sbox[_][A+1]=E;return!0}var m=o.Blowfish=i.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var y=this._keyPriorReset=this._key,w=y.words,v=y.sigBytes/4;p(u,w,v)}},encryptBlock:function(y,w){var v=h(u,y[w],y[w+1]);y[w]=v.left,y[w+1]=v.right},decryptBlock:function(y,w){var v=g(u,y[w],y[w+1]);y[w]=v.left,y[w+1]=v.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=i._createHelper(m)}(),t.Blowfish})}(k0)),k0.exports}(function(n,e){(function(t,r,s){n.exports=r(re(),ta(),ew(),tw(),an(),rw(),cn(),H3(),U1(),nw(),z3(),sw(),iw(),ow(),$1(),aw(),Lr(),Me(),cw(),lw(),uw(),dw(),hw(),fw(),pw(),gw(),mw(),yw(),xw(),bw(),vw(),ww(),Ew(),Cw(),_w())})(J,function(t){return t})})($3);var Sw=$3.exports;const ce=Gn(Sw),Aw={apiKey:"AIzaSyBrdrwvY-lPObZgortEgw7YWycUOGsBlyM",authDomain:"dcrypt-edb9c.firebaseapp.com",projectId:"dcrypt-edb9c",storageBucket:"dcrypt-edb9c.firebasestorage.app",messagingSenderId:"952133736604",appId:"1:952133736604:web:32d799360f200bce84f559",measurementId:"G-7KCDLQ6JNH"},H1=W8(Aw),kw=G8(H1),Bw=H8(H1),q3=K8(H1),Dw=Object.freeze(Object.defineProperty({__proto__:null,auth:Bw,db:q3,storage:kw},Symbol.toStringTag,{value:"Module"}));var _d;const Br=(_d=globalThis.crypto)==null?void 0:_d.subtle;if(!Br)throw new Error("Web Crypto API is not available in this environment");function Iw(){const n=new Uint8Array(12);for(let e=0;e<12;e++)n[e]=Math.floor(Math.random()*256);return n}function Pw(n,e,t,r,s,i,o){return{content:new Uint8Array(n),content_type:e,tags:t||[],is_premium:r,price_usd:s,creator_id:new Uint8Array(i),file_type:o}}function Tw(n){return n.content}async function V3(n){const e=await Br.digest("SHA-256",n);return new Uint8Array(e)}function Rw(n){const e=new Uint8Array(new Int32Array([n.index]).buffer),t=new Uint8Array([...n.data,...n.nonce,...e]);return V3(t)}function K2(n){return n.index}function K3(n){return new TextEncoder().encode(n).buffer}async function Fw(n,e,t){const r=n.content,s=Math.ceil(r.length/t),i=[];Array.isArray(e)&&(e=e.join(""));const o=await Br.digest("SHA-256",K3(e)),a=await Br.importKey("raw",o,{name:"AES-GCM"},!1,["encrypt"]);for(let c=0;c<t;c++){const l=c*s,u=Math.min(l+s,r.length),d=r.slice(l,u),h=Iw(),g=await Br.encrypt({name:"AES-GCM",iv:h},a,d),p={data:new Uint8Array(g),nonce:h,index:c,file_type:n.file_type};i.push(p)}return i}async function Lw(n,e){Array.isArray(e)&&(e=e.join(""));const t=await Br.digest("SHA-256",K3(e)),r=await Br.importKey("raw",t,{name:"AES-GCM"},!1,["decrypt"]),s=await Br.decrypt({name:"AES-GCM",iv:n.nonce},r,n.data);return new Uint8Array(s)}function Nw(n){return n.file_type}const j3=Symbol.for("@libp2p/peer-id");class Se extends Error{constructor(t,r,s){super(t);f(this,"code");f(this,"props");this.code=r,this.name=(s==null?void 0:s.name)??"CodeError",this.props=s??{}}}function Nr(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}const $s=32,xr=64,Po=32;function Mw(){const n=cr.utils.randomPrivateKey(),e=cr.getPublicKey(n);return{privateKey:G3(n,e),publicKey:e}}function Ow(n){if(n.length!==Po)throw new TypeError('"seed" must be 32 bytes in length.');if(!(n instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const e=n,t=cr.getPublicKey(e);return{privateKey:G3(e,t),publicKey:t}}function Uw(n,e){const t=n.subarray(0,Po);return cr.sign(e instanceof Uint8Array?e:e.subarray(),t)}function $w(n,e,t){return cr.verify(e,t instanceof Uint8Array?t:t.subarray(),n)}function G3(n,e){const t=new Uint8Array(xr);for(let r=0;r<Po;r++)t[r]=n[r],t[Po+r]=e[r];return t}const Mt={get(n=globalThis){const e=n.crypto;if((e==null?void 0:e.subtle)==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},B0={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function Hw(n){const e="AES-GCM";let t=16;const r=12,s="SHA-256",i=16,o=32767,a=Mt.get();t*=8;async function c(d,h){const g=a.getRandomValues(new Uint8Array(i)),p=a.getRandomValues(new Uint8Array(r)),m={name:e,iv:p};typeof h=="string"&&(h=Y(h));let y;if(h.length===0){y=await a.subtle.importKey("jwk",B0,{name:"AES-GCM"},!0,["encrypt"]);try{const v={name:"PBKDF2",salt:g,iterations:o,hash:{name:s}},b=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(v,b,{name:e,length:t},!0,["encrypt"])}catch{y=await a.subtle.importKey("jwk",B0,{name:"AES-GCM"},!0,["encrypt"])}}else{const v={name:"PBKDF2",salt:g,iterations:o,hash:{name:s}},b=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);y=await a.subtle.deriveKey(v,b,{name:e,length:t},!0,["encrypt"])}const w=await a.subtle.encrypt(m,y,d);return Dt([g,m.iv,new Uint8Array(w)])}async function l(d,h){const g=d.subarray(0,i),p=d.subarray(i,i+r),m=d.subarray(i+r),y={name:e,iv:p};typeof h=="string"&&(h=Y(h));let w;if(h.length===0)try{const b={name:"PBKDF2",salt:g,iterations:o,hash:{name:s}},x=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(b,x,{name:e,length:t},!0,["decrypt"])}catch{w=await a.subtle.importKey("jwk",B0,{name:"AES-GCM"},!0,["decrypt"])}else{const b={name:"PBKDF2",salt:g,iterations:o,hash:{name:s}},x=await a.subtle.importKey("raw",h,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(b,x,{name:e,length:t},!0,["decrypt"])}const v=await a.subtle.decrypt(y,w,m);return new Uint8Array(v)}return{encrypt:c,decrypt:l}}async function z1(n,e){const r=await Hw().encrypt(n,e);return Xc.encode(r)}var ht;(function(n){n.RSA="RSA",n.Ed25519="Ed25519",n.Secp256k1="Secp256k1"})(ht||(ht={}));var Bc;(function(n){n[n.RSA=0]="RSA",n[n.Ed25519=1]="Ed25519",n[n.Secp256k1=2]="Secp256k1"})(Bc||(Bc={}));(function(n){n.codec=()=>Ho(Bc)})(ht||(ht={}));var Hs;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),ht.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),s.lengthDelimited!==!1&&r.ldelim()},(t,r)=>{const s={},i=r==null?t.len:t.pos+r;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.Type=ht.codec().decode(t);break;case 2:s.Data=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),n.encode=t=>Qe(t,n.codec()),n.decode=t=>We(t,n.codec())})(Hs||(Hs={}));var zs;(function(n){let e;n.codec=()=>(e==null&&(e=Ye((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),ht.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),s.lengthDelimited!==!1&&r.ldelim()},(t,r)=>{const s={},i=r==null?t.len:t.pos+r;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.Type=ht.codec().decode(t);break;case 2:s.Data=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),n.encode=t=>Qe(t,n.codec()),n.decode=t=>We(t,n.codec())})(zs||(zs={}));class q1{constructor(e){f(this,"_key");this._key=Vn(e,$s)}verify(e,t){return $w(this._key,t,e)}marshal(){return this._key}get bytes(){return Hs.encode({Type:ht.Ed25519,Data:this.marshal()}).subarray()}equals(e){return de(this.bytes,e.bytes)}hash(){const e=at.digest(this.bytes);return Nr(e)?e.then(({bytes:t})=>t):e.bytes}}class qs{constructor(e,t){f(this,"_key");f(this,"_publicKey");this._key=Vn(e,xr),this._publicKey=Vn(t,$s)}sign(e){return Uw(this._key,e)}get public(){return new q1(this._publicKey)}marshal(){return this._key}get bytes(){return zs.encode({Type:ht.Ed25519,Data:this.marshal()}).subarray()}equals(e){return de(this.bytes,e.bytes)}async hash(){const e=at.digest(this.bytes);let t;return Nr(e)?{bytes:t}=await e:t=e.bytes,t}async id(){const e=Lt.digest(this.public.bytes);return Ce.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return z1(this.bytes,e);throw new Se(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function zw(n){if(n.length>xr){n=Vn(n,xr+$s);const r=n.subarray(0,xr),s=n.subarray(xr,n.length);return new qs(r,s)}n=Vn(n,xr);const e=n.subarray(0,xr),t=n.subarray($s);return new qs(e,t)}function qw(n){return n=Vn(n,$s),new q1(n)}async function Vw(){const{privateKey:n,publicKey:e}=Mw();return new qs(n,e)}async function Kw(n){const{privateKey:e,publicKey:t}=Ow(n);return new qs(e,t)}function Vn(n,e){if(n=Uint8Array.from(n??[]),n.length!==e)throw new Se(`Key must be a Uint8Array of length ${e}, got ${n.length}`,"ERR_INVALID_KEY_TYPE");return n}const jw=Object.freeze(Object.defineProperty({__proto__:null,Ed25519PrivateKey:qs,Ed25519PublicKey:q1,generateKeyPair:Vw,generateKeyPairFromSeed:Kw,unmarshalEd25519PrivateKey:zw,unmarshalEd25519PublicKey:qw},Symbol.toStringTag,{value:"Module"}));function Dc(n){if(isNaN(n)||n<=0)throw new Se("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return Uo(n)}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const Gw="[object ArrayBuffer]";class ye{static isArrayBuffer(e){return Object.prototype.toString.call(e)===Gw}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=ye.toUint8Array(e),s=ye.toUint8Array(t);if(r.length!==s.byteLength)return!1;for(let i=0;i<r.length;i++)if(r[i]!==s[i])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let r=0;for(const o of t)r+=o.byteLength;const s=new Uint8Array(r);let i=0;for(const o of t){const a=this.toUint8Array(o);s.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(s,e[e.length-1]):s.buffer}}const D0="string",Ww=/^[0-9a-f\s]+$/i,Qw=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Yw=/^[a-zA-Z0-9-_]+$/;class j2{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r.buffer}static toString(e){const t=ye.toUint8Array(e);let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return decodeURIComponent(escape(r))}}class Ht{static toString(e,t=!1){const r=ye.toArrayBuffer(e),s=new DataView(r);let i="";for(let o=0;o<r.byteLength;o+=2){const a=s.getUint16(o,t);i+=String.fromCharCode(a)}return i}static fromString(e,t=!1){const r=new ArrayBuffer(e.length*2),s=new DataView(r);for(let i=0;i<e.length;i++)s.setUint16(i*2,e.charCodeAt(i),t);return r}}class De{static isHex(e){return typeof e===D0&&Ww.test(e)}static isBase64(e){return typeof e===D0&&Qw.test(e)}static isBase64Url(e){return typeof e===D0&&Yw.test(e)}static ToString(e,t="utf8"){const r=ye.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return Ht.toString(r,!0);case"utf16":case"utf16be":return Ht.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Ht.fromString(e,!0);case"utf16":case"utf16be":return Ht.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=ye.toUint8Array(e);if(typeof btoa<"u"){const r=this.ToString(t,"binary");return btoa(r)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!De.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!De.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=De.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return j2.fromString(e);case"utf16":case"utf16be":return Ht.fromString(e);case"utf16le":case"usc2":return Ht.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=De.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return j2.toString(e);case"utf16":case"utf16be":return Ht.toString(e);case"utf16le":case"usc2":return Ht.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return r.buffer}static ToBinary(e){const t=ye.toUint8Array(e);let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}static ToHex(e){const t=ye.toUint8Array(e);let r="";const s=t.length;for(let i=0;i<s;i++){const o=t[i];o<16&&(r+="0"),r+=o.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!De.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let s=0;s<t.length;s=s+2){const i=t.slice(s,s+2);r[s/2]=parseInt(i,16)}return r.buffer}static ToUtf16String(e,t=!1){return Ht.toString(e,t)}static FromUtf16String(e,t=!1){return Ht.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}De.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function Kn(n,e){let t=0;if(n.length===1)return n[0];for(let r=n.length-1;r>=0;r--)t+=n[n.length-1-r]*Math.pow(2,e*r);return t}function rn(n,e,t=-1){const r=t;let s=n,i=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(n<o){let c;if(r<0)c=new ArrayBuffer(a),i=a;else{if(r<a)return new ArrayBuffer(0);c=new ArrayBuffer(r),i=r}const l=new Uint8Array(c);for(let u=a-1;u>=0;u--){const d=Math.pow(2,u*e);l[i-u-1]=Math.floor(s/d),s-=l[i-u-1]*d}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function Ic(...n){let e=0,t=0;for(const i of n)e+=i.length;const r=new ArrayBuffer(e),s=new Uint8Array(r);for(const i of n)s.set(i,t),t+=i.length;return s}function W3(){const n=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=n[0]===255&&n[1]&128,c=n[0]===0&&(n[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=n[0]&128;const r=Kn(t,8),s=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(s);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=n[a];return i[0]&=127,Kn(i,8)-r}function Zw(n){const e=n<0?n*-1:n;let t=128;for(let r=1;r<8;r++){if(e<=t){if(n<0){const o=t-e,a=rn(o,8,r),c=new Uint8Array(a);return c[0]|=128,a}let s=rn(e,8,r),i=new Uint8Array(s);if(i[0]&128){const o=s.slice(0),a=new Uint8Array(o);s=new ArrayBuffer(s.byteLength+1),i=new Uint8Array(s);for(let c=0;c<o.byteLength;c++)i[c+1]=a[c];i[0]=0}return s}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function Xw(n,e){if(n.byteLength!==e.byteLength)return!1;const t=new Uint8Array(n),r=new Uint8Array(e);for(let s=0;s<t.length;s++)if(t[s]!==r[s])return!1;return!0}function xt(n,e){const t=n.toString(10);if(e<t.length)return"";const r=e-t.length,s=new Array(r);for(let o=0;o<r;o++)s[o]="0";return s.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function To(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function V1(n){let e=0,t=0;for(let s=0;s<n.length;s++){const i=n[s];e+=i.byteLength}const r=new Uint8Array(e);for(let s=0;s<n.length;s++){const i=n[s];r.set(new Uint8Array(i),t),t+=i.byteLength}return r.buffer}function ur(n,e,t,r){return e instanceof Uint8Array?e.byteLength?t<0?(n.error="Wrong parameter: inputOffset less than zero",!1):r<0?(n.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-r<0?(n.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(n.error="Wrong parameter: inputBuffer has zero length",!1):(n.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class K1{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return V1(this.items)}}const ls=[new Uint8Array([1])],G2="0123456789",Xn="",Ot=new ArrayBuffer(0),j1=new Uint8Array(0),Vs="EndOfContent",Q3="OCTET STRING",Y3="BIT STRING";function dr(n){var e;return e=class extends n{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(r){this.valueHexView=new Uint8Array(r)}constructor(...r){var s;super(...r);const i=r[0]||{};this.isHexOnly=(s=i.isHexOnly)!==null&&s!==void 0?s:!1,this.valueHexView=i.valueHex?ye.toUint8Array(i.valueHex):j1}fromBER(r,s,i){const o=r instanceof ArrayBuffer?new Uint8Array(r):r;if(!ur(this,o,s,i))return-1;const a=s+i;return this.valueHexView=o.subarray(s,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),s)}toBER(r=!1){return this.isHexOnly?r?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Ot)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:De.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class ln{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Xn,warnings:r=[],valueBeforeDecode:s=j1}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=ye.toUint8Array(s)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:De.ToHex(this.valueBeforeDecodeView)}}}ln.NAME="baseBlock";class pt extends ln{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}pt.NAME="valueBlock";class Z3 extends dr(ln){constructor({idBlock:e={}}={}){var t,r,s,i;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?ye.toUint8Array(e.valueHex):j1,this.tagClass=(r=e.tagClass)!==null&&r!==void 0?r:-1,this.tagNumber=(s=e.tagNumber)!==null&&s!==void 0?s:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",Ot}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const s=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,t|=i,s[0]=t}return s.buffer}if(!this.isHexOnly){const s=rn(this.tagNumber,7),i=new Uint8Array(s),o=s.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=i[c]|128;a[o]=i[o-1]}return a.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=t|31,!e){const s=this.valueHexView;for(let i=0;i<s.length-1;i++)r[i+1]=s[i]|128;r[this.valueHexView.byteLength]=s[s.length-1]}return r.buffer}fromBER(e,t,r){const s=ye.toUint8Array(e);if(!ur(this,s,t,r))return-1;const i=s.subarray(t,t+r);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;const a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),u=255;for(;i[c]&128;){if(l[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===u){u+=255;const h=new Uint8Array(u);for(let g=0;g<l.length;g++)h[g]=l[g];l=this.valueHexView=new Uint8Array(u)}}this.blockLength=c+1,l[c-1]=i[c]&127;const d=new Uint8Array(c);for(let h=0;h<c;h++)d[h]=l[h];l=this.valueHexView=new Uint8Array(c),l.set(d),this.blockLength<=9?this.tagNumber=Kn(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}Z3.NAME="identificationBlock";class X3 extends ln{constructor({lenBlock:e={}}={}){var t,r,s;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(r=e.longFormUsed)!==null&&r!==void 0?r:!1,this.length=(s=e.length)!==null&&s!==void 0?s:0}fromBER(e,t,r){const s=ye.toUint8Array(e);if(!ur(this,s,t,r))return-1;const i=s.subarray(t,t+r);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,t+this.blockLength;const o=i[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>i.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=s.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=Kn(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const s=rn(this.length,8);if(s.byteLength>127)return this.error="Too big length",Ot;if(t=new ArrayBuffer(s.byteLength+1),e)return t;const i=new Uint8Array(s);r=new Uint8Array(t),r[0]=s.byteLength|128;for(let o=0;o<s.byteLength;o++)r[o+1]=i[o];return t}return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}X3.NAME="lengthBlock";const q={};class ot extends ln{constructor({name:e=Xn,optional:t=!1,primitiveSchema:r,...s}={},i){super(s),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new Z3(s),this.lenBlock=new X3(s),this.valueBlock=i?new i(s):new pt(s)}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}toBER(e,t){const r=t||new K1;t||J3(this);const s=this.idBlock.toBER(e);if(r.write(s),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;const o=this.lenBlock.toBER(e);r.write(o),r.write(i)}return t?Ot:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():De.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=De.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),r=e.toBER();return Xw(t,r)}}ot.NAME="BaseBlock";function J3(n){var e;if(n instanceof q.Constructed)for(const t of n.valueBlock.value)J3(t)&&(n.lenBlock.isIndefiniteForm=!0);return!!(!((e=n.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class e4 extends ot{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Xn,...t}={},r){super(t,r),e&&this.fromString(e)}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}e4.NAME="BaseStringBlock";class t4 extends dr(pt){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}t4.NAME="PrimitiveValueBlock";var r4;class n4 extends ot{constructor(e={}){super(e,t4),this.idBlock.isConstructed=!1}}r4=n4;q.Primitive=r4;n4.NAME="PRIMITIVE";function Jw(n,e){if(n instanceof e)return n;const t=new e;return t.idBlock=n.idBlock,t.lenBlock=n.lenBlock,t.warnings=n.warnings,t.valueBeforeDecodeView=n.valueBeforeDecodeView,t}function ra(n,e=0,t=n.length){const r=e;let s=new ot({},pt);const i=new ln;if(!ur(i,n,e,t))return s.error=i.error,{offset:-1,result:s};if(!n.subarray(e,e+t).length)return s.error="Zero buffer length",{offset:-1,result:s};let a=s.idBlock.fromBER(n,e,t);if(s.idBlock.warnings.length&&s.warnings.concat(s.idBlock.warnings),a===-1)return s.error=s.idBlock.error,{offset:-1,result:s};if(e=a,t-=s.idBlock.blockLength,a=s.lenBlock.fromBER(n,e,t),s.lenBlock.warnings.length&&s.warnings.concat(s.lenBlock.warnings),a===-1)return s.error=s.lenBlock.error,{offset:-1,result:s};if(e=a,t-=s.lenBlock.blockLength,!s.idBlock.isConstructed&&s.lenBlock.isIndefiniteForm)return s.error="Indefinite length form used for primitive encoding form",{offset:-1,result:s};let c=ot;switch(s.idBlock.tagClass){case 1:if(s.idBlock.tagNumber>=37&&s.idBlock.isHexOnly===!1)return s.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:s};switch(s.idBlock.tagNumber){case 0:if(s.idBlock.isConstructed&&s.lenBlock.length>0)return s.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:s};c=q.EndOfContent;break;case 1:c=q.Boolean;break;case 2:c=q.Integer;break;case 3:c=q.BitString;break;case 4:c=q.OctetString;break;case 5:c=q.Null;break;case 6:c=q.ObjectIdentifier;break;case 10:c=q.Enumerated;break;case 12:c=q.Utf8String;break;case 13:c=q.RelativeObjectIdentifier;break;case 14:c=q.TIME;break;case 15:return s.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:s};case 16:c=q.Sequence;break;case 17:c=q.Set;break;case 18:c=q.NumericString;break;case 19:c=q.PrintableString;break;case 20:c=q.TeletexString;break;case 21:c=q.VideotexString;break;case 22:c=q.IA5String;break;case 23:c=q.UTCTime;break;case 24:c=q.GeneralizedTime;break;case 25:c=q.GraphicString;break;case 26:c=q.VisibleString;break;case 27:c=q.GeneralString;break;case 28:c=q.UniversalString;break;case 29:c=q.CharacterString;break;case 30:c=q.BmpString;break;case 31:c=q.DATE;break;case 32:c=q.TimeOfDay;break;case 33:c=q.DateTime;break;case 34:c=q.Duration;break;default:{const l=s.idBlock.isConstructed?new q.Constructed:new q.Primitive;l.idBlock=s.idBlock,l.lenBlock=s.lenBlock,l.warnings=s.warnings,s=l}}break;case 2:case 3:case 4:default:c=s.idBlock.isConstructed?q.Constructed:q.Primitive}return s=Jw(s,c),a=s.fromBER(n,e,s.lenBlock.isIndefiniteForm?t:s.lenBlock.length),s.valueBeforeDecodeView=n.subarray(r,r+s.blockLength),{offset:a,result:s}}function s4(n){if(!n.byteLength){const e=new ot({},pt);return e.error="Input buffer has zero length",{offset:-1,result:e}}return ra(ye.toUint8Array(n).slice(),0,n.byteLength)}function eE(n,e){return n?1:e}class Dr extends pt{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const s=ye.toUint8Array(e);if(!ur(this,s,t,r))return-1;if(this.valueBeforeDecodeView=s.subarray(t,t+r),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let i=t;for(;eE(this.isIndefiniteForm,r)>0;){const o=ra(s,i,r);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(i=o.offset,this.blockLength+=o.result.blockLength,r-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===Vs)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Vs?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){const r=t||new K1;for(let s=0;s<this.value.length;s++)this.value[s].toBER(e,r);return t?Ot:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Dr.NAME="ConstructedValueBlock";var i4;class Jn extends ot{constructor(e={}){super(e,Dr),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){const e=[];for(const r of this.valueBlock.value)e.push(r.toString("ascii").split(`
`).map(s=>`  ${s}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}i4=Jn;q.Constructed=i4;Jn.NAME="CONSTRUCTED";class o4 extends pt{fromBER(e,t,r){return t}toBER(e){return Ot}}o4.override="EndOfContentValueBlock";var a4;class c4 extends ot{constructor(e={}){super(e,o4),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}a4=c4;q.EndOfContent=a4;c4.NAME=Vs;var l4;class Ks extends ot{constructor(e={}){super(e,pt),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const s=new Uint8Array(r);s[0]=5,s[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}l4=Ks;q.Null=l4;Ks.NAME="NULL";class u4 extends dr(pt){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=ye.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,r){const s=ye.toUint8Array(e);return ur(this,s,t,r)?(this.valueHexView=s.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,W3.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}u4.NAME="BooleanValueBlock";var d4;let h4=class extends ot{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,u4),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};d4=h4;q.Boolean=d4;h4.NAME="BOOLEAN";class f4 extends dr(Dr){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let s=0;if(this.isConstructed){if(this.isHexOnly=!1,s=Dr.prototype.fromBER.call(this,e,t,r),s===-1)return s;for(let i=0;i<this.value.length;i++){const o=this.value[i].constructor.NAME;if(o===Vs){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==Q3)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,s=super.fromBER(e,t,r),this.blockLength=r;return s}toBER(e,t){return this.isConstructed?Dr.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}f4.NAME="OctetStringValueBlock";var G1;class bn extends ot{constructor({idBlock:e={},lenBlock:t={},...r}={}){var s,i;(s=r.isConstructed)!==null&&s!==void 0||(r.isConstructed=!!(!((i=r.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},f4),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,r===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(i.byteLength){const o=ra(i,0,i.byteLength);o.offset!==-1&&o.offset===r&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Jn.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=De.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof G1&&e.push(t.valueBlock.valueHexView);return ye.concat(e)}}G1=bn;q.OctetString=G1;bn.NAME=Q3;class p4 extends dr(Dr){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let s=-1;if(this.isConstructed){if(s=Dr.prototype.fromBER.call(this,e,t,r),s===-1)return s;for(const a of this.value){const c=a.constructor.NAME;if(c===Vs){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==Y3)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return s}const i=ye.toUint8Array(e);if(!ur(this,i,t,r))return-1;const o=i.subarray(t,t+r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=ra(a,0,a.byteLength);c.offset!==-1&&c.offset===r-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+r}toBER(e,t){if(this.isConstructed)return Dr.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Ot;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}p4.NAME="BitStringValueBlock";var g4;class W1 extends ot{constructor({idBlock:e={},lenBlock:t={},...r}={}){var s,i;(s=r.isConstructed)!==null&&s!==void 0||(r.isConstructed=!!(!((i=r.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},p4),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Jn.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const r=e.join(""),s=this.constructor.NAME,i=r.substring(0,r.length-this.valueBlock.unusedBits);return`${s} : ${i}`}}}g4=W1;q.BitString=g4;W1.NAME=Y3;var m4;function tE(n,e){const t=new Uint8Array([0]),r=new Uint8Array(n),s=new Uint8Array(e);let i=r.slice(0);const o=i.length-1,a=s.slice(0),c=a.length-1;let l=0;const u=c<o?o:c;let d=0;for(let h=u;h>=0;h--,d++){switch(!0){case d<a.length:l=i[o-d]+a[c-d]+t[0];break;default:l=i[o-d]+t[0]}switch(t[0]=l/10,!0){case d>=i.length:i=Ic(new Uint8Array([l%10]),i);break;default:i[o-d]=l%10}}return t[0]>0&&(i=Ic(t,i)),i}function W2(n){if(n>=ls.length)for(let e=ls.length;e<=n;e++){const t=new Uint8Array([0]);let r=ls[e-1].slice(0);for(let s=r.length-1;s>=0;s--){const i=new Uint8Array([(r[s]<<1)+t[0]]);t[0]=i[0]/10,r[s]=i[0]%10}t[0]>0&&(r=Ic(t,r)),ls.push(r)}return ls[n]}function rE(n,e){let t=0;const r=new Uint8Array(n),s=new Uint8Array(e),i=r.slice(0),o=i.length-1,a=s.slice(0),c=a.length-1;let l,u=0;for(let d=c;d>=0;d--,u++)switch(l=i[o-u]-a[c-u]-t,!0){case l<0:t=1,i[o-u]=l+10;break;default:t=0,i[o-u]=l}if(t>0)for(let d=o-c+1;d>=0;d--,u++)if(l=i[o-u]-t,l<0)t=1,i[o-u]=l+10;else{t=0,i[o-u]=l;break}return i.slice()}class Q1 extends dr(pt){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=W3.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(Zw(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,s=0){const i=this.fromBER(e,t,r);if(i===-1)return i;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):s!==0&&o.length<s&&(s-o.length>1&&(s=o.length+1),this.valueHexView=o.subarray(s-o.length)),i}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,r){const s=super.fromBER(e,t,r);return s===-1||this.setValueHex(),s}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),r=0,s;const i=this.valueHexView;let o="",a=!1;for(let c=i.byteLength-1;c>=0;c--){s=i[c];for(let l=0;l<8;l++){if((s&1)===1)switch(r){case e:t=rE(W2(r),t),o="-";break;default:t=tE(t,W2(r))}r++,s>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=G2.charAt(t[c]));return a===!1&&(o+=G2.charAt(0)),o}}m4=Q1;Q1.NAME="IntegerValueBlock";Object.defineProperty(m4.prototype,"valueHex",{set:function(n){this.valueHexView=new Uint8Array(n),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var ys;class Ue extends ot{constructor(e={}){super(e,Q1),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return To(),BigInt(this.valueBlock.toString())}static fromBigInt(e){To();const t=BigInt(e),r=new K1,s=t.toString(16).replace(/^-/,""),i=new Uint8Array(De.FromHex(s));if(t<0){const a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${De.ToHex(a)}`)+t,u=ye.toUint8Array(De.FromHex(l.toString(16)));u[0]|=128,r.write(u)}else i[0]&128&&r.write(new Uint8Array([0])),r.write(i);return new ys({valueHex:r.final()})}convertToDER(){const e=new ys({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new ys({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}ys=Ue;q.Integer=ys;Ue.NAME="INTEGER";var y4;class x4 extends Ue{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}y4=x4;q.Enumerated=y4;x4.NAME="ENUMERATED";class Pc extends dr(pt){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const s=ye.toUint8Array(e);if(!ur(this,s,t,r))return-1;const i=s.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let a=0;a<r&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Kn(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){To();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let s=0;s<r.length;s++)r[s]=parseInt(t.slice(s*7,s*7+7),2)+(s+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}const t=rn(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Ot;const r=new Uint8Array(t.byteLength);if(!e){const s=new Uint8Array(t),i=t.byteLength-1;for(let o=0;o<i;o++)r[o]=s[o]|128;r[i]=s[i]}return r}toString(){let e="";if(this.isHexOnly)e=De.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Pc.NAME="sidBlock";class b4 extends pt{constructor({value:e=Xn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let s=t;for(;r>0;){const i=new Pc;if(s=i.fromBER(e,s,r),s===-1)return this.blockLength=0,this.error=i.error,s;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return s}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const s=this.value[r].toBER(e);if(s.byteLength===0)return this.error=this.value[r].error,Ot;t.push(s)}return V1(t)}fromString(e){this.value=[];let t=0,r=0,s="",i=!1;do if(r=e.indexOf(".",t),r===-1?s=e.substring(t):s=e.substring(t,r),t=r+1,i){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(s,10);if(isNaN(c))return;o.valueDec=c+a,i=!1}else{const o=new Pc;if(s>Number.MAX_SAFE_INTEGER){To();const a=BigInt(s);o.valueBigInt=a}else if(o.valueDec=parseInt(s,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,i=!0),this.value.push(o)}while(r!==-1)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let s=this.value[r].toString();r!==0&&(e=`${e}.`),t?(s=`{${s}}`,this.value[r].isFirstSid?e=`2.{${s} - 80}`:e+=s):e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}b4.NAME="ObjectIdentifierValueBlock";var v4;class wr extends ot{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,b4),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}v4=wr;q.ObjectIdentifier=v4;wr.NAME="OBJECT IDENTIFIER";class Tc extends dr(ln){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(r===0)return t;const s=ye.toUint8Array(e);if(!ur(this,s,t,r))return-1;const i=s.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let a=0;a<r&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Kn(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}const t=rn(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Ot;const r=new Uint8Array(t.byteLength);if(!e){const s=new Uint8Array(t),i=t.byteLength-1;for(let o=0;o<i;o++)r[o]=s[o]|128;r[i]=s[i]}return r.buffer}toString(){let e="";return this.isHexOnly?e=De.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Tc.NAME="relativeSidBlock";class w4 extends pt{constructor({value:e=Xn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let s=t;for(;r>0;){const i=new Tc;if(s=i.fromBER(e,s,r),s===-1)return this.blockLength=0,this.error=i.error,s;this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return s}toBER(e,t){const r=[];for(let s=0;s<this.value.length;s++){const i=this.value[s].toBER(e);if(i.byteLength===0)return this.error=this.value[s].error,Ot;r.push(i)}return V1(r)}fromString(e){this.value=[];let t=0,r=0,s="";do{r=e.indexOf(".",t),r===-1?s=e.substring(t):s=e.substring(t,r),t=r+1;const i=new Tc;if(i.valueDec=parseInt(s,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(r!==-1);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let s=this.value[r].toString();r!==0&&(e=`${e}.`),t&&(s=`{${s}}`),e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}w4.NAME="RelativeObjectIdentifierValueBlock";var E4;class C4 extends ot{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,w4),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}E4=C4;q.RelativeObjectIdentifier=E4;C4.NAME="RelativeObjectIdentifier";var _4;class nt extends Jn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}_4=nt;q.Sequence=_4;nt.NAME="SEQUENCE";var S4;let A4=class extends Jn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};S4=A4;q.Set=S4;A4.NAME="SET";class k4 extends dr(pt){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Xn}toJSON(){return{...super.toJSON(),value:this.value}}}k4.NAME="StringValueBlock";class B4 extends k4{}B4.NAME="SimpleStringValueBlock";class Ct extends e4{constructor({...e}={}){super(e,B4)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,ye.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);this.valueBlock.value=e}}Ct.NAME="SIMPLE STRING";class D4 extends Ct{fromBuffer(e){this.valueBlock.valueHexView=ye.toUint8Array(e);try{this.valueBlock.value=De.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=De.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(De.FromUtf8String(e)),this.valueBlock.value=e}}D4.NAME="Utf8StringValueBlock";var I4;class un extends D4{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}I4=un;q.Utf8String=I4;un.NAME="UTF8String";class P4 extends Ct{fromBuffer(e){this.valueBlock.value=De.ToUtf16String(e),this.valueBlock.valueHexView=ye.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(De.FromUtf16String(e))}}P4.NAME="BmpStringValueBlock";var T4;class R4 extends P4{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}T4=R4;q.BmpString=T4;R4.NAME="BMPString";class F4 extends Ct{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let s=0;s<r.length;s+=4)r[s]=r[s+3],r[s+1]=r[s+2],r[s+2]=0,r[s+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let s=0;s<t;s++){const i=rn(e.charCodeAt(s),8),o=new Uint8Array(i);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)r[s*4+c+a]=o[c]}this.valueBlock.value=e}}F4.NAME="UniversalStringValueBlock";var L4;class N4 extends F4{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}L4=N4;q.UniversalString=L4;N4.NAME="UniversalString";var M4;class O4 extends Ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}M4=O4;q.NumericString=M4;O4.NAME="NumericString";var U4;class $4 extends Ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}U4=$4;q.PrintableString=U4;$4.NAME="PrintableString";var H4;class z4 extends Ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}H4=z4;q.TeletexString=H4;z4.NAME="TeletexString";var q4;class V4 extends Ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}q4=V4;q.VideotexString=q4;V4.NAME="VideotexString";var K4;class j4 extends Ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}K4=j4;q.IA5String=K4;j4.NAME="IA5String";var G4;class W4 extends Ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}G4=W4;q.GraphicString=G4;W4.NAME="GraphicString";var Q4;class Y1 extends Ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}Q4=Y1;q.VisibleString=Q4;Y1.NAME="VisibleString";var Y4;class Z4 extends Ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Y4=Z4;q.GeneralString=Y4;Z4.NAME="GeneralString";var X4;class J4 extends Ct{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}X4=J4;q.CharacterString=X4;J4.NAME="CharacterString";var e8;class Z1 extends Y1{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let s=0;s<e.length;s++)this.valueBlock.valueHexView[s]=e.charCodeAt(s)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,ye.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const r=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(r===null){this.error="Wrong input string for conversion";return}const s=parseInt(r[1],10);s>=50?this.year=1900+s:this.year=2e3+s,this.month=parseInt(r[2],10),this.day=parseInt(r[3],10),this.hour=parseInt(r[4],10),this.minute=parseInt(r[5],10),this.second=parseInt(r[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=xt(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=xt(this.month,2),t[2]=xt(this.day,2),t[3]=xt(this.hour,2),t[4]=xt(this.minute,2),t[5]=xt(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}e8=Z1;q.UTCTime=e8;Z1.NAME="UTCTime";var t8;class r8 extends Z1{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,r="",s="",i=0,o,a=0,c=0;if(e[e.length-1]==="Z")r=e.substring(0,e.length-1),t=!0;else{const d=new Number(e[e.length-1]);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");r=e}if(t){if(r.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(r.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let d=1,h=r.indexOf("+"),g="";if(h===-1&&(h=r.indexOf("-"),d=-1),h!==-1){if(g=r.substring(h+1),r=r.substring(0,h),g.length!==2&&g.length!==4)throw new Error("Wrong input string for conversion");let p=parseInt(g.substring(0,2),10);if(isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");if(a=d*p,g.length===4){if(p=parseInt(g.substring(2,4),10),isNaN(p.valueOf()))throw new Error("Wrong input string for conversion");c=d*p}}}let l=r.indexOf(".");if(l===-1&&(l=r.indexOf(",")),l!==-1){const d=new Number(`0${r.substring(l)}`);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");i=d.valueOf(),s=r.substring(0,l)}else s=r;switch(!0){case s.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case s.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case s.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case s.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const d=1e3*i;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}const u=o.exec(s);if(u===null)throw new Error("Wrong input string for conversion");for(let d=1;d<u.length;d++)switch(d){case 1:this.year=parseInt(u[d],10);break;case 2:this.month=parseInt(u[d],10);break;case 3:this.day=parseInt(u[d],10);break;case 4:this.hour=parseInt(u[d],10)+a;break;case 5:this.minute=parseInt(u[d],10)+c;break;case 6:this.second=parseInt(u[d],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear(),this.month=d.getUTCMonth(),this.day=d.getUTCDay(),this.hour=d.getUTCHours(),this.minute=d.getUTCMinutes(),this.second=d.getUTCSeconds(),this.millisecond=d.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(xt(this.year,4)),t.push(xt(this.month,2)),t.push(xt(this.day,2)),t.push(xt(this.hour,2)),t.push(xt(this.minute,2)),t.push(xt(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(xt(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}t8=r8;q.GeneralizedTime=t8;r8.NAME="GeneralizedTime";var n8;class s8 extends un{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}n8=s8;q.DATE=n8;s8.NAME="DATE";var i8;class o8 extends un{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}i8=o8;q.TimeOfDay=i8;o8.NAME="TimeOfDay";var a8;class c8 extends un{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}a8=c8;q.DateTime=a8;c8.NAME="DateTime";var l8;class u8 extends un{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}l8=u8;q.Duration=l8;u8.NAME="Duration";var d8;class h8 extends un{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}d8=h8;q.TIME=d8;h8.NAME="TIME";function nE(n){const{result:e}=s4(n),t=e.valueBlock.value;return{n:Q(zt(t[1].toBigInt()),"base64url"),e:Q(zt(t[2].toBigInt()),"base64url"),d:Q(zt(t[3].toBigInt()),"base64url"),p:Q(zt(t[4].toBigInt()),"base64url"),q:Q(zt(t[5].toBigInt()),"base64url"),dp:Q(zt(t[6].toBigInt()),"base64url"),dq:Q(zt(t[7].toBigInt()),"base64url"),qi:Q(zt(t[8].toBigInt()),"base64url"),kty:"RSA",alg:"RS256"}}function sE(n){if(n.n==null||n.e==null||n.d==null||n.p==null||n.q==null||n.dp==null||n.dq==null||n.qi==null)throw new Se("JWK was missing components","ERR_INVALID_PARAMETERS");const t=new nt({value:[new Ue({value:0}),Ue.fromBigInt(qt(Y(n.n,"base64url"))),Ue.fromBigInt(qt(Y(n.e,"base64url"))),Ue.fromBigInt(qt(Y(n.d,"base64url"))),Ue.fromBigInt(qt(Y(n.p,"base64url"))),Ue.fromBigInt(qt(Y(n.q,"base64url"))),Ue.fromBigInt(qt(Y(n.dp,"base64url"))),Ue.fromBigInt(qt(Y(n.dq,"base64url"))),Ue.fromBigInt(qt(Y(n.qi,"base64url")))]}).toBER();return new Uint8Array(t,0,t.byteLength)}function iE(n){const{result:e}=s4(n),t=e.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:Q(zt(t[0].toBigInt()),"base64url"),e:Q(zt(t[1].toBigInt()),"base64url")}}function oE(n){if(n.n==null||n.e==null)throw new Se("JWK was missing components","ERR_INVALID_PARAMETERS");const t=new nt({value:[new nt({value:[new wr({value:"1.2.840.113549.1.1.1"}),new Ks]}),new W1({valueHex:new nt({value:[Ue.fromBigInt(qt(Y(n.n,"base64url"))),Ue.fromBigInt(qt(Y(n.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(t,0,t.byteLength)}function zt(n){let e=n.toString(16);e.length%2>0&&(e=`0${e}`);const t=e.length/2,r=new Uint8Array(t);let s=0,i=0;for(;s<t;)r[s]=parseInt(e.slice(i,i+2),16),s+=1,i+=2;return r}function qt(n){const e=[];return n.forEach(function(t){let r=t.toString(16);r.length%2>0&&(r=`0${r}`),e.push(r)}),BigInt("0x"+e.join(""))}const aE=16,Q2=32,Y2=1e4;async function cE(n,e){const t=Mt.get(),s=new nt({value:[new Ue({value:0}),new nt({value:[new wr({value:"1.2.840.113549.1.1.1"}),new Ks]}),new bn({valueHex:n.marshal()})]}).toBER(),i=new Uint8Array(s,0,s.byteLength),o=Dc(aE),a=await Og(Ug,e,o,{c:Y2,dkLen:Q2}),c=Dc(16),l=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),u=await t.subtle.encrypt({name:"AES-CBC",iv:c},l,i),d=new nt({value:[new bn({valueHex:o}),new Ue({value:Y2}),new Ue({value:Q2}),new nt({value:[new wr({value:"1.2.840.113549.2.11"}),new Ks]})]}),h=new nt({value:[new wr({value:"1.2.840.113549.1.5.13"}),new nt({value:[new nt({value:[new wr({value:"1.2.840.113549.1.5.12"}),d]}),new nt({value:[new wr({value:"2.16.840.1.101.3.4.1.42"}),new bn({valueHex:c})]})]})]}),p=new nt({value:[h,new bn({valueHex:u})]}).toBER(),m=new Uint8Array(p,0,p.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...Q(m,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function lE(n){const e=await Mt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:n,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await p8(e);return{privateKey:t[0],publicKey:t[1]}}async function f8(n){const t=[await Mt.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await hE(n)],r=await p8({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function uE(n,e){const t=await Mt.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await Mt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(r,0,r.byteLength)}async function dE(n,e,t){const r=await Mt.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Mt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,e,t instanceof Uint8Array?t:t.subarray())}async function p8(n){if(n.privateKey==null||n.publicKey==null)throw new Se("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Mt.get().subtle.exportKey("jwk",n.privateKey),Mt.get().subtle.exportKey("jwk",n.publicKey)])}async function hE(n){return Mt.get().subtle.importKey("jwk",{kty:n.kty,n:n.n,e:n.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function X1(n){if(n.kty!=="RSA")throw new Se("invalid key type","ERR_INVALID_KEY_TYPE");if(n.n==null)throw new Se("invalid key modulus","ERR_INVALID_KEY_MODULUS");return Y(n.n,"base64url").length*8}const ui=8192;class J1{constructor(e){f(this,"_key");this._key=e}verify(e,t){return dE(this._key,t,e)}marshal(){return oE(this._key)}get bytes(){return Hs.encode({Type:ht.RSA,Data:this.marshal()}).subarray()}equals(e){return de(this.bytes,e.bytes)}hash(){const e=at.digest(this.bytes);return Nr(e)?e.then(({bytes:t})=>t):e.bytes}}class na{constructor(e,t){f(this,"_key");f(this,"_publicKey");this._key=e,this._publicKey=t}genSecret(){return Dc(16)}sign(e){return uE(this._key,e)}get public(){if(this._publicKey==null)throw new Se("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new J1(this._publicKey)}marshal(){return sE(this._key)}get bytes(){return zs.encode({Type:ht.RSA,Data:this.marshal()}).subarray()}equals(e){return de(this.bytes,e.bytes)}hash(){const e=at.digest(this.bytes);return Nr(e)?e.then(({bytes:t})=>t):e.bytes}async id(){const e=await this.public.hash();return Q(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8")return cE(this,e);if(t==="libp2p-key")return z1(this.bytes,e);throw new Se(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function fE(n){const e=nE(n);if(X1(e)>ui)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await f8(e);return new na(t.privateKey,t.publicKey)}function pE(n){const e=iE(n);if(X1(e)>ui)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new J1(e)}async function gE(n){if(X1(n)>ui)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await f8(n);return new na(e.privateKey,e.publicKey)}async function mE(n){if(n>ui)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await lE(n);return new na(e.privateKey,e.publicKey)}const yE=Object.freeze(Object.defineProperty({__proto__:null,MAX_RSA_KEY_SIZE:ui,RsaPrivateKey:na,RsaPublicKey:J1,fromJwk:gE,generateKeyPair:mE,unmarshalRsaPrivateKey:fE,unmarshalRsaPublicKey:pE},Symbol.toStringTag,{value:"Module"}));function xE(){return wt.utils.randomPrivateKey()}function bE(n,e){const t=at.digest(e instanceof Uint8Array?e:e.subarray());if(Nr(t))return t.then(({digest:r})=>wt.sign(r,n).toDERRawBytes()).catch(r=>{throw new Se(String(r),"ERR_INVALID_INPUT")});try{return wt.sign(t.digest,n).toDERRawBytes()}catch(r){throw new Se(String(r),"ERR_INVALID_INPUT")}}function vE(n,e,t){const r=at.digest(t instanceof Uint8Array?t:t.subarray());if(Nr(r))return r.then(({digest:s})=>wt.verify(e,s,n)).catch(s=>{throw new Se(String(s),"ERR_INVALID_INPUT")});try{return wt.verify(e,r.digest,n)}catch(s){throw new Se(String(s),"ERR_INVALID_INPUT")}}function wE(n){return wt.ProjectivePoint.fromHex(n).toRawBytes(!0)}function EE(n){try{wt.getPublicKey(n,!0)}catch(e){throw new Se(String(e),"ERR_INVALID_PRIVATE_KEY")}}function g8(n){try{wt.ProjectivePoint.fromHex(n)}catch(e){throw new Se(String(e),"ERR_INVALID_PUBLIC_KEY")}}function CE(n){try{return wt.getPublicKey(n,!0)}catch(e){throw new Se(String(e),"ERR_INVALID_PRIVATE_KEY")}}class el{constructor(e){f(this,"_key");g8(e),this._key=e}verify(e,t){return vE(this._key,t,e)}marshal(){return wE(this._key)}get bytes(){return Hs.encode({Type:ht.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return de(this.bytes,e.bytes)}async hash(){const e=at.digest(this.bytes);let t;return Nr(e)?{bytes:t}=await e:t=e.bytes,t}}class tl{constructor(e,t){f(this,"_key");f(this,"_publicKey");this._key=e,this._publicKey=t??CE(e),EE(this._key),g8(this._publicKey)}sign(e){return bE(this._key,e)}get public(){return new el(this._publicKey)}marshal(){return this._key}get bytes(){return zs.encode({Type:ht.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return de(this.bytes,e.bytes)}hash(){const e=at.digest(this.bytes);return Nr(e)?e.then(({bytes:t})=>t):e.bytes}async id(){const e=await this.public.hash();return Q(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return z1(this.bytes,e);throw new Se(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function _E(n){return new tl(n)}function SE(n){return new el(n)}async function AE(){const n=xE();return new tl(n)}const kE=Object.freeze(Object.defineProperty({__proto__:null,Secp256k1PrivateKey:tl,Secp256k1PublicKey:el,generateKeyPair:AE,unmarshalSecp256k1PrivateKey:_E,unmarshalSecp256k1PublicKey:SE},Symbol.toStringTag,{value:"Module"})),m8={rsa:yE,ed25519:jw,secp256k1:kE};function BE(n){const e=Object.keys(m8).join(" / ");return new Se(`invalid or unsupported key type ${n}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function rl(n){if(n=n.toLowerCase(),n==="rsa"||n==="ed25519"||n==="secp256k1")return m8[n];throw BE(n)}async function DE(n,e){return rl(n).generateKeyPair(2048)}function IE(n,e){return e=(e??"rsa").toLowerCase(),rl(e),n.bytes}function PE(n,e){return e=(e??"rsa").toLowerCase(),rl(e),n.bytes}const y8=Symbol.for("nodejs.util.inspect.custom"),TE=Object.values(Is).map(n=>n.decoder).reduce((n,e)=>n.or(e),Is.identity.decoder),x8=114,nl=36,sl=37;var Sd;class il{constructor(e){f(this,"type");f(this,"multihash");f(this,"privateKey");f(this,"publicKey");f(this,"string");f(this,Sd,!0);this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Ce.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return se.createV1(x8,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return de(this.multihash.bytes,e);if(typeof e=="string")return FE(e).equals(this);if(((t=e==null?void 0:e.multihash)==null?void 0:t.bytes)!=null)return de(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[(Sd=j3,y8)](){return`PeerId(${this.toString()})`}}class sa extends il{constructor(t){super({...t,type:"RSA"});f(this,"type","RSA");f(this,"publicKey");this.publicKey=t.publicKey}}class ia extends il{constructor(t){super({...t,type:"Ed25519"});f(this,"type","Ed25519");f(this,"publicKey");this.publicKey=t.multihash.digest}}class oa extends il{constructor(t){super({...t,type:"secp256k1"});f(this,"type","secp256k1");f(this,"publicKey");this.publicKey=t.multihash.digest}}const Rc=2336;var Ad,kd;class RE{constructor(e){f(this,"type","url");f(this,"multihash");f(this,"privateKey");f(this,"publicKey");f(this,"url");f(this,Ad,!0);this.url=e.toString(),this.multihash=Lt.digest(Y(this.url))}[(kd=y8,Ad=j3,kd)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toCID(){return se.createV1(Rc,this.multihash)}toBytes(){return this.toCID().bytes}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=Q(e)),e.toString()===this.toString())}}function FE(n,e){if(n.charAt(0)==="1"||n.charAt(0)==="Q"){const t=ft(Ce.decode(`z${n}`));return n.startsWith("12D")?new ia({multihash:t}):n.startsWith("16U")?new oa({multihash:t}):new sa({multihash:t})}return LE(TE.decode(n))}function LE(n){try{const e=ft(n);if(e.code===Lt.code){if(e.digest.length===nl)return new ia({multihash:e});if(e.digest.length===sl)return new oa({multihash:e})}if(e.code===at.code)return new sa({multihash:e})}catch{return NE(se.decode(n))}throw new Error("Supplied PeerID CID is invalid")}function NE(n){if((n==null?void 0:n.multihash)==null||n.version==null||n.version===1&&n.code!==x8&&n.code!==Rc)throw new Error("Supplied PeerID CID is invalid");if(n.code===Rc){const t=Q(n.multihash.digest);return new RE(new URL(t))}const e=n.multihash;if(e.code===at.code)return new sa({multihash:n.multihash});if(e.code===Lt.code){if(e.digest.length===nl)return new ia({multihash:n.multihash});if(e.digest.length===sl)return new oa({multihash:n.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function ME(n,e){return n.length===nl?new ia({multihash:Yr(Lt.code,n),privateKey:e}):n.length===sl?new oa({multihash:Yr(Lt.code,n),privateKey:e}):new sa({multihash:await at.digest(n),publicKey:n,privateKey:e})}const OE=async()=>{const n=await DE("Ed25519"),e=await b8(n);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)};async function b8(n){return ME(IE(n.public),PE(n))}class UE{constructor(e){this.peer=e,this.connections=new Map}async dial(e){const t=e.getPeerId();if(!t)throw new Error("No peer ID in multiaddr");const r=this.peer.connect(t,{reliable:!0});return new Promise((s,i)=>{r.on("open",()=>{this.connections.set(t,r),s({id:t,remotePeer:t,remoteAddr:e,close:()=>r.close(),abort:()=>r.close(),getStreams:()=>[{id:`stream-${t}`,protocol:"/webrtc/1.0.0",read:o=>{r.on("data",a=>o(null,a)),r.on("close",()=>o(new Error("Connection closed")))},write:o=>r.send(o),close:()=>r.close(),abort:()=>r.close()}]})}),r.on("error",i)})}createListener(e){return{listen:t=>{this.peer.on("connection",r=>{var s;this.connections.set(r.peer,r),(s=e.onConnection)==null||s.call(e,{id:r.peer,remotePeer:r.peer,remoteAddr:t,close:()=>r.close(),abort:()=>r.close(),getStreams:()=>[{id:`stream-${r.peer}`,protocol:"/webrtc/1.0.0",read:i=>{r.on("data",o=>i(null,o)),r.on("close",()=>i(new Error("Connection closed")))},write:i=>r.send(i),close:()=>r.close(),abort:()=>r.close()}]})})},close:()=>this.peer.destroy(),getAddrs:()=>[be(`/webrtc/p2p/${this.peer.id}`)]}}filter(e){return e.filter(t=>t.protoNames().includes("webrtc"))}}class v8{constructor(e,t=!1){this.peers=new Map,this.knownObjects=new Map,this.chunkToPeerMap=new Map,this.pendingRequests=new Map,this.db=null,this.keypair=e,this.activeNodes=new Set,this.nodes=new Set,this.offlineQueue=[],this.isNode=t,this.peerId=null,this.peer=null,this.libp2p=null,this.kadDht=null,this.connectionAttempts=new Map,this.maxConnectionAttempts=3,this.connectionRetryDelay=5e3,this.averageLatency=0,this.bootstrapNodes=new Set,this.nodeLatencies=new Map,this.peerId=this.isNode?`node-${this.keypair}`:e;const r=ce.SHA256(this.peerId).toString(ce.enc.Hex);this.kademliaId=r.substring(0,40),console.log("DHT initialized with keypair:",e,"isNode:",t),this.initializeKnownNodes()}async initializeLibp2p(){if(!this.isNode)return;this.peer=new Tl(this.peerId,{host:"0.peerjs.com",port:443,path:"/",secure:!0,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}]},debug:3}),await new Promise((t,r)=>{this.peer.on("open",t),this.peer.on("error",r)});let e;try{const t=this.base64UrlToUint8Array(this.keypair);if(e=await b8(t),ce.SHA256(e.toString()).toString(ce.enc.Hex).substring(0,40)!==this.kademliaId)throw console.warn("Derived PeerId does not match kademliaId, generating new PeerId"),new Error("PeerId mismatch")}catch(t){console.warn("Failed to create PeerId from keypair, generating new Ed25519 PeerId:",t),e=await OE(),this.kademliaId=ce.SHA256(e.toString()).toString(ce.enc.Hex).substring(0,40),this.peerId=this.isNode?`node-${this.uint8ArrayToBase64Url(e.privateKey)}`:this.uint8ArrayToBase64Url(e.privateKey)}this.libp2p=await mb({peerId:e,transports:[new UE(this.peer)],addresses:{listen:[`/webrtc/p2p/${this.peerId}`]},services:{dht:Qv({kBucketSize:20,clientMode:!1})}}),this.kadDht=this.libp2p.services.dht,console.log("libp2p and kad-dht initialized with PeerId:",e.toString())}async initializeKnownNodes(){const e=async()=>{try{const t=await Ji(ws(q3,"nodes"));if(this.nodes.clear(),t.forEach(r=>this.nodes.add(`node-${r.id}`)),console.log("Fetched nodes:",Array.from(this.nodes)),this.nodes.size>0){const r=await this.selectBootstrapNode();r&&(this.bootstrapNodes.add(r),await this.queryBootstrapNode(r))}}catch(t){console.error("Failed to fetch nodes from Firestore:",t),this.nodes.clear()}};await e(),setInterval(e,5*60*1e3),this.isNode&&(await this.initializeLibp2p(),setInterval(()=>this.refreshRoutingTable(),10*60*1e3),setInterval(()=>this.republishData(),6*60*60*1e3),setInterval(()=>this.cleanupDHTStore(),24*60*60*1e3))}async selectBootstrapNode(){const e=Array.from(this.nodes).filter(s=>s!==this.peerId);if(e.length===0)return null;let t=1/0,r=null;for(const s of e.slice(0,5)){const i=await this.measureLatencyToPeer(s);i!==null&&i<t&&(t=i,r=s)}return r||(r=e[Math.floor(Math.random()*e.length)]),r}async queryBootstrapNode(e){try{await this.connectToPeer(e);const t=this.peers.get(e);if(t&&t.connected&&t.conn){const r=`${e}-getKnownNodes-${Date.now()}`;return t.conn.send({type:"getKnownNodes",requestId:r,peerId:this.peerId}),new Promise((s,i)=>{this.pendingRequests.set(r,{resolve:o=>{o.forEach(a=>{if(a!==this.peerId&&(this.bootstrapNodes.add(a),this.isNode)){const c=ce.SHA256(a).toString(ce.enc.Hex).substring(0,40);this.kadDht.addPeer(c,[be(`/webrtc/p2p/${a}`)]),this.nodeLatencies.set(c,1/0)}}),console.log("Received known nodes from bootstrap:",o),s()},reject:i}),setTimeout(()=>{this.pendingRequests.has(r)&&(this.pendingRequests.delete(r),i(new Error("Bootstrap query timed out")))},1e4)})}}catch(t){console.error("Failed to query bootstrap node:",t)}}async measureLatencyToPeer(e){const t=this.peers.get(e);if(t&&t.connected&&t.conn){const r=Date.now();try{await new Promise((i,o)=>{const a=`${e}-ping-${Date.now()}`;t.conn.send({type:"ping",requestId:a}),this.pendingRequests.set(a,{resolve:i,reject:o}),setTimeout(()=>{this.pendingRequests.has(a)&&(this.pendingRequests.delete(a),o(new Error("Ping timeout")))},2e3)});const s=Date.now()-r;if(this.isNode){const i=ce.SHA256(e).toString(ce.enc.Hex).substring(0,40);this.nodeLatencies.set(i,s)}return s}catch(s){return console.warn(`Failed to measure latency for peer ${e}:`,s),null}}return null}async measureLatency(){const e=[],t=Array.from(this.activeNodes).slice(0,5);for(const r of t){const s=await this.measureLatencyToPeer(r);s!==null&&e.push(s)}this.averageLatency=e.length>0?e.reduce((r,s)=>r+s,0)/e.length:0,console.log(`Average latency: ${this.averageLatency} ms`)}async refreshRoutingTable(){if(this.isNode)try{const e=ce.SHA256(String(Math.random())).toString(ce.enc.Hex).substring(0,40),t=await this.kadDht.getClosestPeers(e);for(const r of t)await this.connectToPeer(r.id.toString());console.log("Refreshed routing table")}catch(e){console.error("Failed to refresh routing table:",e)}}async initDB(){return new Promise((e,t)=>{const s=indexedDB.open("dcrypt_db",6);let i;s.onupgradeneeded=o=>{i=s.result,i.objectStoreNames.contains("store")||i.createObjectStore("store",{keyPath:"id"}),i.objectStoreNames.contains("transactions")||i.createObjectStore("transactions",{keyPath:"id",autoIncrement:!0}),i.objectStoreNames.contains("offlineQueue")||i.createObjectStore("offlineQueue",{keyPath:"id",autoIncrement:!0}),i.objectStoreNames.contains("chunkCache")||i.createObjectStore("chunkCache",{keyPath:"id"}),i.objectStoreNames.contains("dhtStore")||i.createObjectStore("dhtStore",{keyPath:"id"}),console.log("DHT database upgraded to version",6)},s.onsuccess=()=>{this.db=s.result,console.log("DHT IndexedDB opened at version",this.db.version),e()},s.onerror=o=>t(new Error(`Failed to open IndexedDB: ${o.target.error.message}`))})}async loadKnownObjects(){if(!this.db)throw new Error("IndexedDB not initialized");try{const r=this.db.transaction("store","readonly").objectStore("store").getAll();r.onsuccess=()=>{r.result.forEach(s=>{if(s.id!=="dcrypt_identity")try{const{metadata:i,chunks:o}=JSON.parse(s.value);this.knownObjects.set(s.id,{metadata:i,chunks:o})}catch(i){console.error("Failed to parse known object:",s.id,i)}}),console.log("Loaded known objects from IndexedDB")}}catch(e){console.error("Failed to load known objects:",e)}}async syncUserData(){if(!this.db)throw new Error("IndexedDB not initialized");try{await this.dbPut("store",{id:"dcrypt_identity",value:this.keypair}),await this.updateBalance(),this.activeNodes.size>0&&await this.processOfflineQueue();const e={type:"userData",peerId:this.peerId,keypair:this.keypair,balance:await this.getBalance(this.keypair),timestamp:Date.now()};this.broadcast(e),console.log("User data synced successfully")}catch(e){throw console.error("Sync failed:",e),e}}async saveUserData(){if(!this.db)throw new Error("IndexedDB not initialized");try{await this.dbPut("store",{id:"dcrypt_identity",value:this.keypair}),await this.updateBalance(),console.log("User data saved to IndexedDB")}catch(e){throw console.error("Save failed:",e),e}}async initSwarm(){try{return this.isNode?void 0:(console.log("Initializing PeerJS with Peer ID:",this.peerId),this.peer=new Tl(this.peerId,{host:"0.peerjs.com",port:443,path:"/",secure:!0,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}]},debug:3}),await new Promise((e,t)=>{this.peer.on("open",r=>{console.log(`PeerJS connection opened with ID: ${r}`),this.activeNodes.add(this.peerId),this.peer.on("connection",s=>this.handleConnection(s)),this.peer.on("error",s=>{var i;if(console.error("PeerJS error:",s.type,s.message),s.type==="peer-unavailable"){const o=(i=s.message.match(/Peer (.+) is unavailable/))==null?void 0:i[1];o&&this.handlePeerDisconnect(o)}}),this.peer.on("disconnected",()=>{console.log("PeerJS disconnected. Attempting to reconnect..."),this.peer.reconnect()}),window.addEventListener("beforeunload",()=>{this.peer&&!this.peer.destroyed&&(this.peer.destroy(),console.log("PeerJS peer destroyed on page unload"))}),setInterval(()=>this.discoverPeers(),3e3),setInterval(()=>this.measureLatency(),6e4),e()}),this.peer.on("error",r=>t(r))}))}catch(e){throw console.error("initSwarm failed:",e),e}}async discoverPeers(){console.log("Discovering peers...");const e=[...Array.from(this.nodes),...Array.from(this.bootstrapNodes),...Array.from(this.activeNodes)].filter(t=>t!==this.peerId);if(e.length===0){console.warn("No known peers to connect to.");return}if(this.isNode){const t=await this.kadDht.getClosestPeers(this.kademliaId);e.push(...t.map(r=>r.id.toString()))}e.forEach(t=>{this.peers.has(t)?this.peers.get(t).connected||this.connectToPeer(t):(this.peers.set(t,{connected:!1,conn:null}),console.log("Discovered peer:",t),this.connectToPeer(t))}),this.peers.size>50&&Array.from(this.peers.entries()).filter(([r,s])=>!s.connected).sort((r,s)=>(this.connectionAttempts.get(s[0])||0)-(this.connectionAttempts.get(r[0])||0)).slice(0,this.peers.size-50).forEach(([r])=>{if(this.peers.delete(r),this.connectionAttempts.delete(r),this.activeNodes.delete(r),this.isNode){const s=ce.SHA256(r).toString(ce.enc.Hex).substring(0,40);this.kadDht.removePeer(s)}})}async connectToPeer(e,t=1){var s;if((s=this.peers.get(e))!=null&&s.connected)return;console.log(`Connecting to peer: ${e} (Attempt ${t}/3)`);const r=this.peer.connect(e,{reliable:!0});r.on("open",()=>{if(console.log(`Connection opened with peer: ${e}`),this.peers.set(e,{connected:!0,conn:r}),this.activeNodes.add(e),this.isNode){const i=ce.SHA256(e).toString(ce.enc.Hex).substring(0,40);this.kadDht.addPeer(i,[be(`/webrtc/p2p/${e}`)]),this.nodeLatencies.set(i,1/0)}r.send({type:"handshake",peerId:this.peerId})}),r.on("data",i=>{console.log(`Received data from peer ${e}:`,i),this.handlePeerData(i,e)}),r.on("close",()=>{console.log(`Connection closed with peer ${e}`),this.handlePeerDisconnect(e)}),r.on("error",i=>{console.error(`Connection error with peer ${e}:`,i),t<3?setTimeout(()=>this.connectToPeer(e,t+1),5e3*t):(console.log(`Max attempts reached for peer ${e}. Marking as unreachable.`),this.handlePeerDisconnect(e))})}handleConnection(e){const t=e.peer;console.log(`Incoming connection from peer: ${t} at ${Date.now()}`),e.on("open",()=>{if(console.log(`Connection opened with peer: ${t}`),this.peers.set(t,{connected:!0,conn:e}),this.activeNodes.add(t),this.isNode){const r=ce.SHA256(t).toString(ce.enc.Hex).substring(0,40);this.kadDht.addPeer(r,[be(`/webrtc/p2p/${t}`)]),this.nodeLatencies.set(r,1/0)}}),e.on("data",r=>{console.log(`Received data from peer ${t}:`,r),this.handlePeerData(r,t)}),e.on("close",()=>{console.log(`Connection closed with peer ${t}`),this.handlePeerDisconnect(t)}),e.on("error",r=>{console.error(`Connection error with peer ${t}:`,r),this.handlePeerDisconnect(t)})}handlePeerDisconnect(e){const t=this.peers.get(e);if(t){if(t.connected=!1,t.conn=null,this.activeNodes.delete(e),this.isNode){const r=ce.SHA256(e).toString(ce.enc.Hex).substring(0,40);this.kadDht.removePeer(r),this.nodeLatencies.delete(r)}console.log(`Peer disconnected: ${e}. Will reconnect on next discovery.`)}}handlePeerData(e,t){switch(console.log(`Received data from peer ${t}:`,e),e.type){case"handshake":console.log(`Handshake from peer: ${t}`),this.activeNodes.add(t);break;case"chunk":this.chunkToPeerMap.set(e.chunkHash,new Set([...this.chunkToPeerMap.get(e.chunkHash)||[],t])),console.log(`Updated chunkToPeerMap for chunk ${e.chunkHash} with peer ${t}`);break;case"ip":this.knownObjects.set(e.ipHash,{metadata:e.metadata,chunks:e.chunkHashes}),this.dbPut("store",{id:e.ipHash,value:JSON.stringify({metadata:e.metadata,chunks:e.chunkHashes})}),console.log(`Received IP ${e.ipHash} from peer ${t}`);break;case"chunkRequest":this.handleChunkRequest(e,t);break;case"chunkResponse":this.handleChunkResponse(e);break;case"metadataRequest":this.handleMetadataRequest(e,t);break;case"metadataResponse":this.handleMetadataResponse(e);break;case"userData":console.log(`Received user data from peer ${t}:`,e);break;case"storeChunk":this.storeChunkFromPeer(e.chunkHash,e.chunkData,t);break;case"ping":peer=this.peers.get(t),peer&&peer.connected&&peer.conn&&peer.conn.send({type:"pong",requestId:e.requestId});break;case"pong":const r=this.pendingRequests.get(e.requestId);r&&(r.resolve(),this.pendingRequests.delete(e.requestId));break;case"commission":console.log(`Received commission of ${e.amount}. New balance: ${e.newBalance}`);break;case"getKnownNodes":if(peer=this.peers.get(t),peer&&peer.connected&&peer.conn){const o=Array.from(this.activeNodes);peer.conn.send({type:"knownNodesResponse",requestId:e.requestId,nodes:o,peerId:this.peerId})}break;case"knownNodesResponse":const s=this.pendingRequests.get(e.requestId);s&&(s.resolve(e.nodes),this.pendingRequests.delete(e.requestId));break;case"storeDHT":this.storeDHTFromPeer(e.key,e.value,e.ttl,t);break;case"findDHT":this.handleFindDHT(e,t);break;case"findDHTResponse":const i=this.pendingRequests.get(e.requestId);i&&(i.resolve({value:e.value,nodes:e.nodes}),this.pendingRequests.delete(e.requestId));break;default:console.warn(`Unknown data type from peer ${t}:`,e.type)}}async storeDHT(e,t,r=864e5){try{const s=ce.SHA256(e).toString(ce.enc.Hex).substring(0,40);let i=[];if(this.isNode)i=(await this.kadDht.getClosestPeers(s)).map(a=>({id:a.id.toString()})).slice(0,20);else{const o=Array.from(this.bootstrapNodes)[0];if(!o)throw new Error("No bootstrap node available");i=await this.requestNodesFromPeer(o,s)}for(const o of i){const a=o.id||o.address,c=this.peers.get(a);c&&c.connected&&c.conn&&c.conn.send({type:"storeDHT",key:e,value:t,ttl:r,peerId:this.peerId})}this.isNode&&(await this.storeDHTFromPeer(e,t,r,this.peerId),await this.kadDht.put(Buffer.from(s),Buffer.from(t))),console.log(`Stored DHT key ${e} on ${i.length} nodes`)}catch(s){throw console.error("Failed to store DHT key:",s),s}}async storeDHTFromPeer(e,t,r,s){if(this.isNode)try{await this.dbPut("dhtStore",{id:e,value:t,ttl:r,timestamp:Date.now()});const i=ce.SHA256(e).toString(ce.enc.Hex).substring(0,40);await this.kadDht.put(Buffer.from(i),Buffer.from(t)),console.log(`Stored DHT key ${e} from peer ${s}`)}catch(i){console.error(`Failed to store DHT key ${e} from peer ${s}:`,i)}}async findDHT(e){try{const t=ce.SHA256(e).toString(ce.enc.Hex).substring(0,40);if(this.isNode){if(await this.kadDht.get(Buffer.from(t))){const i=await this.dbGet("dhtStore",e);if(i&&i.timestamp+i.ttl>Date.now())return i.value}const s=await this.kadDht.getClosestPeers(t);for(const i of s){const o=await this.requestDHTFromPeer(i.id.toString(),e);if(o)return o}}else{const r=Array.from(this.bootstrapNodes)[0];if(!r)throw new Error("No bootstrap node available");const s=await this.requestDHTFromPeer(r,e);if(s)return s}throw new Error(`DHT key ${e} not found`)}catch(t){throw console.error("Failed to find DHT key:",t),t}}async requestNodesFromPeer(e,t){const r=this.peers.get(e);if(!r||!r.connected||!r.conn)throw new Error(`Peer ${e} is not connected`);const s=`${e}-findNodes-${Date.now()}`;return r.conn.send({type:"findDHT",key:t,requestId:s,peerId:this.peerId}),new Promise((i,o)=>{this.pendingRequests.set(s,{resolve:({nodes:a})=>i(a.map(c=>({id:c}))),reject:o}),setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),o(new Error(`Request for nodes for key ${t} timed out`)))},1e4)})}async requestDHTFromPeer(e,t){const r=this.peers.get(e);if(!r||!r.connected||!r.conn)throw new Error(`Peer ${e} is not connected`);const s=`${e}-findDHT-${Date.now()}`;return r.conn.send({type:"findDHT",key:t,requestId:s,peerId:this.peerId}),new Promise((i,o)=>{this.pendingRequests.set(s,{resolve:({value:a,nodes:c})=>i(a||null),reject:o}),setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),o(new Error(`Request for DHT key ${t} timed out`)))},1e4)})}async handleFindDHT(e,t){if(!this.isNode)return;const{key:r,requestId:s}=e,i=this.peers.get(t);if(!i||!i.connected||!i.conn)return;const o=await this.dbGet("dhtStore",r);if(o&&o.timestamp+o.ttl>Date.now())i.conn.send({type:"findDHTResponse",requestId:s,value:o.value,nodes:[],peerId:this.peerId});else{const a=ce.SHA256(r).toString(ce.enc.Hex).substring(0,40),c=await this.kadDht.getClosestPeers(a);i.conn.send({type:"findDHTResponse",requestId:s,value:null,nodes:c.map(l=>l.id.toString()),peerId:this.peerId})}}async republishData(){if(this.isNode)try{const e=await this.dbGetAll("dhtStore");for(const t of e)t.timestamp+t.ttl>Date.now()&&await this.storeDHT(t.id,t.value,t.ttl);console.log("Republished DHT data")}catch(e){console.error("Failed to republish DHT data:",e)}}async cleanupDHTStore(){if(this.isNode)try{const t=this.db.transaction("dhtStore","readwrite").objectStore("dhtStore"),r=await new Promise(s=>{t.getAll().onsuccess=i=>s(i.target.result)});for(const s of r)s.timestamp+s.ttl<=Date.now()&&await new Promise(i=>{t.delete(s.id).onsuccess=i});console.log("Cleaned up expired DHT entries")}catch(e){console.error("Failed to clean up DHT store:",e)}}async storeChunkFromPeer(e,t,r){if(this.isNode)try{await this.dbPut("chunkCache",{id:e,value:t});let s=this.chunkToPeerMap.get(e)||new Set;s.add(this.peerId),this.chunkToPeerMap.set(e,s),console.log(`Stored chunk ${e} from peer ${r}`)}catch(s){console.error(`Failed to store chunk ${e} from peer ${r}:`,s)}}async publishChunk(e,t,r,s){if(!this.db)throw new Error("IndexedDB not initialized");try{if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid chunk hash");await this.dbPut("chunkCache",{id:e,value:t});let i=this.chunkToPeerMap.get(e)||new Set;if(i.add(this.peerId),this.chunkToPeerMap.set(e,i),this.activeNodes.size>0){const o=ce.SHA256(e).toString(ce.enc.Hex).substring(0,40);let a=[];if(this.isNode)a=(await this.kadDht.getClosestPeers(o)).map(l=>({id:l.id.toString()})).slice(0,3);else{const c=Array.from(this.bootstrapNodes)[0];if(!c)throw new Error("No bootstrap node available");a=await this.requestNodesFromPeer(c,o),a=a.slice(0,3)}a=a.filter(c=>(c.id||c.address).startsWith("node-"));for(const c of a){const l=c.id||c.address,u=this.peers.get(l);u&&u.connected&&u.conn&&(u.conn.send({type:"storeChunk",chunkHash:e,chunkData:t,peerId:this.peerId}),i.add(l),this.chunkToPeerMap.set(e,i),console.log(`Sent chunk ${e} to node ${l}`))}if(r===s-1){const c={};this.chunkToPeerMap.forEach((u,d)=>{c[d]=Array.from(u)});const l=this.chunkToIpHash.get(e)||e;await this.storeDHT(l,JSON.stringify(c))}}else await this.queueOfflineOperation({type:"publishChunk",chunkHash:e,chunkData:t,chunkIndex:r,totalChunks:s});this.broadcastChunk(e)}catch(i){throw console.error("publishChunk failed:",i),i}}broadcastChunk(e){const t={type:"chunk",chunkHash:e,peerId:this.peerId};this.broadcast(t),console.log(`Broadcasted chunk ${e} to ${this.activeNodes.size} peers`)}async publishIP(e,t,r){if(!this.db||!this.keypair)throw new Error("IndexedDB or keypair not initialized");try{const s=Array.isArray(e.tags)?e.tags.map(E=>String(E).trim()).filter(E=>E!==""):[],i=!!e.isPremium,o=i?e.priceUsd||30:0,a=new Uint8Array(t),c=e.content_type||"",l=this.keypair,d=Pw(a,c,s,i,o,l,r||"text/plain"),h=Tw(d),g=await V3(h),p=this.uint8ArrayToBase64Url(g),m=Array.from(this.activeNodes).filter(E=>E.startsWith("node-")),y=m.length>0?m.length:1,w=await Fw(d,this.keypair,y),v=await Promise.all(w.map(E=>Rw(E).then(C=>this.uint8ArrayToBase64Url(C)))),b={...e,chunk_count:w.length,isPremium:i,priceUsd:o,chunks:v},x={metadata:b,chunks:v};this.knownObjects.set(p,x),await this.dbPut("store",{id:p,value:JSON.stringify(x)}),this.chunkToIpHash=new Map,v.forEach(E=>this.chunkToIpHash.set(E,p));for(let E=0;E<w.length;E++)await this.publishChunk(v[E],w[E],E,w.length);return this.activeNodes.size>0?this.broadcastIP(p,b,v):await this.queueOfflineOperation({type:"publishIP",ipHash:p,metadata:b,chunkHashes:v}),p}catch(s){throw console.error("publishIP failed:",s),s}}broadcastIP(e,t,r){const s={type:"ip",ipHash:e,metadata:t,chunkHashes:r,peerId:this.peerId};this.broadcast(s),console.log(`Broadcasted IP ${e} to ${this.activeNodes.size} peers`)}async requestData(e){if(!this.db)throw new Error("IndexedDB not initialized");try{if(!e)throw new Error("IP not found");const t=await this.findDHT(e.metadata.hash||e.chunks[0]),r=JSON.parse(t);this.chunkToPeerMap=new Map,Object.entries(r).forEach(([u,d])=>{this.chunkToPeerMap.set(u,new Set(d))});const s=[];for(const u of e.chunks){const d=await this.dbGet("chunkCache",u);if(d&&d.value){s.push({chunk:d.value,hash:u});continue}const h=this.chunkToPeerMap.get(u);if(!h||h.size===0)throw new Error(`No peers found with chunk ${u}`);const g=Array.from(h).filter(w=>w.startsWith("node-")),p=Array.from(h).filter(w=>!w.startsWith("node-"));let m=!1,y=null;for(const w of[...g,...p])if(this.activeNodes.has(w))try{const v=await this.fetchChunkFromPeer(w,u);await this.dbPut("chunkCache",{id:u,value:v}),s.push({chunk:v,hash:u}),m=!0;break}catch(v){y=v,console.error(`Failed to fetch chunk ${u} from peer ${w}:`,v)}if(!m)throw y||new Error(`No available peer for chunk ${u}`)}const i=s.sort((u,d)=>K2(u.chunk)-K2(d.chunk)),o=await Promise.all(i.map(({chunk:u})=>Lw(u,this.keypair))),a=new Uint8Array(o.reduce((u,d)=>u+d.length,0));let c=0;for(const u of o)a.set(u,c),c+=u.length;const l=Nw(i[0].chunk);return{data:a,fileType:l}}catch(t){throw console.error("requestData failed:",t),t}}async getIPmetadata(e){try{const t=this.knownObjects.get(e);if(t)return t;const r=await this.findDHT(e),s=JSON.parse(r);this.chunkToPeerMap=new Map,Object.entries(s).forEach(([l,u])=>{this.chunkToPeerMap.set(l,new Set(u))});const i=Array.from(this.activeNodes).find(l=>l.startsWith("node-"));if(!i)throw new Error("No nodes available");const o=i,a=`${o}-${e}-${Date.now()}`,c=this.peers.get(o);if(!c||!c.connected||!c.conn)throw new Error(`Peer ${o} is not connected`);return c.conn.send({type:"metadataRequest",requestId:a,ipHash:e,peerId:this.peerId}),new Promise((l,u)=>{this.pendingRequests.set(a,{resolve:l,reject:u,hash:e}),setTimeout(()=>{this.pendingRequests.has(a)&&(this.pendingRequests.delete(a),u(new Error(`Request for object ${e} from peer timed out`)))},1e4)})}catch(t){throw console.error("getIPmetadata failed:",t),t}}async fetchChunkFromPeer(e,t){const r=this.peers.get(e);if(!r||!r.connected||!r.conn)throw new Error(`Peer ${e} is not connected`);const s=`${e}-${t}-${Date.now()}`,i={type:"chunkRequest",requestId:s,chunkHash:t,peerId:this.peerId};return r.conn.send(i),new Promise((o,a)=>{this.pendingRequests.set(s,{resolve:o,reject:a,hash:t}),setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),a(new Error(`Request for chunk ${t} from peer ${e} timed out`)))},1e4)})}handleChunkRequest(e,t){const{requestId:r,chunkHash:s}=e;this.dbGet("chunkCache",s).then(i=>{if(i&&i.value){const o=this.peers.get(t);o&&o.connected&&o.conn&&(o.conn.send({type:"chunkResponse",requestId:r,chunkHash:s,chunkData:i.value,peerId:this.peerId}),console.log(`Sent chunk ${s} to peer ${t}`))}else console.warn(`Chunk ${s} not found for peer ${t}`)}).catch(i=>console.error(`Failed to retrieve chunk ${s} for peer ${t}:`,i))}handleMetadataRequest(e,t){const{requestId:r,ipHash:s}=e,i=this.knownObjects.get(s),o=this.peers.get(t);o&&o.connected&&o.conn&&o.conn.send({type:"metadataResponse",requestId:r,ipObject:i,peerId:this.peerId,ipHash:s})}handleMetadataResponse(e){const{requestId:t,ipObject:r,ipHash:s}=e,i=this.pendingRequests.get(t);i&&(s===i.hash&&i.resolve(r),this.pendingRequests.delete(t))}handleChunkResponse(e){const{requestId:t,chunkHash:r,chunkData:s}=e,i=this.pendingRequests.get(t);i&&(i.hash===r?i.resolve(s):i.reject(new Error(`Received chunk hash ${r} does not match requested hash ${i.hash}`)),this.pendingRequests.delete(t))}async distributeCommission(e){const t=Array.from(this.activeNodes).filter(s=>s.startsWith("node-"));if(t.length===0){console.log("No active nodes to distribute commission to.");return}const r=e/t.length;console.log(`Distributing commission of ${e} to ${t.length} nodes (${r} per node)`);for(const s of t){const i=s.replace("node-",""),o=this.base64UrlToUint8Array(i),c=await this.getBalance(o)+r;await this.putBalance(o,c);const l=this.peers.get(s);l&&l.connected&&l.conn&&l.conn.send({type:"commission",amount:r,newBalance:c,peerId:this.peerId})}}async getBalance(e){if(!this.db)throw new Error("IndexedDB not initialized");const t=await this.dbGet("store","balance_"+e);return t&&t.value?parseFloat(t.value):0}async putBalance(e,t){if(!this.db)throw new Error("IndexedDB not initialized");if(typeof t!="number"||t<0)throw new Error("Invalid balance amount");await this.dbPut("store",{id:"balance_"+e,value:t.toString()}),this.activeNodes.size>0&&this.broadcast({type:"userData",peerId:this.peerId,keypair:this.keypair,balance:t,timestamp:Date.now()})}async updateBalance(){if(!this.db)throw new Error("IndexedDB not initialized");const e=await this.getBalance(this.keypair);await this.putBalance(this.keypair,e)}async queueOfflineOperation(e){if(!this.db)throw new Error("IndexedDB not initialized");this.offlineQueue.push(e),await this.dbAdd("offlineQueue",{id:Date.now().toString(),value:e}),console.log("Queued offline operation:",e)}async processOfflineQueue(){if(this.offlineQueue.length===0)return;console.log("Processing offline queue...");const e=[...this.offlineQueue];this.offlineQueue=[];const r=this.db.transaction("offlineQueue","readwrite").objectStore("offlineQueue");await new Promise(s=>r.clear().onsuccess=s);for(const s of e)try{switch(s.type){case"publishChunk":await this.publishChunk(s.chunkHash,s.chunkData,s.chunkIndex,s.totalChunks);break;case"publishIP":await this.broadcastIP(s.ipHash,s.metadata,s.chunkHashes);break;default:console.warn("Unknown offline operation type:",s.type)}}catch(i){console.error(`Failed to process offline operation ${s.type}:`,i),this.offlineQueue.push(s),await this.dbAdd("offlineQueue",{id:Date.now().toString(),value:s})}}async dbPut(e,t){if(!this.db)throw new Error("IndexedDB not initialized");return new Promise((r,s)=>{const a=this.db.transaction(e,"readwrite").objectStore(e).put(t);a.onsuccess=()=>r(),a.onerror=c=>s(new Error(`DB put failed: ${c.target.error.message}`))})}async dbAdd(e,t){if(!this.db)throw new Error("IndexedDB not initialized");return new Promise((r,s)=>{const a=this.db.transaction(e,"readwrite").objectStore(e).add(t);a.onsuccess=()=>r(),a.onerror=c=>s(new Error(`DB add failed: ${c.target.error.message}`))})}async dbGet(e,t){if(!this.db)throw new Error("IndexedDB not initialized");return new Promise((r,s)=>{const a=this.db.transaction(e,"readonly").objectStore(e).get(t);a.onsuccess=()=>r(a.result),a.onerror=c=>s(new Error(`DB get failed: ${c.target.error.message}`))})}async dbGetAll(e){if(!this.db)throw new Error("IndexedDB not initialized");return new Promise((t,r)=>{const o=this.db.transaction(e,"readonly").objectStore(e).getAll();o.onsuccess=()=>t(o.result),o.onerror=a=>r(new Error(`DB getAll failed: ${a.target.error.message}`))})}broadcast(e){this.activeNodes.forEach(t=>{if(t!==this.peerId){const r=this.peers.get(t);r&&r.connected&&r.conn&&r.conn.send(e)}})}uint8ArrayToBase64Url(e){const t=String.fromCharCode(...e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}base64UrlToUint8Array(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";const r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;i++)s[i]=r.charCodeAt(i);return s}async destroy(){this.peer&&!this.peer.destroyed&&(this.peer.destroy(),console.log("PeerJS peer destroyed")),this.libp2p&&(await this.libp2p.stop(),console.log("libp2p stopped")),this.peers.clear(),this.activeNodes.clear(),this.pendingRequests.clear(),this.bootstrapNodes.clear()}}function w8(n){const e=String.fromCharCode(...n);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}let Ne=null,Xe=null,$E=null,K=null,Xi=!1,jr=0,I0=!1,P0=!1;async function E8(){console.log("Starting Firebase initialization...");try{const n=await X8(()=>Promise.resolve().then(()=>Dw),void 0);Ne=n.auth,Xe=n.db,$E=n.storage,await z8(Ne,q8),console.log("Firebase services initialized successfully with local persistence")}catch(n){throw console.error("Failed to initialize Firebase services:",n),Z("Failed to initialize Firebase. Please try again later.",!0),n}}function HE(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function es(){return!!(Ne!=null&&Ne.currentUser)||localStorage.getItem("role")==="node"}function Z(n,e=!1){const t=document.getElementById("toast");t&&(t.textContent=n,t.className="toast",e&&t.classList.add("error-toast"),t.style.display="block",setTimeout(()=>{t.style.display="none"},3e3))}function zE(){if(!es()||!K){Z("Please sign in and ensure the app is initialized before publishing.",!0);return}try{document.getElementById("publishModal").classList.add("active"),console.log("Opened publish modal")}catch(n){console.error("Failed to open publish modal:",n),Z("Failed to open publish modal. Please try again.",!0)}}async function qE(n){let e=K.knownObjects.get(n).metadata;if(window.currentProduct=e.hash,!es()||!K){Z("Please sign in and ensure the app is initialized before viewing.",!0);return}try{const t=document.getElementById("buyModal");document.getElementById("snippetTitle").value=e.content_type,document.getElementById("snippetDescription").value=e.description,document.getElementById("snippetPrice").value=e.priceUsd==0?"Free":e.priceUsd,t.classList.add("active")}catch(t){console.error("Failed to open buy/preview modal:",t),Z("Failed to open buy/preview modal. Please try again.",!0)}}function xs(){var e,t;const n={publishedItemsTableBody:(e=document.getElementById("publishedItems"))==null?void 0:e.querySelector("tbody"),mySnippetsTableBody:(t=document.getElementById("mySnippets"))==null?void 0:t.querySelector("tbody"),transactionList:document.getElementById("transactionList"),userBalanceElement:document.getElementById("userBalance"),userNameElement:document.getElementById("userName"),userAvatarElement:document.querySelector(".user-avatar"),snippetsPostedElement:document.getElementById("snippetsPosted")};n.publishedItemsTableBody&&(n.publishedItemsTableBody.innerHTML=""),n.mySnippetsTableBody&&(n.mySnippetsTableBody.innerHTML=""),n.transactionList&&(n.transactionList.innerHTML="No transactions yet."),n.userBalanceElement&&(n.userBalanceElement.textContent="Balance: 0 DCT"),n.userNameElement&&(n.userNameElement.textContent="Guest User"),n.userAvatarElement&&(n.userAvatarElement.innerHTML='<i class="fas fa-user text-lg"></i>'),n.snippetsPostedElement&&(n.snippetsPostedElement.textContent="0"),jr=0,localStorage.removeItem("userKeypair"),localStorage.removeItem("peerId"),localStorage.removeItem("dhtInitialized"),console.log("Cleared persisted state from localStorage on sign-out")}async function di(){const n=document.getElementById("userBalance");if(n){if(!K){n.textContent="Balance: 0 DCT",jr=0;return}try{jr=await K.getBalance(K.keypair)||0,n.textContent=`Balance: ${jr} DCT`}catch(e){console.error("Failed to update balance:",e),n.textContent="Balance: 0 DCT",jr=0}}}async function hi(){const n=document.getElementById("transactionList");if(n){if(!K){n.innerHTML="Not initialized.";return}try{const e=await K.dbGetAll("transactions");if(e.length===0){n.innerHTML="No transactions yet.";return}n.innerHTML=e.map(t=>`<p class="py-1">${t.type} - ${t.amount} DCT - ${new Date(t.timestamp).toLocaleString()}</p>`).join("")}catch(e){console.error("Failed to update transaction history:",e),n.innerHTML="Failed to load transactions."}}}async function aa(){var e;const n=(e=document.getElementById("publishedItems"))==null?void 0:e.querySelector("tbody");if(n){n.innerHTML="";try{const t=to(ws(Xe,"snippets"));j8(t,async r=>{const s={};if(r.forEach(i=>{s[i.id]=i.data()}),K){K.knownObjects.clear();for(const[i,o]of Object.entries(s)){const a={content_type:o.title,hash:o.ipHash,description:o.description||"No description",tags:o.tags||[],isPremium:o.isPremium||!1,priceUsd:o.priceUsd||0};K.knownObjects.set(i,{metadata:a,chunks:o.chunks||[]})}K.knownObjects.forEach((i,o)=>{const a=s[o],l=(i.metadata.isPremium||!1)&&i.metadata.priceUsd||0,u=l>0?`${l} DCT`:"Free",d=document.createElement("tr");d.innerHTML=`
            <td class="py-2 px-4">${i.metadata.content_type}</td>
            <td class="py-2 px-4">${i.metadata.tags.join(", ")||"No tags"}</td>
            <td class="py-2 px-4">${a.likes}</td>
            <td class="py-2 px-4">${a.dislikes}</td>
            <td class="py-2 px-4">
            
              <button onclick="window.openBuyModal('${o}')" class="bg-purple-500 text-white rounded hover:bg-purple-600 px-3 py-1 mr-2">Get (${u})</button>
              <button onclick="window.flagSnippet('${o}')" class="bg-red-500 text-white rounded hover:bg-red-600 px-3 py-1">Flag</button>
            </td>
          `,n.appendChild(d)})}},r=>{console.error("Live feed snapshot error:",r),Z("Failed to load live feed.",!0)})}catch(t){console.error("Failed to update live feed:",t),Z("Failed to load live feed.",!0)}}}async function ol(){var e,t;const n=(e=document.getElementById("mySnippets"))==null?void 0:e.querySelector("tbody");if(n){n.innerHTML="";try{const r=((t=Ne.currentUser)==null?void 0:t.uid)||localStorage.getItem("nodeId");if(!r)return;const s=to(ws(Xe,"snippets"),L0("creatorId","==",r));(await Ji(s)).forEach(o=>{const a=o.data(),c=document.createElement("tr");c.innerHTML=`
        <td class="py-2 px-4">${a.title||"No title"}</td>
        <td class="py-2 px-4">${a.ipHash}</td>
        <td class="py-2 px-4">
          <button onclick="window.copyHash('${a.ipHash}')" class="bg-blue-500 text-white rounded hover:bg-blue-600 px-3 py-1">Copy Hash</button>
        </td>
      `,n.appendChild(c)})}catch(r){console.error("Failed to update my snippets:",r),Z("Failed to load your snippets.",!0)}}}async function VE(n){var t;const e=(t=document.getElementById("publishedItems"))==null?void 0:t.querySelector("tbody");if(e){e.innerHTML="";try{const r=n.split(",").map(o=>o.trim().toLowerCase()).filter(o=>o);let s;r.length===0?s=await Ji(to(ws(Xe,"snippets"),L0("reviewStatus","==","active"))):s=await Ji(to(ws(Xe,"snippets"),L0("reviewStatus","==","active")));const i={};if(s.forEach(o=>{i[o.id]=o.data()}),K){K.knownObjects.clear();for(const[o,a]of Object.entries(i)){const c={content_type:a.title,description:a.description||"No description",tags:a.tags||[],isPremium:a.isPremium||!1,priceUsd:a.priceUsd||0};K.knownObjects.set(o,{metadata:c,chunks:a.chunks||[]})}K.knownObjects.forEach((o,a)=>{const c=i[a]||{likes:0,dislikes:0},l=(o.metadata.tags||[]).map(p=>p.toLowerCase());if(r.length>0&&!r.some(p=>l.includes(p)))return;const d=(o.metadata.isPremium||!1)&&o.metadata.priceUsd||0,h=d>0?`${d} DCT`:"Free",g=document.createElement("tr");g.innerHTML=`
          <td class="py-2 px-4">${o.metadata.content_type}</td>
          <td class="py-2 px-4">${o.metadata.description||"No description"}</td>
          <td class="py-2 px-4">${o.metadata.tags.join(", ")||"No tags"}</td>
          <td class="py-2 px-4">${c.likes}</td>
          <td class="py-2 px-4">${c.dislikes}</td>
          <td class="py-2 px-4">
            <button onclick="window.openBuyModal(${a})" class="bg-purple-500 text-white rounded hover:bg-purple-600 px-3 py-1 mr-2">Get (${h})</button>
            <button onclick="window.flagSnippet('${a}')" class="bg-red-500 text-white rounded hover:bg-red-600 px-3 py-1">Flag</button>
          </td>
        `,e.appendChild(g)})}}catch(r){console.error("Failed to search snippets:",r),Z("Search failed.",!0)}}}async function fi(){var e;const n=((e=Ne.currentUser)==null?void 0:e.uid)||localStorage.getItem("nodeId");if(n)try{const t=Ft(Xe,"users",n),r=K?await K.getBalance(K.keypair):0;await jn(t,{balance:r,lastUpdated:Date.now()},{merge:!0}),console.log("User data uploaded to Firebase")}catch(t){console.error("Failed to upload user data to Firebase:",t)}}function KE(){const n=document.getElementById("transactionHistory");n&&(n.style.display=n.style.display==="none"?"block":"none")}function jE(n,e,t){const r=document.getElementById("snippetDisplay");if(!r)return;r.innerHTML="";const s=document.createElement("div");s.className="p-4 bg-gray-800 rounded-lg mt-4";const i=document.createElement("h3");if(i.className="text-lg font-semibold mb-2",i.textContent=t||"Snippet Content",s.appendChild(i),e.startsWith("text")){const o=new TextDecoder().decode(n),a=document.createElement("pre");a.className="text-sm text-gray-300 whitespace-pre-wrap",a.textContent=o,s.appendChild(a)}else if(e.startsWith("image")){const o=new Blob([n],{type:e}),a=URL.createObjectURL(o),c=document.createElement("img");c.src=a,c.className="max-w-full h-auto rounded",c.onload=()=>URL.revokeObjectURL(a),s.appendChild(c)}else{const o=new Blob([n],{type:e}),a=URL.createObjectURL(o),c=document.createElement("a");c.href=a,c.download=t||"downloaded_file",c.className="text-blue-400 hover:underline",c.textContent="Download File",c.onclick=()=>setTimeout(()=>URL.revokeObjectURL(a),1e3),s.appendChild(c)}r.appendChild(s)}async function al(){return new Promise((e,t)=>{console.log("Starting IndexedDB initialization...");const r=indexedDB.open("dcrypt_db");r.onsuccess=()=>{const s=r.result,i=s.version;console.log("Current IndexedDB version:",i),s.close();const o=indexedDB.open("dcrypt_db",Math.max(i,5));o.onupgradeneeded=a=>{const c=o.result;console.log("Upgrading database to version",5),c.objectStoreNames.contains("store")||(c.createObjectStore("store",{keyPath:"id"}),console.log("Created object store: store")),c.objectStoreNames.contains("transactions")||(c.createObjectStore("transactions",{keyPath:"id",autoIncrement:!0}),console.log("Created object store: transactions")),c.objectStoreNames.contains("offlineQueue")||(c.createObjectStore("offlineQueue",{keyPath:"id",autoIncrement:!0}),console.log("Created object store: offlineQueue")),c.objectStoreNames.contains("chunkCache")||(c.createObjectStore("chunkCache",{keyPath:"id"}),console.log("Created object store: chunkCache")),console.log("Database upgrade completed")},o.onsuccess=()=>{const a=o.result;console.log("IndexedDB opened successfully at version",a.version),e(a)},o.onerror=()=>{console.error("Failed to open IndexedDB:",o.error),t(new Error(`Failed to open IndexedDB: ${o.error.message}`))}},r.onerror=()=>{console.error("Failed to check IndexedDB version:",r.error),t(new Error(`Failed to check IndexedDB version: ${r.error.message}`))}})}async function C8(n){return new Promise((e,t)=>{try{const i=n.transaction("store","readonly").objectStore("store").get("dcrypt_identity");i.onsuccess=()=>{var a;const o=(a=i.result)==null?void 0:a.value;o&&typeof o=="string"?(console.log("Loaded keypair from IndexedDB:",o),e(o)):(console.log("No valid keypair found in IndexedDB."),e(null))},i.onerror=()=>{console.error("Failed to load keypair from IndexedDB:",i.error),t(new Error("Failed to load keypair from IndexedDB"))}}catch(r){console.error('Error accessing "store" object store:',r),t(r)}})}async function Z2(n,e){return new Promise((t,r)=>{try{console.log("Storing keypair in IndexedDB:",e);const o=n.transaction("store","readwrite").objectStore("store").put({id:"dcrypt_identity",value:e});o.onsuccess=()=>{console.log("Successfully stored keypair in IndexedDB"),t()},o.onerror=()=>{console.error("Failed to store keypair in IndexedDB:",o.error),r(new Error("Failed to store keypair in IndexedDB"))}}catch(s){console.error('Error storing keypair in "store" object store:',s),r(s)}})}async function X2(n,e){if(P0){console.log("Initialization already in progress, skipping...");return}P0=!0,console.log("Initializing app with userId:",n);try{e||(e=await al());let t=await C8(e);if(t instanceof Uint8Array&&(t=w8(t)),!t&&n)console.log("No keypair found, using userId as keypair:",n),await Z2(e,n),t=n;else if(t)t.length>40&&(console.warn("Existing keypair is unusually large:",t.length,"characters. Overwriting with userId."),t=n,await Z2(e,n));else throw new Error("No keypair available and no userId provided to create one");Xi=await GE(n),console.log(`User is ${Xi?"":"not "}a node.`),K=new v8(t,Xi),window.dht=K,await K.initDB(),console.log("DHT database initialized.");let r=3;for(;r>0;)try{await K.initSwarm();break}catch(s){if(s.message.includes("No bootstrap node available")&&r>1)console.warn("No nodes available, retrying...",r),await new Promise(i=>setTimeout(i,5e3)),r--;else throw s}console.log("DHT swarm initialized."),await K.syncUserData(),console.log("User data synced."),await Promise.all([aa(),ol(),di(),hi()]),console.log("UI updated."),await S8(n)}catch(t){console.error("Error initializing application:",t),t.message.includes("ID conflict")?Z("Failed to connect to the network due to an ID conflict. Please try signing out and signing in again.",!0):t.message.includes("No bootstrap node available")?Z("No nodes available in the network. Please try again later.",!0):Z(`Initialization failed: ${t.message}`,!0),K&&K.destroy(),K=null,window.dht=null,jr=0,xs()}finally{P0=!1}fi()}async function GE(n){try{const e=Ft(Xe,"nodes",n);return(await Oc(e)).exists()}catch(e){return console.error("Failed to check node status:",e),!1}}async function WE(n,e=800,t=800,r=.7){return new Promise((s,i)=>{const o=new Image;o.src=URL.createObjectURL(n),o.onload=()=>{const a=document.createElement("canvas");let c=o.width,l=o.height;c>l?c>e&&(l*=e/c,c=e):l>t&&(c*=t/l,l=t),a.width=c,a.height=l,a.getContext("2d").drawImage(o,0,0,c,l),a.toBlob(d=>s(d),n.type,r)},o.onerror=i})}async function QE(n,e){if(!e)return console.log("No file provided for upload"),null;if(!Ne.currentUser||Ne.currentUser.uid!==n)return console.error("User not authenticated or ID mismatch"),Z("Please sign in to upload a profile image.",!0),null;try{const t=await WE(e),r=new FileReader,i=await new Promise((a,c)=>{r.onload=()=>a(r.result.split(",")[1]),r.onerror=c,r.readAsDataURL(t)}),o=Ft(Xe,"users",n);return await jn(o,{profileImage:i,updatedAt:new Date().toISOString()},{merge:!0}),console.log("Compressed profile image stored in Firestore for user:",n),i}catch(t){return console.error("Failed to store profile image in Firestore:",t),Z(`Failed to store profile image: ${t.message}`,!0),null}}async function YE(){if(console.log("handleSignup function called"),I0){console.log("Signup already in progress, ignoring additional clicks");return}I0=!0;const n=document.getElementById("signupButton");n&&(n.disabled=!0,n.textContent="Signing Up...",console.log("Signup button disabled and text updated")),localStorage.setItem("pendingRole","user");try{const e=new Bd,t=await Dd(Ne,e);console.log("Sign-up successful, user:",t.user);const r=document.getElementById("usernameInput").value,i=document.getElementById("profileImageInput").files[0];console.log(i);const o=i?await QE(t.user.uid,i):null,a=Ft(Xe,"users",t.user.uid);await jn(a,{username:r||t.user.displayName||"Anonymous User",profileImageUrl:o||null,createdAt:Date.now(),snippetsPosted:0},{merge:!0}),console.log("User profile saved to Firestore"),Z("Sign-up successful! Redirecting to dashboard..."),window.location.href="/datasharingApp/"}catch(e){console.error("Signup failed:",e),Z(`Sign-up failed: ${e.message}`,!0),I0=!1,n&&(n.disabled=!1,n.textContent="Sign Up with Google")}finally{localStorage.removeItem("pendingRole")}}async function ZE(n){if(!es()){Z("Please sign in to deposit.");return}try{if(!K)throw new Error("DHT not initialized");if(!n||n<=0)throw new Error("Invalid deposit amount");const t=await K.getBalance(K.keypair)+n;await K.putBalance(K.keypair,t),await K.dbAdd("transactions",{type:"deposit",amount:n,timestamp:Date.now()}),Z(`Deposited ${n} DCT successfully!`),await Promise.all([hi(),di(),fi()])}catch(e){console.error("deposit failed:",e),Z(`Deposit failed: ${e.message}`,!0)}}async function XE(n){if(!es()){Z("Please sign in to withdraw.");return}try{if(!K)throw new Error("DHT not initialized");if(!n||n<=0)throw new Error("Invalid withdrawal amount");const e=await K.getBalance(K.keypair);if(e<n)throw new Error("Insufficient balance");await K.putBalance(K.keypair,e-n),await K.dbAdd("transactions",{type:"withdraw",amount:n,timestamp:Date.now()}),Z(`Withdrew ${n} DCT successfully!`),await Promise.all([hi(),di(),fi()])}catch(e){console.error("withdraw failed:",e),Z(`Withdrawal failed: ${e.message}`,!0)}}async function JE(){console.log("signIn function called");try{Ne||(console.error("Firebase Auth is not initialized, initializing now..."),await E8());const n=new Bd,e=await Dd(Ne,n);console.log("Sign-in successful, user:",e.user)}catch(n){console.error("Login failed:",n),Z(`Login failed: ${n.message}`,!0)}}async function J2(){console.log("signOutUser function called");try{localStorage.getItem("role")==="node"?(localStorage.removeItem("nodeId"),localStorage.removeItem("role"),Z("Node signed out successfully!")):(await V8(Ne),Z("Signed out successfully!")),K&&(K.destroy(),K=null,window.dht=null);const t=(await al()).transaction("store","readwrite").objectStore("store");await new Promise((r,s)=>{const i=t.delete("dcrypt_identity");i.onsuccess=()=>{console.log("Successfully deleted keypair from IndexedDB"),r()},i.onerror=()=>{console.error("Failed to delete keypair from IndexedDB:",i.error),s(new Error("Failed to delete keypair from IndexedDB"))}}),jr=0,xs()}catch(n){console.error("Sign-out failed:",n),Z(`Sign-out failed: ${n.message}`,!0)}}async function eC(n,e,t,r,s){var i,o;if(!es()){Z("Please sign in to publish.");return}try{if(!K)throw new Error("DHT not initialized");if(!n)throw new Error("Title is required");let a=r||"",c="text/plain";if((i=s==null?void 0:s.files)!=null&&i.length){const v=s.files[0];c=v.type||"application/octet-stream",a=await new Promise((b,x)=>{const E=new FileReader;E.onload=C=>b(new Uint8Array(C.target.result)),E.onerror=()=>x(new Error("Failed to read file")),E.readAsArrayBuffer(v)})}else a=new TextEncoder().encode(a);const l=document.getElementById("modalPremium").checked,u=document.getElementById("modalPriceInput"),d=l&&u&&parseFloat(u.value)||0,h={content_type:c,title:n,description:e||"",tags:t?t.split(",").map(v=>v.trim()).filter(v=>v.length>0):[],isPremium:l,priceUsd:d},g=await K.publishIP(h,a,c),p=((o=Ne.currentUser)==null?void 0:o.uid)||localStorage.getItem("nodeId"),m=Ft(Xe,"snippets",g),y={ipHash:g,title:n,description:e||"",tags:h.tags,isPremium:l,priceUsd:d,flagCount:0,likes:0,dislikes:0,createdAt:Date.now(),creatorId:p};console.log("Saving snippet to Firestore: ",y),await jn(m,y,{merge:!0});const w=Ft(Xe,"users",p);await Es(w,{snippetsPosted:eo(1)}),Z("Snippet published successfully!"),window.closePublishModal(),await Promise.all([aa(),ol(),hi(),di(),fi(),S8(p)])}catch(a){throw console.error("publishSnippet failed:",a),Z(`Publish failed: ${a.message}`,!0),a}}async function _8(n){if(!es())return Z("Please sign in to buy."),null;try{if(!K)throw new Error("DHT not initialized");if(!n)throw new Error("Hash is required");let e=await K.getIPmetadata(n);console.log("IP Object:",e);const s=(e.metadata.isPremium||!1)&&e.metadata.priceUsd||0;if(s>0){const c=await K.getBalance(K.keypair);if(c<s)throw new Error("Insufficient balance");const l=s*.05;await K.distributeCommission(l),await K.putBalance(K.keypair,c-s),await K.dbAdd("transactions",{type:"buy",amount:s,timestamp:Date.now()})}else console.log("This snippet is free!"),await K.dbAdd("transactions",{type:"buy",amount:0,timestamp:Date.now()});const{data:i,fileType:o}=await K.requestData(e);Z("Snippet retrieved successfully!"),await Promise.all([hi(),di(),fi(),ol()]);const a=prompt('Do you like this snippet? Type "like" or "dislike":');if(a!==null){const c=a.trim().toLowerCase();c==="like"||c==="dislike"?(await rC(n,c),Z(`You ${c}d this snippet!`),await aa()):Z('Invalid input. Please type "like" or "dislike".',!0)}return jE(i,o,e.metadata.title||e.metadata.content_type),{data:i,fileType:o}}catch(e){return console.error("buySnippet failed:",e),Z(`Purchase failed: ${e.message}`,!0),null}}async function tC(n){var r;const e=n||((r=document.getElementById("buyHashInput"))==null?void 0:r.value.trim());if(!e){Z("Please enter a valid hash.",!0);return}await _8(e)&&Z("Snippet purchased and displayed below!")}async function rC(n,e){var r;const t=((r=Ne.currentUser)==null?void 0:r.uid)||localStorage.getItem("nodeId");if(t)try{const s=Ft(Xe,"snippets",n,"feedback",t);await jn(s,{action:e,timestamp:Date.now()});const i=Ft(Xe,"snippets",n);e==="like"?await Es(i,{likes:eo(1)}):e==="dislike"&&await Es(i,{dislikes:eo(1)})}catch(s){console.error("Failed to submit feedback:",s),Z(`Failed to submit feedback: ${s.message}`,!0)}}async function nC(n){var t;if(!(((t=Ne.currentUser)==null?void 0:t.uid)||localStorage.getItem("nodeId"))){Z("Please sign in to flag content.");return}try{const r=Ft(Xe,"snippets",n);await Es(r,{flagCount:eo(1)}),((await Oc(r)).data().flagCount||0)>=3?(await Es(r,{reviewStatus:"under_review"}),Z("Snippet has been flagged and is under review."),await aa()):Z("Snippet flagged. It will be reviewed if flagged by more users.")}catch(r){console.error("Failed to flag snippet:",r),Z(`Failed to flag snippet: ${r.message}`,!0)}}async function sC(){const n=HE();console.log("Generated nodeId:",n),localStorage.setItem("nodeId",n),localStorage.setItem("role","node");const e=Ft(Xe,"nodes",n);if(await jn(e,{role:"node",createdAt:Date.now(),status:"active"},{merge:!0}),console.log("Node registered in Firestore:",n),!window.location.pathname.includes("node-instructions.html")){console.log("Redirecting to node-instructions.html for node role"),window.location.href="/datasharingApp/node-instructions.html";return}}async function iC(){try{const n=localStorage.getItem("nodeId"),e=localStorage.getItem("role");if(localStorage.removeItem("nodeId"),localStorage.removeItem("role"),sessionStorage.setItem("nodeId",n),sessionStorage.setItem("role",e),console.log("Moved to session storage"),e!=="node"||!n){Z("You must be signed in as a node to view this page."),window.location.href="/datasharingApp/signup.html";return}const t=w8(new TextEncoder().encode(CryptoJS.SHA256(n).toString(CryptoJS.enc.Hex).substring(0,40)));K=new v8(t,!0),window.dht=K,await K.initDB(),await K.initSwarm(),await K.syncUserData();const s=(await K.dbGetAll("transactions")).filter(o=>o.type==="commission").reduce((o,a)=>o+(a.amount||0),0),i=document.getElementById("nodeEarnings");i&&(i.textContent=`Total Earnings: ${s.toFixed(2)} DCT`)}catch(n){console.error("Error initializing node instructions:",n),Z(`Initialization failed: ${n.message}`,!0)}}async function S8(n){if(n)try{const e=Ft(Xe,"users",n),t=await Oc(e);if(t.exists()){const r=t.data(),s=document.getElementById("userName"),i=document.querySelector(".user-avatar"),o=document.getElementById("snippetsPosted");s&&(s.textContent=r.username||"Anonymous User"),i&&(r.profileImageUrl?i.innerHTML=`<img src="${r.profileImageUrl}" alt="Profile Image" class="w-12 h-12 rounded-full object-cover">`:i.innerHTML='<i class="fas fa-user text-lg"></i>'),o&&(o.textContent=r.snippetsPosted||0)}}catch(e){console.error("Failed to fetch user profile:",e),Z("Failed to load user profile.",!0)}}async function oC(n){try{await navigator.clipboard.writeText(n),Z("Hash copied to clipboard!")}catch(e){console.error("Failed to copy hash:",e),Z("Failed to copy hash.",!0)}}document.addEventListener("DOMContentLoaded",async()=>{var r,s,i;if(console.log("DOMContentLoaded event fired"),console.log("Current pathname:",window.location.pathname),window.location.pathname.includes("signup")){const o=document.getElementById("userSignupForm");o&&o.addEventListener("submit",async a=>{a.preventDefault(),await window.handleSignup()})}window.location.pathname.includes("node")&&iC();try{await E8()}catch(o){console.error("Firebase initialization failed, aborting setup:",o),Z("Firebase initialization failed. Please check your configuration.",!0);return}const n=localStorage.getItem("role"),e=localStorage.getItem("nodeId"),t=!(window.location.pathname.includes("node")||window.location.pathname.includes("signup.html")||window.location.pathname.includes("publish"));if(t&&n==="node"&&e&&(console.log("Node detected on index.html, redirecting to node-instructions.html"),window.location.href="/datasharingApp/node-instructions.html"),t||window.location.pathname.includes("publish")){const o=await al(),a=await C8(o);try{await Promise.all([new Promise(c=>{wl(Ne,async l=>{if(console.log("onAuthStateChanged triggered"),l)console.log("User is signed in:",l.uid),await X2(l.uid,o);else{console.log("No user is signed in. Checking IndexedDB for keypair...");try{a?(console.log("Found keypair in IndexedDB, initializing app..."),await X2(a,o)):(console.log("No keypair found in IndexedDB."),t&&xs())}catch(u){console.error("Failed to initialize IndexedDB or load keypair:",u),t&&xs()}}c()},l=>{console.error("onAuthStateChanged error:",l),Z("Failed to monitor authentication state.",!0),c()})})])}catch(c){console.error("Initialization error:",c),Z("An error occurred during initialization.",!0)}}if(t){const o={signupButton:document.getElementById("signupButton"),loginButton:document.getElementById("loginButton"),logoutButton:document.getElementById("logoutButton"),userBalanceElement:document.getElementById("userBalance"),searchButton:document.getElementById("searchButton"),depositButton:document.getElementById("depositButton"),withdrawButton:document.getElementById("withdrawButton"),toggleHistoryButton:document.getElementById("toggleHistoryButton"),transactionHistory:document.getElementById("transactionHistory"),publishedItemsTableBody:(r=document.getElementById("publishedItems"))==null?void 0:r.querySelector("tbody"),buyHashButton:document.getElementById("buyHashButton")};console.log("On index.html, setting up UI and event listeners"),n==="node"&&e&&(Xi=!0,console.log("Node detected, but should have been redirected already.")),(s=o.loginButton)==null||s.addEventListener("click",c=>{c.preventDefault(),console.log("Login button clicked"),JE()}),(i=o.logoutButton)==null||i.addEventListener("click",c=>{c.preventDefault(),console.log("Logout button clicked"),J2()}),wl(Ne,c=>{var l,u,d,h,g,p;c?((l=o.signupButton)==null||l.classList.add("hidden"),(u=o.loginButton)==null||u.classList.add("hidden"),(d=o.logoutButton)==null||d.classList.remove("hidden"),o.searchButton.disabled=!1,o.depositButton.disabled=!1,o.withdrawButton.disabled=!1,o.toggleHistoryButton.disabled=!1,o.buyHashButton.disabled=!1):((h=o.signupButton)==null||h.classList.remove("hidden"),(g=o.loginButton)==null||g.classList.remove("hidden"),(p=o.logoutButton)==null||p.classList.add("hidden"),o.searchButton.disabled=!0,o.depositButton.disabled=!0,o.withdrawButton.disabled=!0,o.toggleHistoryButton.disabled=!0,o.buyHashButton.disabled=!0,xs())});const a=document.getElementById("publishForm");a&&a.addEventListener("submit",async c=>{c.preventDefault();const l=document.getElementById("modalTitleInput").value,u=document.getElementById("modalDescriptionInput").value,d=document.getElementById("modalTagsInput").value,h=document.getElementById("modalContentInput").value,g=document.getElementById("modalFileInput");await window.publishSnippet(l,u,d,h,g)})}else console.log("Not on index.html, skipping index.html-specific setup");window.logout=J2,window.publishSnippet=eC,window.buySnippet=_8,window.buySnippetByHash=tC,window.toggleTransactionHistory=KE,window.flagSnippet=nC,window.handleSignup=YE,window.becomeNode=sC,window.deposit=ZE,window.withdraw=XE,window.redirectToPublish=zE,window.searchSnippets=VE,window.copyHash=oC,window.openBuyModal=qE});
