var ky=Object.defineProperty;var N2=n=>{throw TypeError(n)};var Py=(n,e,t)=>e in n?ky(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var p=(n,e,t)=>Py(n,typeof e!="symbol"?e+"":e,t),Y0=(n,e,t)=>e.has(n)||N2("Cannot "+t);var X=(n,e,t)=>(Y0(n,e,"read from private field"),t?t.call(n):e.get(n)),ke=(n,e,t)=>e.has(n)?N2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),$e=(n,e,t,r)=>(Y0(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),Ie=(n,e,t)=>(Y0(n,e,"access private method"),t);var vo=(n,e,t,r)=>({set _(s){$e(n,e,s,t)},get _(){return X(n,e,r)}});import{getAuth as Dy,onAuthStateChanged as L2,setPersistence as Ry,browserLocalPersistence as By,GoogleAuthProvider as Y6,signInWithPopup as X6,signOut as Fy}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";import{getFirestore as Ny,doc as Dr,setDoc as Hi,updateDoc as zo,increment as ol,getDoc as nd,getDocs as Rh,query as al,collection as cl,where as Bh,onSnapshot as Ly}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";import{getStorage as My}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js";import{initializeApp as Oy}from"https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";function Vy(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(n,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Uy="modulepreload",$y=function(n){return"/datasharingApp/"+n},M2={},Hy=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(c=>{if(c=$y(c),c in M2)return;M2[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":Uy,l||(d.as="script"),d.crossOrigin="",d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),l)return new Promise((f,m)=>{d.addEventListener("load",f),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};class qy{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return zy(e).buffer}}function zy(n){let e=0;for(const s of n)e+=s.byteLength;const t=new Uint8Array(e);let r=0;for(const s of n){const i=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);t.set(i,r),r+=s.byteLength}return t}function J6(n){return new Ky(n).unpack()}function Z6(n){const e=new jy,t=e.pack(n);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class Ky{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let r=0,s="",i,o;for(;r<e;)i=t[r],i<160?(o=i,r++):(i^192)<32?(o=(i&31)<<6|t[r+1]&63,r+=2):(i^224)<16?(o=(i&15)<<12|(t[r+1]&63)<<6|t[r+2]&63,r+=3):(o=(i&7)<<18|(t[r+1]&63)<<12|(t[r+2]&63)<<6|t[r+3]&63,r+=4),s+=String.fromCodePoint(o);return this.index+=e,s}unpack_array(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){const t={};for(let r=0;r<e;r++){const s=this.unpack();t[s]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(t===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,o=(e&1048575|1048576)*2**(s-20)+t*2**(s-52);return(r===0?1:-1)*o}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class jy{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const r=s=>{if(s<t){const i=this.pack(e[s]);return i instanceof Promise?i.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,i=Math.floor(s*2**52),o=2**32,a=t<<31|r+1023<<20|i/o&1048575,c=i%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(c)}pack_object(e){const t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=i=>{if(i<t.length){const o=t[i];if(e.hasOwnProperty(o)){this.pack(o);const a=this.pack(e[o]);if(a instanceof Promise)return a.then(()=>s(i+1))}return s(i+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new qy,this._textEncoder=new TextEncoder}}let e8=!0,t8=!0;function Nc(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseInt(r[t],10)}function Fs(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return s.apply(this,arguments);const c=l=>{const u=t(l);u&&(a.handleEvent?a.handleEvent(u):a(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),s.apply(this,[o,c])};const i=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return i.apply(this,arguments);if(!this._eventMap[e].has(a))return i.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,i.apply(this,[o,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function Gy(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(e8=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function Wy(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(t8=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function r8(){if(typeof window=="object"){if(e8)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function sd(n,e){t8&&console.warn(n+" is deprecated, please use "+e+" instead.")}function Qy(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=Nc(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=Nc(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Nc(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function O2(n){return Object.prototype.toString.call(n)==="[object Object]"}function n8(n){return O2(n)?Object.keys(n).reduce(function(e,t){const r=O2(n[t]),s=r?n8(n[t]):n[t],i=r&&!Object.keys(s).length;return s===void 0||i?e:Object.assign(e,{[t]:s})},{}):n}function Fh(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?Fh(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(s=>{Fh(n,n.get(s),t)})}))}function V2(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const i=[];return n.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&i.push(o)}),i.forEach(o=>{n.forEach(a=>{a.type===r&&a.trackId===o.id&&Fh(n,a,s)})}),s}const U2=r8;function s8(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const c={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const u=typeof a[l]=="object"?a[l]:{ideal:a[l]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,m){return f?f+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",l)]=u.ideal,c.optional.push(f),f={},f[d("max",l)]=u.ideal,c.optional.push(f)):(f[d("",l)]=u.ideal,c.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[d("",l)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[d(f,l)]=u[f])})}),a.advanced&&(c.optional=(c.optional||[]).concat(a.advanced)),c},s=function(a,c){if(e.version>=61)return c(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=r(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const u=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete a.video.facingMode;let d;if(l.exact==="environment"||l.ideal==="environment"?d=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(d=["front"]),d)return t.mediaDevices.enumerateDevices().then(f=>{f=f.filter(y=>y.kind==="videoinput");let m=f.find(y=>d.some(b=>y.label.toLowerCase().includes(b)));return!m&&f.length&&d.includes("back")&&(m=f[f.length-1]),m&&(a.video.deviceId=l.exact?{exact:m.deviceId}:{ideal:m.deviceId}),a.video=r(a.video),U2("chrome: "+JSON.stringify(a)),c(a)})}a.video=r(a.video)}return U2("chrome: "+JSON.stringify(a)),c(a)},i=function(a){return e.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,c,l){s(a,u=>{t.webkitGetUserMedia(u,c,d=>{l&&l(i(d))})})};if(t.getUserMedia=o.bind(t),t.mediaDevices.getUserMedia){const a=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return s(c,l=>a(l).then(u=>{if(l.audio&&!u.getAudioTracks().length||l.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(i(u))))}}}function i8(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function o8(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let i;n.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.track.id):i={track:s.track};const o=new Event("track");o.track=s.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(s=>{let i;n.RTCPeerConnection.prototype.getReceivers?i=this.getReceivers().find(a=>a.track&&a.track.id===s.id):i={track:s};const o=new Event("track");o.track=s,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Fs(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function a8(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(s,i){return{track:i,get dtmf(){return this._dtmf===void 0&&(i.kind==="audio"?this._dtmf=s.createDTMFSender(i):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,c){let l=s.apply(this,arguments);return l||(l=e(this,a),this._senders.push(l)),l};const i=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){i.apply(this,arguments);const c=this._senders.indexOf(a);c!==-1&&this._senders.splice(c,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],t.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const a=this._senders.find(c=>c.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function c8(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),n.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>V2(o,i.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(i=>i._pc=this),s}),Fs(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(i=>V2(i,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let s,i,o;return this.getSenders().forEach(a=>{a.track===r&&(s?o=!0:s=a)}),this.getReceivers().forEach(a=>(a.track===r&&(i?o=!0:i=a),a.track===r)),o||s&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function l8(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(c)===-1&&this._shimmedLocalStreams[a.id].push(c):this._shimmedLocalStreams[a.id]=[a,c],c};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(d=>d.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(c)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const c=this._shimmedLocalStreams[a].indexOf(o);c!==-1&&this._shimmedLocalStreams[a].splice(c,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),s.apply(this,arguments)}}function u8(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return l8(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(d=>this._reverseStreams[d.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(d=>{if(this.getSenders().find(m=>m.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const d=new n.MediaStream(u.getTracks());this._streams[u.id]=d,this._reverseStreams[d.id]=u,u=d}r.apply(this,[u])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(b=>b===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(b=>b.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const y=this._streams[d.id];if(y)y.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const b=new n.MediaStream([u]);this._streams[d.id]=b,this._reverseStreams[b.id]=d,this.addStream(b)}return this.getSenders().find(b=>b.track===u)};function i(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const m=l._reverseStreams[f],y=l._streams[m.id];d=d.replace(new RegExp(y.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:d})}function o(l,u){let d=u.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const m=l._reverseStreams[f],y=l._streams[m.id];d=d.replace(new RegExp(m.id,"g"),y.id)}),new RTCSessionDescription({type:u.type,sdp:d})}["createOffer","createAnswer"].forEach(function(l){const u=n.RTCPeerConnection.prototype[l],d={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[y=>{const b=i(this,y);f[0].apply(null,[b])},y=>{f[1]&&f[1].apply(null,y)},arguments[2]]):u.apply(this,arguments).then(y=>i(this,y))}};n.RTCPeerConnection.prototype[l]=d[l]});const a=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const l=c.get.apply(this);return l.type===""?l:i(this,l)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(b=>u.track===b)&&(f=this._streams[m])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Nh(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=s[t]})}function h8(n,e){Fs(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}const $2=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:h8,shimAddTrackRemoveTrack:u8,shimAddTrackRemoveTrackWithNative:l8,shimGetSendersWithDtmf:a8,shimGetUserMedia:s8,shimMediaStream:i8,shimOnTrack:o8,shimPeerConnection:Nh,shimSenderReceiverGetStats:c8},Symbol.toStringTag,{value:"Module"}));function d8(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(s,i,o){sd("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(s).then(i,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const s=function(o,a,c){a in o&&!(c in o)&&(o[c]=o[a],delete o[a])},i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),s(o.audio,"autoGainControl","mozAutoGainControl"),s(o.audio,"noiseSuppression","mozNoiseSuppression")),i(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return s(a,"mozAutoGainControl","autoGainControl"),s(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a,"autoGainControl","mozAutoGainControl"),s(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function Yy(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function f8(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Lh(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=n.RTCPeerConnection.prototype[s],o={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=o[s]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[i,o,a]=arguments;return r.apply(this,[i||null]).then(c=>{if(e.version<53&&!o)try{c.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;c.forEach((u,d)=>{c.set(d,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(o,a)}}function p8(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(i=>i._pc=this),s});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function g8(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Fs(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function m8(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){sd("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function y8(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function x8(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(s){const{sender:o}=i,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function v8(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function b8(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function w8(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const H2=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:x8,shimCreateAnswer:w8,shimCreateOffer:b8,shimGetDisplayMedia:Yy,shimGetParameters:v8,shimGetUserMedia:d8,shimOnTrack:f8,shimPeerConnection:Lh,shimRTCDataChannel:y8,shimReceiverGetStats:g8,shimRemoveStream:m8,shimSenderGetStats:p8},Symbol.toStringTag,{value:"Module"}));function _8(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(i=>{this._localStreams?this._localStreams.includes(i)||this._localStreams.push(i):this._localStreams=[i]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const s=t.getTracks();this.getSenders().forEach(i=>{s.includes(i.track)&&this.removeTrack(i)})})}}function E8(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const i=new Event("addstream");i.stream=s,this.dispatchEvent(i)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),e.apply(r,arguments)}}}function A8(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=t.apply(this,[d]);return u?(f.then(l,u),Promise.resolve()):f},e.createAnswer=function(l,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[d]);return u?(f.then(l,u),Promise.resolve()):f};let a=function(c,l,u){const d=s.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d};e.setLocalDescription=a,a=function(c,l,u){const d=i.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.setRemoteDescription=a,a=function(c,l,u){const d=o.apply(this,[c]);return u?(d.then(l,u),Promise.resolve()):d},e.addIceCandidate=a}function C8(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=s=>r(S8(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,i){e.mediaDevices.getUserMedia(r).then(s,i)}).bind(e))}function S8(n){return n&&n.video!==void 0?Object.assign({},n,{video:n8(n.video)}):n}function T8(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const i=[];for(let o=0;o<r.iceServers.length;o++){let a=r.iceServers[o];a.urls===void 0&&a.url?(sd("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(r.iceServers[o])}r.iceServers=i}return new e(r,s)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function I8(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function k8(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo===!0&&!i&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function P8(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const q2=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:P8,shimCallbacksAPI:A8,shimConstraints:S8,shimCreateOfferLegacy:k8,shimGetUserMedia:C8,shimLocalStreamsAPI:_8,shimRTCIceServerUrls:T8,shimRemoteStreamsAPI:E8,shimTrackEventTransceiver:I8},Symbol.toStringTag,{value:"Module"}));var fe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qi(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Xy(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}),t}var D8={exports:{}};(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((s,i)=>(i>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let i=8;i<r.length;i+=2)switch(r[i]){case"raddr":s.relatedAddress=r[i+1];break;case"rport":s.relatedPort=parseInt(r[i+1],10);break;case"tcptype":s.tcpType=r[i+1];break;case"ufrag":s.ufrag=r[i+1],s.usernameFragment=r[i+1];break;default:s[r[i]]===void 0&&(s[r[i]]=r[i+1]);break}return s},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const s=t.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const i=t.type;return r.push("typ"),r.push(i),i!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const s=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let s;const i=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<i.length;o++)s=i[o].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(t){let r="",s=t.payloadType;if(t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const i=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?i.push(o+"="+t.parameters[o]):i.push(o)}),r+="a=fmtp:"+s+" "+i.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",s=t.payloadType;return t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(i=>{r+="a=rtcp-fb:"+s+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),s={ssrc:parseInt(t.substring(7,r),10)},i=t.indexOf(":",r);return i>-1?(s.attribute=t.substring(r+1,i),s.value=t.substring(i+1)):s.attribute=t.substring(r+1),s},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let s="a=setup:"+r+`\r
`;return t.fingerprints.forEach(i=>{s+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),s},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const s=e.matchPrefix(t+r,"a=ice-ufrag:")[0],i=e.matchPrefix(t+r,"a=ice-pwd:")[0];return s&&i?{usernameFragment:s.substring(12),password:i.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(t)[0].split(" ");r.profile=i[2];for(let a=3;a<i.length;a++){const c=i[a],l=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(l){const u=e.parseRtpMap(l),d=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(a=>{r.headerExtensions.push(e.parseExtmap(a))});const o=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(a=>{o.forEach(c=>{a.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||a.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(t,r){let s="";s+="m="+t+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{s+=e.writeRtpMap(o),s+=e.writeFmtp(o),s+=e.writeRtcpFb(o)});let i=0;return r.codecs.forEach(o=>{o.maxptime>i&&(i=o.maxptime)}),i>0&&(s+="a=maxptime:"+i+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{s+=e.writeExtmap(o)}),s},e.parseRtpEncodingParameters=function(t){const r=[],s=e.parseRtpParameters(t),i=s.fecMechanisms.indexOf("RED")!==-1,o=s.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(t,"a=ssrc:").map(f=>e.parseSsrcMedia(f)).filter(f=>f.attribute==="cname"),c=a.length>0&&a[0].ssrc;let l;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(f=>f.substring(17).split(" ").map(y=>parseInt(y,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(l=u[0][1]),s.codecs.forEach(f=>{if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(f.parameters.apt,10)};c&&l&&(m.rtx={ssrc:l}),r.push(m),i&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(m))}}),r.length===0&&c&&r.push({ssrc:c});let d=e.matchPrefix(t,"b=");return d.length&&(d[0].indexOf("b=TIAS:")===0?d=parseInt(d[0].substring(7),10):d[0].indexOf("b=AS:")===0?d=parseInt(d[0].substring(5),10)*1e3*.95-50*40*8:d=void 0,r.forEach(f=>{f.maxBitrate=d})),r},e.parseRtcpParameters=function(t){const r={},s=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const i=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;const o=e.matchPrefix(t,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const s=e.matchPrefix(t,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const i=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),s=e.matchPrefix(t,"a=max-message-size:");let i;s.length>0&&(i=parseInt(s[0].substring(19),10)),isNaN(i)&&(i=65536);const o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:i};const a=e.matchPrefix(t,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:i}}},e.writeSctpDescription=function(t,r){let s=[];return t.protocol!=="DTLS/SCTP"?s=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,s){let i;const o=r!==void 0?r:2;return t?i=t:i=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+i+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const s=e.splitLines(t);for(let i=0;i<s.length;i++)switch(s[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[i].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const s=e.splitLines(t)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(t){const s=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},n.exports=e})(D8);var R8=D8.exports;const li=qi(R8),Jy=Vy({__proto__:null,default:li},[R8]);function Lc(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),i=li.parseCandidate(r.candidate);for(const o in i)o in s||Object.defineProperty(s,o,{value:i[o]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,Fs(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function Mh(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Fs(n,"icecandidate",e=>{if(e.candidate){const t=li.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function Mc(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(a){if(!a||!a.sdp)return!1;const c=li.splitSections(a.sdp);return c.shift(),c.some(l=>{const u=li.parseMLine(l);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const l=parseInt(c[1],10);return l!==l?-1:l},s=function(a){let c=65536;return e.browser==="firefox"&&(e.version<57?a===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},i=function(a,c){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const u=li.matchPrefix(a.sdp,"a=max-message-size:");return u.length>0?l=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(l=2147483637),l},o=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=r(arguments[0]),l=s(c),u=i(arguments[0],c);let d;l===0&&u===0?d=Number.POSITIVE_INFINITY:l===0||u===0?d=Math.max(l,u):d=Math.min(l,u);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return d}}),this._sctp=f}return o.apply(this,arguments)}}function Oc(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,s){const i=r.send;r.send=function(){const a=arguments[0],c=a.length||a.size||a.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return i.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=t.apply(this,arguments);return e(s,this),s},Fs(n,"datachannel",r=>(e(r.channel,r.target),r))}function Oh(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const i=s.target;if(i._lastConnectionState!==i.connectionState){i._lastConnectionState=i.connectionState;const o=new Event("connectionstatechange",s);i.dispatchEvent(o)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Vh(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=s.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:i}):s.sdp=i}return t.apply(this,arguments)}}function Vc(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Uc(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return t.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?t.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>t.apply(this,[o]))})}const Zy=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Vh,shimAddIceCandidateNullOrEmpty:Vc,shimConnectionState:Oh,shimMaxMessageSize:Mc,shimParameterlessSetLocalDescription:Uc,shimRTCIceCandidate:Lc,shimRTCIceCandidateRelayProtocol:Mh,shimSendThrowTypeError:Oc},Symbol.toStringTag,{value:"Module"}));function ex({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=r8,r=Qy(n),s={browserDetails:r,commonShim:Zy,extractVersion:Nc,disableLog:Gy,disableWarnings:Wy,sdp:Jy};switch(r.browser){case"chrome":if(!$2||!Nh||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=$2,Vc(n,r),Uc(n),s8(n,r),i8(n),Nh(n,r),o8(n),u8(n,r),a8(n),c8(n),h8(n,r),Lc(n),Mh(n),Oh(n),Mc(n,r),Oc(n),Vh(n,r);break;case"firefox":if(!H2||!Lh||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=H2,Vc(n,r),Uc(n),d8(n,r),Lh(n,r),f8(n),m8(n),p8(n),g8(n),y8(n),x8(n),v8(n),b8(n),w8(n),Lc(n),Oh(n),Mc(n,r),Oc(n);break;case"safari":if(!q2||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=q2,Vc(n,r),Uc(n),T8(n),k8(n),A8(n),_8(n),E8(n),I8(n),C8(n),P8(n),Lc(n),Mh(n),Mc(n,r),Oc(n),Vh(n,r);break;default:t("Unsupported browser!");break}return s}const z2=ex({window:typeof window>"u"?void 0:window});function Ns(n,e,t,r){Object.defineProperty(n,e,{get:t,set:r,enumerable:!0,configurable:!0})}class B8{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let i=0,o=0;for(;o<r;){const a=Math.min(r,o+this.chunkedMTU),c=e.slice(o,a),l={__peerData:this._dataCount,n:i,data:c,total:s};t.push(l),o=a,i++}return this._dataCount++,t}}}function tx(n){let e=0;for(const s of n)e+=s.byteLength;const t=new Uint8Array(e);let r=0;for(const s of n)t.set(s,r),r+=s.byteLength;return t}const X0=z2.default||z2,bo=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const n=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(n)?n==="chrome"?e>=this.minChromeVersion:n==="firefox"?e>=this.minFirefoxVersion:n==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return X0.browserDetails.browser}getVersion(){return X0.browserDetails.version||0}isUnifiedPlanSupported(){const n=this.getBrowser(),e=X0.browserDetails.version||0;if(n==="chrome"&&e<this.minChromeVersion)return!1;if(n==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,r=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),r=!0}catch{}finally{t&&t.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},rx=n=>!n||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(n),F8=()=>Math.random().toString(36).slice(2),K2={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class nx extends B8{noop(){}blobToArrayBuffer(e,t){const r=new FileReader;return r.onload=function(s){s.target&&t(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=K2,this.browser=bo.getBrowser(),this.browserVersion=bo.getVersion(),this.pack=Z6,this.unpack=J6,this.supports=function(){const t={browser:bo.isBrowserSupported(),webRTC:bo.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let r;try{r=new RTCPeerConnection(K2),t.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!s.ordered;try{s.binaryType="blob",t.binaryBlob=!bo.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return t}(),this.validateId=rx,this.randomToken=F8}}const er=new nx,sx="PeerJS: ";var j2;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(j2||(j2={}));class ix{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const r=[sx,...t];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var te=new ix,id={},ox=Object.prototype.hasOwnProperty,Wt="~";function Ko(){}Object.create&&(Ko.prototype=Object.create(null),new Ko().__proto__||(Wt=!1));function ax(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function N8(n,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var i=new ax(t,r||n,s),o=Wt?Wt+e:e;return n._events[o]?n._events[o].fn?n._events[o]=[n._events[o],i]:n._events[o].push(i):(n._events[o]=i,n._eventsCount++),n}function $c(n,e){--n._eventsCount===0?n._events=new Ko:delete n._events[e]}function Ht(){this._events=new Ko,this._eventsCount=0}Ht.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)ox.call(t,r)&&e.push(Wt?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};Ht.prototype.listeners=function(e){var t=Wt?Wt+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,i=r.length,o=new Array(i);s<i;s++)o[s]=r[s].fn;return o};Ht.prototype.listenerCount=function(e){var t=Wt?Wt+e:e,r=this._events[t];return r?r.fn?1:r.length:0};Ht.prototype.emit=function(e,t,r,s,i,o){var a=Wt?Wt+e:e;if(!this._events[a])return!1;var c=this._events[a],l=arguments.length,u,d;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),l){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,s),!0;case 5:return c.fn.call(c.context,t,r,s,i),!0;case 6:return c.fn.call(c.context,t,r,s,i,o),!0}for(d=1,u=new Array(l-1);d<l;d++)u[d-1]=arguments[d];c.fn.apply(c.context,u)}else{var f=c.length,m;for(d=0;d<f;d++)switch(c[d].once&&this.removeListener(e,c[d].fn,void 0,!0),l){case 1:c[d].fn.call(c[d].context);break;case 2:c[d].fn.call(c[d].context,t);break;case 3:c[d].fn.call(c[d].context,t,r);break;case 4:c[d].fn.call(c[d].context,t,r,s);break;default:if(!u)for(m=1,u=new Array(l-1);m<l;m++)u[m-1]=arguments[m];c[d].fn.apply(c[d].context,u)}}return!0};Ht.prototype.on=function(e,t,r){return N8(this,e,t,r,!1)};Ht.prototype.once=function(e,t,r){return N8(this,e,t,r,!0)};Ht.prototype.removeListener=function(e,t,r,s){var i=Wt?Wt+e:e;if(!this._events[i])return this;if(!t)return $c(this,i),this;var o=this._events[i];if(o.fn)o.fn===t&&(!s||o.once)&&(!r||o.context===r)&&$c(this,i);else{for(var a=0,c=[],l=o.length;a<l;a++)(o[a].fn!==t||s&&!o[a].once||r&&o[a].context!==r)&&c.push(o[a]);c.length?this._events[i]=c.length===1?c[0]:c:$c(this,i)}return this};Ht.prototype.removeAllListeners=function(e){var t;return e?(t=Wt?Wt+e:e,this._events[t]&&$c(this,t)):(this._events=new Ko,this._eventsCount=0),this};Ht.prototype.off=Ht.prototype.removeListener;Ht.prototype.addListener=Ht.prototype.on;Ht.prefixed=Wt;Ht.EventEmitter=Ht;id=Ht;var Ls={};Ns(Ls,"ConnectionType",()=>jr);Ns(Ls,"PeerErrorType",()=>Ze);Ns(Ls,"BaseConnectionErrorType",()=>jo);Ns(Ls,"DataConnectionErrorType",()=>Go);Ns(Ls,"SerializationType",()=>_i);Ns(Ls,"SocketEventType",()=>Kr);Ns(Ls,"ServerMessageType",()=>yt);var jr;(function(n){n.Data="data",n.Media="media"})(jr||(jr={}));var Ze;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(Ze||(Ze={}));var jo;(function(n){n.NegotiationFailed="negotiation-failed",n.ConnectionClosed="connection-closed"})(jo||(jo={}));var Go;(function(n){n.NotOpenYet="not-open-yet",n.MessageToBig="message-too-big"})(Go||(Go={}));var _i;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json",n.None="raw"})(_i||(_i={}));var Kr;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(Kr||(Kr={}));var yt;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(yt||(yt={}));var od={};od=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class cx extends id.EventEmitter{constructor(e,t,r,s,i,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=e?"wss://":"ws://";this._baseUrl=a+t+":"+r+s+"peerjs?key="+i}start(e,t){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+od.version),this._disconnected=!1,this._socket.onmessage=s=>{let i;try{i=JSON.parse(s.data),te.log("Server message received:",i)}catch{te.log("Invalid server message",s.data);return}this.emit(Kr.Message,i)},this._socket.onclose=s=>{this._disconnected||(te.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(Kr.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),te.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){te.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:yt.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(Kr.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class L8{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===jr.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const r=this.connection,s={ordered:!!e.reliable},i=t.createDataChannel(r.label,s);r._initializeDataChannel(i),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){te.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,i=this.connection.provider;te.log("Listening for ICE candidates."),e.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(te.log(`Received ICE candidates for ${t}:`,o.candidate),i.socket.send({type:yt.Candidate,payload:{candidate:o.candidate,type:s,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":te.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(jo.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":te.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(jo.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":te.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},te.log("Listening for data channel"),e.ondatachannel=o=>{te.log("Received data channel");const a=o.channel;i.getConnection(t,r)._initializeDataChannel(a)},te.log("Listening for remote stream"),e.ontrack=o=>{te.log("Received remote stream");const a=o.streams[0],c=i.getConnection(t,r);if(c.type===jr.Media){const l=c;this._addStreamToMediaConnection(a,l)}}}cleanup(){te.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(t||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);te.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),te.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===jr.Data){const i=this.connection;s={...s,label:i.label,reliable:i.reliable,serialization:i.serialization}}t.socket.send({type:yt.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(Ze.WebRTC,s),te.log("Failed to setLocalDescription, ",s))}}catch(r){t.emitError(Ze.WebRTC,r),te.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createAnswer();te.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),te.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:yt.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){t.emitError(Ze.WebRTC,s),te.log("Failed to setLocalDescription, ",s)}}catch(r){t.emitError(Ze.WebRTC,r),te.log("Failed to create answer, ",r)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const r=this.connection.peerConnection,s=this.connection.provider;te.log("Setting remote description",t);const i=this;try{await r.setRemoteDescription(t),te.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await i._makeAnswer()}catch(o){s.emitError(Ze.WebRTC,o),te.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(e){te.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),te.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(Ze.WebRTC,t),te.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(te.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return te.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){te.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class M8 extends id.EventEmitter{emitError(e,t){te.error("Error:",t),this.emit("error",new lx(`${e}`,t))}}class lx extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class O8 extends M8{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}var Z1;const Ho=class Ho extends O8{get type(){return jr.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Ho.ID_PREFIX+er.randomToken(),this._negotiator=new L8(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{te.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{te.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){te.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,r=e.payload;switch(e.type){case yt.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case yt.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:te.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){te.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Z1=new WeakMap,ke(Ho,Z1,Ho.ID_PREFIX="mc_");let ll=Ho;class ux{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:r,port:s,path:i,key:o}=this._options,a=new URL(`${t}://${r}:${s}${i}${o}/${e}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",od.version),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){te.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==er.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===er.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw te.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var ed,td;const gs=class gs extends O8{get type(){return jr.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||gs.ID_PREFIX+F8(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new L8(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{te.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{te.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{te.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(Go.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case yt.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case yt.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:te.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};ed=new WeakMap,td=new WeakMap,ke(gs,ed,gs.ID_PREFIX="dc_"),ke(gs,td,gs.MAX_BUFFERED_AMOUNT=8388608);let ul=gs;class ad extends ul{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>ul.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return te.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class J0 extends ad{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new B8,this.serialization=_i.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=J6(e),r=t.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];const s=tx(r.data);this._handleDataMessage({data:s})}}_send(e,t){const r=Z6(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);te.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const r of t)this.send(r,!0)}}class hx extends ad{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=_i.None}}class dx extends ad{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=er.chunkedMTU){this.emitError(Go.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=_i.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var rd;const qo=class qo extends M8{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:hx,json:dx,binary:J0,"binary-utf8":J0,default:J0},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:er.CLOUD_HOST,port:er.CLOUD_PORT,path:"/",key:qo.DEFAULT_KEY,token:er.randomToken(),config:er.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==er.CLOUD_HOST?this._options.secure=er.isSecure():this._options.host==er.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&te.setLogFunction(this._options.logFunction),te.logLevel=this._options.debug||0,this._api=new ux(t),this._socket=this._createServerConnection(),!er.supports.audioVideo&&!er.supports.data){this._delayedAbort(Ze.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!er.validateId(r)){this._delayedAbort(Ze.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(Ze.ServerError,s))}_createServerConnection(){const e=new cx(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(Kr.Message,t=>{this._handleMessage(t)}),e.on(Kr.Error,t=>{this._abort(Ze.SocketError,t)}),e.on(Kr.Disconnected,()=>{this.disconnected||(this.emitError(Ze.Network,"Lost connection to server."),this.disconnect())}),e.on(Kr.Close,()=>{this.disconnected||this._abort(Ze.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,r=e.payload,s=e.src;switch(t){case yt.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case yt.Error:this._abort(Ze.ServerError,r.msg);break;case yt.IdTaken:this._abort(Ze.UnavailableID,`ID "${this.id}" is taken`);break;case yt.InvalidKey:this._abort(Ze.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case yt.Leave:te.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case yt.Expire:this.emitError(Ze.PeerUnavailable,`Could not connect to peer ${s}`);break;case yt.Offer:{const i=r.connectionId;let o=this.getConnection(s,i);if(o&&(o.close(),te.warn(`Offer received for existing Connection ID:${i}`)),r.type===jr.Media){const c=new ll(s,this,{connectionId:i,_payload:r,metadata:r.metadata});o=c,this._addConnection(s,o),this.emit("call",c)}else if(r.type===jr.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:i,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});o=c,this._addConnection(s,o),this.emit("connection",c)}else{te.warn(`Received malformed connection type:${r.type}`);return}const a=this._getMessages(i);for(const c of a)o.handleMessage(c);break}default:{if(!r){te.warn(`You received a malformed message from ${s} of type ${t}`);return}const i=r.connectionId,o=this.getConnection(s,i);o&&o.peerConnection?o.handleMessage(e):i?this._storeMessage(i,e):te.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){te.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(Ze.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){te.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(Ze.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){te.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new ll(e,this,{...r,_stream:t});return this._addConnection(e,s),s}_addConnection(e,t){te.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const r=t.indexOf(e);r!==-1&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===t)return s;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){te.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(te.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const r of t)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;te.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)te.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)te.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(Ze.ServerError,t))}};rd=new WeakMap,ke(qo,rd,qo.DEFAULT_KEY="peerjs");let Uh=qo;var G2=Uh;const fx=Symbol.for("@libp2p/connection"),$h=Symbol.for("@libp2p/content-routing"),Hh=Symbol.for("@libp2p/peer-discovery"),cd=Symbol.for("@libp2p/peer-id");function V8(n){return!!(n!=null&&n[cd])}const qh=Symbol.for("@libp2p/peer-routing"),ld="keep-alive";var Wo;(function(n){n[n.FATAL_ALL=0]="FATAL_ALL",n[n.NO_FATAL=1]="NO_FATAL"})(Wo||(Wo={}));var kh;let Qo=(kh=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},p(kh,"name","AbortError"),kh);class pe extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}}p(pe,"name","InvalidParametersError");class Yo extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}p(Yo,"name","InvalidPublicKeyError");class U8 extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}p(U8,"name","ConnectionClosingError");class ud extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}p(ud,"name","ConnectionClosedError");var Ph;let Wn=(Ph=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},p(Ph,"name","NotFoundError"),Ph);class hd extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}p(hd,"name","InvalidPeerIdError");class Ql extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}}p(Ql,"name","InvalidMultiaddrError");class $8 extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}p($8,"name","InvalidCIDError");class H8 extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}p(H8,"name","InvalidMultihashError");class dd extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}p(dd,"name","UnsupportedProtocolError");class pn extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}p(pn,"name","InvalidMessageError");var Dh;let px=(Dh=class extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}},p(Dh,"name","TimeoutError"),Dh);class Xo extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}p(Xo,"name","NotStartedError");class Hc extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}p(Hc,"name","DialError");class fd extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}p(fd,"name","LimitedConnectionError");class q8 extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}p(q8,"name","TooManyInboundProtocolStreamsError");class z8 extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}p(z8,"name","TooManyOutboundProtocolStreamsError");class Yl extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}p(Yl,"name","UnsupportedKeyTypeError");var Hr;class gn extends EventTarget{constructor(){super();ke(this,Hr,new Map)}listenerCount(t){const r=X(this,Hr).get(t);return r==null?0:r.length}addEventListener(t,r,s){super.addEventListener(t,r,s);let i=X(this,Hr).get(t);i==null&&(i=[],X(this,Hr).set(t,i)),i.push({callback:r,once:(s!==!0&&s!==!1&&(s==null?void 0:s.once))??!1})}removeEventListener(t,r,s){super.removeEventListener(t.toString(),r??null,s);let i=X(this,Hr).get(t);i!=null&&(i=i.filter(({callback:o})=>o!==r),X(this,Hr).set(t,i))}dispatchEvent(t){const r=super.dispatchEvent(t);let s=X(this,Hr).get(t.type);return s==null||(s=s.filter(({once:i})=>!i),X(this,Hr).set(t.type,s)),r}safeDispatchEvent(t,r={}){return this.dispatchEvent(new CustomEvent(t,r))}}Hr=new WeakMap;function pd(n){return n!=null&&typeof n.start=="function"&&typeof n.stop=="function"}async function hl(...n){const e=[];for(const t of n)pd(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function gd(...n){const e=[];for(const t of n)pd(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const dl=Symbol.for("@libp2p/service-capabilities"),zh=Symbol.for("@libp2p/service-dependencies");function gx(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}function Xl(n){if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")}function mx(n){return new TextEncoder().encode(n)}function yx(n){return new TextDecoder().decode(n)}function xx(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<n.length;s++){var i=n.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=n.length,c=n.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function d(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var b=0,x=0,D=0,S=y.length;D!==S&&y[D]===0;)D++,b++;for(var _=(S-D)*u+1>>>0,E=new Uint8Array(_);D!==S;){for(var B=y[D],F=0,A=_-1;(B!==0||F<x)&&A!==-1;A--,F++)B+=256*E[A]>>>0,E[A]=B%a>>>0,B=B/a>>>0;if(B!==0)throw new Error("Non-zero carry");x=F,D++}for(var w=_-x;w!==_&&E[w]===0;)w++;for(var k=c.repeat(b);w<_;++w)k+=n.charAt(E[w]);return k}function f(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var b=0;if(y[b]!==" "){for(var x=0,D=0;y[b]===c;)x++,b++;for(var S=(y.length-b)*l+1>>>0,_=new Uint8Array(S);y[b];){var E=t[y.charCodeAt(b)];if(E===255)return;for(var B=0,F=S-1;(E!==0||B<D)&&F!==-1;F--,B++)E+=a*_[F]>>>0,_[F]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");D=B,b++}if(y[b]!==" "){for(var A=S-D;A!==S&&_[A]===0;)A++;for(var w=new Uint8Array(x+(S-A)),k=x;A!==S;)w[k++]=_[A++];return w}}}function m(y){var b=f(y);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:d,decodeUnsafe:f,decode:m}}var vx=xx,bx=vx;class wx{constructor(e,t,r){p(this,"name");p(this,"prefix");p(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class _x{constructor(e,t,r){p(this,"name");p(this,"prefix");p(this,"baseDecode");p(this,"prefixCodePoint");this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return K8(this,e)}}class Ex{constructor(e){p(this,"decoders");this.decoders=e}or(e){return K8(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r!=null)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function K8(n,e){return new Ex({...n.decoders??{[n.prefix]:n},...e.decoders??{[e.prefix]:e}})}class Ax{constructor(e,t,r,s){p(this,"name");p(this,"prefix");p(this,"baseEncode");p(this,"baseDecode");p(this,"encoder");p(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new wx(e,t,r),this.decoder=new _x(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function Jl({name:n,prefix:e,encode:t,decode:r}){return new Ax(n,e,t,r)}function Ta({name:n,prefix:e,alphabet:t}){const{encode:r,decode:s}=bx(t,n);return Jl({prefix:e,name:n,encode:r,decode:i=>Xl(s(i))})}function Cx(n,e,t,r){const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=n.length;for(;n[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const d=s[n[u]];if(d===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<t|d,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o}function Sx(n,e,t){const r=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<n.length;++c)for(a=a<<8|n[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),r)for(;i.length*t&7;)i+="=";return i}function kt({name:n,prefix:e,bitsPerChar:t,alphabet:r}){return Jl({prefix:e,name:n,encode(s){return Sx(s,r,t)},decode(s){return Cx(s,r,t,n)}})}const Ke=Ta({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Tx=Ta({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ix=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Ke,base58flickr:Tx},Symbol.toStringTag,{value:"Module"})),dn=kt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),kx=kt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Px=kt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Dx=kt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Rx=kt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Bx=kt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Fx=kt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Nx=kt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Lx=kt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Mx=Object.freeze(Object.defineProperty({__proto__:null,base32:dn,base32hex:Rx,base32hexpad:Fx,base32hexpadupper:Nx,base32hexupper:Bx,base32pad:Px,base32padupper:Dx,base32upper:kx,base32z:Lx},Symbol.toStringTag,{value:"Module"})),qc=Ta({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ox=Ta({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Vx=Object.freeze(Object.defineProperty({__proto__:null,base36:qc,base36upper:Ox},Symbol.toStringTag,{value:"Module"}));var Ux=j8,W2=128,$x=-128,Hx=Math.pow(2,31);function j8(n,e,t){e=e||[],t=t||0;for(var r=t;n>=Hx;)e[t++]=n&255|W2,n/=128;for(;n&$x;)e[t++]=n&255|W2,n>>>=7;return e[t]=n|0,j8.bytes=t-r+1,e}var qx=Kh,zx=128,Q2=127;function Kh(n,r){var t=0,r=r||0,s=0,i=r,o,a=n.length;do{if(i>=a)throw Kh.bytes=0,new RangeError("Could not decode varint");o=n[i++],t+=s<28?(o&Q2)<<s:(o&Q2)*Math.pow(2,s),s+=7}while(o>=zx);return Kh.bytes=i-r,t}var Kx=Math.pow(2,7),jx=Math.pow(2,14),Gx=Math.pow(2,21),Wx=Math.pow(2,28),Qx=Math.pow(2,35),Yx=Math.pow(2,42),Xx=Math.pow(2,49),Jx=Math.pow(2,56),Zx=Math.pow(2,63),ev=function(n){return n<Kx?1:n<jx?2:n<Gx?3:n<Wx?4:n<Qx?5:n<Yx?6:n<Xx?7:n<Jx?8:n<Zx?9:10},tv={encode:Ux,decode:qx,encodingLength:ev},fl=tv;function jh(n,e=0){return[fl.decode(n,e),fl.decode.bytes]}function pl(n,e,t=0){return fl.encode(n,e,t),e}function gl(n){return fl.encodingLength(n)}function Ss(n,e){const t=e.byteLength,r=gl(n),s=r+gl(t),i=new Uint8Array(s+t);return pl(n,i,0),pl(t,i,r),i.set(e,s),new md(n,t,e,i)}function cr(n){const e=Xl(n),[t,r]=jh(e),[s,i]=jh(e.subarray(r)),o=e.subarray(r+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new md(t,s,o,e)}function rv(n,e){if(n===e)return!0;{const t=e;return n.code===t.code&&n.size===t.size&&t.bytes instanceof Uint8Array&&gx(n.bytes,t.bytes)}}class md{constructor(e,t,r,s){p(this,"code");p(this,"size");p(this,"digest");p(this,"bytes");this.code=e,this.size=t,this.digest=r,this.bytes=s}}function Y2(n,e){const{bytes:t,version:r}=n;switch(r){case 0:return sv(t,Gh(n),e??Ke.encoder);default:return iv(t,Gh(n),e??dn.encoder)}}const X2=new WeakMap;function Gh(n){const e=X2.get(n);if(e==null){const t=new Map;return X2.set(n,t),t}return e}var _6;class Ce{constructor(e,t,r,s){p(this,"code");p(this,"version");p(this,"multihash");p(this,"bytes");p(this,"/");p(this,_6,"CID");this.code=t,this.version=e,this.multihash=r,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==wo)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==ov)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ce.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=Ss(e,t);return Ce.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ce.equals(this,e)}static equals(e,t){const r=t;return r!=null&&e.code===r.code&&e.version===r.version&&rv(e.multihash,r.multihash)}toString(e){return Y2(this,e)}toJSON(){return{"/":Y2(this)}}link(){return this}[(_6=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Ce)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:r,code:s,multihash:i,bytes:o}=t;return new Ce(r,s,i,o??J2(r,s,i.bytes))}else if(t[av]===!0){const{version:r,multihash:s,code:i}=t,o=cr(s);return Ce.create(r,i,o)}else return null}static create(e,t,r){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(r.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==wo)throw new Error(`Version 0 CID must use dag-pb (code: ${wo}) block encoding`);return new Ce(e,t,r,r.bytes)}case 1:{const s=J2(e,t,r.bytes);return new Ce(e,t,r,s)}default:throw new Error("Invalid version")}}static createV0(e){return Ce.create(0,wo,e)}static createV1(e,t){return Ce.create(1,e,t)}static decode(e){const[t,r]=Ce.decodeFirst(e);if(r.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ce.inspectBytes(e),r=t.size-t.multihashSize,s=Xl(e.subarray(r,r+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new md(t.multihashCode,t.digestSize,i,s);return[t.version===0?Ce.createV0(o):Ce.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[d,f]=jh(e.subarray(t));return t+=f,d};let s=r(),i=wo;if(s===18?(s=0,t=0):i=r(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=r(),c=r(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[r,s]=nv(e,t),i=Ce.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return Gh(i).set(r,e),i}}function nv(n,e){switch(n[0]){case"Q":{const t=e??Ke;return[Ke.prefix,t.decode(`${Ke.prefix}${n}`)]}case Ke.prefix:{const t=e??Ke;return[Ke.prefix,t.decode(n)]}case dn.prefix:{const t=e??dn;return[dn.prefix,t.decode(n)]}case qc.prefix:{const t=e??qc;return[qc.prefix,t.decode(n)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[n[0],e.decode(n)]}}}function sv(n,e,t){const{prefix:r}=t;if(r!==Ke.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(r);if(s==null){const i=t.encode(n).slice(1);return e.set(r,i),i}else return s}function iv(n,e,t){const{prefix:r}=t,s=e.get(r);if(s==null){const i=t.encode(n);return e.set(r,i),i}else return s}const wo=112,ov=18;function J2(n,e,t){const r=gl(n),s=r+gl(e),i=new Uint8Array(s+t.byteLength);return pl(n,i,0),pl(e,i,r),i.set(t,s),i}const av=Symbol.for("@ipld/js-cid/CID"),G8=0,cv="identity",W8=Xl;function lv(n){return Ss(G8,W8(n))}const Rr={code:G8,name:cv,encode:W8,digest:lv};function Ne(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}function lt(n=0){return new Uint8Array(n)}function Qr(n=0){return new Uint8Array(n)}function Er(n,e){e==null&&(e=n.reduce((s,i)=>s+i.length,0));const t=Qr(e);let r=0;for(const s of n)t.set(s,r),r+=s.length;return t}const Q8=Symbol.for("@achingbrain/uint8arraylist");function Z2(n,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const r of n){const s=t+r.byteLength;if(e<s)return{buf:r,index:e-t};t=s}throw new RangeError("index is out of bounds")}function hc(n){return!!(n!=null&&n[Q8])}var E6;class nt{constructor(...e){p(this,"bufs");p(this,"length");p(this,E6,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(E6=Q8,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const r of e)if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.push(r);else if(hc(r))t+=r.byteLength,this.bufs.push(...r.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const r of e.reverse())if(r instanceof Uint8Array)t+=r.byteLength,this.bufs.unshift(r);else if(hc(r))t+=r.byteLength,this.bufs.unshift(...r.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=Z2(this.bufs,e);return t.buf[t.index]}set(e,t){const r=Z2(this.bufs,e);r.buf[r.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let r=0;r<e.length;r++)this.set(t+r,e[r]);else if(hc(e))for(let r=0;r<e.length;r++)this.set(t+r,e.get(r));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:r,length:s}=this._subList(e,t);return Er(r,s)}subarray(e,t){const{bufs:r,length:s}=this._subList(e,t);return r.length===1?r[0]:Er(r,s)}sublist(e,t){const{bufs:r,length:s}=this._subList(e,t),i=new nt;return i.length=s,i.bufs=[...r],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const r=[];let s=0;for(let i=0;i<this.bufs.length;i++){const o=this.bufs[i],a=s,c=a+o.byteLength;if(s=c,e>=c)continue;const l=e>=a&&e<c,u=t>a&&t<=c;if(l&&u){if(e===a&&t===c){r.push(o);break}const d=e-a;r.push(o.subarray(d,d+(t-e)));break}if(l){if(e===0){r.push(o);continue}r.push(o.subarray(e-a));continue}if(u){if(t===c){r.push(o);break}r.push(o.subarray(0,t-a));break}r.push(o)}return{bufs:r,length:t-e}}indexOf(e,t=0){if(!hc(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const r=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const s=r.byteLength;if(s===0)throw new TypeError("search must be at least 1 byte long");const i=256,o=new Int32Array(i);for(let d=0;d<i;d++)o[d]=-1;for(let d=0;d<s;d++)o[r[d]]=d;const a=o,c=this.byteLength-r.byteLength,l=r.byteLength-1;let u;for(let d=t;d<=c;d+=u){u=0;for(let f=l;f>=0;f--){const m=this.get(d+f);if(r[f]!==m){u=Math.max(1,f-a[m]);break}}if(u===0)return d}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const r=Qr(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt8(0,t),this.write(r,e)}getInt16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt16(0,t)}setInt16(e,t,r){const s=lt(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,t,r),this.write(s,e)}getInt32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt32(0,t)}setInt32(e,t,r){const s=lt(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,t,r),this.write(s,e)}getBigInt64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigInt64(0,t)}setBigInt64(e,t,r){const s=lt(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,t,r),this.write(s,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const r=Qr(1);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint8(0,t),this.write(r,e)}getUint16(e,t){const r=this.subarray(e,e+2);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint16(0,t)}setUint16(e,t,r){const s=lt(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,t,r),this.write(s,e)}getUint32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint32(0,t)}setUint32(e,t,r){const s=lt(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,t,r),this.write(s,e)}getBigUint64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getBigUint64(0,t)}setBigUint64(e,t,r){const s=lt(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,t,r),this.write(s,e)}getFloat32(e,t){const r=this.subarray(e,e+4);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat32(0,t)}setFloat32(e,t,r){const s=lt(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,t,r),this.write(s,e)}getFloat64(e,t){const r=this.subarray(e,e+8);return new DataView(r.buffer,r.byteOffset,r.byteLength).getFloat64(0,t)}setFloat64(e,t,r){const s=lt(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,t,r),this.write(s,e)}equals(e){if(e==null||!(e instanceof nt)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Ne(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const r=new nt;return r.bufs=e,t==null&&(t=e.reduce((s,i)=>s+i.byteLength,0)),r.length=t,r}}const uv=Ta({prefix:"9",name:"base10",alphabet:"0123456789"}),hv=Object.freeze(Object.defineProperty({__proto__:null,base10:uv},Symbol.toStringTag,{value:"Module"})),dv=kt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),fv=kt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),pv=Object.freeze(Object.defineProperty({__proto__:null,base16:dv,base16upper:fv},Symbol.toStringTag,{value:"Module"})),gv=kt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),mv=Object.freeze(Object.defineProperty({__proto__:null,base2:gv},Symbol.toStringTag,{value:"Module"})),Y8=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),yv=Y8.reduce((n,e,t)=>(n[t]=e,n),[]),xv=Y8.reduce((n,e,t)=>{const r=e.codePointAt(0);if(r==null)throw new Error(`Invalid character: ${e}`);return n[r]=t,n},[]);function vv(n){return n.reduce((e,t)=>(e+=yv[t],e),"")}function bv(n){const e=[];for(const t of n){const r=t.codePointAt(0);if(r==null)throw new Error(`Invalid character: ${t}`);const s=xv[r];if(s==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const wv=Jl({prefix:"🚀",name:"base256emoji",encode:vv,decode:bv}),_v=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:wv},Symbol.toStringTag,{value:"Module"})),yd=kt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ev=kt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),X8=kt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Av=kt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Cv=Object.freeze(Object.defineProperty({__proto__:null,base64:yd,base64pad:Ev,base64url:X8,base64urlpad:Av},Symbol.toStringTag,{value:"Module"})),Sv=kt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Tv=Object.freeze(Object.defineProperty({__proto__:null,base8:Sv},Symbol.toStringTag,{value:"Module"})),Iv=Jl({prefix:"\0",name:"identity",encode:n=>yx(n),decode:n=>mx(n)}),kv=Object.freeze(Object.defineProperty({__proto__:null,identity:Iv},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Pv=85;function Dv({name:n,code:e,encode:t}){return new Rv(n,e,t)}class Rv{constructor(e,t,r){p(this,"name");p(this,"code");p(this,"encode");this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Ss(this.code,t):t.then(r=>Ss(this.code,r))}else throw Error("Unknown type, must be binary type")}}function Bv(n){return async e=>new Uint8Array(await crypto.subtle.digest(n,e))}const Xt=Dv({name:"sha2-256",code:18,encode:Bv("SHA-256")}),Jo={...kv,...mv,...Tv,...hv,...pv,...Mx,...Vx,...Ix,...Cv,..._v};function J8(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}const e4=J8("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),Z0=J8("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=Qr(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),Z8={utf8:e4,"utf-8":e4,hex:Jo.base16,latin1:Z0,ascii:Z0,binary:Z0,...Jo};function oe(n,e="utf8"){const t=Z8[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${n}`)}function ie(n,e="utf8"){const t=Z8[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(n).substring(1)}const Fv=parseInt("11111",2),Wh=parseInt("10000000",2),Nv=parseInt("01111111",2),t4={0:_o,1:_o,2:Lv,3:Vv,4:Uv,5:Ov,6:Mv,16:_o,22:_o,48:_o};function Zl(n,e={offset:0}){const t=n[e.offset]&Fv;if(e.offset++,t4[t]!=null)return t4[t](n,e);throw new Error("No decoder for tag "+t)}function Ia(n,e){let t=0;if((n[e.offset]&Wh)===Wh){const r=n[e.offset]&Nv;let s="0x";e.offset++;for(let i=0;i<r;i++,e.offset++)s+=n[e.offset].toString(16).padStart(2,"0");t=parseInt(s,16)}else t=n[e.offset],e.offset++;return t}function _o(n,e){Ia(n,e);const t=[];for(;!(e.offset>=n.byteLength);){const r=Zl(n,e);if(r===null)break;t.push(r)}return t}function Lv(n,e){const t=Ia(n,e),r=e.offset,s=e.offset+t,i=[];for(let o=r;o<s;o++)o===r&&n[o]===0||i.push(n[o]);return e.offset+=t,Uint8Array.from(i)}function Mv(n,e){const t=Ia(n,e),r=e.offset+t,s=n[e.offset];e.offset++;let i=0,o=0;s<40?(i=0,o=s):s<80?(i=1,o=s-40):(i=2,o=s-80);let a=`${i}.${o}`,c=[];for(;e.offset<r;){const l=n[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let u=0;for(let d=0;d<c.length;d++)u+=c[d]<<d*7;a+=`.${u}`,c=[]}}return a}function Ov(n,e){return e.offset++,null}function Vv(n,e){const t=Ia(n,e),r=n[e.offset];e.offset++;const s=n.subarray(e.offset,e.offset+t-1);if(e.offset+=t,r!==0)throw new Error("Unused bits in bit string is unimplemented");return s}function Uv(n,e){const t=Ia(n,e),r=n.subarray(e.offset,e.offset+t);return e.offset+=t,r}function $v(n){let e=n.toString(16);e.length%2===1&&(e="0"+e);const t=new nt;for(let r=0;r<e.length;r+=2)t.append(Uint8Array.from([parseInt(`${e[r]}${e[r+1]}`,16)]));return t}function xd(n){if(n.byteLength<128)return Uint8Array.from([n.byteLength]);const e=$v(n.byteLength);return new nt(Uint8Array.from([e.byteLength|Wh]),e)}function Qh(n){const e=new nt,t=128;return(n.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(n),new nt(Uint8Array.from([2]),xd(e),e)}function e5(n){const e=Uint8Array.from([0]),t=new nt(e,n);return new nt(Uint8Array.from([3]),xd(t),t)}function Po(n,e=48){const t=new nt;for(const r of n)t.append(r);return new nt(Uint8Array.from([e]),xd(t),t)}async function Hv(n,e,t){const r=await crypto.subtle.importKey("jwk",n,{name:"ECDSA",namedCurve:n.crv??"P-256"},!1,["verify"]);return crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},r,e,t.subarray())}const qv=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),zv=Uint8Array.from([6,5,43,129,4,0,34]),Kv=Uint8Array.from([6,5,43,129,4,0,35]),jv={ext:!0,kty:"EC",crv:"P-256"},Gv={ext:!0,kty:"EC",crv:"P-384"},Wv={ext:!0,kty:"EC",crv:"P-521"},eu=32,tu=48,ru=66;function t5(n){const e=Zl(n);return Qv(e)}function Qv(n){const e=n[1][1][0],t=1;let r,s;if(e.byteLength===eu*2+1)return r=ie(e.subarray(t,t+eu),"base64url"),s=ie(e.subarray(t+eu),"base64url"),new nu({...jv,key_ops:["verify"],x:r,y:s});if(e.byteLength===tu*2+1)return r=ie(e.subarray(t,t+tu),"base64url"),s=ie(e.subarray(t+tu),"base64url"),new nu({...Gv,key_ops:["verify"],x:r,y:s});if(e.byteLength===ru*2+1)return r=ie(e.subarray(t,t+ru),"base64url"),s=ie(e.subarray(t+ru),"base64url"),new nu({...Wv,key_ops:["verify"],x:r,y:s});throw new pe(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function Yv(n){return Po([Qh(Uint8Array.from([1])),Po([Xv(n.crv)],160),Po([e5(new nt(Uint8Array.from([4]),oe(n.x??"","base64url"),oe(n.y??"","base64url")))],161)]).subarray()}function Xv(n){if(n==="P-256")return qv;if(n==="P-384")return zv;if(n==="P-521")return Kv;throw new pe(`Invalid curve ${n}`)}class nu{constructor(e){p(this,"type","ECDSA");p(this,"jwk");p(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=Yv(this.jwk)),this._raw}toMultihash(){return Rr.digest(Hn(this))}toCID(){return Ce.createV1(114,this.toMultihash())}toString(){return Ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ne(this.raw,e.raw)}async verify(e,t){return Hv(this.jwk,t,e)}}const Ys=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Jv(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function ui(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function zi(n,...e){if(!Jv(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function r5(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ui(n.outputLen),ui(n.blockLen)}function ml(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function Zv(n,e){zi(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Ts(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}function zc(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function Lr(n,e){return n<<32-e|n>>>e}const eb=async()=>{};async function tb(n,e,t){let r=Date.now();for(let s=0;s<n;s++){t(s);const i=Date.now()-r;i>=0&&i<e||(await eb(),r+=i)}}function n5(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}function vd(n){return typeof n=="string"&&(n=n5(n)),zi(n),n}function r4(n){return typeof n=="string"&&(n=n5(n)),zi(n),n}function rb(...n){let e=0;for(let r=0;r<n.length;r++){const s=n[r];zi(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<n.length;r++){const i=n[r];t.set(i,s),s+=i.length}return t}function nb(n,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(n,e)}class s5{}function i5(n){const e=r=>n().update(vd(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function e0(n=32){if(Ys&&typeof Ys.getRandomValues=="function")return Ys.getRandomValues(new Uint8Array(n));if(Ys&&typeof Ys.randomBytes=="function")return Uint8Array.from(Ys.randomBytes(n));throw new Error("crypto.getRandomValues must be defined")}function sb(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=r?4:0,l=r?0:4;n.setUint32(e+c,o,r),n.setUint32(e+l,a,r)}function ib(n,e,t){return n&e^~n&t}function ob(n,e,t){return n&e^n&t^e&t}class o5 extends s5{constructor(e,t,r,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=s,this.buffer=new Uint8Array(e),this.view=zc(this.buffer)}update(e){ml(this),e=vd(e),zi(e);const{view:t,buffer:r,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=zc(e);for(;s<=i-o;o+=s)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ml(this),Zv(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,Ts(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(r,0),o=0);for(let d=o;d<s;d++)t[d]=0;sb(r,s-8,BigInt(this.length*8),i),this.process(r,0);const a=zc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<l;d++)a.setUint32(4*d,u[d],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}const In=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Bt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),dc=BigInt(2**32-1),n4=BigInt(32);function ab(n,e=!1){return e?{h:Number(n&dc),l:Number(n>>n4&dc)}:{h:Number(n>>n4&dc)|0,l:Number(n&dc)|0}}function cb(n,e=!1){const t=n.length;let r=new Uint32Array(t),s=new Uint32Array(t);for(let i=0;i<t;i++){const{h:o,l:a}=ab(n[i],e);[r[i],s[i]]=[o,a]}return[r,s]}const s4=(n,e,t)=>n>>>t,i4=(n,e,t)=>n<<32-t|e>>>t,Xs=(n,e,t)=>n>>>t|e<<32-t,Js=(n,e,t)=>n<<32-t|e>>>t,fc=(n,e,t)=>n<<64-t|e>>>t-32,pc=(n,e,t)=>n>>>t-32|e<<64-t;function sn(n,e,t,r){const s=(e>>>0)+(r>>>0);return{h:n+t+(s/2**32|0)|0,l:s|0}}const lb=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),ub=(n,e,t,r)=>e+t+r+(n/2**32|0)|0,hb=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0),db=(n,e,t,r,s)=>e+t+r+s+(n/2**32|0)|0,fb=(n,e,t,r,s)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(s>>>0),pb=(n,e,t,r,s,i)=>e+t+r+s+i+(n/2**32|0)|0,gb=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),kn=new Uint32Array(64);class mb extends o5{constructor(e=32){super(64,e,8,!1),this.A=In[0]|0,this.B=In[1]|0,this.C=In[2]|0,this.D=In[3]|0,this.E=In[4]|0,this.F=In[5]|0,this.G=In[6]|0,this.H=In[7]|0}get(){const{A:e,B:t,C:r,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,r,s,i,o,a,c]}set(e,t,r,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)kn[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){const f=kn[d-15],m=kn[d-2],y=Lr(f,7)^Lr(f,18)^f>>>3,b=Lr(m,17)^Lr(m,19)^m>>>10;kn[d]=b+kn[d-7]+y+kn[d-16]|0}let{A:r,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let d=0;d<64;d++){const f=Lr(a,6)^Lr(a,11)^Lr(a,25),m=u+f+ib(a,c,l)+gb[d]+kn[d]|0,b=(Lr(r,2)^Lr(r,13)^Lr(r,22))+ob(r,s,i)|0;u=l,l=c,c=a,a=o+m|0,o=i,i=s,s=r,r=m+b|0}r=r+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,s,i,o,a,c,l,u)}roundClean(){Ts(kn)}destroy(){this.set(0,0,0,0,0,0,0,0),Ts(this.buffer)}}const a5=cb(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),yb=a5[0],xb=a5[1],Pn=new Uint32Array(80),Dn=new Uint32Array(80);class vb extends o5{constructor(e=64){super(128,e,16,!1),this.Ah=Bt[0]|0,this.Al=Bt[1]|0,this.Bh=Bt[2]|0,this.Bl=Bt[3]|0,this.Ch=Bt[4]|0,this.Cl=Bt[5]|0,this.Dh=Bt[6]|0,this.Dl=Bt[7]|0,this.Eh=Bt[8]|0,this.El=Bt[9]|0,this.Fh=Bt[10]|0,this.Fl=Bt[11]|0,this.Gh=Bt[12]|0,this.Gl=Bt[13]|0,this.Hh=Bt[14]|0,this.Hl=Bt[15]|0}get(){const{Ah:e,Al:t,Bh:r,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:d,Fl:f,Gh:m,Gl:y,Hh:b,Hl:x}=this;return[e,t,r,s,i,o,a,c,l,u,d,f,m,y,b,x]}set(e,t,r,s,i,o,a,c,l,u,d,f,m,y,b,x){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=d|0,this.Fl=f|0,this.Gh=m|0,this.Gl=y|0,this.Hh=b|0,this.Hl=x|0}process(e,t){for(let _=0;_<16;_++,t+=4)Pn[_]=e.getUint32(t),Dn[_]=e.getUint32(t+=4);for(let _=16;_<80;_++){const E=Pn[_-15]|0,B=Dn[_-15]|0,F=Xs(E,B,1)^Xs(E,B,8)^s4(E,B,7),A=Js(E,B,1)^Js(E,B,8)^i4(E,B,7),w=Pn[_-2]|0,k=Dn[_-2]|0,C=Xs(w,k,19)^fc(w,k,61)^s4(w,k,6),I=Js(w,k,19)^pc(w,k,61)^i4(w,k,6),R=hb(A,I,Dn[_-7],Dn[_-16]),T=db(R,F,C,Pn[_-7],Pn[_-16]);Pn[_]=T|0,Dn[_]=R|0}let{Ah:r,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:d,El:f,Fh:m,Fl:y,Gh:b,Gl:x,Hh:D,Hl:S}=this;for(let _=0;_<80;_++){const E=Xs(d,f,14)^Xs(d,f,18)^fc(d,f,41),B=Js(d,f,14)^Js(d,f,18)^pc(d,f,41),F=d&m^~d&b,A=f&y^~f&x,w=fb(S,B,A,xb[_],Dn[_]),k=pb(w,D,E,F,yb[_],Pn[_]),C=w|0,I=Xs(r,s,28)^fc(r,s,34)^fc(r,s,39),R=Js(r,s,28)^pc(r,s,34)^pc(r,s,39),T=r&i^r&a^i&a,G=s&o^s&c^o&c;D=b|0,S=x|0,b=m|0,x=y|0,m=d|0,y=f|0,{h:d,l:f}=sn(l|0,u|0,k|0,C|0),l=a|0,u=c|0,a=i|0,c=o|0,i=r|0,o=s|0;const H=lb(C,R,G);r=ub(H,k,I,T),s=H|0}({h:r,l:s}=sn(this.Ah|0,this.Al|0,r|0,s|0)),{h:i,l:o}=sn(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=sn(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=sn(this.Dh|0,this.Dl|0,l|0,u|0),{h:d,l:f}=sn(this.Eh|0,this.El|0,d|0,f|0),{h:m,l:y}=sn(this.Fh|0,this.Fl|0,m|0,y|0),{h:b,l:x}=sn(this.Gh|0,this.Gl|0,b|0,x|0),{h:D,l:S}=sn(this.Hh|0,this.Hl|0,D|0,S|0),this.set(r,s,i,o,a,c,l,u,d,f,m,y,b,x,D,S)}roundClean(){Ts(Pn,Dn)}destroy(){Ts(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const c5=i5(()=>new mb),l5=i5(()=>new vb);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const bd=BigInt(0),Yh=BigInt(1);function ka(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function wd(n){if(!ka(n))throw new Error("Uint8Array expected")}function $n(n,e){if(typeof e!="boolean")throw new Error(n+" boolean expected, got "+e)}function gc(n){const e=n.toString(16);return e.length&1?"0"+e:e}function u5(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?bd:BigInt("0x"+n)}const h5=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",bb=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Ei(n){if(wd(n),h5)return n.toHex();let e="";for(let t=0;t<n.length;t++)e+=bb[n[t]];return e}const on={_0:48,_9:57,A:65,F:70,a:97,f:102};function o4(n){if(n>=on._0&&n<=on._9)return n-on._0;if(n>=on.A&&n<=on.F)return n-(on.A-10);if(n>=on.a&&n<=on.f)return n-(on.a-10)}function yl(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);if(h5)return Uint8Array.fromHex(n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=o4(n.charCodeAt(i)),a=o4(n.charCodeAt(i+1));if(o===void 0||a===void 0){const c=n[i]+n[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}r[s]=o*16+a}return r}function ws(n){return u5(Ei(n))}function Do(n){return wd(n),u5(Ei(Uint8Array.from(n).reverse()))}function Pa(n,e){return yl(n.toString(16).padStart(e*2,"0"))}function xl(n,e){return Pa(n,e).reverse()}function it(n,e,t){let r;if(typeof e=="string")try{r=yl(e)}catch(i){throw new Error(n+" must be hex string or Uint8Array, cause: "+i)}else if(ka(e))r=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");const s=r.length;if(typeof t=="number"&&s!==t)throw new Error(n+" of length "+t+" expected, got "+s);return r}function Ai(...n){let e=0;for(let r=0;r<n.length;r++){const s=n[r];wd(s),e+=s.length}const t=new Uint8Array(e);for(let r=0,s=0;r<n.length;r++){const i=n[r];t.set(i,s),s+=i.length}return t}const su=n=>typeof n=="bigint"&&bd<=n;function _d(n,e,t){return su(n)&&su(e)&&su(t)&&e<=n&&n<t}function kr(n,e,t,r){if(!_d(e,t,r))throw new Error("expected valid "+n+": "+t+" <= n < "+r+", got "+e)}function wb(n){let e;for(e=0;n>bd;n>>=Yh,e+=1);return e}const t0=n=>(Yh<<BigInt(n))-Yh,iu=n=>new Uint8Array(n),a4=n=>Uint8Array.from(n);function _b(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=iu(n),s=iu(n),i=0;const o=()=>{r.fill(1),s.fill(0),i=0},a=(...d)=>t(s,r,...d),c=(d=iu(0))=>{s=a(a4([0]),d),r=a(),d.length!==0&&(s=a(a4([1]),d),r=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let d=0;const f=[];for(;d<e;){r=a();const m=r.slice();f.push(m),d+=r.length}return Ai(...f)};return(d,f)=>{o(),c(d);let m;for(;!(m=f(l()));)c();return o(),m}}const Eb={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||ka(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function Da(n,e,t={}){const r=(s,i,o)=>{const a=Eb[i];if(typeof a!="function")throw new Error("invalid validator function");const c=n[s];if(!(o&&c===void 0)&&!a(c,n))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))r(s,i,!1);for(const[s,i]of Object.entries(t))r(s,i,!0);return n}function vl(n){const e=new WeakMap;return(t,...r)=>{const s=e.get(t);if(s!==void 0)return s;const i=n(t,...r);return e.set(t,i),i}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sr=BigInt(0),Tt=BigInt(1),ms=BigInt(2),Ab=BigInt(3),d5=BigInt(4),f5=BigInt(5),p5=BigInt(8);function ze(n,e){const t=n%e;return t>=sr?t:e+t}function et(n,e,t){let r=n;for(;e-- >sr;)r*=r,r%=t;return r}function Xh(n,e){if(n===sr)throw new Error("invert: expected non-zero number");if(e<=sr)throw new Error("invert: expected positive modulus, got "+e);let t=ze(n,e),r=e,s=sr,i=Tt;for(;t!==sr;){const a=r/t,c=r%t,l=s-i*a;r=t,t=c,s=i,i=l}if(r!==Tt)throw new Error("invert: does not exist");return ze(s,e)}function g5(n,e){const t=(n.ORDER+Tt)/d5,r=n.pow(e,t);if(!n.eql(n.sqr(r),e))throw new Error("Cannot find square root");return r}function Cb(n,e){const t=(n.ORDER-f5)/p5,r=n.mul(e,ms),s=n.pow(r,t),i=n.mul(e,s),o=n.mul(n.mul(i,ms),s),a=n.mul(i,n.sub(o,n.ONE));if(!n.eql(n.sqr(a),e))throw new Error("Cannot find square root");return a}function Sb(n){if(n<BigInt(3))throw new Error("sqrt is not defined for small field");let e=n-Tt,t=0;for(;e%ms===sr;)e/=ms,t++;let r=ms;const s=Ra(n);for(;c4(s,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return g5;let i=s.pow(r,e);const o=(e+Tt)/ms;return function(c,l){if(c.is0(l))return l;if(c4(c,l)!==1)throw new Error("Cannot find square root");let u=t,d=c.mul(c.ONE,i),f=c.pow(l,e),m=c.pow(l,o);for(;!c.eql(f,c.ONE);){if(c.is0(f))return c.ZERO;let y=1,b=c.sqr(f);for(;!c.eql(b,c.ONE);)if(y++,b=c.sqr(b),y===u)throw new Error("Cannot find square root");const x=Tt<<BigInt(u-y-1),D=c.pow(d,x);u=y,d=c.sqr(D),f=c.mul(f,d),m=c.mul(m,D)}return m}}function Tb(n){return n%d5===Ab?g5:n%p5===f5?Cb:Sb(n)}const Ib=(n,e)=>(ze(n,e)&Tt)===Tt,kb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Pb(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=kb.reduce((r,s)=>(r[s]="function",r),e);return Da(n,t)}function Db(n,e,t){if(t<sr)throw new Error("invalid exponent, negatives unsupported");if(t===sr)return n.ONE;if(t===Tt)return e;let r=n.ONE,s=e;for(;t>sr;)t&Tt&&(r=n.mul(r,s)),s=n.sqr(s),t>>=Tt;return r}function Ed(n,e,t=!1){const r=new Array(e.length).fill(t?n.ZERO:void 0),s=e.reduce((o,a,c)=>n.is0(a)?o:(r[c]=o,n.mul(o,a)),n.ONE),i=n.inv(s);return e.reduceRight((o,a,c)=>n.is0(a)?o:(r[c]=n.mul(o,r[c]),n.mul(o,a)),i),r}function c4(n,e){const t=(n.ORDER-Tt)/ms,r=n.pow(e,t),s=n.eql(r,n.ONE),i=n.eql(r,n.ZERO),o=n.eql(r,n.neg(n.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function m5(n,e){e!==void 0&&ui(e);const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function Ra(n,e,t=!1,r={}){if(n<=sr)throw new Error("invalid field: expected ORDER > 0, got "+n);const{nBitLength:s,nByteLength:i}=m5(n,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:n,isLE:t,BITS:s,BYTES:i,MASK:t0(s),ZERO:sr,ONE:Tt,create:c=>ze(c,n),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return sr<=c&&c<n},is0:c=>c===sr,isOdd:c=>(c&Tt)===Tt,neg:c=>ze(-c,n),eql:(c,l)=>c===l,sqr:c=>ze(c*c,n),add:(c,l)=>ze(c+l,n),sub:(c,l)=>ze(c-l,n),mul:(c,l)=>ze(c*l,n),pow:(c,l)=>Db(a,c,l),div:(c,l)=>ze(c*Xh(l,n),n),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Xh(c,n),sqrt:r.sqrt||(c=>(o||(o=Tb(n)),o(a,c))),toBytes:c=>t?xl(c,i):Pa(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return t?Do(c):ws(c)},invertBatch:c=>Ed(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function y5(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function x5(n){const e=y5(n);return e+Math.ceil(e/2)}function Rb(n,e,t=!1){const r=n.length,s=y5(e),i=x5(e);if(r<16||r<i||r>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+r);const o=t?Do(n):ws(n),a=ze(o,e-Tt)+Tt;return t?xl(a,s):Pa(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const l4=BigInt(0),Jh=BigInt(1);function ou(n,e){const t=e.negate();return n?t:e}function v5(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function au(n,e){v5(n,e);const t=Math.ceil(e/n)+1,r=2**(n-1),s=2**n,i=t0(n),o=BigInt(n);return{windows:t,windowSize:r,mask:i,maxNumber:s,shiftBy:o}}function u4(n,e,t){const{windowSize:r,mask:s,maxNumber:i,shiftBy:o}=t;let a=Number(n&s),c=n>>o;a>r&&(a-=i,c+=Jh);const l=e*r,u=l+Math.abs(a)-1,d=a===0,f=a<0,m=e%2!==0;return{nextN:c,offset:u,isZero:d,isNeg:f,isNegF:m,offsetF:l}}function Bb(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function Fb(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const cu=new WeakMap,b5=new WeakMap;function lu(n){return b5.get(n)||1}function w5(n,e){return{constTimeNegate:ou,hasPrecomputes(t){return lu(t)!==1},unsafeLadder(t,r,s=n.ZERO){let i=t;for(;r>l4;)r&Jh&&(s=s.add(i)),i=i.double(),r>>=Jh;return s},precomputeWindow(t,r){const{windows:s,windowSize:i}=au(r,e),o=[];let a=t,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,r,s){let i=n.ZERO,o=n.BASE;const a=au(t,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:d,isNeg:f,isNegF:m,offsetF:y}=u4(s,c,a);s=l,d?o=o.add(ou(m,r[y])):i=i.add(ou(f,r[u]))}return{p:i,f:o}},wNAFUnsafe(t,r,s,i=n.ZERO){const o=au(t,e);for(let a=0;a<o.windows&&s!==l4;a++){const{nextN:c,offset:l,isZero:u,isNeg:d}=u4(s,a,o);if(s=c,!u){const f=r[l];i=i.add(d?f.negate():f)}}return i},getPrecomputes(t,r,s){let i=cu.get(r);return i||(i=this.precomputeWindow(r,t),t!==1&&cu.set(r,s(i))),i},wNAFCached(t,r,s){const i=lu(t);return this.wNAF(i,this.getPrecomputes(i,t,s),r)},wNAFCachedUnsafe(t,r,s,i){const o=lu(t);return o===1?this.unsafeLadder(t,r,i):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),r,i)},setWindowSize(t,r){v5(r,e),b5.set(t,r),cu.delete(t)}}}function _5(n,e,t,r){Bb(t,n),Fb(r,e);const s=t.length,i=r.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=n.ZERO,a=wb(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=t0(c),u=new Array(Number(l)+1).fill(o),d=Math.floor((e.BITS-1)/c)*c;let f=o;for(let m=d;m>=0;m-=c){u.fill(o);for(let b=0;b<i;b++){const x=r[b],D=Number(x>>BigInt(m)&l);u[D]=u[D].add(t[b])}let y=o;for(let b=u.length-1,x=o;b>0;b--)x=x.add(u[b]),y=y.add(x);if(f=f.add(y),m!==0)for(let b=0;b<c;b++)f=f.double()}return f}function Ad(n){return Pb(n.Fp),Da(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...m5(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Mr=BigInt(0),zt=BigInt(1),h4=BigInt(2),Nb=BigInt(8),Lb={zip215:!0};function Mb(n){const e=Ad(n);return Da(n,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Ob(n){const e=Mb(n),{Fp:t,n:r,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,l=h4<<BigInt(a*8)-zt,u=t.create,d=Ra(e.n,e.nBitLength);function f(K,O){const q=t.sqr(K),N=t.sqr(O),M=t.add(t.mul(e.a,q),N),V=t.add(t.ONE,t.mul(e.d,t.mul(q,N)));return t.eql(M,V)}if(!f(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const m=e.uvRatio||((K,O)=>{try{return{isValid:!0,value:t.sqrt(K*t.inv(O))}}catch{return{isValid:!1,value:Mr}}}),y=e.adjustScalarBytes||(K=>K),b=e.domain||((K,O,q)=>{if($n("phflag",q),O.length||q)throw new Error("Contexts/pre-hash are not supported");return K});function x(K,O,q=!1){const N=q?zt:Mr;kr("coordinate "+K,O,N,l)}function D(K){if(!(K instanceof E))throw new Error("ExtendedPoint expected")}const S=vl((K,O)=>{const{ex:q,ey:N,ez:M}=K,V=K.is0();O==null&&(O=V?Nb:t.inv(M));const U=u(q*O),ee=u(N*O),ne=u(M*O);if(V)return{x:Mr,y:zt};if(ne!==zt)throw new Error("invZ was invalid");return{x:U,y:ee}}),_=vl(K=>{const{a:O,d:q}=e;if(K.is0())throw new Error("bad point: ZERO");const{ex:N,ey:M,ez:V,et:U}=K,ee=u(N*N),ne=u(M*M),ae=u(V*V),re=u(ae*ae),Be=u(ee*O),Fe=u(ae*u(Be+ne)),Ge=u(re+u(q*u(ee*ne)));if(Fe!==Ge)throw new Error("bad point: equation left != right (1)");const Le=u(N*M),Ee=u(V*U);if(Le!==Ee)throw new Error("bad point: equation left != right (2)");return!0});class E{constructor(O,q,N,M){x("x",O),x("y",q),x("z",N,!0),x("t",M),this.ex=O,this.ey=q,this.ez=N,this.et=M,Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(O){if(O instanceof E)throw new Error("extended point not allowed");const{x:q,y:N}=O||{};return x("x",q),x("y",N),new E(q,N,zt,u(q*N))}static normalizeZ(O){const q=Ed(t,O.map(N=>N.ez));return O.map((N,M)=>N.toAffine(q[M])).map(E.fromAffine)}static msm(O,q){return _5(E,d,O,q)}_setWindowSize(O){A.setWindowSize(this,O)}assertValidity(){_(this)}equals(O){D(O);const{ex:q,ey:N,ez:M}=this,{ex:V,ey:U,ez:ee}=O,ne=u(q*ee),ae=u(V*M),re=u(N*ee),Be=u(U*M);return ne===ae&&re===Be}is0(){return this.equals(E.ZERO)}negate(){return new E(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:O}=e,{ex:q,ey:N,ez:M}=this,V=u(q*q),U=u(N*N),ee=u(h4*u(M*M)),ne=u(O*V),ae=q+N,re=u(u(ae*ae)-V-U),Be=ne+U,Fe=Be-ee,Ge=ne-U,Le=u(re*Fe),Ee=u(Be*Ge),Te=u(re*Ge),ut=u(Fe*Be);return new E(Le,Ee,ut,Te)}add(O){D(O);const{a:q,d:N}=e,{ex:M,ey:V,ez:U,et:ee}=this,{ex:ne,ey:ae,ez:re,et:Be}=O,Fe=u(M*ne),Ge=u(V*ae),Le=u(ee*N*Be),Ee=u(U*re),Te=u((M+V)*(ne+ae)-Fe-Ge),ut=Ee-Le,pt=Ee+Le,Zr=u(Ge-q*Fe),en=u(Te*ut),_n=u(pt*Zr),Cr=u(Te*Zr),Pt=u(ut*pt);return new E(en,_n,Pt,Cr)}subtract(O){return this.add(O.negate())}wNAF(O){return A.wNAFCached(this,O,E.normalizeZ)}multiply(O){const q=O;kr("scalar",q,zt,r);const{p:N,f:M}=this.wNAF(q);return E.normalizeZ([N,M])[0]}multiplyUnsafe(O,q=E.ZERO){const N=O;return kr("scalar",N,Mr,r),N===Mr?F:this.is0()||N===zt?this:A.wNAFCachedUnsafe(this,N,E.normalizeZ,q)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return A.unsafeLadder(this,r).is0()}toAffine(O){return S(this,O)}clearCofactor(){const{h:O}=e;return O===zt?this:this.multiplyUnsafe(O)}static fromHex(O,q=!1){const{d:N,a:M}=e,V=t.BYTES;O=it("pointHex",O,V),$n("zip215",q);const U=O.slice(),ee=O[V-1];U[V-1]=ee&-129;const ne=Do(U),ae=q?l:t.ORDER;kr("pointHex.y",ne,Mr,ae);const re=u(ne*ne),Be=u(re-zt),Fe=u(N*re-M);let{isValid:Ge,value:Le}=m(Be,Fe);if(!Ge)throw new Error("Point.fromHex: invalid y coordinate");const Ee=(Le&zt)===zt,Te=(ee&128)!==0;if(!q&&Le===Mr&&Te)throw new Error("Point.fromHex: x=0 and x_0=1");return Te!==Ee&&(Le=u(-Le)),E.fromAffine({x:Le,y:ne})}static fromPrivateKey(O){const{scalar:q}=C(O);return B.multiply(q)}toRawBytes(){const{x:O,y:q}=this.toAffine(),N=xl(q,t.BYTES);return N[N.length-1]|=O&zt?128:0,N}toHex(){return Ei(this.toRawBytes())}}E.BASE=new E(e.Gx,e.Gy,zt,u(e.Gx*e.Gy)),E.ZERO=new E(Mr,zt,zt,Mr);const{BASE:B,ZERO:F}=E,A=w5(E,a*8);function w(K){return ze(K,r)}function k(K){return w(Do(K))}function C(K){const O=t.BYTES;K=it("private key",K,O);const q=it("hashed private key",i(K),2*O),N=y(q.slice(0,O)),M=q.slice(O,2*O),V=k(N);return{head:N,prefix:M,scalar:V}}function I(K){const{head:O,prefix:q,scalar:N}=C(K),M=B.multiply(N),V=M.toRawBytes();return{head:O,prefix:q,scalar:N,point:M,pointBytes:V}}function R(K){return I(K).pointBytes}function T(K=Uint8Array.of(),...O){const q=Ai(...O);return k(i(b(q,it("context",K),!!s)))}function G(K,O,q={}){K=it("message",K),s&&(K=s(K));const{prefix:N,scalar:M,pointBytes:V}=I(O),U=T(q.context,N,K),ee=B.multiply(U).toRawBytes(),ne=T(q.context,ee,V,K),ae=w(U+ne*M);kr("signature.s",ae,Mr,r);const re=Ai(ee,xl(ae,t.BYTES));return it("result",re,t.BYTES*2)}const H=Lb;function z(K,O,q,N=H){const{context:M,zip215:V}=N,U=t.BYTES;K=it("signature",K,2*U),O=it("message",O),q=it("publicKey",q,U),V!==void 0&&$n("zip215",V),s&&(O=s(O));const ee=Do(K.slice(U,2*U));let ne,ae,re;try{ne=E.fromHex(q,V),ae=E.fromHex(K.slice(0,U),V),re=B.multiplyUnsafe(ee)}catch{return!1}if(!V&&ne.isSmallOrder())return!1;const Be=T(M,ae.toRawBytes(),ne.toRawBytes(),O);return ae.add(ne.multiplyUnsafe(Be)).subtract(re).clearCofactor().equals(E.ZERO)}return B._setWindowSize(8),{CURVE:e,getPublicKey:R,sign:G,verify:z,ExtendedPoint:E,utils:{getExtendedPublicKey:I,randomPrivateKey:()=>o(t.BYTES),precompute(K=8,O=E.BASE){return O._setWindowSize(K),O.multiply(BigInt(3)),O}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Cd=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),d4=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Vb=BigInt(1),f4=BigInt(2);BigInt(3);const Ub=BigInt(5),$b=BigInt(8);function Hb(n){const e=BigInt(10),t=BigInt(20),r=BigInt(40),s=BigInt(80),i=Cd,a=n*n%i*n%i,c=et(a,f4,i)*a%i,l=et(c,Vb,i)*n%i,u=et(l,Ub,i)*l%i,d=et(u,e,i)*u%i,f=et(d,t,i)*d%i,m=et(f,r,i)*f%i,y=et(m,s,i)*m%i,b=et(y,s,i)*m%i,x=et(b,e,i)*u%i;return{pow_p_5_8:et(x,f4,i)*n%i,b2:a}}function qb(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}function zb(n,e){const t=Cd,r=ze(e*e*e,t),s=ze(r*r*e,t),i=Hb(n*s).pow_p_5_8;let o=ze(n*r*i,t);const a=ze(e*o*o,t),c=o,l=ze(o*d4,t),u=a===n,d=a===ze(-n,t),f=a===ze(-n*d4,t);return u&&(o=c),(d||f)&&(o=l),Ib(o,t)&&(o=ze(-o,t)),{isValid:u||d,value:o}}const p4=Ra(Cd,void 0,!0),Kb={a:p4.create(BigInt(-1)),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:p4,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:$b,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:l5,randomBytes:e0,adjustScalarBytes:qb,uvRatio:zb},mn=Ob(Kb),E5=32,A5=64,Zh=32;function jb(){const n=mn.utils.randomPrivateKey(),e=mn.getPublicKey(n);return{privateKey:Qb(n,e),publicKey:e}}function Gb(n,e){const t=n.subarray(0,Zh);return mn.sign(e instanceof Uint8Array?e:e.subarray(),t)}function Wb(n,e,t){return mn.verify(e,t instanceof Uint8Array?t:t.subarray(),n)}function Qb(n,e){const t=new Uint8Array(A5);for(let r=0;r<Zh;r++)t[r]=n[r],t[Zh+r]=e[r];return t}let C5=class{constructor(e){p(this,"type","Ed25519");p(this,"raw");this.raw=Sd(e,E5)}toMultihash(){return Rr.digest(Hn(this))}toCID(){return Ce.createV1(114,this.toMultihash())}toString(){return Ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ne(this.raw,e.raw)}verify(e,t){return Wb(this.raw,t,e)}},Yb=class{constructor(e,t){p(this,"type","Ed25519");p(this,"raw");p(this,"publicKey");this.raw=Sd(e,A5),this.publicKey=new C5(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ne(this.raw,e.raw)}sign(e){return Gb(this.raw,e)}};function S5(n){return n=Sd(n,E5),new C5(n)}async function Xb(){const{privateKey:n,publicKey:e}=jb();return new Yb(n,e)}function Sd(n,e){if(n=Uint8Array.from(n??[]),n.length!==e)throw new pe(`Key must be a Uint8Array of length ${e}, got ${n.length}`);return n}const Jb=Math.pow(2,7),Zb=Math.pow(2,14),ew=Math.pow(2,21),Td=Math.pow(2,28),Id=Math.pow(2,35),kd=Math.pow(2,42),Pd=Math.pow(2,49),De=128,Nt=127;function mr(n){if(n<Jb)return 1;if(n<Zb)return 2;if(n<ew)return 3;if(n<Td)return 4;if(n<Id)return 5;if(n<kd)return 6;if(n<Pd)return 7;if(Number.MAX_SAFE_INTEGER!=null&&n>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function T5(n,e,t=0){switch(mr(n)){case 8:e[t++]=n&255|De,n/=128;case 7:e[t++]=n&255|De,n/=128;case 6:e[t++]=n&255|De,n/=128;case 5:e[t++]=n&255|De,n/=128;case 4:e[t++]=n&255|De,n>>>=7;case 3:e[t++]=n&255|De,n>>>=7;case 2:e[t++]=n&255|De,n>>>=7;case 1:{e[t++]=n&255,n>>>=7;break}default:throw new Error("unreachable")}return e}function tw(n,e,t=0){switch(mr(n)){case 8:e.set(t++,n&255|De),n/=128;case 7:e.set(t++,n&255|De),n/=128;case 6:e.set(t++,n&255|De),n/=128;case 5:e.set(t++,n&255|De),n/=128;case 4:e.set(t++,n&255|De),n>>>=7;case 3:e.set(t++,n&255|De),n>>>=7;case 2:e.set(t++,n&255|De),n>>>=7;case 1:{e.set(t++,n&255),n>>>=7;break}default:throw new Error("unreachable")}return e}function I5(n,e){let t=n[e],r=0;if(r+=t&Nt,t<De||(t=n[e+1],r+=(t&Nt)<<7,t<De)||(t=n[e+2],r+=(t&Nt)<<14,t<De)||(t=n[e+3],r+=(t&Nt)<<21,t<De)||(t=n[e+4],r+=(t&Nt)*Td,t<De)||(t=n[e+5],r+=(t&Nt)*Id,t<De)||(t=n[e+6],r+=(t&Nt)*kd,t<De)||(t=n[e+7],r+=(t&Nt)*Pd,t<De))return r;throw new RangeError("Could not decode varint")}function rw(n,e){let t=n.get(e),r=0;if(r+=t&Nt,t<De||(t=n.get(e+1),r+=(t&Nt)<<7,t<De)||(t=n.get(e+2),r+=(t&Nt)<<14,t<De)||(t=n.get(e+3),r+=(t&Nt)<<21,t<De)||(t=n.get(e+4),r+=(t&Nt)*Td,t<De)||(t=n.get(e+5),r+=(t&Nt)*Id,t<De)||(t=n.get(e+6),r+=(t&Nt)*kd,t<De)||(t=n.get(e+7),r+=(t&Nt)*Pd,t<De))return r;throw new RangeError("Could not decode varint")}function Pr(n,e,t=0){return e==null&&(e=Qr(mr(n))),e instanceof Uint8Array?T5(n,e,t):tw(n,e,t)}function ss(n,e=0){return n instanceof Uint8Array?I5(n,e):rw(n,e)}const Dd=new Float32Array([-0]),On=new Uint8Array(Dd.buffer);function nw(n,e,t){Dd[0]=n,e[t]=On[0],e[t+1]=On[1],e[t+2]=On[2],e[t+3]=On[3]}function sw(n,e){return On[0]=n[e],On[1]=n[e+1],On[2]=n[e+2],On[3]=n[e+3],Dd[0]}const Rd=new Float64Array([-0]),Lt=new Uint8Array(Rd.buffer);function iw(n,e,t){Rd[0]=n,e[t]=Lt[0],e[t+1]=Lt[1],e[t+2]=Lt[2],e[t+3]=Lt[3],e[t+4]=Lt[4],e[t+5]=Lt[5],e[t+6]=Lt[6],e[t+7]=Lt[7]}function ow(n,e){return Lt[0]=n[e],Lt[1]=n[e+1],Lt[2]=n[e+2],Lt[3]=n[e+3],Lt[4]=n[e+4],Lt[5]=n[e+5],Lt[6]=n[e+6],Lt[7]=n[e+7],Rd[0]}const aw=BigInt(Number.MAX_SAFE_INTEGER),cw=BigInt(Number.MIN_SAFE_INTEGER);class Mt{constructor(e,t){p(this,"lo");p(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let r=~this.hi>>>0;return t===0&&(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let r=~this.hi>>>0;return t===0&&(r=r+1>>>0),-(BigInt(t)+(BigInt(r)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}static fromBigInt(e){if(e===0n)return _s;if(e<aw&&e>cw)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let r=e>>32n,s=e-(r<<32n);return t&&(r=~r|0n,s=~s|0n,++s>g4&&(s=0n,++r>g4&&(r=0n))),new Mt(Number(s),Number(r))}static fromNumber(e){if(e===0)return _s;const t=e<0;t&&(e=-e);let r=e>>>0,s=(e-r)/4294967296>>>0;return t&&(s=~s>>>0,r=~r>>>0,++r>4294967295&&(r=0,++s>4294967295&&(s=0))),new Mt(r,s)}static from(e){return typeof e=="number"?Mt.fromNumber(e):typeof e=="bigint"?Mt.fromBigInt(e):typeof e=="string"?Mt.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new Mt(e.low>>>0,e.high>>>0):_s}}const _s=new Mt(0,0);_s.toBigInt=function(){return 0n};_s.zzEncode=_s.zzDecode=function(){return this};_s.length=function(){return 1};const g4=4294967296n;function lw(n){let e=0,t=0;for(let r=0;r<n.length;++r)t=n.charCodeAt(r),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(n.charCodeAt(r+1)&64512)===56320?(++r,e+=4):e+=3;return e}function uw(n,e,t){if(t-e<1)return"";let s;const i=[];let o=0,a;for(;e<t;)a=n[e++],a<128?i[o++]=a:a>191&&a<224?i[o++]=(a&31)<<6|n[e++]&63:a>239&&a<365?(a=((a&7)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,i[o++]=55296+(a>>10),i[o++]=56320+(a&1023)):i[o++]=(a&15)<<12|(n[e++]&63)<<6|n[e++]&63,o>8191&&((s??(s=[])).push(String.fromCharCode.apply(String,i)),o=0);return s!=null?(o>0&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))}function k5(n,e,t){const r=t;let s,i;for(let o=0;o<n.length;++o)s=n.charCodeAt(o),s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&((i=n.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(i&1023),++o,e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128);return t-r}function Ir(n,e){return RangeError(`index out of range: ${n.pos} + ${e??1} > ${n.len}`)}function mc(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}class hw{constructor(e){p(this,"buf");p(this,"pos");p(this,"len");p(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Ir(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Ir(this,4);return mc(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Ir(this,4);return mc(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Ir(this,4);const e=sw(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Ir(this,4);const e=ow(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw Ir(this,e);return this.pos+=e,t===r?new Uint8Array(0):this.buf.subarray(t,r)}string(){const e=this.bytes();return uw(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Ir(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Ir(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new Mt(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Ir(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Ir(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Ir(this,8);const e=mc(this.buf,this.pos+=4),t=mc(this.buf,this.pos+=4);return new Mt(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=I5(this.buf,this.pos);return this.pos+=mr(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function dw(n){return new hw(n instanceof Uint8Array?n:n.subarray())}function Vt(n,e,t){const r=dw(n);return e.decode(r,void 0,t)}function fw(n){let r,s=8192;return function(o){if(o<1||o>4096)return Qr(o);s+o>8192&&(r=Qr(8192),s=0);const a=r.subarray(s,s+=o);return s&7&&(s=(s|7)+1),a}}class Co{constructor(e,t,r){p(this,"fn");p(this,"len");p(this,"next");p(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=r}}function uu(){}class pw{constructor(e){p(this,"head");p(this,"tail");p(this,"len");p(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const gw=fw();function mw(n){return globalThis.Buffer!=null?Qr(n):gw(n)}class e1{constructor(){p(this,"len");p(this,"head");p(this,"tail");p(this,"states");this.len=0,this.head=new Co(uu,0,0),this.tail=this.head,this.states=null}_push(e,t,r){return this.tail=this.tail.next=new Co(e,t,r),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new xw((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(yc,10,Mt.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=Mt.fromBigInt(e);return this._push(yc,t.length(),t)}uint64Number(e){return this._push(T5,mr(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=Mt.fromBigInt(e).zzEncode();return this._push(yc,t.length(),t)}sint64Number(e){const t=Mt.fromNumber(e).zzEncode();return this._push(yc,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(hu,1,e?1:0)}fixed32(e){return this._push(Eo,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=Mt.fromBigInt(e);return this._push(Eo,4,t.lo)._push(Eo,4,t.hi)}fixed64Number(e){const t=Mt.fromNumber(e);return this._push(Eo,4,t.lo)._push(Eo,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(nw,4,e)}double(e){return this._push(iw,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(hu,1,0):this.uint32(t)._push(vw,t,e)}string(e){const t=lw(e);return t!==0?this.uint32(t)._push(k5,t,e):this._push(hu,1,0)}fork(){return this.states=new pw(this),this.head=this.tail=new Co(uu,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Co(uu,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r!==0&&(this.tail.next=e.next,this.tail=t,this.len+=r),this}finish(){let e=this.head.next;const t=mw(this.len);let r=0;for(;e!=null;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t}}function hu(n,e,t){e[t]=n&255}function yw(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}class xw extends Co{constructor(t,r){super(yw,t,r);p(this,"next");this.next=void 0}}function yc(n,e,t){for(;n.hi!==0;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}function Eo(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function vw(n,e,t){e.set(n,t)}globalThis.Buffer!=null&&(e1.prototype.bytes=function(n){const e=n.length>>>0;return this.uint32(e),e>0&&this._push(bw,e,n),this},e1.prototype.string=function(n){const e=globalThis.Buffer.byteLength(n);return this.uint32(e),e>0&&this._push(ww,e,n),this});function bw(n,e,t){e.set(n,t)}function ww(n,e,t){n.length<40?k5(n,e,t):e.utf8Write!=null?e.utf8Write(n,t):e.set(oe(n),t)}function _w(){return new e1}function Ut(n,e){const t=_w();return e.encode(n,t,{lengthDelimited:!1}),t.finish()}var bl;(function(n){n[n.VARINT=0]="VARINT",n[n.BIT64=1]="BIT64",n[n.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",n[n.START_GROUP=3]="START_GROUP",n[n.END_GROUP=4]="END_GROUP",n[n.BIT32=5]="BIT32"})(bl||(bl={}));function P5(n,e,t,r){return{name:n,type:e,encode:t,decode:r}}function r0(n){function e(s){if(n[s.toString()]==null)throw new Error("Invalid enum value");return n[s]}const t=function(i,o){const a=e(i);o.int32(a)},r=function(i){const o=i.int32();return e(o)};return P5("enum",bl.VARINT,t,r)}function $t(n,e){return P5("message",bl.LENGTH_DELIMITED,n,e)}class Ci extends Error{constructor(){super(...arguments);p(this,"code","ERR_MAX_LENGTH");p(this,"name","MaxLengthError")}}class m4 extends Error{constructor(){super(...arguments);p(this,"code","ERR_MAX_SIZE");p(this,"name","MaxSizeError")}}var Ct;(function(n){n.RSA="RSA",n.Ed25519="Ed25519",n.secp256k1="secp256k1",n.ECDSA="ECDSA"})(Ct||(Ct={}));var t1;(function(n){n[n.RSA=0]="RSA",n[n.Ed25519=1]="Ed25519",n[n.secp256k1=2]="secp256k1",n[n.ECDSA=3]="ECDSA"})(t1||(t1={}));(function(n){n.codec=()=>r0(t1)})(Ct||(Ct={}));var Si;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),Ct.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.Type=Ct.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(Si||(Si={}));var y4;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),Ct.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.Type=Ct.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(y4||(y4={}));function Bd(n){if(isNaN(n)||n<=0)throw new pe("random bytes length must be a Number bigger than 0");return e0(n)}class x4 extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class Ew extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const v4={get(n=globalThis){const e=n.crypto;if((e==null?void 0:e.subtle)==null)throw new Ew("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}},Aw=c5;class Cw{constructor(e,t){p(this,"type","RSA");p(this,"jwk");p(this,"_raw");p(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=Pw(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return Ce.createV1(114,this._multihash)}toString(){return Ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ne(this.raw,e.raw)}verify(e,t){return Bw(this.jwk,t,e)}}const Sw=18,Tw=1062,Iw=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function kw(n){const e=Zl(n[1],{offset:0});return{kty:"RSA",n:ie(e[0],"base64url"),e:ie(e[1],"base64url")}}function Pw(n){if(n.n==null||n.e==null)throw new pe("JWK was missing components");return Po([Iw,e5(Po([Qh(oe(n.n,"base64url")),Qh(oe(n.e,"base64url"))]))]).subarray()}function Dw(n,e){if(n.byteLength>=Tw)throw new Yo("Key size is too large");const t=Zl(n,{offset:0});return Rw(t,n,e)}function Rw(n,e,t){const r=kw(n);if(t==null){const s=Aw(Si.encode({Type:Ct.RSA,Data:e}));t=Ss(Sw,s)}return new Cw(r,t)}async function Bw(n,e,t){const r=await v4.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return v4.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,e,t instanceof Uint8Array?t:t.subarray())}class D5 extends s5{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,r5(e);const r=vd(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(r.length>s?e.create().update(r).digest():r);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Ts(i)}update(e){return ml(this),this.iHash.update(e),this}digestInto(e){ml(this),zi(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Fd=(n,e,t)=>new D5(n,e).update(t).digest();Fd.create=(n,e)=>new D5(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function b4(n){n.lowS!==void 0&&$n("lowS",n.lowS),n.prehash!==void 0&&$n("prehash",n.prehash)}function Fw(n){const e=Ad(n);Da(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});const{endo:t,Fp:r,a:s}=e;if(t){if(!r.eql(s,r.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze({...e})}class Nw extends Error{constructor(e=""){super(e)}}const ln={Err:Nw,_tlv:{encode:(n,e)=>{const{Err:t}=ln;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,s=gc(r);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const i=r>127?gc(s.length/2|128):"";return gc(n)+i+s+e},decode(n,e){const{Err:t}=ln;let r=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==n)throw new t("tlv.decode: wrong tlv");const s=e[r++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(r,r+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(r+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(n){const{Err:e}=ln;if(n<hn)throw new e("integer: negative integers are not allowed");let t=gc(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=ln;if(n[0]&128)throw new e("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ws(n)}},toSig(n){const{Err:e,_int:t,_tlv:r}=ln,s=it("signature",n),{v:i,l:o}=r.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,i),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(n){const{_tlv:e,_int:t}=ln,r=e.encode(2,t.encode(n.r)),s=e.encode(2,t.encode(n.s)),i=r+s;return e.encode(48,i)}};function du(n,e){return Ei(Pa(n,e))}const hn=BigInt(0),gt=BigInt(1);BigInt(2);const fu=BigInt(3),Lw=BigInt(4);function Mw(n){const e=Fw(n),{Fp:t}=e,r=Ra(e.n,e.nBitLength),s=e.toBytes||((_,E,B)=>{const F=E.toAffine();return Ai(Uint8Array.from([4]),t.toBytes(F.x),t.toBytes(F.y))}),i=e.fromBytes||(_=>{const E=_.subarray(1),B=t.fromBytes(E.subarray(0,t.BYTES)),F=t.fromBytes(E.subarray(t.BYTES,2*t.BYTES));return{x:B,y:F}});function o(_){const{a:E,b:B}=e,F=t.sqr(_),A=t.mul(F,_);return t.add(t.add(A,t.mul(_,E)),B)}function a(_,E){const B=t.sqr(E),F=o(_);return t.eql(B,F)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");const c=t.mul(t.pow(e.a,fu),Lw),l=t.mul(t.sqr(e.b),BigInt(27));if(t.is0(t.add(c,l)))throw new Error("bad curve params: a or b");function u(_){return _d(_,gt,e.n)}function d(_){const{allowedPrivateKeyLengths:E,nByteLength:B,wrapPrivateKey:F,n:A}=e;if(E&&typeof _!="bigint"){if(ka(_)&&(_=Ei(_)),typeof _!="string"||!E.includes(_.length))throw new Error("invalid private key");_=_.padStart(B*2,"0")}let w;try{w=typeof _=="bigint"?_:ws(it("private key",_,B))}catch{throw new Error("invalid private key, expected hex or "+B+" bytes, got "+typeof _)}return F&&(w=ze(w,A)),kr("private key",w,gt,A),w}function f(_){if(!(_ instanceof b))throw new Error("ProjectivePoint expected")}const m=vl((_,E)=>{const{px:B,py:F,pz:A}=_;if(t.eql(A,t.ONE))return{x:B,y:F};const w=_.is0();E==null&&(E=w?t.ONE:t.inv(A));const k=t.mul(B,E),C=t.mul(F,E),I=t.mul(A,E);if(w)return{x:t.ZERO,y:t.ZERO};if(!t.eql(I,t.ONE))throw new Error("invZ was invalid");return{x:k,y:C}}),y=vl(_=>{if(_.is0()){if(e.allowInfinityPoint&&!t.is0(_.py))return;throw new Error("bad point: ZERO")}const{x:E,y:B}=_.toAffine();if(!t.isValid(E)||!t.isValid(B))throw new Error("bad point: x or y not FE");if(!a(E,B))throw new Error("bad point: equation left != right");if(!_.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class b{constructor(E,B,F){if(E==null||!t.isValid(E))throw new Error("x required");if(B==null||!t.isValid(B)||t.is0(B))throw new Error("y required");if(F==null||!t.isValid(F))throw new Error("z required");this.px=E,this.py=B,this.pz=F,Object.freeze(this)}static fromAffine(E){const{x:B,y:F}=E||{};if(!E||!t.isValid(B)||!t.isValid(F))throw new Error("invalid affine point");if(E instanceof b)throw new Error("projective point not allowed");const A=w=>t.eql(w,t.ZERO);return A(B)&&A(F)?b.ZERO:new b(B,F,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(E){const B=Ed(t,E.map(F=>F.pz));return E.map((F,A)=>F.toAffine(B[A])).map(b.fromAffine)}static fromHex(E){const B=b.fromAffine(i(it("pointHex",E)));return B.assertValidity(),B}static fromPrivateKey(E){return b.BASE.multiply(d(E))}static msm(E,B){return _5(b,r,E,B)}_setWindowSize(E){S.setWindowSize(this,E)}assertValidity(){y(this)}hasEvenY(){const{y:E}=this.toAffine();if(t.isOdd)return!t.isOdd(E);throw new Error("Field doesn't support isOdd")}equals(E){f(E);const{px:B,py:F,pz:A}=this,{px:w,py:k,pz:C}=E,I=t.eql(t.mul(B,C),t.mul(w,A)),R=t.eql(t.mul(F,C),t.mul(k,A));return I&&R}negate(){return new b(this.px,t.neg(this.py),this.pz)}double(){const{a:E,b:B}=e,F=t.mul(B,fu),{px:A,py:w,pz:k}=this;let C=t.ZERO,I=t.ZERO,R=t.ZERO,T=t.mul(A,A),G=t.mul(w,w),H=t.mul(k,k),z=t.mul(A,w);return z=t.add(z,z),R=t.mul(A,k),R=t.add(R,R),C=t.mul(E,R),I=t.mul(F,H),I=t.add(C,I),C=t.sub(G,I),I=t.add(G,I),I=t.mul(C,I),C=t.mul(z,C),R=t.mul(F,R),H=t.mul(E,H),z=t.sub(T,H),z=t.mul(E,z),z=t.add(z,R),R=t.add(T,T),T=t.add(R,T),T=t.add(T,H),T=t.mul(T,z),I=t.add(I,T),H=t.mul(w,k),H=t.add(H,H),T=t.mul(H,z),C=t.sub(C,T),R=t.mul(H,G),R=t.add(R,R),R=t.add(R,R),new b(C,I,R)}add(E){f(E);const{px:B,py:F,pz:A}=this,{px:w,py:k,pz:C}=E;let I=t.ZERO,R=t.ZERO,T=t.ZERO;const G=e.a,H=t.mul(e.b,fu);let z=t.mul(B,w),W=t.mul(F,k),K=t.mul(A,C),O=t.add(B,F),q=t.add(w,k);O=t.mul(O,q),q=t.add(z,W),O=t.sub(O,q),q=t.add(B,A);let N=t.add(w,C);return q=t.mul(q,N),N=t.add(z,K),q=t.sub(q,N),N=t.add(F,A),I=t.add(k,C),N=t.mul(N,I),I=t.add(W,K),N=t.sub(N,I),T=t.mul(G,q),I=t.mul(H,K),T=t.add(I,T),I=t.sub(W,T),T=t.add(W,T),R=t.mul(I,T),W=t.add(z,z),W=t.add(W,z),K=t.mul(G,K),q=t.mul(H,q),W=t.add(W,K),K=t.sub(z,K),K=t.mul(G,K),q=t.add(q,K),z=t.mul(W,q),R=t.add(R,z),z=t.mul(N,q),I=t.mul(O,I),I=t.sub(I,z),z=t.mul(O,W),T=t.mul(N,T),T=t.add(T,z),new b(I,R,T)}subtract(E){return this.add(E.negate())}is0(){return this.equals(b.ZERO)}wNAF(E){return S.wNAFCached(this,E,b.normalizeZ)}multiplyUnsafe(E){const{endo:B,n:F}=e;kr("scalar",E,hn,F);const A=b.ZERO;if(E===hn)return A;if(this.is0()||E===gt)return this;if(!B||S.hasPrecomputes(this))return S.wNAFCachedUnsafe(this,E,b.normalizeZ);let{k1neg:w,k1:k,k2neg:C,k2:I}=B.splitScalar(E),R=A,T=A,G=this;for(;k>hn||I>hn;)k&gt&&(R=R.add(G)),I&gt&&(T=T.add(G)),G=G.double(),k>>=gt,I>>=gt;return w&&(R=R.negate()),C&&(T=T.negate()),T=new b(t.mul(T.px,B.beta),T.py,T.pz),R.add(T)}multiply(E){const{endo:B,n:F}=e;kr("scalar",E,gt,F);let A,w;if(B){const{k1neg:k,k1:C,k2neg:I,k2:R}=B.splitScalar(E);let{p:T,f:G}=this.wNAF(C),{p:H,f:z}=this.wNAF(R);T=S.constTimeNegate(k,T),H=S.constTimeNegate(I,H),H=new b(t.mul(H.px,B.beta),H.py,H.pz),A=T.add(H),w=G.add(z)}else{const{p:k,f:C}=this.wNAF(E);A=k,w=C}return b.normalizeZ([A,w])[0]}multiplyAndAddUnsafe(E,B,F){const A=b.BASE,w=(C,I)=>I===hn||I===gt||!C.equals(A)?C.multiplyUnsafe(I):C.multiply(I),k=w(this,B).add(w(E,F));return k.is0()?void 0:k}toAffine(E){return m(this,E)}isTorsionFree(){const{h:E,isTorsionFree:B}=e;if(E===gt)return!0;if(B)return B(b,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:E,clearCofactor:B}=e;return E===gt?this:B?B(b,this):this.multiplyUnsafe(e.h)}toRawBytes(E=!0){return $n("isCompressed",E),this.assertValidity(),s(b,this,E)}toHex(E=!0){return $n("isCompressed",E),Ei(this.toRawBytes(E))}}b.BASE=new b(e.Gx,e.Gy,t.ONE),b.ZERO=new b(t.ZERO,t.ONE,t.ZERO);const{endo:x,nBitLength:D}=e,S=w5(b,x?Math.ceil(D/2):D);return{CURVE:e,ProjectivePoint:b,normPrivateKeyToScalar:d,weierstrassEquation:o,isWithinCurveOrder:u}}function Ow(n){const e=Ad(n);return Da(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function Vw(n){const e=Ow(n),{Fp:t,n:r,nByteLength:s,nBitLength:i}=e,o=t.BYTES+1,a=2*t.BYTES+1;function c(H){return ze(H,r)}function l(H){return Xh(H,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:d,weierstrassEquation:f,isWithinCurveOrder:m}=Mw({...e,toBytes(H,z,W){const K=z.toAffine(),O=t.toBytes(K.x),q=Ai;return $n("isCompressed",W),W?q(Uint8Array.from([z.hasEvenY()?2:3]),O):q(Uint8Array.from([4]),O,t.toBytes(K.y))},fromBytes(H){const z=H.length,W=H[0],K=H.subarray(1);if(z===o&&(W===2||W===3)){const O=ws(K);if(!_d(O,gt,t.ORDER))throw new Error("Point is not on curve");const q=f(O);let N;try{N=t.sqrt(q)}catch(U){const ee=U instanceof Error?": "+U.message:"";throw new Error("Point is not on curve"+ee)}const M=(N&gt)===gt;return(W&1)===1!==M&&(N=t.neg(N)),{x:O,y:N}}else if(z===a&&W===4){const O=t.fromBytes(K.subarray(0,t.BYTES)),q=t.fromBytes(K.subarray(t.BYTES,2*t.BYTES));return{x:O,y:q}}else{const O=o,q=a;throw new Error("invalid Point, expected length of "+O+", or uncompressed "+q+", got "+z)}}});function y(H){const z=r>>gt;return H>z}function b(H){return y(H)?c(-H):H}const x=(H,z,W)=>ws(H.slice(z,W));class D{constructor(z,W,K){kr("r",z,gt,r),kr("s",W,gt,r),this.r=z,this.s=W,K!=null&&(this.recovery=K),Object.freeze(this)}static fromCompact(z){const W=s;return z=it("compactSignature",z,W*2),new D(x(z,0,W),x(z,W,2*W))}static fromDER(z){const{r:W,s:K}=ln.toSig(it("DER",z));return new D(W,K)}assertValidity(){}addRecoveryBit(z){return new D(this.r,this.s,z)}recoverPublicKey(z){const{r:W,s:K,recovery:O}=this,q=A(it("msgHash",z));if(O==null||![0,1,2,3].includes(O))throw new Error("recovery id invalid");const N=O===2||O===3?W+e.n:W;if(N>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const M=O&1?"03":"02",V=u.fromHex(M+du(N,t.BYTES)),U=l(N),ee=c(-q*U),ne=c(K*U),ae=u.BASE.multiplyAndAddUnsafe(V,ee,ne);if(!ae)throw new Error("point at infinify");return ae.assertValidity(),ae}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new D(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return yl(this.toDERHex())}toDERHex(){return ln.hexFromSig(this)}toCompactRawBytes(){return yl(this.toCompactHex())}toCompactHex(){const z=s;return du(this.r,z)+du(this.s,z)}}const S={isValidPrivateKey(H){try{return d(H),!0}catch{return!1}},normPrivateKeyToScalar:d,randomPrivateKey:()=>{const H=x5(e.n);return Rb(e.randomBytes(H),e.n)},precompute(H=8,z=u.BASE){return z._setWindowSize(H),z.multiply(BigInt(3)),z}};function _(H,z=!0){return u.fromPrivateKey(H).toRawBytes(z)}function E(H){if(typeof H=="bigint")return!1;if(H instanceof u)return!0;const W=it("key",H).length,K=t.BYTES,O=K+1,q=2*K+1;if(!(e.allowedPrivateKeyLengths||s===O))return W===O||W===q}function B(H,z,W=!0){if(E(H)===!0)throw new Error("first arg must be private key");if(E(z)===!1)throw new Error("second arg must be public key");return u.fromHex(z).multiply(d(H)).toRawBytes(W)}const F=e.bits2int||function(H){if(H.length>8192)throw new Error("input is too large");const z=ws(H),W=H.length*8-i;return W>0?z>>BigInt(W):z},A=e.bits2int_modN||function(H){return c(F(H))},w=t0(i);function k(H){return kr("num < 2^"+i,H,hn,w),Pa(H,s)}function C(H,z,W=I){if(["recovered","canonical"].some(Be=>Be in W))throw new Error("sign() legacy options not supported");const{hash:K,randomBytes:O}=e;let{lowS:q,prehash:N,extraEntropy:M}=W;q==null&&(q=!0),H=it("msgHash",H),b4(W),N&&(H=it("prehashed msgHash",K(H)));const V=A(H),U=d(z),ee=[k(U),k(V)];if(M!=null&&M!==!1){const Be=M===!0?O(t.BYTES):M;ee.push(it("extraEntropy",Be))}const ne=Ai(...ee),ae=V;function re(Be){const Fe=F(Be);if(!m(Fe))return;const Ge=l(Fe),Le=u.BASE.multiply(Fe).toAffine(),Ee=c(Le.x);if(Ee===hn)return;const Te=c(Ge*c(ae+Ee*U));if(Te===hn)return;let ut=(Le.x===Ee?0:2)|Number(Le.y&gt),pt=Te;return q&&y(Te)&&(pt=b(Te),ut^=1),new D(Ee,pt,ut)}return{seed:ne,k2sig:re}}const I={lowS:e.lowS,prehash:!1},R={lowS:e.lowS,prehash:!1};function T(H,z,W=I){const{seed:K,k2sig:O}=C(H,z,W),q=e;return _b(q.hash.outputLen,q.nByteLength,q.hmac)(K,O)}u.BASE._setWindowSize(8);function G(H,z,W,K=R){var ut;const O=H;z=it("msgHash",z),W=it("publicKey",W);const{lowS:q,prehash:N,format:M}=K;if(b4(K),"strict"in K)throw new Error("options.strict was renamed to lowS");if(M!==void 0&&M!=="compact"&&M!=="der")throw new Error("format must be compact or der");const V=typeof O=="string"||ka(O),U=!V&&!M&&typeof O=="object"&&O!==null&&typeof O.r=="bigint"&&typeof O.s=="bigint";if(!V&&!U)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let ee,ne;try{if(U&&(ee=new D(O.r,O.s)),V){try{M!=="compact"&&(ee=D.fromDER(O))}catch(pt){if(!(pt instanceof ln.Err))throw pt}!ee&&M!=="der"&&(ee=D.fromCompact(O))}ne=u.fromHex(W)}catch{return!1}if(!ee||q&&ee.hasHighS())return!1;N&&(z=e.hash(z));const{r:ae,s:re}=ee,Be=A(z),Fe=l(re),Ge=c(Be*Fe),Le=c(ae*Fe),Ee=(ut=u.BASE.multiplyAndAddUnsafe(ne,Ge,Le))==null?void 0:ut.toAffine();return Ee?c(Ee.x)===ae:!1}return{CURVE:e,getPublicKey:_,getSharedSecret:B,sign:T,verify:G,ProjectivePoint:u,Signature:D,utils:S}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Uw(n){return{hash:n,hmac:(e,...t)=>Fd(n,e,rb(...t)),randomBytes:e0}}function $w(n,e){const t=r=>Vw({...n,...Uw(r)});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const R5=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),w4=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Hw=BigInt(0),qw=BigInt(1),r1=BigInt(2),_4=(n,e)=>(n+e/r1)/e;function zw(n){const e=R5,t=BigInt(3),r=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=n*n*n%e,u=l*l*n%e,d=et(u,t,e)*u%e,f=et(d,t,e)*u%e,m=et(f,r1,e)*l%e,y=et(m,s,e)*m%e,b=et(y,i,e)*y%e,x=et(b,a,e)*b%e,D=et(x,c,e)*x%e,S=et(D,a,e)*b%e,_=et(S,t,e)*u%e,E=et(_,o,e)*y%e,B=et(E,r,e)*l%e,F=et(B,r1,e);if(!n1.eql(n1.sqr(F),n))throw new Error("Cannot find square root");return F}const n1=Ra(R5,void 0,void 0,{sqrt:zw}),gr=$w({a:Hw,b:BigInt(7),Fp:n1,n:w4,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const e=w4,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-qw*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,o=BigInt("0x100000000000000000000000000000000"),a=_4(i*n,e),c=_4(-r*n,e);let l=ze(n-a*t-c*s,e),u=ze(-a*r-c*i,e);const d=l>o,f=u>o;if(d&&(l=e-l),f&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:d,k1:l,k2neg:f,k2:u}}}},c5);function Kw(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}function jw(n,e,t){const r=Xt.digest(t instanceof Uint8Array?t:t.subarray());if(Kw(r))return r.then(({digest:s})=>gr.verify(e,s,n)).catch(s=>{throw new x4(String(s))});try{return gr.verify(e,r.digest,n)}catch(s){throw new x4(String(s))}}let Gw=class{constructor(e){p(this,"type","secp256k1");p(this,"raw");p(this,"_key");this._key=Qw(e),this.raw=Ww(this._key)}toMultihash(){return Rr.digest(Hn(this))}toCID(){return Ce.createV1(114,this.toMultihash())}toString(){return Ke.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Ne(this.raw,e.raw)}verify(e,t){return jw(this._key,t,e)}};function B5(n){return new Gw(n)}function Ww(n){return gr.ProjectivePoint.fromHex(n).toRawBytes(!0)}function Qw(n){try{return gr.ProjectivePoint.fromHex(n),n}catch(e){throw new Yo(String(e))}}async function Yw(n,e){return Xb()}function Ba(n,e){const{Type:t,Data:r}=Si.decode(n),s=r??new Uint8Array;switch(t){case Ct.RSA:return Dw(s,e);case Ct.Ed25519:return S5(s);case Ct.secp256k1:return B5(s);case Ct.ECDSA:return t5(s);default:throw new Yl}}function Xw(n){const{Type:e,Data:t}=Si.decode(n.digest),r=t??new Uint8Array;switch(e){case Ct.Ed25519:return S5(r);case Ct.secp256k1:return B5(r);case Ct.ECDSA:return t5(r);default:throw new Yl}}function Hn(n){return Si.encode({Type:Ct[n.type],Data:n.raw})}const F5=Symbol.for("nodejs.util.inspect.custom"),Jw=114;var A6;let Nd=class{constructor(e){p(this,"type");p(this,"multihash");p(this,"publicKey");p(this,"string");p(this,A6,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Ke.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Ce.createV1(Jw,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return Ne(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return Ne(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(A6=cd,F5)](){return`PeerId(${this.toString()})`}};class N5 extends Nd{constructor(t){super({...t,type:"RSA"});p(this,"type","RSA");p(this,"publicKey");this.publicKey=t.publicKey}}class L5 extends Nd{constructor(t){super({...t,type:"Ed25519"});p(this,"type","Ed25519");p(this,"publicKey");this.publicKey=t.publicKey}}class M5 extends Nd{constructor(t){super({...t,type:"secp256k1"});p(this,"type","secp256k1");p(this,"publicKey");this.publicKey=t.publicKey}}const Zw=2336;var C6,S6;class O5{constructor(e){p(this,"type","url");p(this,"multihash");p(this,"publicKey");p(this,"url");p(this,C6,!0);this.url=e.toString(),this.multihash=Rr.digest(oe(this.url))}[(S6=F5,C6=cd,S6)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Ce.createV1(Zw,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=ie(e)),e.toString()===this.toString())}}const e_=114,E4=2336;function Is(n,e){let t;if(n.charAt(0)==="1"||n.charAt(0)==="Q")t=cr(Ke.decode(`z${n}`));else{if(n.startsWith("k51qzi5uqu5")||n.startsWith("kzwfwjn5ji4")||n.startsWith("k2k4r8")||n.startsWith("bafz"))return Md(Ce.parse(n));throw new pe('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return vn(t)}function Ld(n){if(n.type==="Ed25519")return new L5({multihash:n.toCID().multihash,publicKey:n});if(n.type==="secp256k1")return new M5({multihash:n.toCID().multihash,publicKey:n});if(n.type==="RSA")return new N5({multihash:n.toCID().multihash,publicKey:n});throw new Yl}function t_(n){return Ld(n.publicKey)}function vn(n){if(n_(n))return new N5({multihash:n});if(r_(n))try{const e=Xw(n);if(e.type==="Ed25519")return new L5({multihash:n,publicKey:e});if(e.type==="secp256k1")return new M5({multihash:n,publicKey:e})}catch{const t=ie(n.digest);return new O5(new URL(t))}throw new H8("Supplied PeerID Multihash is invalid")}function Md(n){if((n==null?void 0:n.multihash)==null||n.version==null||n.version===1&&n.code!==e_&&n.code!==E4)throw new $8("Supplied PeerID CID is invalid");if(n.code===E4){const e=ie(n.multihash.digest);return new O5(new URL(e))}return vn(n.multihash)}function r_(n){return n.code===Rr.code}function n_(n){return n.code===Xt.code}class fr extends Event{constructor(t,r){super(t);p(this,"type");p(this,"detail");this.type=t,this.detail=r}}var V5={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function i(c,l,u,d,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new s(u,d||c,f),y=t?t+l:l;return c._events[y]?c._events[y].fn?c._events[y]=[c._events[y],m]:c._events[y].push(m):(c._events[y]=m,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,d;if(this._eventsCount===0)return l;for(d in u=this._events)e.call(u,d)&&l.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=t?t+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,m=d.length,y=new Array(m);f<m;f++)y[f]=d[f].fn;return y},a.prototype.listenerCount=function(l){var u=t?t+l:l,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,u,d,f,m,y){var b=t?t+l:l;if(!this._events[b])return!1;var x=this._events[b],D=arguments.length,S,_;if(x.fn){switch(x.once&&this.removeListener(l,x.fn,void 0,!0),D){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,u),!0;case 3:return x.fn.call(x.context,u,d),!0;case 4:return x.fn.call(x.context,u,d,f),!0;case 5:return x.fn.call(x.context,u,d,f,m),!0;case 6:return x.fn.call(x.context,u,d,f,m,y),!0}for(_=1,S=new Array(D-1);_<D;_++)S[_-1]=arguments[_];x.fn.apply(x.context,S)}else{var E=x.length,B;for(_=0;_<E;_++)switch(x[_].once&&this.removeListener(l,x[_].fn,void 0,!0),D){case 1:x[_].fn.call(x[_].context);break;case 2:x[_].fn.call(x[_].context,u);break;case 3:x[_].fn.call(x[_].context,u,d);break;case 4:x[_].fn.call(x[_].context,u,d,f);break;default:if(!S)for(B=1,S=new Array(D-1);B<D;B++)S[B-1]=arguments[B];x[_].fn.apply(x[_].context,S)}}return!0},a.prototype.on=function(l,u,d){return i(this,l,u,d,!1)},a.prototype.once=function(l,u,d){return i(this,l,u,d,!0)},a.prototype.removeListener=function(l,u,d,f){var m=t?t+l:l;if(!this._events[m])return this;if(!u)return o(this,m),this;var y=this._events[m];if(y.fn)y.fn===u&&(!f||y.once)&&(!d||y.context===d)&&o(this,m);else{for(var b=0,x=[],D=y.length;b<D;b++)(y[b].fn!==u||f&&!y[b].once||d&&y[b].context!==d)&&x.push(y[b]);x.length?this._events[m]=x.length===1?x[0]:x:o(this,m)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(V5);var s_=V5.exports;const i_=qi(s_);class U5 extends Error{constructor(e){super(e),this.name="TimeoutError"}}let o_=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const A4=n=>globalThis.DOMException===void 0?new o_(n):new DOMException(n),C4=n=>{const e=n.reason===void 0?A4("This operation was aborted."):n.reason;return e instanceof Error?e:A4(e)};function Od(n,e){const{milliseconds:t,fallback:r,message:s,customTimers:i={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((u,d)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:m}=e;m.aborted&&d(C4(m)),a=()=>{d(C4(m))},m.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){n.then(u,d);return}const f=new U5;o=i.setTimeout.call(void 0,()=>{if(r){try{u(r())}catch(m){d(m)}return}typeof n.cancel=="function"&&n.cancel(),s===!1?u():s instanceof Error?d(s):(f.message=s??`Promise timed out after ${t} milliseconds`,d(f))},t),(async()=>{try{u(await n)}catch(m){d(m)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},l}function a_(n,e,t){let r=0,s=n.length;for(;s>0;){const i=Math.trunc(s/2);let o=r+i;t(n[o],e)<=0?(r=++o,s-=i+1):s=i}return r}var vr,T6;let c_=(T6=class{constructor(){ke(this,vr,[])}enqueue(e,t){t={priority:0,...t};const r={priority:t.priority,id:t.id,run:e};if(this.size===0||X(this,vr)[this.size-1].priority>=t.priority){X(this,vr).push(r);return}const s=a_(X(this,vr),r,(i,o)=>o.priority-i.priority);X(this,vr).splice(s,0,r)}setPriority(e,t){const r=X(this,vr).findIndex(i=>i.id===e);if(r===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[s]=X(this,vr).splice(r,1);this.enqueue(s.run,{priority:t,id:e})}dequeue(){const e=X(this,vr).shift();return e==null?void 0:e.run}filter(e){return X(this,vr).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return X(this,vr).length}},vr=new WeakMap,T6);var gi,mi,Ln,ba,yi,wa,br,xi,Kt,_a,wr,vi,un,Ea,Wl,Se,$5,H5,q5,z5,K5,Kc,i1,o1,jc,j5,Gc;class s1 extends i_{constructor(t){var r,s;super();ke(this,Se);ke(this,gi);ke(this,mi);ke(this,Ln,0);ke(this,ba);ke(this,yi);ke(this,wa,0);ke(this,br);ke(this,xi);ke(this,Kt);ke(this,_a);ke(this,wr,0);ke(this,vi);ke(this,un);ke(this,Ea);ke(this,Wl,1n);p(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:c_,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((r=t.intervalCap)==null?void 0:r.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((s=t.interval)==null?void 0:s.toString())??""}\` (${typeof t.interval})`);$e(this,gi,t.carryoverConcurrencyCount),$e(this,mi,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),$e(this,ba,t.intervalCap),$e(this,yi,t.interval),$e(this,Kt,new t.queueClass),$e(this,_a,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,$e(this,Ea,t.throwOnTimeout===!0),$e(this,un,t.autoStart===!1)}get concurrency(){return X(this,vi)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);$e(this,vi,t),Ie(this,Se,jc).call(this)}setPriority(t,r){X(this,Kt).setPriority(t,r)}async add(t,r={}){return r.id??(r.id=(vo(this,Wl)._++).toString()),r={timeout:this.timeout,throwOnTimeout:X(this,Ea),...r},new Promise((s,i)=>{X(this,Kt).enqueue(async()=>{var o;vo(this,wr)._++,vo(this,Ln)._++;try{(o=r.signal)==null||o.throwIfAborted();let a=t({signal:r.signal});r.timeout&&(a=Od(Promise.resolve(a),{milliseconds:r.timeout})),r.signal&&(a=Promise.race([a,Ie(this,Se,j5).call(this,r.signal)]));const c=await a;s(c),this.emit("completed",c)}catch(a){if(a instanceof U5&&!r.throwOnTimeout){s();return}i(a),this.emit("error",a)}finally{Ie(this,Se,q5).call(this)}},r),this.emit("add"),Ie(this,Se,Kc).call(this)})}async addAll(t,r){return Promise.all(t.map(async s=>this.add(s,r)))}start(){return X(this,un)?($e(this,un,!1),Ie(this,Se,jc).call(this),this):this}pause(){$e(this,un,!0)}clear(){$e(this,Kt,new(X(this,_a)))}async onEmpty(){X(this,Kt).size!==0&&await Ie(this,Se,Gc).call(this,"empty")}async onSizeLessThan(t){X(this,Kt).size<t||await Ie(this,Se,Gc).call(this,"next",()=>X(this,Kt).size<t)}async onIdle(){X(this,wr)===0&&X(this,Kt).size===0||await Ie(this,Se,Gc).call(this,"idle")}get size(){return X(this,Kt).size}sizeBy(t){return X(this,Kt).filter(t).length}get pending(){return X(this,wr)}get isPaused(){return X(this,un)}}gi=new WeakMap,mi=new WeakMap,Ln=new WeakMap,ba=new WeakMap,yi=new WeakMap,wa=new WeakMap,br=new WeakMap,xi=new WeakMap,Kt=new WeakMap,_a=new WeakMap,wr=new WeakMap,vi=new WeakMap,un=new WeakMap,Ea=new WeakMap,Wl=new WeakMap,Se=new WeakSet,$5=function(){return X(this,mi)||X(this,Ln)<X(this,ba)},H5=function(){return X(this,wr)<X(this,vi)},q5=function(){vo(this,wr)._--,Ie(this,Se,Kc).call(this),this.emit("next")},z5=function(){Ie(this,Se,o1).call(this),Ie(this,Se,i1).call(this),$e(this,xi,void 0)},K5=function(){const t=Date.now();if(X(this,br)===void 0){const r=X(this,wa)-t;if(r<0)$e(this,Ln,X(this,gi)?X(this,wr):0);else return X(this,xi)===void 0&&$e(this,xi,setTimeout(()=>{Ie(this,Se,z5).call(this)},r)),!0}return!1},Kc=function(){if(X(this,Kt).size===0)return X(this,br)&&clearInterval(X(this,br)),$e(this,br,void 0),this.emit("empty"),X(this,wr)===0&&this.emit("idle"),!1;if(!X(this,un)){const t=!X(this,Se,K5);if(X(this,Se,$5)&&X(this,Se,H5)){const r=X(this,Kt).dequeue();return r?(this.emit("active"),r(),t&&Ie(this,Se,i1).call(this),!0):!1}}return!1},i1=function(){X(this,mi)||X(this,br)!==void 0||($e(this,br,setInterval(()=>{Ie(this,Se,o1).call(this)},X(this,yi))),$e(this,wa,Date.now()+X(this,yi)))},o1=function(){X(this,Ln)===0&&X(this,wr)===0&&X(this,br)&&(clearInterval(X(this,br)),$e(this,br,void 0)),$e(this,Ln,X(this,gi)?X(this,wr):0),Ie(this,Se,jc).call(this)},jc=function(){for(;Ie(this,Se,Kc).call(this););},j5=async function(t){return new Promise((r,s)=>{t.addEventListener("abort",()=>{s(t.reason)},{once:!0})})},Gc=async function(t,r){return new Promise(s=>{const i=()=>{r&&!r()||(this.off(t,i),s())};this.on(t,i)})};function G5(n){const e=[Qn.A];return n==null?e:Array.isArray(n)?n.length===0?e:n:[n]}const W5=60;function Q5(n){return{Status:n.Status??0,TC:n.TC??n.flag_tc??!1,RD:n.RD??n.flag_rd??!1,RA:n.RA??n.flag_ra??!1,AD:n.AD??n.flag_ad??!1,CD:n.CD??n.flag_cd??!1,Question:(n.Question??n.questions??[]).map(e=>({name:e.name,type:Qn[e.type]})),Answer:(n.Answer??n.answers??[]).map(e=>({name:e.name,type:Qn[e.type],TTL:e.TTL??e.ttl??W5,data:e.data instanceof Uint8Array?ie(e.data):e.data}))}}const l_=4;function S4(n,e={}){const t=new s1({concurrency:e.queryConcurrency??l_});return async(r,s={})=>{var a;const i=new URLSearchParams;i.set("name",r),G5(s.types).forEach(c=>{i.append("type",Qn[c])}),(a=s.onProgress)==null||a.call(s,new fr("dns:query",{detail:r}));const o=await t.add(async()=>{var u;const c=await fetch(`${n}?${i}`,{headers:{accept:"application/dns-json"},signal:s==null?void 0:s.signal});if(c.status!==200)throw new Error(`Unexpected HTTP status: ${c.status} - ${c.statusText}`);const l=Q5(await c.json());return(u=s.onProgress)==null||u.call(s,new fr("dns:response",{detail:l})),l},{signal:s.signal});if(o==null)throw new Error("No DNS response received");return o}}function u_(){return[S4("https://cloudflare-dns.com/dns-query"),S4("https://dns.google/resolve")]}var h_=function(n){if(!n)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),r=Object.create(null);function s(i,o){t[i]=o,e++,e>=n&&(e=0,r=t,t=Object.create(null))}return{has:function(i){return t[i]!==void 0||r[i]!==void 0},remove:function(i){t[i]!==void 0&&(t[i]=void 0),r[i]!==void 0&&(r[i]=void 0)},get:function(i){var o=t[i];if(o!==void 0)return o;if((o=r[i])!==void 0)return s(i,o),o},set:function(i,o){t[i]!==void 0?t[i]=o:s(i,o)},clear:function(){t=Object.create(null),r=Object.create(null)}}};const d_=qi(h_);class f_{constructor(e){p(this,"lru");this.lru=d_(e)}get(e,t){let r=!0;const s=[];for(const i of t){const o=this.getAnswers(e,i);if(o.length===0){r=!1;break}s.push(...o)}if(r)return Q5({answers:s})}getAnswers(e,t){const r=`${e.toLowerCase()}-${t}`,s=this.lru.get(r);if(s!=null){const i=s.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:Qn[a.type]}));return i.length===0&&this.lru.remove(r),i}return[]}add(e,t){const r=`${e.toLowerCase()}-${t.type}`,s=this.lru.get(r)??[];s.push({expires:Date.now()+(t.TTL??W5)*1e3,value:t}),this.lru.set(r,s)}remove(e,t){const r=`${e.toLowerCase()}-${t}`;this.lru.remove(r)}clear(){this.lru.clear()}}function p_(n){return new f_(n)}const g_=1e3;class m_{constructor(e){p(this,"resolvers");p(this,"cache");this.resolvers={},this.cache=p_(e.cacheSize??g_),Object.entries(e.resolvers??{}).forEach(([t,r])=>{Array.isArray(r)||(r=[r]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=r}),this.resolvers["."]==null&&(this.resolvers["."]=u_())}async query(e,t={}){var c,l,u;const r=G5(t.types),s=t.cached!==!1?this.cache.get(e,r):void 0;if(s!=null)return(c=t.onProgress)==null||c.call(t,new fr("dns:cache",{detail:s})),s;const i=`${e.split(".").pop()}.`,o=(this.resolvers[i]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const d of o){if(((l=t.signal)==null?void 0:l.aborted)===!0)break;try{const f=await d(e,{...t,types:r});for(const m of f.Answer)this.cache.add(e,m);return f}catch(f){a.push(f),(u=t.onProgress)==null||u.call(t,new fr("dns:error",{detail:f}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${r} failed`)}}var Qn;(function(n){n[n.A=1]="A",n[n.CNAME=5]="CNAME",n[n.TXT=16]="TXT",n[n.AAAA=28]="AAAA"})(Qn||(Qn={}));function y_(n={}){return new m_(n)}class x_{constructor(){p(this,"index",0);p(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,r=e();return r===void 0&&(this.index=t),r}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,r){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return r()})}readNumber(e,t,r,s){return this.readAtomically(()=>{let i=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*s)-1;for(;;){const u=this.readAtomically(()=>{const d=this.readChar();if(d===void 0)return;const f=Number.parseInt(d,e);if(!Number.isNaN(f))return f});if(u===void 0)break;if(i*=e,i+=u,i>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!r&&c&&o>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const r=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(r===void 0)return;e[t]=r}return e})}readIPv6Addr(){const e=t=>{for(let r=0;r<t.length/2;r++){const s=r*2;if(r<t.length-3){const o=this.readSeparator(":",r,()=>this.readIPv4Addr());if(o!==void 0)return t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3],[s+4,!0]}const i=this.readSeparator(":",r,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[s,!1];t[s]=i>>8,t[s+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[r,s]=e(t);if(r===16)return t;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const i=new Uint8Array(14),o=16-(r+2),[a]=e(i.subarray(0,o));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const Y5=45,v_=15,Ti=new x_;function X5(n){if(!(n.length>v_))return Ti.new(n).parseWith(()=>Ti.readIPv4Addr())}function J5(n){if(n.includes("%")&&(n=n.split("%")[0]),!(n.length>Y5))return Ti.new(n).parseWith(()=>Ti.readIPv6Addr())}function wl(n,e=!1){if(n.includes("%")&&(n=n.split("%")[0]),n.length>Y5)return;const t=Ti.new(n).parseWith(()=>Ti.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function b_(n,e,t){let r=0;for(const s of n)if(!(r<e)){if(r>t)break;if(s!==255)return!1;r++}return!0}function w_(n,e,t,r){let s=0;for(const i of n)if(!(s<t)){if(s>r)break;if(i!==e[s])return!1;s++}return!0}function __(n){switch(n.length){case Zo:return n.join(".");case ea:{const e=[];for(let t=0;t<n.length;t++)t%2===0&&e.push(n[t].toString(16).padStart(2,"0")+n[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function E_(n){let e=0;for(let[t,r]of n.entries()){if(r===255){e+=8;continue}for(;r&128;)e++,r=r<<1;if(r&128)return-1;for(let s=t+1;s<n.length;s++)if(n[s]!=0)return-1;break}return e}function A_(n){let e="0x";for(const t of n)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const Zo=4,ea=16,C_=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function Z5(n,e){e.length===ea&&n.length===Zo&&b_(e,0,11)&&(e=e.slice(12)),e.length===Zo&&n.length===ea&&w_(n,C_,0,11)&&(n=n.slice(12));const t=n.length;if(t!=e.length)throw new Error("Failed to mask ip");const r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=n[s]&e[s];return r}function S_(n,e){if(typeof e=="string"&&(e=wl(e)),e==null)throw new Error("Invalid ip");if(e.length!==n.network.length)return!1;for(let t=0;t<e.length;t++)if((n.network[t]&n.mask[t])!==(e[t]&n.mask[t]))return!1;return!0}function T_(n){const[e,t]=n.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+n);let r=Zo,s=X5(e);if(s==null&&(r=ea,s=J5(e),s==null))throw new Error("Failed to parse given CIDR: "+n);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>r*8)throw new Error("Failed to parse given CIDR: "+n);const o=eg(i,8*r);return{network:Z5(s,o),mask:o}}function eg(n,e){if(e!==8*Zo&&e!==8*ea)throw new Error("Invalid CIDR mask");if(n<0||n>e)throw new Error("Invalid CIDR mask");const t=e/8,r=new Uint8Array(t);for(let s=0;s<t;s++){if(n>=8){r[s]=255,n-=8;continue}r[s]=255-(255>>n),n=0}return r}class I_{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=T_(e));else{const r=wl(e);if(r==null)throw new Error("Failed to parse network");t=String(t);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>r.length*8){const i=wl(t);if(i==null)throw new Error("Failed to parse mask");this.mask=i}else this.mask=eg(s,8*r.length);this.network=Z5(r,this.mask)}}contains(e){return S_({network:this.network,mask:this.mask},e)}toString(){const e=E_(this.mask),t=e!==-1?String(e):A_(this.mask);return __(this.network)+"/"+t}}function Ii(n){return!!X5(n)}function Vd(n){return!!J5(n)}function tg(n){return!!wl(n)}const T4=Ii,k_=Vd,rg=function(n){let e=0;if(n=n.toString().trim(),T4(n)){const t=new Uint8Array(e+4);return n.split(/\./g).forEach(r=>{t[e++]=parseInt(r,10)&255}),t}if(k_(n)){const t=n.split(":",8);let r;for(r=0;r<t.length;r++){const i=T4(t[r]);let o;i&&(o=rg(t[r]),t[r]=ie(o.slice(0,2),"base16")),o!=null&&++r<8&&t.splice(r,0,ie(o.slice(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(r=0;r<t.length&&t[r]!=="";r++);const i=[r,1];for(r=9-t.length;r>0;r--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(r=0;r<t.length;r++){const i=parseInt(t[r],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},P_=function(n,e=0,t){e=~~e,t=t??n.length-e;const r=new DataView(n.buffer);if(t===4){const s=[];for(let i=0;i<t;i++)s.push(n[e+i]);return s.join(".")}if(t===16){const s=[];for(let i=0;i<t;i+=2)s.push(r.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},hr=-1,ta={},a1={},D_=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,hr,"ip6zone"],[43,8,"ipcidr"],[53,hr,"dns",!0],[54,hr,"dns4",!0],[55,hr,"dns6",!0],[56,hr,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,hr,"unix",!1,!0],[421,hr,"ipfs"],[421,hr,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,hr,"garlic64"],[448,0,"tls"],[449,hr,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,hr,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,hr,"http-path"],[777,hr,"memory"]];D_.forEach(n=>{const e=R_(...n);a1[e.code]=e,ta[e.name]=e});function R_(n,e,t,r,s){return{code:n,size:e,name:t,resolvable:!!r,path:!!s}}function Ve(n){if(typeof n=="number"){if(a1[n]!=null)return a1[n];throw new Error(`no protocol with code: ${n}`)}else if(typeof n=="string"){if(ta[n]!=null)return ta[n];throw new Error(`no protocol with name: ${n}`)}throw new Error(`invalid protocol id type: ${typeof n}`)}const B_=Ve("ip4"),F_=Ve("ip6"),N_=Ve("ipcidr");function ng(n,e){switch(Ve(n).code){case 4:case 41:return O_(e);case 42:return mu(e);case 43:return ie(e,"base10");case 6:case 273:case 33:case 132:return sg(e).toString();case 53:case 54:case 55:case 56:case 400:case 449:case 777:return mu(e);case 421:return H_(e);case 444:return P4(e);case 445:return P4(e);case 466:return $_(e);case 481:return globalThis.encodeURIComponent(mu(e));default:return ie(e,"base16")}}function I4(n,e){switch(Ve(n).code){case 4:return k4(e);case 41:return k4(e);case 42:return gu(e);case 43:return oe(e,"base10");case 6:case 273:case 33:case 132:return Ud(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 449:case 777:return gu(e);case 421:return V_(e);case 444:return q_(e);case 445:return z_(e);case 466:return U_(e);case 481:return gu(globalThis.decodeURIComponent(e));default:return oe(e,"base16")}}function L_(n){let e,t;if(n.stringTuples().forEach(([r,s])=>{(r===B_.code||r===F_.code)&&(t=s),r===N_.code&&(e=s)}),e==null||t==null)throw new Error("Invalid multiaddr");return new I_(t,e)}const pu=Object.values(Jo).map(n=>n.decoder),M_=function(){let n=pu[0].or(pu[1]);return pu.slice(2).forEach(e=>n=n.or(e)),n}();function k4(n){if(!tg(n))throw new Error("invalid ip address");return rg(n)}function O_(n){const e=P_(n,0,n.length);if(e==null)throw new Error("ipBuff is required");if(!tg(e))throw new Error("invalid ip address");return e}function Ud(n){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,n),new Uint8Array(e)}function sg(n){return new DataView(n.buffer).getUint16(n.byteOffset)}function gu(n){const e=oe(n),t=Uint8Array.from(Pr(e.length));return Er([t,e],t.length+e.length)}function mu(n){const e=ss(n);if(n=n.slice(mr(e)),n.length!==e)throw new Error("inconsistent lengths");return ie(n)}function V_(n){let e;n[0]==="Q"||n[0]==="1"?e=cr(Ke.decode(`z${n}`)).bytes:e=Ce.parse(n).multihash.bytes;const t=Uint8Array.from(Pr(e.length));return Er([t,e],t.length+e.length)}function U_(n){const e=M_.decode(n),t=Uint8Array.from(Pr(e.length));return Er([t,e],t.length+e.length)}function $_(n){const e=ss(n),t=n.slice(mr(e));if(t.length!==e)throw new Error("inconsistent lengths");return"u"+ie(t,"base64url")}function H_(n){const e=ss(n),t=n.slice(mr(e));if(t.length!==e)throw new Error("inconsistent lengths");return ie(t,"base58btc")}function q_(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=dn.decode("b"+e[0]),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=Ud(r);return Er([t,s],t.length+s.length)}function z_(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=dn.decode(`b${e[0]}`),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=Ud(r);return Er([t,s],t.length+s.length)}function P4(n){const e=n.slice(0,n.length-2),t=n.slice(n.length-2),r=ie(e,"base32"),s=sg(t);return`${r}:${s}`}function K_(n){n=c1(n);const e=[],t=[];let r=null;const s=n.split("/").slice(1);if(s.length===1&&s[0]==="")return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let i=0;i<s.length;i++){const o=s[i],a=Ve(o);if(a.size===0){e.push([a.code]),t.push([a.code]);continue}if(i++,i>=s.length)throw new $d("invalid address: "+n);if(a.path===!0){r=c1(s.slice(i).join("/")),e.push([a.code,I4(a.code,r)]),t.push([a.code,r]);break}const c=I4(a.code,s[i]);e.push([a.code,c]),t.push([a.code,ng(a.code,c)])}return{string:ig(t),bytes:og(e),tuples:e,stringTuples:t,path:r}}function D4(n){const e=[],t=[];let r=null,s=0;for(;s<n.length;){const i=ss(n,s),o=mr(i),a=Ve(i),c=j_(a,n.slice(s+o));if(c===0){e.push([i]),t.push([i]),s+=o;continue}const l=n.slice(s+o,s+o+c);if(s+=c+o,s>n.length)throw new $d("Invalid address Uint8Array: "+ie(n,"base16"));e.push([i,l]);const u=ng(i,l);if(t.push([i,u]),a.path===!0){r=u;break}}return{bytes:Uint8Array.from(n),string:ig(t),tuples:e,stringTuples:t,path:r}}function ig(n){const e=[];return n.map(t=>{const r=Ve(t[0]);return e.push(r.name),t.length>1&&t[1]!=null&&e.push(t[1]),null}),c1(e.join("/"))}function og(n){return Er(n.map(e=>{const t=Ve(e[0]);let r=Uint8Array.from(Pr(t.code));return e.length>1&&e[1]!=null&&(r=Er([r,e[1]])),r}))}function j_(n,e){if(n.size>0)return n.size/8;if(n.size===0)return 0;{const t=ss(e instanceof Uint8Array?e:Uint8Array.from(e));return t+mr(t)}}function c1(n){return"/"+n.trim().split("/").filter(e=>e).join("/")}class $d extends Error{constructor(t){super(`Error parsing address: ${t}`);p(this,"name","ParseError")}}p($d,"name","ParseError");const G_=Symbol.for("nodejs.util.inspect.custom"),ag=Symbol.for("@multiformats/js-multiaddr/multiaddr"),W_=[Ve("dns").code,Ve("dns4").code,Ve("dns6").code,Ve("dnsaddr").code];class Q_ extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}var I6,bi,Mn,Aa,Ca;const ai=class ai{constructor(e){p(this,"bytes");ke(this,bi);ke(this,Mn);ke(this,Aa);ke(this,Ca);p(this,I6,!0);e==null&&(e="");let t;if(e instanceof Uint8Array)t=D4(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);t=K_(e)}else if(n0(e))t=D4(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=t.bytes,$e(this,bi,t.string),$e(this,Mn,t.tuples),$e(this,Aa,t.stringTuples),$e(this,Ca,t.path)}toString(){return X(this,bi)}toJSON(){return this.toString()}toOptions(){let e,t,r,s,i="";const o=Ve("tcp"),a=Ve("udp"),c=Ve("ip4"),l=Ve("ip6"),u=Ve("dns6"),d=Ve("ip6zone");for(const[m,y]of this.stringTuples())m===d.code&&(i=`%${y??""}`),W_.includes(m)&&(t=o.name==="tcp"?"tcp":"udp",s=443,r=`${y??""}${i}`,e=m===u.code?6:4),(m===o.code||m===a.code)&&(t=Ve(m).name==="tcp"?"tcp":"udp",s=parseInt(y??"")),(m===c.code||m===l.code)&&(t=Ve(m).name==="tcp"?"tcp":"udp",r=`${y??""}${i}`,e=m===l.code?6:4);if(e==null||t==null||r==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:r,transport:t,port:s}}protos(){return X(this,Mn).map(([e])=>Object.assign({},Ve(e)))}protoCodes(){return X(this,Mn).map(([e])=>e)}protoNames(){return X(this,Mn).map(([e])=>Ve(e).name)}tuples(){return X(this,Mn).map(([e,t])=>t==null?[e]:[e,t])}stringTuples(){return X(this,Aa).map(([e,t])=>t==null?[e]:[e,t])}encapsulate(e){return e=new ai(e),new ai(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),r=this.toString(),s=r.lastIndexOf(t);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ai(r.slice(0,s))}decapsulateCode(e){const t=this.tuples();for(let r=t.length-1;r>=0;r--)if(t[r][0]===e)return new ai(og(t.slice(0,r)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach(([r,s])=>{r===ta.p2p.code&&e.push([r,s]),r===ta["p2p-circuit"].code&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const r=t[1];return r[0]==="Q"||r[0]==="1"?ie(Ke.decode(`z${r}`),"base58btc"):ie(Ce.parse(r).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){return X(this,Ca)}equals(e){return Ne(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const r=Hd.get(t.name);if(r==null)throw new Q_(`no available resolver for ${t.name}`);return(await r(this,e)).map(i=>qe(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return!(t.length!==2||t[0].code!==4&&t[0].code!==41||t[1].code!==6&&t[1].code!==273)}[(I6=ag,G_)](){return`Multiaddr(${X(this,bi)})`}};bi=new WeakMap,Mn=new WeakMap,Aa=new WeakMap,Ca=new WeakMap;let l1=ai;const Hd=new Map;function n0(n){return!!(n!=null&&n[ag])}function qe(n){return new l1(n)}const Y_=32,{code:X_}=Ve("dnsaddr");class J_ extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const cg=async function(e,t={}){const r=t.maxRecursiveDepth??Y_;if(r===0)throw new J_("Max recursive depth reached");const[,s]=e.stringTuples().find(([l])=>l===X_)??[],o=await((t==null?void 0:t.dns)??y_()).query(`_dnsaddr.${s}`,{signal:t==null?void 0:t.signal,types:[Qn.TXT]}),a=e.getPeerId(),c=[];for(const l of o.Answer){const u=l.data.replace(/["']/g,"").trim().split("=")[1];if(u==null||a!=null&&!u.includes(a))continue;const d=qe(u);if(u.startsWith("/dnsaddr")){const f=await d.resolve({...t,maxRecursiveDepth:r-1});c.push(...f.map(m=>m.toString()))}else c.push(d.toString())}return c};var Z_=n=>{if(Object.prototype.toString.call(n)!=="[object Object]")return!1;const e=Object.getPrototypeOf(n);return e===null||e===Object.prototype};const _l=Z_,{hasOwnProperty:lg}=Object.prototype,{propertyIsEnumerable:eE}=Object,ki=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),tE=fe,R4={concatArrays:!1,ignoreUndefined:!1},s0=n=>{const e=[];for(const t in n)lg.call(n,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(n);for(const r of t)eE.call(n,r)&&e.push(r)}return e};function Ki(n){return Array.isArray(n)?rE(n):_l(n)?nE(n):n}function rE(n){const e=n.slice(0,0);return s0(n).forEach(t=>{ki(e,t,Ki(n[t]))}),e}function nE(n){const e=Object.getPrototypeOf(n)===null?Object.create(null):{};return s0(n).forEach(t=>{ki(e,t,Ki(n[t]))}),e}const ug=(n,e,t,r)=>(t.forEach(s=>{typeof e[s]>"u"&&r.ignoreUndefined||(s in n&&n[s]!==Object.getPrototypeOf(n)?ki(n,s,u1(n[s],e[s],r)):ki(n,s,Ki(e[s])))}),n),sE=(n,e,t)=>{let r=n.slice(0,0),s=0;return[n,e].forEach(i=>{const o=[];for(let a=0;a<i.length;a++)lg.call(i,a)&&(o.push(String(a)),i===n?ki(r,s++,i[a]):ki(r,s++,Ki(i[a])));r=ug(r,i,s0(i).filter(a=>!o.includes(a)),t)}),r};function u1(n,e,t){return t.concatArrays&&Array.isArray(n)&&Array.isArray(e)?sE(n,e,t):!_l(e)||!_l(n)?Ki(e):ug(n,e,s0(e),t)}var iE=function(...n){const e=u1(Ki(R4),this!==tE&&this||{},R4);let t={_:{}};for(const r of n)if(r!==void 0){if(!_l(r))throw new TypeError("`"+r+"` is not an Option Object");t=u1(t,{_:r},e)}return t._};const hg=qi(iE),oE={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:n=>n},connectionManager:{resolvers:{dnsaddr:cg}},transportManager:{faultTolerance:Wo.FATAL_ALL}};async function aE(n){var t,r;const e=hg(oE,n);if(e.connectionProtector===null&&((r=(t=globalThis.process)==null?void 0:t.env)==null?void 0:r.LIBP2P_FORCE_PNET)!=null)throw new pe("Private network is enforced, but no protector was provided");return e}const Pi=1e3,Di=Pi*60,Ri=Di*60,ks=Ri*24,cE=ks*7,lE=ks*365.25;function dg(n,e){try{if(typeof n=="string"&&n.length>0)return uE(n);if(typeof n=="number"&&isFinite(n))return e!=null&&e.long?dE(n):hE(n);throw new Error("Value is not a string or number.")}catch(t){const r=fE(t)?`${t.message}. value=${JSON.stringify(n)}`:"An unknown error has occured.";throw new Error(r)}}function uE(n){if(n=String(n),n.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(!e)return NaN;const t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*lE;case"weeks":case"week":case"w":return t*cE;case"days":case"day":case"d":return t*ks;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Ri;case"minutes":case"minute":case"mins":case"min":case"m":return t*Di;case"seconds":case"second":case"secs":case"sec":case"s":return t*Pi;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${r} was matched, but no matching case exists.`)}}function hE(n){const e=Math.abs(n);return e>=ks?`${Math.round(n/ks)}d`:e>=Ri?`${Math.round(n/Ri)}h`:e>=Di?`${Math.round(n/Di)}m`:e>=Pi?`${Math.round(n/Pi)}s`:`${n}ms`}function dE(n){const e=Math.abs(n);return e>=ks?xc(n,e,ks,"day"):e>=Ri?xc(n,e,Ri,"hour"):e>=Di?xc(n,e,Di,"minute"):e>=Pi?xc(n,e,Pi,"second"):`${n} ms`}function xc(n,e,t,r){const s=e>=t*1.5;return`${Math.round(n/t)} ${r}${s?"s":""}`}function fE(n){return typeof n=="object"&&n!==null&&"message"in n}function pE(n){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=s,t.enabled=o,t.humanize=dg,t.destroy=l,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,f=null,m,y;function b(...x){if(!b.enabled)return;const D=b,S=Number(new Date),_=S-(d||S);D.diff=_,D.prev=d,D.curr=S,d=S,x[0]=t.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");let E=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(F,A)=>{if(F==="%%")return"%";E++;const w=t.formatters[A];if(typeof w=="function"){const k=x[E];F=w.call(D,k),x.splice(E,1),E--}return F}),t.formatArgs.call(D,x),(D.log||t.log).apply(D,x)}return b.namespace=u,b.useColors=t.useColors(),b.color=t.selectColor(u),b.extend=r,b.destroy=t.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(m!==t.namespaces&&(m=t.namespaces,y=t.enabled(u)),y),set:x=>{f=x}}),typeof t.init=="function"&&t.init(b),b}function r(u,d){const f=t(this.namespace+(typeof d>"u"?":":d)+u);return f.log=this.log,f}function s(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let d;const f=(typeof u=="string"?u:"").split(/[\s,]+/),m=f.length;for(d=0;d<m;d++)f[d]&&(u=f[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function i(){const u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let d,f;for(d=0,f=t.skips.length;d<f;d++)if(t.skips[d].test(u))return!1;for(d=0,f=t.names.length;d<f;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack??u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var gE={};const qr=_E(),mE=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function yE(){var n,e,t,r,s;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((s=navigator.userAgent)==null?void 0:s.toLowerCase().match(/applewebkit\/(\d+)/))}function xE(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+dg(this.diff),!this.useColors)return;const e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(r=t))}),n.splice(r,0,e)}const vE=console.debug??console.log??(()=>{});function bE(n){try{n?qr==null||qr.setItem("debug",n):qr==null||qr.removeItem("debug")}catch{}}function wE(){let n;try{n=qr==null?void 0:qr.getItem("debug")}catch{}return!n&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(n=gE.DEBUG),n}function _E(){try{return localStorage}catch{}}function EE(n){n.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const pr=pE({formatArgs:xE,save:bE,load:wE,useColors:yE,setupFormatters:EE,colors:mE,storage:qr,log:vE});pr.formatters.b=n=>n==null?"undefined":Ke.baseEncode(n);pr.formatters.t=n=>n==null?"undefined":dn.baseEncode(n);pr.formatters.m=n=>n==null?"undefined":yd.baseEncode(n);pr.formatters.p=n=>n==null?"undefined":n.toString();pr.formatters.c=n=>n==null?"undefined":n.toString();pr.formatters.k=n=>n==null?"undefined":n.toString();pr.formatters.a=n=>n==null?"undefined":n.toString();pr.formatters.e=n=>n==null?"undefined":B4(n.stack)??B4(n.message)??n.toString();function AE(n){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=n,e.destroy=()=>!0,e.extend=()=>e,e}function fg(){return{forComponent(n){return CE(n)}}}function CE(n){let e=AE(`${n}:trace`);return pr.enabled(`${n}:trace`)&&pr.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=pr(`${n}:trace`)),Object.assign(pr(n),{error:pr(`${n}:error`),trace:e})}function B4(n){if(n!=null&&(n=n.trim(),n.length!==0))return n}function Ro(n,e){const t={[Symbol.iterator]:()=>t,next:()=>{const r=n.next(),s=r.value;return r.done===!0||s==null?{done:!0,value:void 0}:{done:!1,value:e(s)}}};return t}function yu(n){const e=cr(Ke.decode(`z${n}`));return vn(e)}class Fa{constructor(e){p(this,"map");if(this.map=new Map,e!=null)for(const[t,r]of e.entries())this.map.set(t.toString(),{key:t,value:r})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return Ro(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,r)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return Ro(this.map.values(),e=>e.key)}values(){return Ro(this.map.values(),e=>e.value)}get size(){return this.map.size}}class Gr{constructor(e){p(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return Ro(this.set.entries(),e=>{const t=yu(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const r=yu(t);e(r,r,this)})}has(e){return this.set.has(e.toString())}values(){return Ro(this.set.values(),e=>yu(e))}intersection(e){const t=new Gr;for(const r of e)this.has(r)&&t.add(r);return t}difference(e){const t=new Gr;for(const r of this)e.has(r)||t.add(r);return t}union(e){const t=new Gr;for(const r of e)t.add(r);for(const r of this)t.add(r);return t}}function SE(n,e,t,r){r5(n);const s=nb({dkLen:32,asyncTick:10},r),{c:i,dkLen:o,asyncTick:a}=s;if(ui(i),ui(o),ui(a),i<1)throw new Error("iterations (c) should be >= 1");const c=r4(e),l=r4(t),u=new Uint8Array(o),d=Fd.create(n,c),f=d._cloneInto().update(l);return{c:i,dkLen:o,asyncTick:a,DK:u,PRF:d,PRFSalt:f}}function TE(n,e,t,r,s){return n.destroy(),e.destroy(),r&&r.destroy(),Ts(s),t}async function IE(n,e,t,r){const{c:s,dkLen:i,asyncTick:o,DK:a,PRF:c,PRFSalt:l}=SE(n,e,t,r);let u;const d=new Uint8Array(4),f=zc(d),m=new Uint8Array(c.outputLen);for(let y=1,b=0;b<i;y++,b+=c.outputLen){const x=a.subarray(b,b+c.outputLen);f.setInt32(0,y,!1),(u=l._cloneInto(u)).update(d).digestInto(m),x.set(m.subarray(0,x.length)),await tb(s-1,o,()=>{c._cloneInto(u).update(m).digestInto(m);for(let D=0;D<x.length;D++)x[D]^=m[D]})}return TE(c,l,a,u,m)}const kE=l5,qd={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},pg={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},gg=new globalThis.TextEncoder;function PE(n,e){const t=qd[e];let r=pg[e];for(let s=0;s<n.length;s++)r^=BigInt(n[s]),r=BigInt.asUintN(e,r*t);return r}function DE(n,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const r=qd[e];let s=pg[e],i=n;for(;i.length>0;){const o=gg.encodeInto(i,t);i=i.slice(o.read);for(let a=0;a<o.written;a++)s^=BigInt(t[a]),s=BigInt.asUintN(e,s*r)}return s}function RE(n,{size:e=32,utf8Buffer:t}={}){if(!qd[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof n=="string"){if(t)return DE(n,e,t);n=gg.encode(n)}return PE(n,e)}const zd={hash:n=>Number(RE(n,{size:32})),hashV:(n,e)=>BE(zd.hash(n,e))};function BE(n){let e=n.toString(16);return e.length%2===1&&(e=`0${e}`),oe(e,"base16")}const mg=64;class ys{constructor(e,t,r,s=2){p(this,"fp");p(this,"h");p(this,"seed");if(s>mg)throw new TypeError("Invalid Fingerprint Size");const i=t.hashV(e,r),o=lt(s);for(let a=0;a<o.length;a++)o[a]=i[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=r}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?Ne(this.fp,e.fp):!1}}function El(n,e){return Math.floor(Math.random()*(e-n))+n}class vc{constructor(e){p(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof ys))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof ys))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof ys))throw new TypeError("Invalid Fingerprint");const t=El(0,this.contents.length-1),r=this.contents[t];return this.contents[t]=e,r}remove(e){if(!(e instanceof ys))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(r=>e.equals(r));return t>-1?(this.contents[t]=null,!0):!1}}const FE=500;class F4{constructor(e){p(this,"bucketSize");p(this,"filterSize");p(this,"fingerprintSize");p(this,"buckets");p(this,"count");p(this,"hash");p(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??zd,this.seed=e.seed??El(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=oe(e));const t=new ys(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,s=(r^t.hash())%this.filterSize;if(this.buckets[r]==null&&(this.buckets[r]=new vc(this.bucketSize)),this.buckets[s]==null&&(this.buckets[s]=new vc(this.bucketSize)),this.buckets[r].add(t)||this.buckets[s].add(t))return this.count++,!0;const i=[r,s];let o=i[El(0,i.length-1)];this.buckets[o]==null&&(this.buckets[o]=new vc(this.bucketSize));for(let a=0;a<FE;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new vc(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=oe(e));const t=new ys(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,s=((o=this.buckets[r])==null?void 0:o.has(t))??!1;if(s)return s;const i=(r^t.hash())%this.filterSize;return((a=this.buckets[i])==null?void 0:a.has(t))??!1}remove(e){var a,c;typeof e=="string"&&(e=oe(e));const t=new ys(e,this.hash,this.seed,this.fingerprintSize),r=this.hash.hash(e,this.seed)%this.filterSize,s=((a=this.buckets[r])==null?void 0:a.remove(t))??!1;if(s)return this.count--,s;const i=(r^t.hash())%this.filterSize,o=((c=this.buckets[i])==null?void 0:c.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const NE={1:.5,2:.84,4:.95,8:.98};function LE(n=.001){return n>.002?2:n>1e-5?4:8}function ME(n,e=.001){const t=LE(e),r=NE[t],s=Math.round(n/r),i=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),mg);return{filterSize:s,bucketSize:t,fingerprintSize:i}}class OE{constructor(e){p(this,"filterSize");p(this,"bucketSize");p(this,"fingerprintSize");p(this,"scale");p(this,"filterSeries");p(this,"hash");p(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??zd,this.seed=e.seed??El(0,Math.pow(2,10)),this.filterSeries=[new F4({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=oe(e)),this.has(e))return!0;let t=this.filterSeries.find(r=>r.reliable);if(t==null){const r=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new F4({filterSize:r,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=oe(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=oe(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function yg(n,e=.001,t){return new OE({...ME(n,e)})}var Al;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(r.uint32(10),r.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(r.uint32(18),r.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(r.uint32(26),r.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(r.uint32(42),r.bytes(t.signature)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={publicKey:lt(0),payloadType:lt(0),payload:lt(0),signature:lt(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=t.bytes();break}case 5:{i.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(Al||(Al={}));class VE extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const Bn=class Bn{constructor(e){p(this,"publicKey");p(this,"payloadType");p(this,"payload");p(this,"signature");p(this,"marshaled");const{publicKey:t,payloadType:r,payload:s,signature:i}=e;this.publicKey=t,this.payloadType=r,this.payload=s,this.signature=i}marshal(){return this.marshaled==null&&(this.marshaled=Al.encode({publicKey:Hn(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Ne(this.marshal(),e.marshal())}async validate(e){const t=N4(e,this.payloadType,this.payload);return this.publicKey.verify(t.subarray(),this.signature)}};p(Bn,"createFromProtobuf",async e=>{const t=Al.decode(e),r=Ba(t.publicKey);return new Bn({publicKey:r,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),p(Bn,"seal",async(e,t)=>{if(t==null)throw new Error("Missing private key");const r=e.domain,s=e.codec,i=e.marshal(),o=N4(r,s,i),a=await t.sign(o.subarray());return new Bn({publicKey:t.publicKey,payloadType:s,payload:i,signature:a})}),p(Bn,"openAndCertify",async(e,t)=>{const r=await Bn.createFromProtobuf(e);if(!await r.validate(t))throw new VE("Envelope signature is not valid for the given domain");return r});let Cl=Bn;const N4=(n,e,t)=>{const r=oe(n),s=Pr(r.byteLength),i=Pr(e.length),o=Pr(t.length);return new nt(s,r,i,e,o,t)};function UE(n,e){const t=(r,s)=>r.toString().localeCompare(s.toString());return n.length!==e.length?!1:(e.sort(t),n.sort(t).every((r,s)=>e[s].equals(r)))}const $E="libp2p-peer-record",HE=Uint8Array.from([3,1]);var Sl;(function(n){(function(t){let r;t.codec=()=>(r==null&&(r=$t((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(s.multiaddr)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={multiaddr:lt(0)},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.multiaddr=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),r),t.encode=s=>Ut(s,t.codec()),t.decode=(s,i)=>Vt(s,t.codec(),i)})(n.AddressInfo||(n.AddressInfo={}));let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{if(s.lengthDelimited!==!1&&r.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(r.uint32(10),r.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(r.uint32(16),r.uint64(t.seq)),t.addresses!=null)for(const i of t.addresses)r.uint32(26),n.AddressInfo.codec().encode(i,r);s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{var a,c;const i={peerId:lt(0),seq:0n,addresses:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{i.peerId=t.bytes();break}case 2:{i.seq=t.uint64();break}case 3:{if(((a=s.limits)==null?void 0:a.addresses)!=null&&i.addresses.length===s.limits.addresses)throw new Ci('Decode error - map field "addresses" had too many elements');i.addresses.push(n.AddressInfo.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.addresses$}));break}default:{t.skipType(l&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(Sl||(Sl={}));const cn=class cn{constructor(e){p(this,"peerId");p(this,"multiaddrs");p(this,"seqNumber");p(this,"domain",cn.DOMAIN);p(this,"codec",cn.CODEC);p(this,"marshaled");const{peerId:t,multiaddrs:r,seqNumber:s}=e;this.peerId=t,this.multiaddrs=r??[],this.seqNumber=s??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=Sl.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof cn)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!UE(this.multiaddrs,e.multiaddrs))}};p(cn,"createFromProtobuf",e=>{const t=Sl.decode(e),r=vn(cr(t.peerId)),s=(t.addresses??[]).map(o=>qe(o.multiaddr)),i=t.seq;return new cn({peerId:r,multiaddrs:s,seqNumber:i})}),p(cn,"DOMAIN",$E),p(cn,"CODEC",HE);let Bo=cn;function qE(n){return n[Symbol.asyncIterator]!=null}function Tl(n){if(qE(n))return(async()=>{const t=[];for await(const r of n)t.push(r);return t})();const e=[];for(const t of n)e.push(t);return e}const qn={},Ps=n=>{n.addEventListener("message",e=>{Ps.dispatchEvent("message",n,e)}),n.port!=null&&n.port.addEventListener("message",e=>{Ps.dispatchEvent("message",n,e)})};Ps.addEventListener=(n,e)=>{qn[n]==null&&(qn[n]=[]),qn[n].push(e)};Ps.removeEventListener=(n,e)=>{qn[n]!=null&&(qn[n]=qn[n].filter(t=>t===e))};Ps.dispatchEvent=function(n,e,t){qn[n]!=null&&qn[n].forEach(r=>r(e,t))};const L4="lock:worker:request-read",M4="lock:worker:release-read",O4="lock:master:grant-read",V4="lock:worker:request-write",U4="lock:worker:release-write",$4="lock:master:grant-write",zE=(n=21)=>Math.random().toString().substring(2),H4=(n,e,t,r,s)=>(i,o)=>{if(o.data.type!==t)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};n.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>{i.postMessage({type:s,name:a.name,identifier:a.identifier}),await new Promise(c=>{const l=u=>{if((u==null?void 0:u.data)==null)return;const d={type:u.data.type,name:u.data.name,identifier:u.data.identifier};d.type===r&&d.identifier===a.identifier&&(i.removeEventListener("message",l),c())};i.addEventListener("message",l)})}}}))},q4=(n,e,t,r)=>async()=>{const s=zE();return globalThis.postMessage({type:e,identifier:s,name:n}),new Promise(i=>{const o=a=>{if((a==null?void 0:a.data)==null)return;const c={type:a.data.type,identifier:a.data.identifier};c.type===t&&c.identifier===s&&(globalThis.removeEventListener("message",o),i(()=>{globalThis.postMessage({type:r,identifier:s,name:n})}))};globalThis.addEventListener("message",o)})},KE={singleProcess:!1},jE=n=>{if(n=Object.assign({},KE,n),!!globalThis.document||n.singleProcess){const t=new EventTarget;return Ps.addEventListener("message",H4(t,"requestReadLock",L4,M4,O4)),Ps.addEventListener("message",H4(t,"requestWriteLock",V4,U4,$4)),t}return{isWorker:!0,readLock:t=>q4(t,L4,O4,M4),writeLock:t=>q4(t,V4,$4,U4)}},fs={};let Fn;async function xu(n,e){let t;const r=new Promise(s=>{t=s});return n.add(async()=>Od((async()=>{await new Promise(s=>{t(()=>{s()})})})(),{milliseconds:e.timeout})),r}const GE=(n,e)=>{if(Fn.isWorker===!0)return{readLock:Fn.readLock(n,e),writeLock:Fn.writeLock(n,e)};const t=new s1({concurrency:1});let r;return{async readLock(){if(r!=null)return xu(r,e);r=new s1({concurrency:e.concurrency,autoStart:!1});const s=r,i=xu(r,e);return t.add(async()=>{s.start(),await s.onIdle().then(()=>{r===s&&(r=null)})}),i},async writeLock(){return r=null,xu(t,e)}}},WE={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function xg(n){const e=Object.assign({},WE,n);return Fn==null&&(Fn=jE(e),Fn.isWorker!==!0&&(Fn.addEventListener("requestReadLock",t=>{fs[t.data.name]!=null&&fs[t.data.name].readLock().then(async r=>t.data.handler().finally(()=>{r()}))}),Fn.addEventListener("requestWriteLock",async t=>{fs[t.data.name]!=null&&fs[t.data.name].writeLock().then(async r=>t.data.handler().finally(()=>{r()}))}))),fs[e.name]==null&&(fs[e.name]=GE(e.name,e)),fs[e.name]}const QE=36e5,YE=216e5;var xs;(function(n){(function(t){let r;t.codec=()=>(r==null&&(r=$t((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.key!=null&&s.key!==""&&(i.uint32(10),i.string(s.key)),s.value!=null&&s.value.byteLength>0&&(i.uint32(18),i.bytes(s.value)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={key:"",value:lt(0)},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.key=s.string();break}case 2:{a.value=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),r),t.encode=s=>Ut(s,t.codec()),t.decode=(s,i)=>Vt(s,t.codec(),i)})(n.Peer$metadataEntry||(n.Peer$metadataEntry={})),function(t){let r;t.codec=()=>(r==null&&(r=$t((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.key!=null&&s.key!==""&&(i.uint32(10),i.string(s.key)),s.value!=null&&(i.uint32(18),kl.codec().encode(s.value,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{var l;const a={key:""},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const u=s.uint32();switch(u>>>3){case 1:{a.key=s.string();break}case 2:{a.value=kl.codec().decode(s,s.uint32(),{limits:(l=o.limits)==null?void 0:l.value});break}default:{s.skipType(u&7);break}}}return a})),r),t.encode=s=>Ut(s,t.codec()),t.decode=(s,i)=>Vt(s,t.codec(),i)}(n.Peer$tagsEntry||(n.Peer$tagsEntry={}));let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{if(s.lengthDelimited!==!1&&r.fork(),t.addresses!=null)for(const i of t.addresses)r.uint32(10),Il.codec().encode(i,r);if(t.protocols!=null)for(const i of t.protocols)r.uint32(18),r.string(i);if(t.publicKey!=null&&(r.uint32(34),r.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(r.uint32(42),r.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[i,o]of t.metadata.entries())r.uint32(50),n.Peer$metadataEntry.codec().encode({key:i,value:o},r);if(t.tags!=null&&t.tags.size!==0)for(const[i,o]of t.tags.entries())r.uint32(58),n.Peer$tagsEntry.codec().encode({key:i,value:o},r);t.updated!=null&&(r.uint32(64),r.uint64Number(t.updated)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{var a,c,l,u,d,f;const i={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const m=t.uint32();switch(m>>>3){case 1:{if(((a=s.limits)==null?void 0:a.addresses)!=null&&i.addresses.length===s.limits.addresses)throw new Ci('Decode error - map field "addresses" had too many elements');i.addresses.push(Il.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.addresses$}));break}case 2:{if(((l=s.limits)==null?void 0:l.protocols)!=null&&i.protocols.length===s.limits.protocols)throw new Ci('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break}case 4:{i.publicKey=t.bytes();break}case 5:{i.peerRecordEnvelope=t.bytes();break}case 6:{if(((u=s.limits)==null?void 0:u.metadata)!=null&&i.metadata.size===s.limits.metadata)throw new m4('Decode error - map field "metadata" had too many elements');const y=n.Peer$metadataEntry.codec().decode(t,t.uint32());i.metadata.set(y.key,y.value);break}case 7:{if(((d=s.limits)==null?void 0:d.tags)!=null&&i.tags.size===s.limits.tags)throw new m4('Decode error - map field "tags" had too many elements');const y=n.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(f=s.limits)==null?void 0:f.tags$value}});i.tags.set(y.key,y.value);break}case 8:{i.updated=t.uint64Number();break}default:{t.skipType(m&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(xs||(xs={}));var Il;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(r.uint32(10),r.bytes(t.multiaddr)),t.isCertified!=null&&(r.uint32(16),r.bool(t.isCertified)),t.observed!=null&&(r.uint32(24),r.uint64Number(t.observed)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={multiaddr:lt(0)},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.multiaddr=t.bytes();break}case 2:{i.isCertified=t.bool();break}case 3:{i.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(Il||(Il={}));var kl;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.value!=null&&t.value!==0&&(r.uint32(8),r.uint32(t.value)),t.expiry!=null&&(r.uint32(16),r.uint64(t.expiry)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={value:0},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.value=t.uint32();break}case 2:{i.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(kl||(kl={}));function XE(n,e){if(n.publicKey!=null||e.publicKey==null)return n;let t;if(n.type==="RSA"){const s=Ke.decode(`z${n}`);t=cr(s)}const r=Ba(e.publicKey,t);return Ld(r)}function h1(n,e,t){const r=xs.decode(e);return d1(n,r,t)}function d1(n,e,t){const r=new Map,s=BigInt(Date.now());for(const[i,o]of e.tags.entries())o.expiry!=null&&o.expiry<s||r.set(i,o);return{...e,id:XE(n,e),addresses:e.addresses.filter(({observed:i})=>i!=null&&i>Date.now()-t).map(({multiaddr:i,isCertified:o})=>({multiaddr:qe(i),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:r}}function JE(n,e){return ZE(n.addresses,e.addresses)&&eA(n.protocols,e.protocols)&&tA(n.publicKey,e.publicKey)&&rA(n.peerRecordEnvelope,e.peerRecordEnvelope)&&nA(n.metadata,e.metadata)&&sA(n.tags,e.tags)}function ZE(n,e){return bg(n,e,(t,r)=>!(t.isCertified!==r.isCertified||!Ne(t.multiaddr,r.multiaddr)))}function eA(n,e){return bg(n,e,(t,r)=>t===r)}function tA(n,e){return vg(n,e)}function rA(n,e){return vg(n,e)}function nA(n,e){return wg(n,e,(t,r)=>Ne(t,r))}function sA(n,e){return wg(n,e,(t,r)=>t.value===r.value&&t.expiry===r.expiry)}function vg(n,e){return n==null&&e==null?!0:n!=null&&e!=null?Ne(n,e):!1}function bg(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!t(n[r],e[r]))return!1;return!0}function wg(n,e,t){if(n.size!==e.size)return!1;for(const[r,s]of n.entries()){const i=e.get(r);if(i==null||!t(s,i))return!1}return!0}const an="/",_g=new TextEncoder().encode(an),bc=_g[0];class _t{constructor(e,t){p(this,"_buf");if(typeof e=="string")this._buf=oe(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==bc)throw new Error("Invalid key")}toString(e="utf8"){return ie(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new _t(e.join(an))}static random(){return new _t(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new _t(e):typeof e.uint8Array=="function"?new _t(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=_g),this._buf[0]!==bc){const e=new Uint8Array(this._buf.byteLength+1);e.fill(bc,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===bc;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),r=e.list();for(let s=0;s<t.length;s++){if(r.length<s+1)return!1;const i=t[s],o=r[s];if(i<o)return!0;if(i>o)return!1}return t.length<r.length}reverse(){return _t.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(an).slice(1)}type(){return iA(this.baseNamespace())}name(){return oA(this.baseNamespace())}instance(e){return new _t(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(an)||(e+=an),e+=this.type(),new _t(e)}parent(){const e=this.list();return e.length===1?new _t(an):new _t(e.slice(0,-1).join(an))}child(e){return this.toString()===an?e:e.toString()===an?this:new _t(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return _t.withNamespaces([...this.namespaces(),...aA(e.map(t=>t.namespaces()))])}}function iA(n){const e=n.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function oA(n){const e=n.split(":");return e[e.length-1]}function aA(n){return[].concat(...n)}const Eg="/peers/";function wc(n){if(!V8(n)||n.type==null)throw new pe("Invalid PeerId");const e=n.toCID().toString();return new _t(`${Eg}${e}`)}async function cA(n,e,t,r){const s=new Map;for(const i of t){if(i==null)continue;if(i.multiaddr instanceof Uint8Array&&(i.multiaddr=qe(i.multiaddr)),!n0(i.multiaddr))throw new pe("Multiaddr was invalid");if(!await e(n,i.multiaddr))continue;const o=i.isCertified??!1,a=i.multiaddr.toString(),c=s.get(a);c!=null?i.isCertified=c.isCertified||o:s.set(a,{multiaddr:i.multiaddr,isCertified:o})}return[...s.values()].sort((i,o)=>i.multiaddr.toString().localeCompare(o.multiaddr.toString())).map(({isCertified:i,multiaddr:o})=>({isCertified:i,multiaddr:o.bytes}))}async function vu(n,e,t,r){var f,m;if(e==null)throw new pe("Invalid PeerData");if(e.publicKey!=null&&n.publicKey!=null&&!e.publicKey.equals(n.publicKey))throw new pe("publicKey bytes do not match peer id publicKey bytes");const s=(f=r.existingPeer)==null?void 0:f.peer;if(s!=null&&!n.equals(s.id))throw new pe("peer id did not match existing peer id");let i=(s==null?void 0:s.addresses)??[],o=new Set((s==null?void 0:s.protocols)??[]),a=(s==null?void 0:s.metadata)??new Map,c=(s==null?void 0:s.tags)??new Map,l=s==null?void 0:s.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(i=[],e.multiaddrs!=null&&i.push(...e.multiaddrs.map(y=>({isCertified:!1,multiaddr:y}))),e.addresses!=null&&i.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const y=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=_c(y,{validate:z4})}if(e.tags!=null){const y=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=_c(y,{validate:K4,map:j4})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&i.push(...e.multiaddrs.map(y=>({isCertified:!1,multiaddr:y}))),e.addresses!=null&&i.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const y=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[b,x]of y)x==null?a.delete(b):a.set(b,x);a=_c([...a.entries()],{validate:z4})}if(e.tags!=null){const y=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),b=new Map(c);for(const[x,D]of y)D==null?b.delete(x):b.set(x,D);c=_c([...b.entries()],{validate:K4,map:j4})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let u;(s==null?void 0:s.id.publicKey)!=null?u=Hn(s.id.publicKey):e.publicKey!=null?u=Hn(e.publicKey):n.publicKey!=null&&(u=Hn(n.publicKey));const d={addresses:await cA(n,r.addressFilter??(async()=>!0),i,(m=r.existingPeer)==null?void 0:m.peerPB.addresses),protocols:[...o.values()].sort((y,b)=>y.localeCompare(b)),metadata:a,tags:c,publicKey:u,peerRecordEnvelope:l};return d.addresses.forEach(y=>{var b,x,D;y.observed=((D=(x=(b=r.existingPeer)==null?void 0:b.peerPB.addresses)==null?void 0:x.find(S=>Ne(S.multiaddr,S.multiaddr)))==null?void 0:D.observed)??Date.now()}),n.type!=="RSA"&&delete d.publicKey,d}function _c(n,e){var r;const t=new Map;for(const[s,i]of n)i!=null&&e.validate(s,i);for(const[s,i]of n.sort(([o],[a])=>o.localeCompare(a)))i!=null&&t.set(s,((r=e.map)==null?void 0:r.call(e,s,i))??i);return t}function z4(n,e){if(typeof n!="string")throw new pe("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new pe("Metadata value must be a Uint8Array")}function K4(n,e){if(typeof n!="string")throw new pe("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new pe("Tag value must be an integer");if(e.value<0||e.value>100)throw new pe("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new pe("Tag ttl must be an integer");if(e.ttl<0)throw new pe("Tag ttl must be between greater than 0")}}function j4(n,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function Ag(n){const e=n.toString().split("/")[2],t=Ce.parse(e,dn);return Md(t)}function bu(n,e,t){const r=Ag(n);return h1(r,e,t)}function lA(n,e){return{prefix:Eg,filters:(n.filters??[]).map(t=>({key:r,value:s})=>t(bu(r,s,e))),orders:(n.orders??[]).map(t=>(r,s)=>t(bu(r.key,r.value,e),bu(s.key,s.value,e)))}}var or,Wc,Qc,Yc;class uA{constructor(e,t={}){ke(this,or);p(this,"peerId");p(this,"datastore");p(this,"lock");p(this,"addressFilter");p(this,"log");p(this,"maxAddressAge");p(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=xg({name:"peer-store",singleProcess:!0}),this.maxAddressAge=t.maxAddressAge??QE,this.maxPeerAge=t.maxPeerAge??YE}async has(e){try{return await this.load(e),!0}catch(t){if(t.name!=="NotFoundError")throw t}return!1}async delete(e){this.peerId.equals(e)||await this.datastore.delete(wc(e))}async load(e){const t=wc(e),r=await this.datastore.get(t),s=xs.decode(r);if(Ie(this,or,Yc).call(this,e,s))throw await this.datastore.delete(t),new Wn;return d1(e,s,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t){const r=await Ie(this,or,Wc).call(this,e),s=await vu(e,t,"patch",{addressFilter:this.addressFilter});return Ie(this,or,Qc).call(this,e,s,r)}async patch(e,t){const r=await Ie(this,or,Wc).call(this,e),s=await vu(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:r});return Ie(this,or,Qc).call(this,e,s,r)}async merge(e,t){const r=await Ie(this,or,Wc).call(this,e),s=await vu(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:r});return Ie(this,or,Qc).call(this,e,s,r)}async*all(e){for await(const{key:t,value:r}of this.datastore.query(lA(e??{},this.maxAddressAge))){const s=Ag(t);if(s.equals(this.peerId))continue;const i=xs.decode(r);if(Ie(this,or,Yc).call(this,s,i)){await this.datastore.delete(t);continue}yield d1(s,i,this.peerId.equals(s)?1/0:this.maxAddressAge)}}}or=new WeakSet,Wc=async function(e){try{const t=wc(e),r=await this.datastore.get(t),s=xs.decode(r);if(Ie(this,or,Yc).call(this,e,s))throw await this.datastore.delete(t),new Wn;return{peerPB:s,peer:h1(e,r,this.maxAddressAge)}}catch(t){t.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",t)}},Qc=async function(e,t,r){t.updated=Date.now();const s=xs.encode(t);return await this.datastore.put(wc(e),s),{peer:h1(e,s,this.maxAddressAge),previous:r==null?void 0:r.peer,updated:r==null||!JE(t,r.peerPB)}},Yc=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const r=t.updated<Date.now()-this.maxPeerAge,s=Date.now()-this.maxAddressAge,i=t.addresses.filter(o=>o.observed!=null&&o.observed>s);return r&&i.length===0};var k6,wi,Xc;k6=Symbol.toStringTag;class hA{constructor(e,t={}){ke(this,wi);p(this,"store");p(this,"events");p(this,"peerId");p(this,"log");p(this,k6,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new uA(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const r=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const s of this.store.all(t))e(s)}finally{this.log.trace("forEach release read lock"),r()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await Tl(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const r=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const s=await this.store.save(e,t);return Ie(this,wi,Xc).call(this,e,s),s.peer}finally{this.log.trace("save release write lock"),r()}}async patch(e,t){this.log.trace("patch await write lock");const r=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const s=await this.store.patch(e,t);return Ie(this,wi,Xc).call(this,e,s),s.peer}finally{this.log.trace("patch release write lock"),r()}}async merge(e,t){this.log.trace("merge await write lock");const r=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const s=await this.store.merge(e,t);return Ie(this,wi,Xc).call(this,e,s),s.peer}finally{this.log.trace("merge release write lock"),r()}}async consumePeerRecord(e,t){const r=await Cl.openAndCertify(e,Bo.DOMAIN),s=Md(r.publicKey.toCID());if((t==null?void 0:t.equals(s))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,s),!1;const i=Bo.createFromProtobuf(r.payload);let o;try{o=await this.get(s)}catch(a){if(a.name!=="NotFoundError")throw a}if((o==null?void 0:o.peerRecordEnvelope)!=null){const a=await Cl.createFromProtobuf(o.peerRecordEnvelope),c=Bo.createFromProtobuf(a.payload);if(c.seqNumber>=i.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",c.seqNumber,i.seqNumber),!1}return await this.patch(i.peerId,{peerRecordEnvelope:e,addresses:i.multiaddrs.map(a=>({isCertified:!0,multiaddr:a}))}),!0}}wi=new WeakSet,Xc=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function dA(n,e={}){return new hA(n,e)}const ci=class ci extends Error{constructor(t="Not Found"){super(t);p(this,"name",ci.name);p(this,"code",ci.code)}};p(ci,"name","NotFoundError"),p(ci,"code","ERR_NOT_FOUND");let f1=ci;function fA(n){return n[Symbol.asyncIterator]!=null}function ra(n){if(fA(n))return(async()=>{for await(const e of n);})();for(const e of n);}function Cg(n){const[e,t]=n[Symbol.asyncIterator]!=null?[n[Symbol.asyncIterator](),Symbol.asyncIterator]:[n[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>e.next(),push:s=>{r.push(s)},next:()=>r.length>0?{done:!1,value:r.shift()}:e.next(),[t](){return this}}}function pA(n){return n[Symbol.asyncIterator]!=null}function Zs(n,e){let t=0;if(pA(n))return async function*(){for await(const c of n)await e(c,t++)&&(yield c)}();const r=Cg(n),{value:s,done:i}=r.next();if(i===!0)return function*(){}();const o=e(s,t++);if(typeof o.then=="function")return async function*(){await o&&(yield s);for await(const c of r)await e(c,t++)&&(yield c)}();const a=e;return function*(){o===!0&&(yield s);for(const c of r)a(c,t++)&&(yield c)}()}function gA(n){return n[Symbol.asyncIterator]!=null}function G4(n,e){return gA(n)?async function*(){yield*(await Tl(n)).sort(e)}():function*(){yield*Tl(n).sort(e)}()}function mA(n){return n[Symbol.asyncIterator]!=null}function p1(n,e){return mA(n)?async function*(){let t=0;if(!(e<1)){for await(const r of n)if(yield r,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const r of n)if(yield r,t++,t===e)return}}()}class yA{put(e,t,r){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:r,value:s}of e)await this.put(r,s,t),yield r}async*getMany(e,t={}){for await(const r of e)yield{key:r,value:await this.get(r,t)}}async*deleteMany(e,t={}){for await(const r of e)await this.delete(r,t),yield r}batch(){let e=[],t=[];return{put(r,s){e.push({key:r,value:s})},delete(r){t.push(r)},commit:async r=>{await ra(this.putMany(e,r)),e=[],await ra(this.deleteMany(t,r)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let r=this._all(e,t);if(e.prefix!=null){const s=e.prefix;r=Zs(r,i=>i.key.toString().startsWith(s))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((s,i)=>Zs(s,i),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((s,i)=>G4(s,i),r)),e.offset!=null){let s=0;const i=e.offset;r=Zs(r,()=>s++>=i)}return e.limit!=null&&(r=p1(r,e.limit)),r}queryKeys(e,t){let r=this._allKeys(e,t);if(e.prefix!=null){const s=e.prefix;r=Zs(r,i=>i.toString().startsWith(s))}if(Array.isArray(e.filters)&&(r=e.filters.reduce((s,i)=>Zs(s,i),r)),Array.isArray(e.orders)&&(r=e.orders.reduce((s,i)=>G4(s,i),r)),e.offset!=null){const s=e.offset;let i=0;r=Zs(r,()=>i++>=s)}return e.limit!=null&&(r=p1(r,e.limit)),r}}class xA extends yA{constructor(){super();p(this,"data");this.data=new Map}put(t,r){return this.data.set(t.toString(),r),t}get(t){const r=this.data.get(t.toString());if(r==null)throw new f1;return r}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,r]of this.data.entries())yield{key:new _t(t),value:r}}*_allKeys(){for(const t of this.data.keys())yield new _t(t)}}function vA(n,e){let t;const r=function(){const s=function(){t=void 0,n()};clearTimeout(t),t=setTimeout(s,e)};return r.start=()=>{},r.stop=()=>{clearTimeout(t)},r}var Sg;(function(){var n,e,t,r,s,i,o,a;a=function(c){var l,u,d,f;return l=(c&255<<24)>>>24,u=(c&255<<16)>>>16,d=(c&65280)>>>8,f=c&255,[l,u,d,f].join(".")},o=function(c){var l,u,d,f,m,y;for(l=[],d=f=0;f<=3&&c.length!==0;d=++f){if(d>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}y=e(c),m=y[0],u=y[1],c=c.substring(u),l.push(m)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},r=t("0"),i=t("a"),s=t("A"),e=function(c){var l,u,d,f,m;for(f=0,l=10,u="9",d=0,c.length>1&&c[d]==="0"&&(c[d+1]==="x"||c[d+1]==="X"?(d+=2,l=16):"0"<=c[d+1]&&c[d+1]<="9"&&(d++,l=8,u="7")),m=d;d<c.length;){if("0"<=c[d]&&c[d]<=u)f=f*l+(t(c[d])-r)>>>0;else if(l===16)if("a"<=c[d]&&c[d]<="f")f=f*l+(10+t(c[d])-i)>>>0;else if("A"<=c[d]&&c[d]<="F")f=f*l+(10+t(c[d])-s)>>>0;else break;else break;if(f>4294967295)throw new Error("too large");d++}if(d===m)throw new Error("empty octet");return[f,d]},n=function(){function c(l,u){var d,f,m;if(typeof l!="string")throw new Error("Missing `net' parameter");if(u||(m=l.split("/",2),l=m[0],u=m[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=o(u)}catch{throw new Error("Invalid mask: "+u)}for(d=f=32;f>=0;d=--f)if(this.maskLong===4294967295<<32-d>>>0){this.bitmask=d;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var u,d,f;for(f=o(this.first),d=o(this.last),u=0;f<=d;)l(a(f),f,u),u++,f++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),Sg=n}).call(fe);const bA=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],wA=bA.map(n=>new Sg(n));function Kd(n){for(const e of wA)if(e.contains(n))return!0;return!1}function _A(n){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(n)}function EA(n){const e=n.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),r=e[e.length-2].padStart(4,"0"),s=`${parseInt(r.substring(0,2),16)}.${parseInt(r.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return Kd(s)}function AA(n){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)}function CA(n){const e=n.split(":"),t=e[e.length-1];return Kd(t)}function SA(n){return/^::$/.test(n)||/^::1$/.test(n)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(n)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(n)||/^ff([0-9a-fA-F]{2,2}):/i.test(n)}function ji(n){return Ii(n)?Kd(n):_A(n)?EA(n):AA(n)?CA(n):Vd(n)?SA(n):void 0}const TA=n=>n.toString().split("/").slice(1),Na=n=>({match:e=>e.length<1?!1:n(e[0])?e.slice(1):!1,pattern:"fn"}),ge=n=>({match:e=>Na(t=>t===n).match(e),pattern:n}),Gi=()=>({match:n=>Na(e=>typeof e=="string").match(n),pattern:"{string}"}),na=()=>({match:n=>Na(e=>!isNaN(parseInt(e))).match(n),pattern:"{number}"}),Me=()=>({match:n=>{if(n.length<2||n[0]!=="p2p"&&n[0]!=="ipfs")return!1;if(n[1].startsWith("Q")||n[1].startsWith("1"))try{Ke.decode(`z${n[1]}`)}catch{return!1}else return!1;return n.slice(2)},pattern:"/p2p/{peerid}"}),Pl=()=>({match:n=>{if(n.length<2||n[0]!=="certhash")return!1;try{X8.decode(n[1])}catch{return!1}return n.slice(2)},pattern:"/certhash/{certhash}"}),Re=n=>({match:e=>{const t=n.match(e);return t===!1?e:t},pattern:`optional(${n.pattern})`}),Qt=(...n)=>({match:e=>{let t;for(const r of n){const s=r.match(e);s!==!1&&(t==null||s.length<t.length)&&(t=s)}return t??!1},pattern:`or(${n.map(e=>e.pattern).join(", ")})`}),be=(...n)=>({match:e=>{for(const t of n){const r=t.match(e);if(r===!1)return!1;e=r}return e},pattern:`and(${n.map(e=>e.pattern).join(", ")})`});function Xe(...n){function e(s){let i=TA(s);for(const o of n){const a=o.match(i);if(a===!1)return!1;i=a}return i}function t(s){return e(s)!==!1}function r(s){const i=e(s);return i===!1?!1:i.length===0}return{matchers:n,matches:t,exactMatch:r}}const IA=Me(),kA=Xe(IA),i0=be(ge("dns4"),Gi()),o0=be(ge("dns6"),Gi()),a0=be(ge("dnsaddr"),Gi()),jd=be(ge("dns"),Gi());Xe(i0,Re(Me()));Xe(o0,Re(Me()));Xe(a0,Re(Me()));Xe(Qt(jd,a0,i0,o0),Re(Me()));const Tg=be(ge("ip4"),Na(Ii)),Ig=be(ge("ip6"),Na(Vd)),Gd=Qt(Tg,Ig),fn=Qt(Gd,jd,i0,o0,a0);Xe(Qt(Gd,be(Qt(jd,a0,i0,o0),Re(Me()))));const W4=Xe(Tg),Q4=Xe(Ig);Xe(Gd);const Wd=be(fn,ge("tcp"),na()),La=be(fn,ge("udp"),na()),g1=Xe(be(Wd,Re(Me())));Xe(La);const Qd=be(La,ge("quic"),Re(Me())),c0=be(La,ge("quic-v1"),Re(Me())),PA=Qt(Qd,c0);Xe(Qd);const DA=Xe(c0),m1=Qt(fn,Wd,La,Qd,c0),kg=Qt(be(m1,ge("ws"),Re(Me()))),Dl=Xe(kg),Pg=Qt(be(m1,ge("wss"),Re(Me())),be(m1,ge("tls"),Re(be(ge("sni"),Gi())),ge("ws"),Re(Me()))),y1=Xe(Pg),Dg=be(La,ge("webrtc-direct"),Re(Pl()),Re(Pl()),Re(Me())),Y4=Xe(Dg),Rg=be(c0,ge("webtransport"),Re(Pl()),Re(Pl()),Re(Me())),X4=Xe(Rg),Rl=Qt(kg,Pg,be(Wd,Re(Me())),be(PA,Re(Me())),be(fn,Re(Me())),Dg,Rg,Me());Xe(Rl);const RA=be(Rl,ge("p2p-circuit"),Me()),x1=Xe(RA),BA=Qt(be(Rl,ge("p2p-circuit"),ge("webrtc"),Re(Me())),be(Rl,ge("webrtc"),Re(Me())),be(ge("webrtc"),Re(Me()))),J4=Xe(BA),FA=Qt(be(fn,ge("tcp"),na(),ge("http"),Re(Me())),be(fn,ge("http"),Re(Me())));Xe(FA);const NA=Qt(be(fn,ge("tcp"),Qt(be(ge("443"),ge("http")),be(na(),ge("https")),be(na(),ge("tls"),ge("http"))),Re(Me())),be(fn,ge("tls"),ge("http"),Re(Me())),be(fn,ge("https"),Re(Me())));Xe(NA);const LA=Qt(be(ge("memory"),Gi(),Re(Me())));Xe(LA);const Z4=864e13,MA=448,wu=449,OA=53,VA=54,UA=55,$A=56;class HA{constructor(e,t={}){p(this,"log");p(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=new Map}has(e){const t=this.findHost(e);for(const r of this.mappings.values())if(r.domain===t)return!0;return!1}add(e,t){t.forEach(r=>{this.log("add DNS mapping %s to %s",r,e);const s=ji(r)===!0;this.mappings.set(r,{domain:e,verified:s,expires:s?Z4-Date.now():0,lastVerified:s?Z4-Date.now():void 0})})}remove(e){const t=this.findHost(e);let r=!1;for(const[s,i]of this.mappings.entries())i.domain===t&&(this.log("removing %s to %s DNS mapping %e",s,i.domain,new Error("where")),this.mappings.delete(s),r=r||i.verified);return r}getAll(e){const t=[];for(let r=0;r<e.length;r++){const i=e[r].multiaddr.stringTuples(),o=i[0][1];if(o!=null)for(const[a,c]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(i,c.domain)&&(e.splice(r,1),r--,t.push({multiaddr:qe(`/${i.map(u=>[Ve(u[0]).name,u[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){var r;for(let s=0;s<e.length;s++)if(e[s][0]===MA&&((r=e[s+1])==null?void 0:r[0])!==wu)return e.splice(s+1,0,[wu,t]),!0;return!1}confirm(e,t){const r=this.findHost(e);let s=!1;for(const[i,o]of this.mappings.entries())o.domain===r&&(this.log("marking %s to %s DNS mapping as verified",i,o.domain),s=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return s}unconfirm(e,t){const r=this.findHost(e);let s=!1;for(const[i,o]of this.mappings.entries())o.domain===r&&(this.log("removing verification of %s to %s DNS mapping",i,o.domain),s=s||o.verified,o.verified=!1,o.expires=Date.now()+t);return s}findHost(e){for(const t of e.stringTuples())if(t[0]===wu||t[0]===OA||t[0]===VA||t[0]===UA||t[0]===$A)return t[1]}}const _u=4,Eu=41,Au=6,qA=273;class zA{constructor(e,t={}){p(this,"log");p(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=new Map}has(e){const t=e.stringTuples();for(const r of this.mappings.values())for(const s of r)if(s.externalIp===t[0][1])return!0;return!1}add(e,t,r,s=t,i="tcp"){const o=`${e}-${t}-${i}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:r,externalPort:s,externalFamily:Ii(r)?4:6,protocol:i,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),r=t[0][1]??"",s=t[1][0]===Au?"tcp":"udp",i=parseInt(t[1][1]??"0");let o=!1;for(const[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){const u=c[l];u.externalIp===r&&u.externalPort===i&&u.protocol===s&&(this.log("removing %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,r,i,s),o=o||u.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:r}of e){const s=r.stringTuples();let i;if((s[0][0]===_u||s[0][0]===Eu)&&s[1][0]===Au?i=`${s[0][1]}-${s[1][1]}-tcp`:(s[0][0]===_u||s[0][0]===Eu)&&s[1][0]===qA&&(i=`${s[0][1]}-${s[1][1]}-udp`),i==null)continue;const o=this.mappings.get(i);if(o!=null)for(const a of o)s[0][0]=a.externalFamily===4?_u:Eu,s[0][1]=a.externalIp,s[1][1]=`${a.externalPort}`,t.push({multiaddr:qe(`/${s.map(c=>[Ve(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const s=e.stringTuples()[0][1];let i=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===s&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),i=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return i}unconfirm(e,t){const r=e.stringTuples(),s=r[0][1]??"",i=r[1][0]===Au?"tcp":"udp",o=parseInt(r[1][1]??"0");let a=!1;for(const c of this.mappings.values())for(let l=0;l<c.length;l++){const u=c[l];u.externalIp===s&&u.externalPort===o&&u.protocol===i&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,s,o,i),a=a||u.verified,u.verified=!1,u.expires=Date.now()+t)}return a}}const KA=4,jA=41;function GA(n){try{const[[e,t]]=n.stringTuples();if(t==null)return!1;if(e===KA)return t.startsWith("169.254.");if(e===jA)return t.toLowerCase().startsWith("fe80")}catch{}return!1}const WA=4,QA=41;function Bg(n){try{const[[e]]=n.stringTuples();return e===WA||e===QA}catch{}return!1}function Bl(n){try{if(!Bg(n))return!1;const[[,e]]=n.stringTuples();return e==null?!1:ji(e)??!1}catch{}return!0}const YA={maxObservedAddresses:10};class XA{constructor(e,t={}){p(this,"log");p(this,"addresses");p(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??YA.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Bl(e)||GA(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:qe(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var r;const t=((r=this.addresses.get(e.toString()))==null?void 0:r.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const r=e.toString(),s=this.addresses.get(r)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},i=s.verified;return s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now(),this.log("marking observed address %a as verified",r),this.addresses.set(r,s),i}}const JA=4,ZA=41,eC=53,tC=54,rC=55,nC=56,sC=[JA,ZA,eC,tC,rC,nC];function e3(n){try{const[[e]]=n.stringTuples();return sC.includes(e)}catch{}return!1}const iC={maxObservedAddresses:10};class oC{constructor(e,t={}){p(this,"log");p(this,"addresses");p(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=new Map,this.maxObservedAddresses=t.maxObservedAddresses??iC.maxObservedAddresses}get(e,t){if(Bl(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const r=this.toKey(e);let s=this.addresses.get(r);return s==null&&(s={verified:!e3(e),expires:0},this.addresses.set(r,s)),{multiaddr:e,verified:s.verified,type:"transport",expires:s.expires,lastVerified:s.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var s;const t=this.toKey(e),r=((s=this.addresses.get(t))==null?void 0:s.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),r}confirm(e,t){const r=this.toKey(e),s=this.addresses.get(r)??{verified:!1,expires:0,lastVerified:0},i=s.verified;return s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now(),this.addresses.set(r,s),i}unconfirm(e,t){const r=this.toKey(e),s=this.addresses.get(r)??{verified:!1,expires:0},i=s.verified;return s.verified=!1,s.expires=Date.now()+t,this.addresses.set(r,s),i}toKey(e){if(e3(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const t3=6e4,r3={addressVerificationTTL:t3*10,addressVerificationRetry:t3*5},aC=n=>n;function Cu(n,e){const t=n.getPeerId();return t!=null&&Is(t).equals(e)&&(n=n.decapsulate(qe(`/p2p/${e.toString()}`))),n}var P6;P6=Symbol.toStringTag;class cC{constructor(e,t={}){p(this,"log");p(this,"components");p(this,"listen");p(this,"announce");p(this,"appendAnnounce");p(this,"announceFilter");p(this,"observed");p(this,"dnsMappings");p(this,"ipMappings");p(this,"transportAddresses");p(this,"observedAddressFilter");p(this,"addressVerificationTTL");p(this,"addressVerificationRetry");p(this,P6,"@libp2p/address-manager");const{listen:r=[],announce:s=[],appendAnnounce:i=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=r.map(o=>o.toString()),this.announce=new Set(s.map(o=>o.toString())),this.appendAnnounce=new Set(i.map(o=>o.toString())),this.observed=new XA(e,t),this.dnsMappings=new HA(e,t),this.ipMappings=new zA(e,t),this.transportAddresses=new oC(e,t),this.announceFilter=t.announceFilter??aC,this.observedAddressFilter=yg(1024),this.addressVerificationTTL=t.addressVerificationTTL??r3.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??r3.addressVerificationRetry,this._updatePeerStoreAddresses=vA(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>qe(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>qe(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>qe(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),r=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(r)||(this.observedAddressFilter.add(r),e=Cu(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=Cu(e,this.components.peerId);let r=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),r=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&r&&(r=!1)),r||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=Cu(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(r=>{if(!r.verified)return!1;const s=r.multiaddr.toString();return e.has(s)?!1:(e.add(s),!0)}).map(r=>r.multiaddr);return this.announceFilter(t.map(r=>{var i;const s=qe(r);return((i=s.protos().pop())==null?void 0:i.path)===!0||s.getPeerId()===this.components.peerId.toString()?s:s.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(s=>{s.updateAnnounceAddrs(e)}),e.map(s=>({multiaddr:s,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(s=>this.transportAddresses.get(s,this.addressVerificationTTL)));const r=this.getAppendAnnounceAddrs();return r.length>0&&(this.components.transportManager.getListeners().forEach(s=>{s.updateAnnounceAddrs(r)}),t=t.concat(r.map(s=>({multiaddr:s,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(qe(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,r,s=t,i="tcp"){this.ipMappings.add(e,t,r,s,i),this.observed.removePrefixed(`/ip${Ii(r)?4:6}/${r}/${i}/${s}`)}removePublicAddressMapping(e,t,r,s=t,i="tcp"){this.ipMappings.remove(qe(`/ip${Ii(r)?4:6}/${r}/${i}/${s}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||ji(t.host)===!0)return!1;const r=this.components.transportManager.getListeners(),s=[i=>Dl.exactMatch(i)||y1.exactMatch(i),i=>g1.exactMatch(i),i=>DA.exactMatch(i)];for(const i of s){if(!i(e))continue;const o=r.filter(l=>l.getAddrs().filter(u=>u.toOptions().family===4&&i(u)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}}var n3;(function(n){n.NOT_STARTED_YET="The libp2p node is not started yet",n.NOT_FOUND="Not found"})(n3||(n3={}));class lC extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class uC extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class Su extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class s3 extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class hC extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class dC extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class fC extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class i3 extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class pC extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class gC extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class mC extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class yC extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class xC extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class Ec extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class Ac extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class vC extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class bC{constructor(e={}){p(this,"components",{});p(this,"_started",!1);this.components={};for(const[t,r]of Object.entries(e))this.components[t]=r;this.components.logger==null&&(this.components.logger=fg())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>pd(t)).map(async t=>{var r;await((r=t[e])==null?void 0:r.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const wC=["metrics","connectionProtector","dns"],_C=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function EC(n={}){const e=new bC(n);return new Proxy(e,{get(r,s,i){if(typeof s=="string"&&!_C.includes(s)){const o=e.components[s];if(o==null&&!wC.includes(s))throw new lC(`${s} not set`);return o}return Reflect.get(r,s,i)},set(r,s,i){return typeof s=="string"?e.components[s]=i:Reflect.set(r,s,i),!0}})}function AC(n){const e={};for(const t of Object.values(n.components))for(const r of CC(t))e[r]=!0;for(const t of Object.values(n.components))for(const r of SC(t))if(e[r]!==!0)throw new uC(`Service "${TC(t)}" required capability "${r}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function CC(n){return Array.isArray(n==null?void 0:n[dl])?n[dl]:[]}function SC(n){return Array.isArray(n==null?void 0:n[zh])?n[zh]:[]}function TC(n){return(n==null?void 0:n[Symbol.toStringTag])??(n==null?void 0:n.toString())??"unknown"}const IC=4,kC=41;function PC(n={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(Dl.matches(e))return!1;const t=e.stringTuples();return t[0][0]===IC||t[0][0]===kC?!!ji(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...n}}const o3=()=>{const n=new Error("Delay aborted");return n.name="AbortError",n},DC=new WeakMap;function RC({clearTimeout:n,setTimeout:e}={}){return(t,{value:r,signal:s}={})=>{if(s!=null&&s.aborted)return Promise.reject(o3());let i,o,a;const c=n??clearTimeout,l=()=>{c(i),a(o3())},u=()=>{s&&s.removeEventListener("abort",l)},d=new Promise((f,m)=>{o=()=>{u(),f(r)},a=m,i=(e??setTimeout)(o,t)});return s&&s.addEventListener("abort",l,{once:!0}),DC.set(d,()=>{c(i),i=null,o()}),d}}const BC=RC();class FC extends Error{constructor(t="Rate limit exceeded",r){super(t);p(this,"remainingPoints");p(this,"msBeforeNext");p(this,"consumedPoints");p(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=r.remainingPoints,this.msBeforeNext=r.msBeforeNext,this.consumedPoints=r.consumedPoints,this.isFirstInDuration=r.isFirstInDuration}}class Fg extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}p(Fg,"name","QueueFullError");class NC{constructor(e={}){p(this,"memoryStorage");p(this,"points");p(this,"duration");p(this,"blockDuration");p(this,"execEvenly");p(this,"execEvenlyMinDelayMs");p(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new LC}async consume(e,t=1,r={}){const s=this.getKey(e),i=this._getKeySecDuration(r);let o=this.memoryStorage.incrby(s,t,i);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(s,o.consumedPoints,this.blockDuration)),new FC("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await BC(a)}return o}penalty(e,t=1,r={}){const s=this.getKey(e),i=this._getKeySecDuration(r),o=this.memoryStorage.incrby(s,t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,r={}){const s=this.getKey(e),i=this._getKeySecDuration(r),o=this.memoryStorage.incrby(s,-t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const r=t*1e3,s=this.points+1;return this.memoryStorage.set(this.getKey(e),s,t),{remainingPoints:0,msBeforeNext:r===0?-1:r,consumedPoints:s,isFirstInDuration:!1}}set(e,t,r=0){const s=(r>=0?r:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,r),{remainingPoints:0,msBeforeNext:s===0?-1:s,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class LC{constructor(){p(this,"storage");this.storage=new Map}incrby(e,t,r){const s=this.storage.get(e);if(s!=null){const i=s.expiresAt!=null?s.expiresAt.getTime()-new Date().getTime():-1;return s.expiresAt==null||i>0?(s.value+=t,{remainingPoints:0,msBeforeNext:i,consumedPoints:s.value,isFirstInDuration:!1}):this.set(e,t,r)}return this.set(e,t,r)}set(e,t,r){const s=r*1e3,i=this.storage.get(e);i!=null&&clearTimeout(i.timeoutId);const o={value:t,expiresAt:s>0?new Date(Date.now()+s):void 0};return this.storage.set(e,o),s>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},s),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:s===0?-1:s,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}function Ng(n){if(V8(n))return{peerId:n,multiaddrs:[]};let e=Array.isArray(n)?n:[n],t;if(e.length>0){const r=e[0].getPeerId();t=r==null?void 0:Is(r),e.forEach(s=>{if(!n0(s))throw new Ql("Invalid multiaddr");const i=s.getPeerId();if(i==null){if(t!=null)throw new pe("Multiaddrs must all have the same peer id or have no peer id")}else{const o=Is(i);if((t==null?void 0:t.equals(o))!==!0)throw new pe("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(r=>!kA.exactMatch(r)),{peerId:t,multiaddrs:e}}const MC=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function OC(n,e){var s;const t=((s=n==null?void 0:n.streams)==null?void 0:s.map(i=>i.protocol))??[],r=(e==null?void 0:e.closableProtocols)??MC;if(!(t.filter(i=>i!=null&&!r.includes(i)).length>0))try{await(n==null?void 0:n.close(e))}catch(i){n==null||n.abort(i)}}const Lg=1e4,VC=1e4,a3=1e4,Mg=25,UC=5,$C=10,HC=5,qC="last-dial-failure",zC="last-dial-success",Og=500,Vg=100,Ug=50;async function KC(n,e){let t=!1;for(const s of Hd.keys())if(t=n.protoNames().includes(s),t)break;if(!t)return[n];const r=await n.resolve(e);return e.log("resolved %s to",n,r.map(s=>s.toString())),r}function v1(n){try{let e;if(typeof n=="string"?e=qe(n):e=n,!e.protoNames().includes("ipcidr")){const r=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(r)}return L_(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${n}`)}}const jC={maxConnections:Vg};class GC{constructor(e,t={}){p(this,"maxConnections");p(this,"connectionManager");p(this,"peerStore");p(this,"allow");p(this,"events");p(this,"log");this.maxConnections=t.maxConnections??jC.maxConnections,this.allow=(t.allow??[]).map(r=>v1(r)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const r=new Fa;for(const a of e){const c=a.remotePeer;if(!r.has(c)){r.set(c,0);try{const l=await this.peerStore.get(c);r.set(c,[...l.tags.values()].reduce((u,d)=>u+d.value,0))}catch(l){l.name!=="NotFoundError"&&this.log.error("error loading peer tags",l)}}}const s=this.sortConnections(e,r),i=Math.max(t-this.maxConnections,0),o=[];for(const a of s)if(this.log("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(l=>l.contains(a.remoteAddr.nodeAddress().address))||o.push(a),o.length===i)break;await Promise.all(o.map(async a=>{await OC(a,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((r,s)=>{const i=r.timeline.open,o=s.timeline.open;return i<o?1:i>o?-1:0}).sort((r,s)=>r.direction==="outbound"&&s.direction==="inbound"?1:r.direction==="inbound"&&s.direction==="outbound"?-1:0).sort((r,s)=>r.streams.length>s.streams.length?1:r.streams.length<s.streams.length?-1:0).sort((r,s)=>{const i=t.get(r.remotePeer)??0,o=t.get(s.remotePeer)??0;return i>o?1:i<o?-1:0})}}function St(){const n={};return n.promise=new Promise((e,t)=>{n.resolve=e,n.reject=t}),n}class c3{constructor(e){p(this,"buffer");p(this,"mask");p(this,"top");p(this,"btm");p(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class Tu{constructor(e={}){p(this,"size");p(this,"hwm");p(this,"head");p(this,"tail");this.hwm=e.splitLimit??16,this.head=new c3(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new c3(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let WC=class extends Error{constructor(t,r){super(t??"The operation was aborted");p(this,"type");p(this,"code");this.type="aborted",this.code=r??"ABORT_ERR"}};function $g(n={}){return QC(t=>{const r=t.shift();if(r==null)return{done:!0};if(r.error!=null)throw r.error;return{done:r.done===!0,value:r.value}},n)}function QC(n,e){e=e??{};let t=e.onEnd,r=new Tu,s,i,o,a=St();const c=async()=>{try{return r.isEmpty()?o?{done:!0}:await new Promise((x,D)=>{i=S=>{i=null,r.push(S);try{x(n(r))}catch(_){D(_)}return s}}):n(r)}finally{r.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=St()})}},l=x=>i!=null?i(x):(r.push(x),s),u=x=>(r=new Tu,i!=null?i({error:x}):(r.push({error:x}),s)),d=x=>{if(o)return s;if((e==null?void 0:e.objectMode)!==!0&&(x==null?void 0:x.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:x})},f=x=>o?s:(o=!0,x!=null?u(x):l({done:!0})),m=()=>(r=new Tu,f(),{done:!0}),y=x=>(f(x),{done:!0});if(s={[Symbol.asyncIterator](){return this},next:c,return:m,throw:y,push:d,end:f,get readableLength(){return r.size},onEmpty:async x=>{const D=x==null?void 0:x.signal;if(D==null||D.throwIfAborted(),r.isEmpty())return;let S,_;D!=null&&(S=new Promise((E,B)=>{_=()=>{B(new WC)},D.addEventListener("abort",_)}));try{await Promise.race([a.promise,S])}finally{_!=null&&D!=null&&(D==null||D.removeEventListener("abort",_))}}},t==null)return s;const b=s;return s={[Symbol.asyncIterator](){return this},next(){return b.next()},throw(x){return b.throw(x),t!=null&&(t(x),t=void 0),{done:!0}},return(){return b.return(),t!=null&&(t(),t=void 0),{done:!0}},push:d,end(x){return b.end(x),t!=null&&(t(x),t=void 0),s},get readableLength(){return b.readableLength},onEmpty:x=>b.onEmpty(x)},s}let YC=class extends Error{constructor(t,r){super(t??"The operation was aborted");p(this,"type");p(this,"code");this.type="aborted",this.name="AbortError",this.code=r??"ABORT_ERR"}};async function Jc(n,e,t,r){const s=new YC(r==null?void 0:r.errorMessage,r==null?void 0:r.errorCode);return(t==null?void 0:t.aborted)===!0?Promise.reject(s):new Promise((i,o)=>{function a(){t==null||t.removeEventListener("abort",u),n.removeEventListener(e,c),(r==null?void 0:r.errorEvent)!=null&&n.removeEventListener(r.errorEvent,l)}const c=d=>{var f;try{if(((f=r==null?void 0:r.filter)==null?void 0:f.call(r,d))===!1)return}catch(m){a(),o(m);return}a(),i(d)},l=d=>{a(),o(d.detail)},u=()=>{a(),o(s)};t==null||t.addEventListener("abort",u),n.addEventListener(e,c),(r==null?void 0:r.errorEvent)!=null&&n.addEventListener(r.errorEvent,l)})}let l3=class extends Error{constructor(t,r,s){super(t??"The operation was aborted");p(this,"type");p(this,"code");this.type="aborted",this.name=s??"AbortError",this.code=r??"ABORT_ERR"}};async function Ds(n,e,t){if(e==null)return n;if(e.aborted)return n.catch(()=>{}),Promise.reject(new l3(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let r;const s=new l3(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([n,new Promise((i,o)=>{r=()=>{o(s)},e.addEventListener("abort",r)})])}finally{r!=null&&e.removeEventListener("abort",r)}}class XC{constructor(e){p(this,"deferred");p(this,"signal");var t;this.signal=e,this.deferred=St(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new Qo)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function JC(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class ZC{constructor(e,t){p(this,"id");p(this,"fn");p(this,"options");p(this,"recipients");p(this,"status");p(this,"timeline");p(this,"controller");this.id=JC(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,r)=>{var s;return t&&((s=r.signal)==null?void 0:s.aborted)===!0},!0)&&(this.controller.abort(new Qo),this.cleanup())}async join(e={}){var r;const t=new XC(e.signal);return this.recipients.push(t),(r=e.signal)==null||r.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await Ds(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}class l0 extends gn{constructor(t={}){var r;super();p(this,"concurrency");p(this,"maxSize");p(this,"queue");p(this,"pending");p(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((r=t.metrics)==null||r.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(const r of this.queue)if(r.status==="queued"){t=r;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let r=0;r<this.queue.length;r++)if(this.queue[r]===t){this.queue.splice(r,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,r){var i;if((i=r==null?void 0:r.signal)==null||i.throwIfAborted(),this.size===this.maxSize)throw new Fg;const s=new ZC(t,r);return this.enqueue(s),this.safeDispatchEvent("add"),this.tryToStartAnother(),s.join(r).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:s,result:o}}),o)).catch(o=>{if(s.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===s){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:s,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new Qo)}),this.clear()}async onEmpty(t){this.size!==0&&await Jc(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,r){this.size<t||await Jc(this,"next",r==null?void 0:r.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Jc(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,u,d;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const r=$g({objectMode:!0}),s=f=>{f!=null?this.abort():this.clear(),r.end(f)},i=f=>{f.detail!=null&&r.push(f.detail)},o=f=>{s(f.detail)},a=()=>{s()},c=()=>{s(new Qo("Queue aborted"))};this.addEventListener("completed",i),this.addEventListener("error",o),this.addEventListener("idle",a),(u=t==null?void 0:t.signal)==null||u.addEventListener("abort",c);try{yield*r}finally{this.removeEventListener("completed",i),this.removeEventListener("error",o),this.removeEventListener("idle",a),(d=t==null?void 0:t.signal)==null||d.removeEventListener("abort",c),s()}}}class eS extends l0{constructor(e={}){super({...e,sort:(t,r)=>t.options.priority>r.options.priority?-1:t.options.priority<r.options.priority?1:0})}}function Yr(n){const e=new globalThis.AbortController;function t(){e.abort();for(const i of n)(i==null?void 0:i.removeEventListener)!=null&&i.removeEventListener("abort",t)}for(const i of n){if((i==null?void 0:i.aborted)===!0){t();break}(i==null?void 0:i.addEventListener)!=null&&i.addEventListener("abort",t)}function r(){for(const i of n)(i==null?void 0:i.removeEventListener)!=null&&i.removeEventListener("abort",t)}const s=e.signal;return s.clear=r,s}function tS(n){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(n)||/^::1$/.test(n)}function u3(n){if(!Bg(n))return!1;const{address:e}=n.nodeAddress();return tS(e)}function rS(n,e){const t=g1.exactMatch(n.multiaddr),r=g1.exactMatch(e.multiaddr);if(t&&!r)return-1;if(!t&&r)return 1;const s=y1.exactMatch(n.multiaddr),i=y1.exactMatch(e.multiaddr);if(s&&!i)return-1;if(!s&&i)return 1;const o=Dl.exactMatch(n.multiaddr),a=Dl.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=J4.exactMatch(n.multiaddr),l=J4.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const u=Y4.exactMatch(n.multiaddr),d=Y4.exactMatch(e.multiaddr);if(u&&!d)return-1;if(!u&&d)return 1;const f=X4.exactMatch(n.multiaddr),m=X4.exactMatch(e.multiaddr);return f&&!m?-1:!f&&m?1:0}function nS(n,e){const t=u3(n.multiaddr),r=u3(e.multiaddr);return t&&!r?1:!t&&r?-1:0}function sS(n,e){const t=Bl(n.multiaddr),r=Bl(e.multiaddr);return t&&!r?1:!t&&r?-1:0}function iS(n,e){return n.isCertified&&!e.isCertified?-1:!n.isCertified&&e.isCertified?1:0}function oS(n,e){const t=x1.exactMatch(n.multiaddr),r=x1.exactMatch(e.multiaddr);return t&&!r?1:!t&&r?-1:0}function aS(n){return n.sort(rS).sort(iS).sort(oS).sort(sS).sort(nS)}const Cc={maxParallelDials:Ug,maxDialQueueLength:Og,maxPeerAddrsToDial:Mg,dialTimeout:Lg};class cS{constructor(e,t={}){p(this,"queue");p(this,"components");p(this,"addressSorter");p(this,"maxPeerAddrsToDial");p(this,"maxDialQueueLength");p(this,"dialTimeout");p(this,"shutDownController");p(this,"connections");p(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??Cc.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??Cc.maxDialQueueLength,this.dialTimeout=t.dialTimeout??Cc.dialTimeout,this.connections=t.connections??new Fa,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[r,s]of Object.entries(t.resolvers??{}))Hd.set(r,s);this.queue=new eS({concurrency:t.maxParallelDials??Cc.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",r=>{var s;((s=r.detail)==null?void 0:s.name)!==Qo.name&&this.log.error("error in dial queue - %e",r.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,c,l;const{peerId:r,multiaddrs:s}=Ng(e),i=Array.from(this.connections.values()).flat().find(u=>t.force===!0?!1:u.remotePeer.equals(r)?!0:s.find(d=>d.equals(u.remoteAddr)));if((i==null?void 0:i.status)==="open")return this.log("already connected to %a",i.remoteAddr),(a=t.onProgress)==null||a.call(t,new fr("dial-queue:already-connected")),i;const o=this.queue.queue.find(u=>{if((r==null?void 0:r.equals(u.options.peerId))===!0)return!0;const d=u.options.multiaddrs;if(d==null)return!1;for(const f of s)if(d.has(f.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",r);for(const u of s)o.options.multiaddrs.add(u.toString());return(c=t.onProgress)==null||c.call(t,new fr("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new Hc("Dial queue is full");return this.log("creating dial target for %p",r,s.map(u=>u.toString())),(l=t.onProgress)==null||l.call(t,new fr("dial-queue:add-to-dial-queue")),this.queue.add(async u=>{var f;(f=u.onProgress)==null||f.call(u,new fr("dial-queue:start-dial"));const d=Yr([this.shutDownController.signal,u.signal]);try{return await this.dialPeer(u,d)}finally{d.clear()}},{peerId:r,priority:t.priority??qg,multiaddrs:new Set(s.map(u=>u.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var u;const r=e.peerId,s=e.multiaddrs,i=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",r);o||s.size>0;){c++,o=!1;const d=[],f=new Set(e.multiaddrs);s.clear(),this.log("calculating addrs to dial %p from %s",r,[...f]);const m=await this.calculateMultiaddrs(r,f,{...e,signal:t});for(const y of m){if(i.has(y.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",y.multiaddr,r);continue}d.push(y)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",r,d.map(y=>y.multiaddr.toString())),(u=e==null?void 0:e.onProgress)==null||u.call(e,new fr("dial-queue:calculated-addresses",d));for(const y of d){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new Hc("Peer had more than maxPeerAddrsToDial");a++;try{const b=await this.components.transportManager.dial(y.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",y.multiaddr);try{await this.components.peerStore.merge(b.remotePeer,{multiaddrs:[b.remoteAddr],metadata:{[zC]:oe(Date.now().toString())}})}catch(x){this.log.error("could not update last dial failure key for %p",r,x)}return b}catch(b){if(this.log.error("dial failed to %a",y.multiaddr,b),i.add(y.multiaddr.toString()),r!=null)try{await this.components.peerStore.merge(r,{metadata:{[qC]:oe(Date.now().toString())}})}catch(x){this.log.error("could not update last dial failure key for %p",r,x)}if(t.aborted)throw new px(b.message);l.push(b)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,r={}){var d,f;const s=[...t].map(m=>({multiaddr:qe(m),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new Hc("Tried to dial self");if(await((f=(d=this.components.connectionGater).denyDialPeer)==null?void 0:f.call(d,e))===!0)throw new i3("The dial request is blocked by gater.allowDialPeer");if(s.length===0){this.log("loading multiaddrs for %p",e);try{const m=await this.components.peerStore.get(e);s.push(...m.addresses),this.log("loaded multiaddrs for %p",e,s.map(({multiaddr:y})=>y.toString()))}catch(m){if(m.name!=="NotFoundError")throw m}}if(s.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const m=await this.components.peerRouting.findPeer(e,r);this.log("found multiaddrs for %p in the peer routing",e,s.map(({multiaddr:y})=>y.toString())),s.push(...m.multiaddrs.map(y=>({multiaddr:y,isCertified:!1})))}catch(m){m.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,m)}}}let i=(await Promise.all(s.map(async m=>{const y=await KC(m.multiaddr,{dns:this.components.dns,...r,log:this.log});return y.length===1&&y[0].equals(m.multiaddr)?m:y.map(b=>({multiaddr:b,isCertified:!1}))}))).flat();if(e!=null){const m=`/p2p/${e.toString()}`;i=i.map(y=>{const b=y.multiaddr.protos().pop();return(b==null?void 0:b.path)===!0?y:y.multiaddr.getPeerId()==null?{multiaddr:y.multiaddr.encapsulate(m),isCertified:y.isCertified}:y})}const o=i.filter(m=>{if(this.components.transportManager.dialTransportForMultiaddr(m.multiaddr)==null)return!1;const y=m.multiaddr.getPeerId();return e!=null&&y!=null?e.equals(y):!0}),a=new Map;for(const m of o){const y=m.multiaddr.toString(),b=a.get(y);if(b!=null){b.isCertified=b.isCertified||m.isCertified||!1;continue}a.set(y,m)}const c=[...a.values()];if(c.length===0)throw new mC("The dial request has no valid addresses");const l=[];for(const m of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(m.multiaddr)||l.push(m);const u=this.addressSorter==null?aS(l):l.sort(this.addressSorter);if(u.length===0)throw new i3("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",i.map(({multiaddr:m})=>m.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",u.map(({multiaddr:m})=>m.toString())),u}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const r=await this.calculateMultiaddrs(void 0,new Set(e.map(s=>s.toString())),t);return t.runOnLimitedConnection===!1?r.find(s=>!x1.matches(s.multiaddr))!=null:!0}catch(r){this.log.trace("error calculating if multiaddr(s) were dialable",r)}return!1}}class b1 extends l0{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}var Hg={};function Ar(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var lS=Ar;Ar.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};Ar.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};Ar.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};Ar.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};Ar.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};Ar.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};Ar.prototype.start=Ar.prototype.try;Ar.prototype.errors=function(){return this._errors};Ar.prototype.attempts=function(){return this._attempts};Ar.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var s=this._errors[r],i=s.message,o=(n[i]||0)+1;n[i]=o,o>=t&&(e=s,t=o)}return e};(function(n){var e=lS;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)r[s]=t[s];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],o=0;o<r.retries;o++)i.push(this.createTimeout(o,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(o,r)),i.sort(function(a,c){return a-c}),i},n.createTimeout=function(t,r){var s=r.randomize?Math.random()+1:1,i=Math.round(s*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,s){if(r instanceof Array&&(s=r,r=null),!s){s=[];for(var i in t)typeof t[i]=="function"&&s.push(i)}for(var o=0;o<s.length;o++){var a=s[o],c=t[a];t[a]=(function(u){var d=n.operation(r),f=Array.prototype.slice.call(arguments,1),m=f.pop();f.push(function(y){d.retry(y)||(y&&(arguments[0]=d.mainError()),m.apply(this,arguments))}),d.attempt(function(){u.apply(t,f)})}).bind(t,c),t[a].options=r}}})(Hg);var uS=Hg;const hS=qi(uS),dS=Object.prototype.toString,fS=n=>dS.call(n)==="[object Error]",pS=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function gS(n){return n&&fS(n)&&n.name==="TypeError"&&typeof n.message=="string"?n.message==="Load failed"?n.stack===void 0:pS.has(n.message):!1}class mS extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const h3=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n};async function yS(n,e){return new Promise((t,r)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const s=hS.operation(e),i=()=>{var a;s.stop(),r((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",i,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",i),s.stop()};s.attempt(async a=>{try{const c=await n(a);o(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof mS)throw c.originalError;if(c instanceof TypeError&&!gS(c))throw c;if(h3(c,a,e),await e.shouldRetry(c)||(s.stop(),r(c)),await e.onFailedAttempt(c),!s.retry(c))throw s.mainError()}catch(l){h3(l,a,e),o(),r(l)}}})})}class xS{constructor(e,t={}){p(this,"log");p(this,"queue");p(this,"started");p(this,"peerStore");p(this,"retries");p(this,"retryInterval");p(this,"backoffFactor");p(this,"connectionManager");p(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new b1({concurrency:t.maxParallelReconnects??HC,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",r=>{this.maybeReconnect(r.detail).catch(s=>{this.log.error("failed to maybe reconnect to %p - %e",r.detail,s)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);d3(t)&&(this.queue.has(e)||this.queue.add(async r=>{await yS(async s=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:r==null?void 0:r.signal})}catch(i){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,s,this.retries,i),i}},{signal:r==null?void 0:r.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async r=>{this.log.error("failed to reconnect to %p - %e",e,r);const s={};[...t.tags.keys()].forEach(i=>{i.startsWith(ld)&&(s[i]=void 0)}),await this.peerStore.merge(e,{tags:s}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async r=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,r)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>d3(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(r=>{this.log.error(r)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function d3(n){for(const e of n.tags.keys())if(e.startsWith(ld))return!0;return!1}const qg=50,Iu={maxConnections:Vg,inboundConnectionThreshold:UC,maxIncomingPendingConnections:$C};var D6;D6=Symbol.toStringTag;class vS{constructor(e,t={}){p(this,"started");p(this,"connections");p(this,"allow");p(this,"deny");p(this,"maxIncomingPendingConnections");p(this,"incomingPendingConnections");p(this,"outboundPendingConnections");p(this,"maxConnections");p(this,"dialQueue");p(this,"reconnectQueue");p(this,"connectionPruner");p(this,"inboundConnectionRateLimiter");p(this,"peerStore");p(this,"metrics");p(this,"events");p(this,"log");p(this,"peerId");p(this,D6,"@libp2p/connection-manager");var r;if(this.maxConnections=t.maxConnections??Iu.maxConnections,this.maxConnections<1)throw new pe("Connection Manager maxConnections must be greater than 0");this.connections=new Fa,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(s=>v1(s)),this.deny=(t.deny??[]).map(s=>v1(s)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??Iu.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new NC({points:t.inboundConnectionThreshold??Iu.inboundConnectionThreshold,duration:1}),this.connectionPruner=new GC({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:(r=t.allow)==null?void 0:r.map(s=>qe(s))}),this.dialQueue=new cS(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??Ug,maxDialQueueLength:t.maxDialQueueLength??Og,maxPeerAddrsToDial:t.maxPeerAddrsToDial??Mg,dialTimeout:t.dialTimeout??Lg,resolvers:t.resolvers??{dnsaddr:cg},connections:this.connections}),this.reconnectQueue=new xS({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,r;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const s={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const i of this.connections.values())for(const o of i)s[o.direction]++;return s}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const s={};for(const i of this.connections.values())for(const o of i)for(const a of o.streams){const c=`${a.direction} ${a.protocol??"unnegotiated"}`;s[c]=(s[c]??0)+1}return s}}),(r=this.metrics)==null||r.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const s={};for(const o of this.connections.values())for(const a of o){const c={};for(const l of a.streams){const u=`${l.direction} ${l.protocol??"unnegotiated"}`;c[u]=(c[u]??0)+1}for(const[l,u]of Object.entries(c))s[l]=s[l]??[],s[l].push(u)}const i={};for(let[o,a]of Object.entries(s)){a=a.sort((l,u)=>l-u);const c=Math.floor(a.length*.9);i[o]=a[c]}return i}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await hl(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await gd(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const r of t)e.push((async()=>{try{await r.close()}catch(s){this.log.error(s)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const r=t.remotePeer,s=!this.connections.has(r),i=this.connections.get(r)??[];i.push(t),this.connections.set(r,i),r.publicKey!=null&&r.type==="RSA"&&await this.peerStore.patch(r,{publicKey:r.publicKey}),s&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,r=t.remotePeer,i=(this.connections.get(r)??[]).filter(o=>o.id!==t.id);this.connections.set(r,i),i.length===0&&(this.log("onDisconnect remove all connections for peer %p",r),this.connections.delete(r),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const r of this.connections.values())t=t.concat(r);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var r,s;if(!this.started)throw new Xo("Not started");this.outboundPendingConnections++;try{(r=t.signal)==null||r.throwIfAborted();const{peerId:i}=Ng(e);if(this.peerId.equals(i))throw new hd("Can not dial self");if(i!=null&&t.force!==!0){this.log("dial %p",i);const l=this.getConnections(i).find(u=>u.limits==null);if(l!=null)return this.log("had an existing non-limited connection to %p",i),(s=t.onProgress)==null||s.call(t,new fr("dial-queue:already-connected")),l}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??qg});if(o.status!=="open")throw new ud("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let c=!1;for(const l of a)if(l.id===o.id&&(c=!0),t.force!==!0&&l.id!==o.id&&l.remoteAddr.equals(o.remoteAddr))return o.abort(new Ql("Duplicate multiaddr connection")),l;return c||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const r=this.connections.get(e)??[];await Promise.all(r.map(async s=>{try{await s.close(t)}catch(i){s.abort(i)}}))}async acceptIncomingConnection(e){if(this.deny.some(s=>s.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(s=>s.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const s=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(s,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,s),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(r=>qe(r))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}class ku{constructor(e){p(this,"movingAverage");p(this,"variance");p(this,"deviation");p(this,"forecast");p(this,"timeSpan");p(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const r=this.alpha(t,this.previousTime),s=e-this.movingAverage,i=r*s;this.movingAverage=r*e+(1-r)*this.movingAverage,this.variance=(1-r)*(this.variance+s*i),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+r*s}else this.movingAverage=e;this.previousTime=t}}const bS=1.2,wS=2,_S=2e3;class sa{constructor(e={}){p(this,"success");p(this,"failure");p(this,"next");p(this,"metric");p(this,"timeoutMultiplier");p(this,"failureMultiplier");p(this,"minTimeout");var t;this.success=new ku(e.interval??5e3),this.failure=new ku(e.interval??5e3),this.next=new ku(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??wS,this.timeoutMultiplier=e.timeoutMultiplier??bS,this.minTimeout=e.minTimeout??_S,e.metricName!=null&&(this.metric=(t=e.metrics)==null?void 0:t.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),r=AbortSignal.timeout(t),s=Yr([e.signal,r]);return s.start=Date.now(),s.timeout=t,s}cleanUp(e){var r,s;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(r=this.metric)==null||r.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(s=this.metric)==null||s.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class ES{constructor(){p(this,"readNext");p(this,"haveNext");p(this,"ended");p(this,"nextResult");p(this,"error");this.ended=!1,this.readNext=St(),this.haveNext=St()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=St(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=St(),await Ds(this.readNext.promise,t==null?void 0:t.signal,t)}}function zg(){return new ES}let AS=class extends Error{constructor(){super(...arguments);p(this,"name","UnexpectedEOFError");p(this,"code","ERR_UNEXPECTED_EOF")}};function Kg(n,e){const t=zg();n.sink(t).catch(async o=>{await t.end(o)}),n.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let r=n.source;n.source[Symbol.iterator]!=null?r=n.source[Symbol.iterator]():n.source[Symbol.asyncIterator]!=null&&(r=n.source[Symbol.asyncIterator]());const s=new nt;return{read:async o=>{var c;if((c=o==null?void 0:o.signal)==null||c.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:l,value:u}=await Ds(r.next(),o==null?void 0:o.signal);return l===!0?null:u}for(;s.byteLength<o.bytes;){const{value:l,done:u}=await Ds(r.next(),o==null?void 0:o.signal);if(u===!0)throw new AS("unexpected end of input");s.append(l)}const a=s.sublist(0,o.bytes);return s.consume(o.bytes),a},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(s.byteLength>0){const o=n.source;n.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield s:yield*s,yield*o}()}return n}}}const CS=1e4,SS="1.0.0",TS="ping",IS="ipfs",f3=32,kS=!0;var R6,B6;B6=Symbol.toStringTag,R6=dl;class PS{constructor(e,t={}){p(this,"protocol");p(this,"components");p(this,"log");p(this,"heartbeatInterval");p(this,"pingIntervalMs");p(this,"abortController");p(this,"timeout");p(this,"abortConnectionOnPingFailure");p(this,B6,"@libp2p/connection-monitor");p(this,R6,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??IS}/${TS}/${SS}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??CS,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??kS,this.timeout=new sa({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var r;let t=Date.now();try{const s=this.timeout.getTimeoutSignal({signal:(r=this.abortController)==null?void 0:r.signal}),i=await e.newStream(this.protocol,{signal:s,runOnLimitedConnection:!0}),o=Kg(i);t=Date.now(),await Promise.all([o.write(Bd(f3),{signal:s}),o.read({bytes:f3,signal:s})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:s})}catch(s){if(s.name!=="UnsupportedProtocolError")throw s;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}function DS(n){return n[Symbol.asyncIterator]!=null}async function RS(n,e,t){try{await Promise.all(n.map(async r=>{for await(const s of r)await e.push(s,{signal:t}),t.throwIfAborted()})),await e.end(void 0,{signal:t})}catch(r){await e.end(r,{signal:t}).catch(()=>{})}}async function*BS(n){const e=new AbortController,t=zg();RS(n,t,e.signal).catch(()=>{});try{yield*t}finally{e.abort()}}function*FS(n){for(const e of n)yield*e}function ia(...n){const e=[];for(const t of n)DS(t)||e.push(t);return e.length===n.length?FS(e):BS(n)}var F6;F6=Symbol.toStringTag;class NS{constructor(e,t){p(this,"routers");p(this,"started");p(this,"components");p(this,F6,"@libp2p/content-routing");var r,s,i,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((r=e.metrics)==null?void 0:r.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()}),getAttributesFromYieldedValue:(c,l)=>({...l,providers:[...Array.isArray(l.providers)?l.providers:[],c.id.toString()]})}))??this.findProviders,this.provide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.provide,this.cancelReprovide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([c])=>({key:ie(c,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([c])=>({key:ie(c,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new Su("No content routers available");const r=this,s=new Gr;for await(const i of ia(...r.routers.map(o=>o.findProviders(e,t))))i!=null&&(i.multiaddrs.length>0&&await this.components.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),!s.has(i.id)&&(s.add(i.id),yield i))}async provide(e,t={}){if(this.routers.length===0)throw new Su("No content routers available");await Promise.all(this.routers.map(async r=>{await r.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new Su("No content routers available");await Promise.all(this.routers.map(async r=>{await r.cancelReprovide(e,t)}))}async put(e,t,r){if(!this.isStarted())throw new Xo;await Promise.all(this.routers.map(async s=>{await s.put(e,t,r)}))}async get(e,t){if(!this.isStarted())throw new Xo;return Promise.any(this.routers.map(async r=>r.get(e,t)))}}const Sc=globalThis.CustomEvent??Event;async function*u0(n,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const r=e.ordered??!1,s=new EventTarget,i=[];let o=St(),a=St(),c=!1,l,u=!1;s.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const y of n){if(i.length===t&&(o=St(),await o.promise),u)break;const b={done:!1};i.push(b),y().then(x=>{b.done=!0,b.ok=!0,b.value=x,s.dispatchEvent(new Sc("task-complete"))},x=>{b.done=!0,b.err=x,s.dispatchEvent(new Sc("task-complete"))})}c=!0,s.dispatchEvent(new Sc("task-complete"))}catch(y){l=y,s.dispatchEvent(new Sc("task-complete"))}});function d(){var y;return r?(y=i[0])==null?void 0:y.done:!!i.find(b=>b.done)}function*f(){for(;i.length>0&&i[0].done;){const y=i[0];if(i.shift(),y.ok)yield y.value;else throw u=!0,o.resolve(),y.err;o.resolve()}}function*m(){for(;d();)for(let y=0;y<i.length;y++)if(i[y].done){const b=i[y];if(i.splice(y,1),y--,b.ok)yield b.value;else throw u=!0,o.resolve(),b.err;o.resolve()}}for(;;){if(d()||(a=St(),await a.promise),l!=null||(r?yield*f():yield*m(),l!=null))throw l;if(c&&i.length===0)break}}var N6;N6=Symbol.toStringTag;class LS{constructor(e,t={}){p(this,"log");p(this,"peerId");p(this,"peerStore");p(this,"routers");p(this,N6,"@libp2p/peer-routing");var r,s;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((r=e.metrics)==null?void 0:r.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([i],o)=>({...o,peer:i.toString()})}))??this.findPeer,this.getClosestPeers=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([i],o)=>({...o,key:ie(i,"base36")}),getAttributesFromYieldedValue:(i,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],i.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new s3("No peer routers available");if(e.toString()===this.peerId.toString())throw new hC("Should not try to find self");const r=this,s=ia(...this.routers.map(i=>async function*(){try{yield await i.findPeer(e,t)}catch(o){r.log.error(o)}}()));for await(const i of s)if(i!=null)return i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),i;throw new Wn}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new s3("No peer routers available");const r=this,s=yg(1024);for await(const i of u0(async function*(){const o=ia(...r.routers.map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await r.findPeer(a.id,{...t,useCache:!1})}catch(c){r.log.error("could not find peer multiaddrs",c);return}return a}}()))i!=null&&(i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),!s.has(i.id.toMultihash().bytes)&&(s.add(i.id.toMultihash().bytes),yield i))}}var L6,M6;class MS extends(M6=gn,L6=Symbol.toStringTag,M6){constructor(t){super();p(this,"peerRouting");p(this,"log");p(this,"walking");p(this,"walkers");p(this,"shutdownController");p(this,"walkController");p(this,"needNext");p(this,L6,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var s,i;this.walking||this.startWalk(),this.walkers++;const r=Yr([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(s=this.needNext)==null||s.resolve(),this.needNext=St(),yield(await Jc(this,"walk:peer",r,{errorEvent:"walk:error"})).detail}finally{r.clear(),this.walkers--,this.walkers===0&&((i=this.walkController)==null||i.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=Yr([this.walkController.signal,this.shutdownController.signal]),r=Date.now();let s=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const i=Bd(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(i,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),s++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await Ds(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",i,this.walkers,s)}catch(i){this.log.error("random walk errored",i),this.safeDispatchEvent("walk:error",{detail:i})}this.log("no walkers left, ended walk")}).catch(i=>{this.log.error("random walk errored",i)}).finally(()=>{this.log("finished walk, found %d peers after %dms",s,Date.now()-r),this.walking=!1})}}const jg=32,Gg=64;var O6;O6=Symbol.toStringTag;class OS{constructor(e){p(this,"log");p(this,"topologies");p(this,"handlers");p(this,"components");p(this,O6,"@libp2p/registrar");this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new dC(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,r){if(this.handlers.has(e)&&(r==null?void 0:r.force)!==!0)throw new fC(`Handler already registered for protocol ${e}`);const s=hg.bind({ignoreUndefined:!0})({maxInboundStreams:jg,maxOutboundStreams:Gg},r);this.handlers.set(e,{handler:t,options:s}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(r=>{this.handlers.delete(r)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new pe("invalid topology");const r=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let s=this.topologies.get(e);return s==null&&(s=new Map,this.topologies.set(e,s)),s.set(r,t),r}unregister(e){for(const[t,r]of this.topologies.entries())r.has(e)&&(r.delete(e),r.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(r=>{var s,i,o;for(const a of r.protocols){const c=this.topologies.get(a);if(c!=null)for(const l of c.values())((s=l.filter)==null?void 0:s.has(t))!==!1&&((i=l.filter)==null||i.remove(t),(o=l.onDisconnect)==null||o.call(l,t))}}).catch(r=>{r.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,r)})}_onPeerUpdate(e){var i,o,a;const{peer:t,previous:r}=e.detail,s=((r==null?void 0:r.protocols)??[]).filter(c=>!t.protocols.includes(c));for(const c of s){const l=this.topologies.get(c);if(l!=null)for(const u of l.values())((i=u.filter)==null?void 0:i.has(t.id))!==!1&&((o=u.filter)==null||o.remove(t.id),(a=u.onDisconnect)==null||a.call(u,t.id))}}_onPeerIdentify(e){var i,o,a;const t=e.detail.protocols,r=e.detail.connection,s=e.detail.peerId;for(const c of t){const l=this.topologies.get(c);if(l!=null)for(const u of l.values())r.limits!=null&&u.notifyOnLimitedConnection!==!0||((i=u.filter)==null?void 0:i.has(s))!==!0&&((o=u.filter)==null||o.add(s),(a=u.onConnect)==null||a.call(u,s,r))}}}class VS extends Map{constructor(t){super();p(this,"metric");const{name:r,metrics:s}=t;this.metric=s.registerMetric(r),this.updateComponentMetric()}set(t,r){return super.set(t,r),this.updateComponentMetric(),this}delete(t){const r=super.delete(t);return this.updateComponentMetric(),r}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function US(n){const{name:e,metrics:t}=n;let r;return t!=null?r=new VS({name:e,metrics:t}):r=new Map,r}var V6;V6=Symbol.toStringTag;class $S{constructor(e,t={}){p(this,"log");p(this,"components");p(this,"transports");p(this,"listeners");p(this,"faultTolerance");p(this,"started");p(this,V6,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=US({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??Wo.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new pe("Transport must have a valid tag");if(this.transports.has(t))throw new pe(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,r]of this.listeners)for(this.log("closing listeners for %s",t);r.length>0;){const s=r.pop();s!=null&&e.push(s.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var s;const r=this.dialTransportForMultiaddr(e);if(r==null)throw new vC(`No transport available for address ${String(e)}`);return(s=t==null?void 0:t.onProgress)==null||s.call(t,new fr("transport-manager:selected-transport",r[Symbol.toStringTag])),r.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const r of t)e=[...e,...r.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Xo("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(i=>{t.errors.set(i.toString(),new pC)});const r=[];for(const[i,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",i,c);const l=o.createListener({upgrader:this.components.upgrader});let u=this.listeners.get(i)??[];u==null&&(u=[],this.listeners.set(i,u)),u.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const d=u.findIndex(f=>f===l);u.splice(d,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),W4.matches(c)?t.ipv4.attempts++:Q4.matches(c)&&t.ipv6.attempts++,r.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),W4.matches(c)&&t.ipv4.success++,Q4.matches(c)&&t.ipv6.success++},d=>{throw this.log.error("transport %s could not listen on address %a - %e",i,c,d),t.errors.set(c.toString(),d),d}))}}const s=await Promise.allSettled(r);if(!(s.length>0&&s.every(i=>i.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===Wo.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new gC(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([i,o])=>`
  ${i}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,r=e.ipv6.success===0;return t&&r}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const r=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const s=t.pop();s!=null&&r.push(s.close())}await Promise.all(r),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const nr="/multistream/1.0.0",Yd=1024;let HS=class extends Error{constructor(){super(...arguments);p(this,"name","InvalidMessageLengthError");p(this,"code","ERR_INVALID_MSG_LENGTH")}},qS=class extends Error{constructor(){super(...arguments);p(this,"name","InvalidDataLengthError");p(this,"code","ERR_MSG_DATA_TOO_LONG")}},zS=class extends Error{constructor(){super(...arguments);p(this,"name","InvalidDataLengthLengthError");p(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function h0(n,e={}){const t=Kg(n,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=mr(e.maxDataLength));const r=(e==null?void 0:e.lengthDecoder)??ss,s=(e==null?void 0:e.lengthEncoder)??Pr;return{read:async o=>{let a=-1;const c=new nt;for(;;){c.append(await t.read({...o,bytes:1}));try{a=r(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new HS("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new zS("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new qS("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new nt(s(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new nt(...o.flatMap(l=>[s(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}const KS=oe(`
`);async function So(n,e,t){await n.write(e,t)}async function jS(n,e,t){await n.writeV(e,t)}async function GS(n,e){const t=await n.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==KS[0])throw e.log.error("Invalid mss message - missing newline",t),new pn("Missing newline");return t.sublist(0,-1)}async function hi(n,e){const t=await GS(n,e);return ie(t.subarray())}async function Pu(n,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return WS(n,e[0],t);const r=h0(n,{...t,maxDataLength:Yd}),s=e.shift();if(s==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',nr,s);const i=oe(`${nr}
`),o=oe(`${s}
`);await jS(r,[i,o],t),t.log.trace("select: reading multistream-select header");let a=await hi(r,t);if(t.log.trace('select: read "%s"',a),a===nr&&(t.log.trace("select: reading protocol response"),a=await hi(r,t),t.log.trace('select: read "%s"',a)),a===s)return{stream:r.unwrap(),protocol:s};for(const c of e){t.log.trace('select: write "%s"',c),await So(r,oe(`${c}
`),t),t.log.trace("select: reading protocol response");const l=await hi(r,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:r.unwrap(),protocol:c}}throw new dd("protocol selection failed")}function WS(n,e,t){const r=n.sink.bind(n),s=n.source;let i=!1,o=!1;const a=St();let c=!1,l=!1;const u=St();let d=!1,f=!1;const m=St(),y=h0({sink:r,source:s},{...t,maxDataLength:Yd});n.sink=async S=>{const{sink:_}=y.unwrap();await _(async function*(){let E=!1;for await(const B of S){if(l&&await u.promise,c)yield B;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',nr,e,B.byteLength);const F=`${e}
`;yield new nt(Uint8Array.from([19]),oe(`${nr}
`),Pr(F.length),oe(F),B).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',nr,e,B.byteLength),c=!0,l=!1,u.resolve(),b().catch(A=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,A)})}E=!0}E||await b()}())};async function b(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),await x()),d||(t.log.trace("optimistic: doing read protocol for %s stream",e),await D())}finally{o=!1,i=!0,a.resolve()}}async function x(){if(l){await u.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',nr,e),await y.writeV([oe(`${nr}
`),oe(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',nr,e)}finally{c=!0,l=!1,u.resolve()}}async function D(){if(f){await m.promise;return}f=!0;try{t.log.trace("optimistic: reading multistream select header");let S=await hi(y,t);if(t.log.trace('optimistic: read multistream select header "%s"',S),S===nr&&(S=await hi(y,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',S,e),S!==e)throw new dd("protocol selection failed")}finally{d=!0,f=!1,m.resolve()}}if(n.source=async function*(){await b(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*y.unwrap().source}(),n.closeRead!=null){const S=n.closeRead.bind(n);n.closeRead=async _=>{i||await b().catch(E=>{t.log.error("could not negotiate protocol before close read",E)}),await S(_)}}if(n.closeWrite!=null){const S=n.closeWrite.bind(n);n.closeWrite=async _=>{i||await b().catch(E=>{t.log.error("could not negotiate protocol before close write",E)}),await S(_)}}if(n.close!=null){const S=n.close.bind(n);n.close=async _=>{const E=[];l&&E.push(u.promise),f&&E.push(m.promise),E.length>0?await Ds(Promise.all(E),_==null?void 0:_.signal):(i=!0,o=!1,a.resolve()),await S(_)}}return{stream:n,protocol:e}}const QS=8,Xd=1024*1024*4;class YS extends Error{constructor(){super(...arguments);p(this,"name","InvalidMessageLengthError");p(this,"code","ERR_INVALID_MSG_LENGTH")}}class Wg extends Error{constructor(){super(...arguments);p(this,"name","InvalidDataLengthError");p(this,"code","ERR_MSG_DATA_TOO_LONG")}}class XS extends Error{constructor(){super(...arguments);p(this,"name","InvalidDataLengthLengthError");p(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}class p3 extends Error{constructor(){super(...arguments);p(this,"name","UnexpectedEOFError");p(this,"code","ERR_UNEXPECTED_EOF")}}function Qg(n){return n[Symbol.asyncIterator]!=null}function Yg(n,e){if(n.byteLength>e)throw new Wg("Message length too long")}const d0=n=>{const e=mr(n),t=Qr(e);return Pr(n,t),d0.bytes=e,t};d0.bytes=0;function Jd(n,e){e=e??{};const t=e.lengthEncoder??d0,r=(e==null?void 0:e.maxDataLength)??Xd;function*s(i){Yg(i,r);const o=t(i.byteLength);o instanceof Uint8Array?yield o:yield*o,i instanceof Uint8Array?yield i:yield*i}return Qg(n)?async function*(){for await(const i of n)yield*s(i)}():function*(){for(const i of n)yield*s(i)}()}Jd.single=(n,e)=>{e=e??{};const t=e.lengthEncoder??d0,r=(e==null?void 0:e.maxDataLength)??Xd;return Yg(n,r),new nt(t(n.byteLength),n)};var ps;(function(n){n[n.LENGTH=0]="LENGTH",n[n.DATA=1]="DATA"})(ps||(ps={}));const Zd=n=>{const e=ss(n);return Zd.bytes=mr(e),e};Zd.bytes=0;function w1(n,e){const t=new nt;let r=ps.LENGTH,s=-1;const i=(e==null?void 0:e.lengthDecoder)??Zd,o=(e==null?void 0:e.maxLengthLength)??QS,a=(e==null?void 0:e.maxDataLength)??Xd;function*c(){for(;t.byteLength>0;){if(r===ps.LENGTH)try{if(s=i(t),s<0)throw new YS("Invalid message length");if(s>a)throw new Wg("Message length too long");const l=i.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(s),r=ps.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new XS("Message length length too long");break}throw l}if(r===ps.DATA){if(t.byteLength<s)break;const l=t.sublist(0,s);t.consume(s),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,r=ps.LENGTH}}}return Qg(n)?async function*(){for await(const l of n)t.append(l),yield*c();if(t.byteLength>0)throw new p3("Unexpected end of input")}():function*(){for(const l of n)t.append(l),yield*c();if(t.byteLength>0)throw new p3("Unexpected end of input")}()}w1.fromReader=(n,e)=>{let t=1;const r=async function*(){for(;;)try{const{done:i,value:o}=await n.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}}();return w1(r,{...e??{},onLength:i=>{t=i}})};async function Du(n,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const r=h0(n,{...t,maxDataLength:Yd,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const s=await hi(r,t);if(t.log.trace('handle: read "%s"',s),s===nr){t.log.trace('handle: respond with "%s" for "%s"',nr,s),await So(r,oe(`${nr}
`),t),t.log.trace('handle: responded with "%s" for "%s"',nr,s);continue}if(e.includes(s))return t.log.trace('handle: respond with "%s" for "%s"',s,s),await So(r,oe(`${s}
`),t),t.log.trace('handle: responded with "%s" for "%s"',s,s),{stream:r.unwrap(),protocol:s};if(s==="ls"){const i=new nt(...e.map(o=>Jd.single(oe(`${o}
`))),oe(`
`));t.log.trace('handle: respond with "%s" for %s',e,s),await So(r,i,t),t.log.trace('handle: responded with "%s" for %s',e,s);continue}t.log.trace('handle: respond with "na" for "%s"',s),await So(r,oe(`na
`),t),t.log('handle: responded with "na" for "%s"',s)}}const JS=500;var U6,$6;$6=Symbol.toStringTag,U6=fx;class ZS{constructor(e){p(this,"id");p(this,"remoteAddr");p(this,"remotePeer");p(this,"direction");p(this,"timeline");p(this,"multiplexer");p(this,"encryption");p(this,"status");p(this,"limits");p(this,"log");p(this,"tags");p(this,"_newStream");p(this,"_close");p(this,"_abort");p(this,"_getStreams");p(this,$6,"Connection");p(this,U6,!0);const{remoteAddr:t,remotePeer:r,newStream:s,close:i,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=r,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=s,this._close=i,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new U8("the connection is being closed");if(this.status==="closed")throw new ud("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new fd("Cannot open protocol stream on limited connection");const r=await this._newStream(e,t);return r.direction="outbound",r}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(JS);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function eT(n){return new ZS(n)}function tT(n,e){try{const{options:t}=e.getHandler(n);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return jg}function rT(n,e,t={}){try{const{options:r}=e.getHandler(n);if(r.maxOutboundStreams!=null)return r.maxOutboundStreams}catch(r){if(r.name!=="UnhandledProtocolError")throw r}return t.maxOutboundStreams??Gg}function g3(n,e,t){let r=0;return t.streams.forEach(s=>{s.direction===e&&s.protocol===n&&r++}),r}var H6;H6=Symbol.toStringTag;class nT{constructor(e,t){p(this,"components");p(this,"connectionEncrypters");p(this,"streamMuxers");p(this,"inboundUpgradeTimeout");p(this,"inboundStreamProtocolNegotiationTimeout");p(this,"outboundStreamProtocolNegotiationTimeout");p(this,"events");p(this,"metrics");p(this,H6,"@libp2p/upgrader");var r,s;this.components=e,this.connectionEncrypters=new Map,t.connectionEncrypters.forEach(i=>{this.connectionEncrypters.set(i.protocol,i)}),this.streamMuxers=new Map,t.streamMuxers.forEach(i=>{this.streamMuxers.set(i.protocol,i)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??VC,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??a3,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??a3,this.events=e.events,this.metrics={dials:(r=e.metrics)==null?void 0:r.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(s=e.metrics)==null?void 0:s.registerCounterGroup("libp2p_connection_manager_dial_errors_total")}}async shouldBlockConnection(e,...t){const r=this.components.connectionGater[e];if(r==null)return;if(await r.apply(this.components.connectionGater,t)===!0)throw new yC(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return Yr([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var i,o;let r=!1;const s=this.createInboundAbortSignal(t.signal);try{if((i=this.metrics.dials)==null||i.increment({inbound:!0}),r=await this.components.connectionManager.acceptIncomingConnection(e),!r)throw new xC("Connection denied");await this.shouldBlockConnection("denyInboundConnection",e),await this._performUpgrade(e,"inbound",{...t,signal:s})}catch(a){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),a}finally{s.clear(),r&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var r,s;try{(r=this.metrics.dials)==null||r.increment({outbound:!0});const i=e.remoteAddr.getPeerId();let o;i!=null&&(o=Is(i),await this.shouldBlockConnection("denyOutboundConnection",o,e));let a="outbound";return t.initiator===!1&&(a="inbound"),await this._performUpgrade(e,a,t)}catch(i){throw(s=this.metrics.errors)==null||s.increment({outbound:!0}),i}}async _performUpgrade(e,t,r){var u,d,f;let s,i,o,a,c;(u=this.components.metrics)==null||u.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if((r==null?void 0:r.skipProtection)!==!0){const m=this.components.connectionProtector;m!=null&&(e.log("protecting the %s connection",t),l=await m.protect(e,r))}try{if(s=l,(r==null?void 0:r.skipEncryption)!==!0){(d=r==null?void 0:r.onProgress)==null||d.call(r,new fr(`upgrader:encrypt-${t}-connection`)),{conn:s,remotePeer:i,protocol:c,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(l,r):this._encryptOutbound(l,r));const m={...l,...s};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",i,m)}else{const m=e.remoteAddr.getPeerId();if(m==null)throw new Ql(`${t} connection that skipped encryption must have a peer id`);const y=Is(m);c="native",i=y}if(i.equals(this.components.peerId)){const m=new hd("Can not dial self");throw e.abort(m),m}if(o=s,(r==null?void 0:r.muxerFactory)!=null)a=r.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(f=r==null?void 0:r.onProgress)==null||f.call(r,new fr(`upgrader:multiplex-${t}-connection`));const m=await(t==="inbound"?this._multiplexInbound({...l,...s},this.streamMuxers,r):this._multiplexOutbound({...l,...s},this.streamMuxers,r));a=m.muxerFactory,o=m.stream}}catch(m){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,m),m}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",i,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:i,limits:r==null?void 0:r.limits})}_createConnection(e){const{cryptoProtocol:t,direction:r,maConn:s,upgradedConn:i,remotePeer:o,muxerFactory:a,limits:c}=e;let l,u,d;a!=null&&(l=a.createStreamMuxer({direction:r,onIncomingStream:y=>{d!=null&&Promise.resolve().then(async()=>{var B;const b=this.components.registrar.getProtocols(),x=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout),{stream:D,protocol:S}=await Du(y,b,{signal:x,log:y.log,yieldBytes:!1});if(d==null)return;d.log("incoming stream opened on %s",S);const _=tT(S,this.components.registrar);if(g3(S,"inbound",d)===_){const F=new q8(`Too many inbound protocol streams for protocol "${S}" - limit ${_}`);throw y.abort(F),F}y.source=D.source,y.sink=D.sink,y.protocol=S,D.closeWrite!=null&&(y.closeWrite=D.closeWrite),D.closeRead!=null&&(y.closeRead=D.closeRead),D.close!=null&&(y.close=D.close),await this.components.peerStore.merge(o,{protocols:[S]}),(B=this.components.metrics)==null||B.trackProtocolStream(y,d),this._onStream({connection:d,stream:y,protocol:S})}).catch(async b=>{d.log.error("error handling incoming stream id %s - %e",y.id,b),y.timeline.close==null&&await y.close()})}}),u=async(y,b={})=>{var D;if(l==null)throw new Ec("Connection is not multiplexed");d.log.trace("starting new stream for protocols %s",y);const x=await l.newStream();d.log.trace("started new stream %s for protocols %s",x.id,y);try{if(b.signal==null){x.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",y);const F=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);b={...b,signal:F}}x.log.trace("selecting protocol from protocols %s",y);const{stream:S,protocol:_}=await Pu(x,y,{...b,log:x.log,yieldBytes:!0});x.log.trace("selected protocol %s",_);const E=rT(_,this.components.registrar,b),B=g3(_,"outbound",d);if(B>=E){const F=new z8(`Too many outbound protocol streams for protocol "${_}" - ${B}/${E}`);throw x.abort(F),F}return await this.components.peerStore.merge(o,{protocols:[_]}),x.source=S.source,x.sink=S.sink,x.protocol=_,S.closeWrite!=null&&(x.closeWrite=S.closeWrite),S.closeRead!=null&&(x.closeRead=S.closeRead),S.close!=null&&(x.close=S.close),(D=this.components.metrics)==null||D.trackProtocolStream(x,d),x}catch(S){throw d.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",r==="inbound"?"from":"to",e.maConn.remoteAddr,y,S),x.timeline.close==null&&x.abort(S),S}},Promise.all([l.sink(i.source),i.sink(l.source)]).catch(y=>{d.log.error("error piping data through muxer - %e",y)}));const f=s.timeline;s.timeline=new Proxy(f,{set:(...y)=>(y[1]==="close"&&y[2]!=null&&f.close==null&&(async()=>{try{d.status==="open"&&await d.close()}catch(b){d.log.error("error closing connection after timeline close %e",b)}finally{this.events.safeDispatchEvent("connection:close",{detail:d})}})().catch(b=>{d.log.error("error thrown while dispatching connection:close event %e",b)}),Reflect.set(...y))}),s.timeline.upgraded=Date.now();const m=()=>{throw new Ec("Connection is not multiplexed")};return d=eT({remoteAddr:s.remoteAddr,remotePeer:o,status:"open",direction:r,timeline:s.timeline,multiplexer:l==null?void 0:l.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:u??m,getStreams:()=>(l==null?void 0:l.streams)??[],close:async y=>{await(l==null?void 0:l.close(y)),await s.close(y)},abort:y=>{s.abort(y),l==null||l.abort(y)}}),this.events.safeDispatchEvent("connection:open",{detail:d}),d.__maConnTimeline=f,d}_onStream(e){const{connection:t,stream:r,protocol:s}=e,{handler:i,options:o}=this.components.registrar.getHandler(s);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new fd("Cannot open protocol stream on limited connection");i({connection:t,stream:r})}async _encryptInbound(e,t){const r=Array.from(this.connectionEncrypters.keys());try{const{stream:s,protocol:i}=await Du(e,r,{...t,log:e.log}),o=this.connectionEncrypters.get(i);if(o==null)throw new Ac(`no crypto module found for ${i}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,i),{...await o.secureInbound(s,t),protocol:i}}catch(s){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,s),new Ac(s.message)}}async _encryptOutbound(e,t){const r=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",r);const{stream:s,protocol:i}=await Pu(e,r,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(i);if(o==null)throw new Ac(`no crypto module found for ${i}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,i),{...await o.secureOutbound(s,t),protocol:i}}catch(s){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,s),new Ac(s.message)}}async _multiplexOutbound(e,t,r){const s=Array.from(t.keys());e.log("outbound selecting muxer %s",s);try{e.log.trace("selecting stream muxer from %s",s);const{stream:i,protocol:o}=await Pu(e,s,{...r,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing outbound connection",i),new Ec(String(i))}}async _multiplexInbound(e,t,r){const s=Array.from(t.keys());e.log("inbound handling muxers %s",s);try{const{stream:i,protocol:o}=await Du(e,s,{...r,log:e.log}),a=t.get(o);return{stream:i,muxerFactory:a}}catch(i){throw e.log.error("error multiplexing inbound connection",i),new Ec(String(i))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}const Xg="2.8.5",Jg="js-libp2p";function sT(n,e){return`${n??Jg}/${e??Xg} browser/${globalThis.navigator.userAgent}`}var Sa,_1;class iT extends gn{constructor(t){var u,d,f,m,y,b,x,D,S,_,E,B;super();ke(this,Sa);p(this,"peerId");p(this,"peerStore");p(this,"contentRouting");p(this,"peerRouting");p(this,"metrics");p(this,"services");p(this,"logger");p(this,"status");p(this,"components");p(this,"log");this.status="stopped";const r=new gn,s=r.dispatchEvent.bind(r);r.dispatchEvent=F=>{const A=s(F),w=this.dispatchEvent(new CustomEvent(F.type,{detail:F.detail}));return A||w},this.peerId=t.peerId,this.logger=t.logger??fg(),this.log=this.logger.forComponent("libp2p"),this.services={};const i=((u=t.nodeInfo)==null?void 0:u.name)??Jg,o=((d=t.nodeInfo)==null?void 0:d.version)??Xg,a=this.components=EC({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:i,version:o,userAgent:((f=t.nodeInfo)==null?void 0:f.userAgent)??sT(i,o)},logger:this.logger,events:r,datastore:t.datastore??new xA,connectionGater:PC(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",dA(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),a.events.addEventListener("peer:update",F=>{if(F.detail.previous==null){const A={id:F.detail.peer.id,multiaddrs:F.detail.peer.addresses.map(w=>w.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:A})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new nT(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map((F,A)=>this.configureComponent(`connection-encryption-${A}`,F(this.components))),streamMuxers:(t.streamMuxers??[]).map((F,A)=>this.configureComponent(`stream-muxers-${A}`,F(this.components))),inboundUpgradeTimeout:(m=t.connectionManager)==null?void 0:m.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((y=t.connectionManager)==null?void 0:y.inboundStreamProtocolNegotiationTimeout)??((b=t.connectionManager)==null?void 0:b.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((x=t.connectionManager)==null?void 0:x.outboundStreamProtocolNegotiationTimeout)??((D=t.connectionManager)==null?void 0:D.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new $S(this.components,t.transportManager)),this.configureComponent("connectionManager",new vS(this.components,t.connectionManager)),((S=t.connectionMonitor)==null?void 0:S.enabled)!==!1&&this.configureComponent("connectionMonitor",new PS(this.components,t.connectionMonitor)),this.configureComponent("registrar",new OS(this.components)),this.configureComponent("addressManager",new cC(this.components,t.addresses));const c=(t.peerRouters??[]).map((F,A)=>this.configureComponent(`peer-router-${A}`,F(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new LS(this.components,{routers:c}));const l=(t.contentRouters??[]).map((F,A)=>this.configureComponent(`content-router-${A}`,F(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new NS(this.components,{routers:l})),this.configureComponent("randomWalk",new MS(this.components)),(t.peerDiscovery??[]).forEach((F,A)=>{this.configureComponent(`peer-discovery-${A}`,F(this.components)).addEventListener("peer",k=>{Ie(this,Sa,_1).call(this,k)})}),(_=t.transports)==null||_.forEach((F,A)=>{this.components.transportManager.add(this.configureComponent(`transport-${A}`,F(this.components)))}),t.services!=null)for(const F of Object.keys(t.services)){const A=t.services[F],w=A(this.components);if(w==null){this.log.error("service factory %s returned null or undefined instance",F);continue}this.services[F]=w,this.configureComponent(F,w),w[$h]!=null&&(this.log("registering service %s for content routing",F),l.push(w[$h])),w[qh]!=null&&(this.log("registering service %s for peer routing",F),c.push(w[qh])),w[Hh]!=null&&(this.log("registering service %s for peer discovery",F),(B=(E=w[Hh]).addEventListener)==null||B.call(E,"peer",k=>{Ie(this,Sa,_1).call(this,k)}))}AC(a)}configureComponent(t,r){return r==null&&this.log.error("component %s was null or undefined",t),this.components[t]=r,r}async start(){var t,r,s,i;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((r=(t=this.components).beforeStart)==null?void 0:r.call(t)),await this.components.start(),await((i=(s=this.components).afterStart)==null?void 0:i.call(s)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,r,s,i;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((r=(t=this.components).beforeStop)==null?void 0:r.call(t)),await this.components.stop(),await((i=(s=this.components).afterStop)==null?void 0:i.call(s)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new Gr;for(const r of this.components.connectionManager.getConnections())t.add(r.remotePeer);return Array.from(t)}async dial(t,r={}){return this.components.connectionManager.openConnection(t,{priority:75,...r})}async dialProtocol(t,r,s={}){if(r==null)throw new pe("no protocols were provided to open a stream");if(r=Array.isArray(r)?r:[r],r.length===0)throw new pe("no protocols were provided to open a stream");return(await this.dial(t,s)).newStream(r,s)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,r={}){n0(t)&&(t=Is(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,r)}async getPublicKey(t,r={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const s=Er([oe("/pk/"),t.toMultihash().bytes]),i=await this.contentRouting.get(s,r),o=Ba(i);return await this.peerStore.patch(t,{publicKey:o}),o}async handle(t,r,s){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async i=>{await this.components.registrar.handle(i,r,s)}))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async r=>{await this.components.registrar.unhandle(r)}))}async register(t,r){return this.components.registrar.register(t,r)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,r={}){return this.components.connectionManager.isDialable(t,r)}}Sa=new WeakSet,_1=function(t){const{detail:r}=t;if(r.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(r.id,{multiaddrs:r.multiaddrs}).catch(s=>{this.log.error(s)})};async function oT(n={}){n.privateKey??(n.privateKey=await Yw());const e=new iT({...await aE(n),peerId:t_(n.privateKey)});return n.start!==!1&&await e.start(),e}const Ma=1e3,ef=60*Ma,f0=60*ef,aT=36*f0,cT="/ipfs/kad/1.0.0",lT=48*f0,uT=24*f0,hT=10,dT=16384,fT=f0,Zg=20,tf=3,pT=5*ef,gT=Ma,mT=5*Ma,yT=5*ef,xT=30*Ma,vT=180*Ma,m3=`${ld}-kad-dht`;var Fl;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.key!=null&&t.key.byteLength>0&&(r.uint32(10),r.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(r.uint32(18),r.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(r.uint32(42),r.string(t.timeReceived)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={key:lt(0),value:lt(0),timeReceived:""},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(Fl||(Fl={}));function bT(n){const e=n.getUTCFullYear(),t=String(n.getUTCMonth()+1).padStart(2,"0"),r=String(n.getUTCDate()).padStart(2,"0"),s=String(n.getUTCHours()).padStart(2,"0"),i=String(n.getUTCMinutes()).padStart(2,"0"),o=String(n.getUTCSeconds()).padStart(2,"0"),a=n.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${r}T${s}:${i}:${o}.${c}Z`}function wT(n){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(n).trim().match(e);if(t==null)throw new Error("Invalid format");const r=parseInt(t[1],10),s=parseInt(t[2],10)-1,i=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(r,s,i,o,a,c,l))}class _r{constructor(e,t,r){p(this,"key");p(this,"value");p(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=r}serialize(){return Fl.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:bT(this.timeReceived)}}static deserialize(e){const t=Fl.decode(e);return new _r(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=wT(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new _r(e.key,e.value,t)}}function _T(n){return n[Symbol.asyncIterator]!=null}function p0(n,e){let t=0;if(_T(n))return async function*(){for await(const c of n)yield e(c,t++)}();const r=Cg(n),{value:s,done:i}=r.next();if(i===!0)return function*(){}();const o=e(s,t++);if(typeof o.then=="function")return async function*(){yield await o;for await(const c of r)yield e(c,t++)}();const a=e;return function*(){yield o;for(const c of r)yield a(c,t++)}()}function g0(n,...e){if(n==null)throw new Error("Empty pipeline");if(Ru(n)){const r=n;n=()=>r.source}else if(t7(n)||e7(n)){const r=n;n=()=>r}const t=[n,...e];if(t.length>1&&Ru(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let r=1;r<t.length-1;r++)Ru(t[r])&&(t[r]=AT(t[r]));return ET(...t)}const ET=(...n)=>{let e;for(;n.length>0;)e=n.shift()(e);return e},e7=n=>(n==null?void 0:n[Symbol.asyncIterator])!=null,t7=n=>(n==null?void 0:n[Symbol.iterator])!=null,Ru=n=>n==null?!1:n.sink!=null&&n.source!=null,AT=n=>e=>{const t=n.sink(e);if((t==null?void 0:t.then)!=null){const r=$g({objectMode:!0});t.then(()=>{r.end()},o=>{r.end(o)});let s;const i=n.source;if(e7(i))s=async function*(){yield*i,r.end()};else if(t7(i))s=function*(){yield*i,r.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return ia(r,s())}return n.source};class Nl extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class CT extends Error{constructor(e="Query aborted"){super(e),this.name="QueryAbortedError"}}class ST extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class TT extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var y3;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.key!=null&&(r.uint32(10),r.bytes(t.key)),t.value!=null&&(r.uint32(18),r.bytes(t.value)),t.author!=null&&(r.uint32(26),r.bytes(t.author)),t.signature!=null&&(r.uint32(34),r.bytes(t.signature)),t.timeReceived!=null&&(r.uint32(42),r.string(t.timeReceived)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{const i={},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 3:{i.author=t.bytes();break}case 4:{i.signature=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(y3||(y3={}));var je;(function(n){n.PUT_VALUE="PUT_VALUE",n.GET_VALUE="GET_VALUE",n.ADD_PROVIDER="ADD_PROVIDER",n.GET_PROVIDERS="GET_PROVIDERS",n.FIND_NODE="FIND_NODE",n.PING="PING"})(je||(je={}));var Ll;(function(n){n[n.PUT_VALUE=0]="PUT_VALUE",n[n.GET_VALUE=1]="GET_VALUE",n[n.ADD_PROVIDER=2]="ADD_PROVIDER",n[n.GET_PROVIDERS=3]="GET_PROVIDERS",n[n.FIND_NODE=4]="FIND_NODE",n[n.PING=5]="PING"})(Ll||(Ll={}));(function(n){n.codec=()=>r0(Ll)})(je||(je={}));var Bi;(function(n){n.NOT_CONNECTED="NOT_CONNECTED",n.CONNECTED="CONNECTED",n.CAN_CONNECT="CAN_CONNECT",n.CANNOT_CONNECT="CANNOT_CONNECT"})(Bi||(Bi={}));var E1;(function(n){n[n.NOT_CONNECTED=0]="NOT_CONNECTED",n[n.CONNECTED=1]="CONNECTED",n[n.CAN_CONNECT=2]="CAN_CONNECT",n[n.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(E1||(E1={}));(function(n){n.codec=()=>r0(E1)})(Bi||(Bi={}));var ii;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{if(s.lengthDelimited!==!1&&r.fork(),t.id!=null&&t.id.byteLength>0&&(r.uint32(10),r.bytes(t.id)),t.multiaddrs!=null)for(const i of t.multiaddrs)r.uint32(18),r.bytes(i);t.connection!=null&&(r.uint32(24),Bi.codec().encode(t.connection,r)),s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{var a;const i={id:lt(0),multiaddrs:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{i.id=t.bytes();break}case 2:{if(((a=s.limits)==null?void 0:a.multiaddrs)!=null&&i.multiaddrs.length===s.limits.multiaddrs)throw new Ci('Decode error - map field "multiaddrs" had too many elements');i.multiaddrs.push(t.bytes());break}case 3:{i.connection=Bi.codec().decode(t);break}default:{t.skipType(c&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(ii||(ii={}));var Es;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{if(s.lengthDelimited!==!1&&r.fork(),t.type!=null&&Ll[t.type]!==0&&(r.uint32(8),je.codec().encode(t.type,r)),t.clusterLevel!=null&&(r.uint32(80),r.int32(t.clusterLevel)),t.key!=null&&(r.uint32(18),r.bytes(t.key)),t.record!=null&&(r.uint32(26),r.bytes(t.record)),t.closer!=null)for(const i of t.closer)r.uint32(66),ii.codec().encode(i,r);if(t.providers!=null)for(const i of t.providers)r.uint32(74),ii.codec().encode(i,r);s.lengthDelimited!==!1&&r.ldelim()},(t,r,s={})=>{var a,c,l,u;const i={type:je.PUT_VALUE,closer:[],providers:[]},o=r==null?t.len:t.pos+r;for(;t.pos<o;){const d=t.uint32();switch(d>>>3){case 1:{i.type=je.codec().decode(t);break}case 10:{i.clusterLevel=t.int32();break}case 2:{i.key=t.bytes();break}case 3:{i.record=t.bytes();break}case 8:{if(((a=s.limits)==null?void 0:a.closer)!=null&&i.closer.length===s.limits.closer)throw new Ci('Decode error - map field "closer" had too many elements');i.closer.push(ii.codec().decode(t,t.uint32(),{limits:(c=s.limits)==null?void 0:c.closer$}));break}case 9:{if(((l=s.limits)==null?void 0:l.providers)!=null&&i.providers.length===s.limits.providers)throw new Ci('Decode error - map field "providers" had too many elements');i.providers.push(ii.codec().decode(t,t.uint32(),{limits:(u=s.limits)==null?void 0:u.providers$}));break}default:{t.skipType(d&7);break}}}return i})),e),n.encode=t=>Ut(t,n.codec()),n.decode=(t,r)=>Vt(t,n.codec(),r)})(Es||(Es={}));function x3(n,e={}){var r;const t={...n,name:"SEND_QUERY",type:0,messageName:n.type,messageType:n.type};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function A1(n,e={}){var r;const t={...n,name:"PEER_RESPONSE",type:1,messageName:n.messageType,closer:n.closer??[],providers:n.providers??[]};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function Bu(n,e={}){var r;const t={...n,name:"FINAL_PEER",type:2};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function Yn(n,e={}){var r;const t={...n,name:"QUERY_ERROR",type:3};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function v3(n,e={}){var r;const t={...n,name:"PROVIDER",type:4};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:provider",{detail:t})),t}function C1(n,e={}){var r;const t={...n,name:"VALUE",type:5};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:value",{detail:t})),t}function b3(n,e={}){var r;const t={...n,name:"DIAL_PEER",type:7};return(r=e.onProgress)==null||r.call(e,new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function IT(n,e,t){if(t.length===0)throw new pe("No records given");const s=ie(e).split("/");if(s.length<3)throw new pe("Record key does not have a selector function");const i=n[s[1].toString()];if(i==null)throw new TT(`No selector function configured for key type "${s[1]}"`);return t.length===1?0:i(e,t)}function kT(n,e){return 0}const PT={pk:kT};async function rf(n,e){const t=e.key,s=ie(t).split("/");if(s.length<3)return;const i=n[s[1].toString()];if(i==null)throw new pe(`No validator available for key type "${s[1]}"`);await i(t,e.value)}const DT=async(n,e)=>{if(!(n instanceof Uint8Array))throw new pe('"key" must be a Uint8Array');if(n.byteLength<5)throw new pe("Invalid public key record");if(ie(n.subarray(0,4))!=="/pk/")throw new pe("key was not prefixed with /pk/");const r=Ba(e),s=n.slice(4);if(!Ne(s,r.toMultihash().bytes))throw new pe("public key does not match passed in key")},RT={pk:DT},BT=oe("/pk/");function FT(n){return{...n,multiaddrs:n.multiaddrs.filter(e=>{const[[t,r]]=e.stringTuples();if(t===53||t===54||t===55)return r!=="localhost";if(t!==4&&t!==6||r==null)return!1;const s=ji(r);return s==null?!0:!s})}}async function oa(n){return(await Xt.digest(n)).digest}async function Br(n){return oa(n.toMultihash().bytes)}function Fo(n,e){return new _t(`${n}/${ie(e,"base32")}`,!1)}function NT(n){return Er([BT,n.toMultihash().bytes])}function LT(n){return ie(n.subarray(0,4))==="/pk/"}function MT(n){const e=cr(n.subarray(4));return vn(e)}function w3(n,e){const t=new Date;return new _r(n,e,t).serialize()}const OT=290,VT=54,UT=55,$T=56,HT=4,qT=41;function zT(n){const e=n.stringTuples();for(const t of e)if(t[0]===OT)return!1;if(e[0][0]===VT||e[0][0]===UT||e[0][0]===$T)return!0;if(e[0][0]===HT||e[0][0]===qT){const t=ji(`${e[0][1]}`);return t==null||!t}return!1}function r7(n){const e=n.toString().split("/"),t=e.pop(),r=e.pop();if(t==null||r==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${n.toString()}`);return{cid:Ce.createV1(Pv,cr(oe(r,"base32"))),peerId:Is(t)}}function Fu(n,e,t){const r=typeof e=="string"?e:ie(e.multihash.bytes,"base32"),s=[n,r];return t!=null&&s.push(t.toString()),new _t(s.join("/"))}function n7(n){return new Date(ss(n))}function ei(n,e,t){return async function*(...r){var a,c,l,u,d;const s=(a=e.queryTime)==null?void 0:a.timer(t),i=(c=e.errorTime)==null?void 0:c.timer(t);let o=!1;try{(l=e.queries)==null||l.increment({[t]:!0}),yield*n(...r)}catch(f){throw o=!0,i==null||i(),(u=e.errors)==null||u.increment({[t]:!0}),f}finally{(d=e.queries)==null||d.decrement({[t]:!0}),o||s==null||s()}}}function s7(n,e,t){return async function(...r){var a,c,l,u,d;const s=(a=e==null?void 0:e.queryTime)==null?void 0:a.timer(t),i=(c=e==null?void 0:e.errorTime)==null?void 0:c.timer(t);let o=!1;try{return(l=e.queries)==null||l.increment({[t]:!0}),await n(...r)}catch(f){throw o=!0,i==null||i(),(u=e.errors)==null||u.increment({[t]:!0}),f}finally{(d=e.queries)==null||d.decrement({[t]:!0}),o||s==null||s()}}}class KT{constructor(e,t){p(this,"log");p(this,"components");p(this,"validators");p(this,"selectors");p(this,"peerRouting");p(this,"queryManager");p(this,"network");p(this,"datastorePrefix");var l,u;const{validators:r,selectors:s,peerRouting:i,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=r,this.selectors=s,this.peerRouting=i,this.queryManager=o,this.network=a,this.get=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.put=((u=e.metrics)==null?void 0:u.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2}))??this.put}async getLocal(e){this.log("getLocal %b",e);const t=Fo(this.datastorePrefix,e);this.log("fetching record for key %k",t);const r=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const s=_r.deserialize(r);return await rf(this.validators,s),s}async*sendCorrectionRecord(e,t,r,s={}){this.log("sendCorrection for %b",e);const i=w3(e,r);for(const{value:o,from:a}of t){if(Ne(o,r)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const u=Fo(this.datastorePrefix,e);this.log(`Storing corrected record for key ${u.toString()}`),await this.components.datastore.put(u,i.subarray())}catch(u){this.log.error("Failed error correcting self",u)}continue}let c=!1;const l={type:je.PUT_VALUE,key:e,record:i};for await(const u of this.network.sendRequest(a,l,s))u.name==="PEER_RESPONSE"&&u.record!=null&&Ne(u.record.value,_r.deserialize(i).value)&&(c=!0),yield u;c||(yield Yn({from:a,error:new Nl("Value not put correctly")},s)),this.log.error("Failed error correcting entry")}}async*put(e,t,r={}){this.log("put key %b value %b",e,t);const s=w3(e,t),i=Fo(this.datastorePrefix,e);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,s.subarray()),yield*g0(this.peerRouting.getClosestPeers(e,{...r,signal:r.signal}),o=>p0(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:je.PUT_VALUE,key:e,record:s};this.log("send put to %p",a.peer.id);for await(const u of this.network.sendRequest(a.peer.id,l,r))c.push(u),u.name==="PEER_RESPONSE"&&(u.record!=null&&Ne(u.record.value,_r.deserialize(s).value)||c.push(Yn({from:a.peer.id,error:new Nl("Value not put correctly")},r)));return c}),o=>u0(o,{ordered:!1,concurrency:tf}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const r=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&r.push(a),yield a;if(r.length===0)return;const s=r.map(a=>a.value);let i=0;try{i=IT(this.selectors,e,s)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=s[i];if(this.log("GetValue %b %b",e,o),o==null)throw new Wn("Best value was not found");yield*this.sendCorrectionRecord(e,r,o,t),yield r[i]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const i=await this.getLocal(e);yield C1({value:i.value,from:this.components.peerId},t)}catch(i){this.log("error getting local value for %b",e,i)}const r=this,s=async function*({peer:i,signal:o}){for await(const a of r.peerRouting.getValueOrPeers(i,e,{...t,signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield C1({from:i,value:a.record.value},t))};yield*this.queryManager.run(e,s,t)}}function jT(n,e){return{id:n.id.toMultihash().bytes,multiaddrs:(n.multiaddrs??[]).map(r=>r.bytes),connection:e}}function Tc(n){if(n.id==null)throw new Error("Invalid peer in message");const e=cr(n.id);return{id:vn(e),multiaddrs:(n.multiaddrs??[]).map(t=>qe(t))}}class GT{constructor(e,t){p(this,"log");p(this,"components");p(this,"network");p(this,"peerRouting");p(this,"queryManager");p(this,"routingTable");p(this,"providers");var l,u;const{network:r,peerRouting:s,queryManager:i,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=r,this.peerRouting=s,this.queryManager=i,this.routingTable=o,this.providers=a,this.findProviders=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(d,f)=>(d.name==="PROVIDER"&&(f.providers??(f.providers=[]),f.providers.push(...d.providers.map(m=>m.id.toString()))),f)}))??this.findProviders,this.provide=((u=e.metrics)==null?void 0:u.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(d,f)=>(d.name==="PEER_RESPONSE"&&d.messageName==="ADD_PROVIDER"&&(f.providers??(f.providers=[]),f.providers.push(d.from.toString())),f)}))??this.provide}async*provide(e,t,r={}){this.log("provide %s",e);const s=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const i={type:je.ADD_PROVIDER,key:s,providers:[jT({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=c=>async()=>{if(c.name!=="FINAL_PEER")return[c];const l=[];this.log("putProvider %s to %p",e,c.peer.id);try{this.log("sending provider record for %s to %p",e,c.peer.id);for await(const u of this.network.sendMessage(c.peer.id,i,r))u.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,c.peer.id),o++),l.push(u)}catch(u){this.log.error("error sending provide record to peer %p",c.peer.id,u),l.push(Yn({from:c.peer.id,error:u},r))}return l};yield*g0(this.peerRouting.getClosestPeers(s,r),c=>p0(c,l=>a(l)),c=>u0(c,{ordered:!1,concurrency:tf}),async function*(c){for await(const l of c)yield*l}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const r=this.routingTable.kBucketSize;let s=0;const i=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const u=[];for(const d of a.slice(0,r))try{const f=await this.components.peerStore.get(d);u.push({id:d,multiaddrs:f.addresses.map(({multiaddr:m})=>m)})}catch(f){if(f.name!=="NotFoundError")throw f;this.log("no peer store entry for %p",d)}if(yield A1({from:this.components.peerId,messageType:je.GET_PROVIDERS,providers:u},t),yield v3({from:this.components.peerId,providers:u},t),s+=u.length,s>=r)return}const c=async function*({peer:u,signal:d}){const f={type:je.GET_PROVIDERS,key:i};yield*o.network.sendRequest(u,f,{...t,signal:d})},l=new Gr(a);for await(const u of this.queryManager.run(i,c,t))if(yield u,u.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",u.providers.length,e,u.closer.length);const d=[];for(const f of u.providers)l.has(f.id)||(l.add(f.id),d.push(f));if(d.length>0&&(yield v3({from:u.from,providers:d},t),s+=d.length,s>=r))return}}}function _3(n,e){const t=h0(n,e),r={read:async(s,i)=>{const o=await t.read(i);return s.decode(o)},write:async(s,i,o)=>{await t.write(i.encode(s),o)},writeV:async(s,i,o)=>{await t.writeV(s.map(a=>i.encode(a)),o)},pb:s=>({read:async i=>r.read(s,i),write:async(i,o)=>r.write(i,s,o),writeV:async(i,o)=>r.writeV(i,s,o),unwrap:()=>r}),unwrap:()=>t.unwrap()};return r}class WT extends gn{constructor(t,r){var s,i,o,a;super();p(this,"log");p(this,"protocol");p(this,"running");p(this,"components");p(this,"timeout");p(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${r.logPrefix}:network`),this.running=!1,this.protocol=r.protocol,this.timeout=new sa({...r.timeout??{},metrics:t.metrics,metricName:`${r.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:(s=t.metrics)==null?void 0:s.registerCounterGroup(`${r.metricsPrefix}_outbound_rpc_requests_total`),errors:(i=t.metrics)==null?void 0:i.registerCounterGroup(`${r.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=((o=t.metrics)==null?void 0:o.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],u){return{...u,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((u,d)=>{l[`providers-${d}`]=u.id.toString()}),c.closer.length>0&&c.closer.forEach((u,d)=>{l[`closer-${d}`]=u.id.toString()})),l)}))??this.sendRequest,this.sendMessage=((a=t.metrics)==null?void 0:a.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],u){return{...u,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((u,d)=>{l[`providers-${d}`]=u.id.toString()}),c.closer.length>0&&c.closer.forEach((u,d)=>{l[`closer-${d}`]=u.id.toString()})),l)}))??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,r,s={}){var c,l,u;if(!this.running)return;const i=r.type;if(i==null)throw new pe("Message type was missing");this.log("sending %s to %p",r.type,t),yield b3({peer:t},s),yield x3({to:t,type:i},s);let o;const a=this.timeout.getTimeoutSignal(s);s={...s,signal:a};try{(c=this.metrics.operations)==null||c.increment({[i]:!0}),o=await(await this.components.connectionManager.openConnection(t,s)).newStream(this.protocol,s);const f=await this._writeReadMessage(o,r,s);o.close(s).catch(m=>{this.log.error("error closing stream to %p",t,m),o==null||o.abort(m)}),yield A1({from:t,messageType:f.type,closer:f.closer.map(Tc),providers:f.providers.map(Tc),record:f.record==null?void 0:_r.deserialize(f.record)},s)}catch(d){(l=this.metrics.errors)==null||l.increment({[i]:!0}),o==null||o.abort(d),((u=s.signal)==null?void 0:u.aborted)!==!0&&this.log.error("could not send %s to %p - %e",r.type,t,d),yield Yn({from:t,error:d},s)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,r,s={}){var c,l;if(!this.running)return;const i=r.type;if(i==null)throw new pe("Message type was missing");this.log("sending %s to %p",r.type,t),yield b3({peer:t},s),yield x3({to:t,type:i},s);let o;const a=this.timeout.getTimeoutSignal(s);s={...s,signal:a};try{(c=this.metrics.operations)==null||c.increment({[i]:!0}),o=await(await this.components.connectionManager.openConnection(t,s)).newStream(this.protocol,s),await this._writeMessage(o,r,s),o.close(s).catch(d=>{this.log.error("error closing stream to %p",t,d),o==null||o.abort(d)}),yield A1({from:t,messageType:i},s)}catch(u){(l=this.metrics.errors)==null||l.increment({[i]:!0}),o==null||o.abort(u),yield Yn({from:t,error:u},s)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,r,s){await _3(t).write(r,Es,s)}async _writeReadMessage(t,r,s){const i=_3(t);await i.write(r,Es,s);const o=await i.read(Es,s);return o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:Tc(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:Tc(a)})}),o}}function Xn(n,e){if(n.length!==e.length)throw new Error("Inputs should have the same length");const t=Qr(n.length);for(let r=0;r<n.length;r++)t[r]=n[r]^e[r];return t}function aa(n,e){if(n.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return n[t]<e[t]?-1:1;return 0}class nf{constructor(e,t){p(this,"originDhtKey");p(this,"capacity");p(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await Br(e.id);this.addWithKadId(e,t)}addWithKadId(e,t){if(this.peerDistances.find(i=>i.peer.id.equals(e.id))!=null)return;const r={peer:e,distance:Xn(this.originDhtKey,t)};let s=!1;for(let i=0;i<this.peerDistances.length;i++){const o=aa(this.peerDistances[i].distance,r.distance);if(o===0||o===1){s=!0,this.peerDistances.splice(i,0,r);break}}s||this.peerDistances.push(r),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await Br(e),r=Xn(t,this.originDhtKey),s=this.peerDistances[this.peerDistances.length-1].distance;return aa(r,s)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class QT{constructor(e,t){p(this,"log");p(this,"routingTable");p(this,"network");p(this,"validators");p(this,"queryManager");p(this,"peerStore");p(this,"peerId");var r,s;this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=((r=e.metrics)==null?void 0:r.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async findPeerLocal(e){let t;const r=await this.routingTable.find(e);if(r!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(r)}catch(s){if(s.name!=="NotFoundError")throw s}}if(t==null)try{t=await this.peerStore.get(e)}catch(s){if(s.name!=="NotFoundError")throw s}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(s=>s.multiaddr)}}async*_getValueSingle(e,t,r={}){const s={type:je.GET_VALUE,key:t};yield*this.network.sendRequest(e,s,r)}async*getPublicKeyFromNode(e,t={}){const r=NT(e);for await(const s of this._getValueSingle(e,r,t))if(yield s,s.name==="PEER_RESPONSE"&&s.record!=null){const i=Ba(s.record.value),o=Ld(i);if(!o.equals(e))throw new Yo("public key does not match id");if(o.publicKey==null)throw new Yo("public key missing");yield C1({from:e,value:s.record.value},t)}throw new Nl(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const s=await this.findPeerLocal(e);if(s!=null){this.log("found local"),yield Bu({from:this.peerId,peer:s},t);return}}let r=!1;if(t.useNetwork!==!1){const s=this,i=async function*({peer:o,signal:a}){const c={type:je.FIND_NODE,key:e.toMultihash().bytes};for await(const l of s.network.sendRequest(o,c,{...t,signal:a}))if(yield l,l.name==="PEER_RESPONSE"){const u=l.closer.find(d=>d.id.equals(e));u!=null&&(yield Bu({from:l.from,peer:u},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,i,t))o.name==="FINAL_PEER"&&(r=!0),yield o}r||(yield Yn({from:this.peerId,error:new Wn("Not found")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const r=await oa(e),s=this.routingTable.closestPeers(r),i=this,o=new nf(r,this.routingTable.kBucketSize);await Promise.all(s.map(async c=>{await o.add({id:c,multiaddrs:[]})}));const a=async function*({peer:c,signal:l}){i.log("closerPeersSingle %s from %p",ie(e,"base32"),c);const u={type:je.FIND_NODE,key:e};yield*i.network.sendRequest(c,u,{...t,signal:l})};for await(const c of this.queryManager.run(e,a,t))c.name==="PEER_RESPONSE"&&await Promise.all(c.closer.map(async l=>{await o.add(l)})),yield c;this.log("found %d peers close to %b",o.length,e);for(const c of o.peers)yield Bu({from:this.peerId,peer:c},t)}async*getValueOrPeers(e,t,r={}){for await(const s of this._getValueSingle(e,t,r)){if(s.name==="PEER_RESPONSE"&&s.record!=null)try{await this._verifyRecordOnline(s.record)}catch{const o="invalid record received, discarded";this.log(o),yield Yn({from:s.from,error:new Nl(o)},r);continue}yield s}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new ST("invalid record received");await rf(this.validators,new _r(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const r=[];try{const c=cr(e),l=vn(c),u=await this.peerStore.get(l);r.push({id:u.id,multiaddrs:u.addresses.map(({multiaddr:d})=>d)})}catch{}const s=await oa(e),i=this.routingTable.closestPeers(s),o=await Br(t),a=Xn(o,s);for(const c of i){const l=await Br(c),u=Xn(l,s);if(aa(u,a)===-1)try{const d=await this.peerStore.get(c);r.push({id:c,multiaddrs:d.addresses.map(({multiaddr:f})=>f)})}catch(d){if(d.name!=="NotFoundError")throw d}}return r.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",r.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),r}}class YT{constructor(e,t){p(this,"log");p(this,"datastore");p(this,"datastorePrefix");p(this,"lock");this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore,this.lock=t.lock}async addProvider(e,t){const r=await this.lock.readLock();try{this.log("%p provides %s",t,e),await this.writeProviderEntry(e,t)}finally{r()}}async removeProvider(e,t){const r=await this.lock.writeLock();try{const s=Fu(this.datastorePrefix,e,t);this.log("%p no longer provides %s",t,e),await this.datastore.delete(s)}finally{r()}}async getProviders(e){const t=await this.lock.readLock();try{this.log("get providers for %c",e);const r=await this.loadProviders(e);return this.log("got %d providers for %c",r.size,e),[...r.keys()]}finally{t()}}async writeProviderEntry(e,t,r=new Date){const s=Fu(this.datastorePrefix,e,t),i=Pr(r.getTime());await this.datastore.put(s,i)}async loadProviders(e){const t=new Fa,r=Fu(this.datastorePrefix,e);for await(const s of this.datastore.query({prefix:r.toString()})){const{peerId:i}=r7(s.key);t.set(i,n7(s.value))}return t}}async function*XT(n){const{key:e,startingPeer:t,ourPeerId:r,signal:s,query:i,alpha:o,pathIndex:a,numPaths:c,queryFuncTimeout:l,log:u,peersSeen:d,connectionManager:f}=n,m=new l0({concurrency:o,sort:(x,D)=>aa(x.options.distance,D.options.distance)}),y=await oa(e);function b(x,D){if(x==null)return;d.add(x);const S=Xn(D,y);m.add(async()=>{const _=[s];l!=null&&_.push(AbortSignal.timeout(l));const E=Yr(_);try{for await(const B of i({...n,key:e,peer:x,signal:E,pathIndex:a,numPaths:c})){if(E.aborted)return;if(B.name==="PEER_RESPONSE")for(const F of B.closer){if(d.has(F.id)){u.trace("already seen %p in query",F.id);continue}if(r.equals(F.id)){u("not querying ourselves");continue}if(!await f.isDialable(F.multiaddrs)){u("not querying undialable peer");continue}const A=await Br(F.id),w=Xn(A,y);if(aa(w,S)!==-1){u.trace("skipping %p as they are not closer to %b than %p",F.id,e,x);continue}u.trace("querying closer peer %p",F.id),b(F.id,A)}m.safeDispatchEvent("completed",{detail:B})}}catch(B){if(!s.aborted)return Yn({from:x,error:B},n)}finally{E.clear()}},{distance:S}).catch(_=>{u.error(_)})}b(t,await Br(t));try{for await(const x of m.toGenerator({signal:s}))x!=null&&(yield x)}catch(x){throw s.aborted?new CT("Query aborted"):x}}class JT{constructor(e,t){p(this,"disjointPaths");p(this,"alpha");p(this,"shutDownController");p(this,"running");p(this,"logger");p(this,"peerId");p(this,"connectionManager");p(this,"routingTable");p(this,"initialQuerySelfHasRun");p(this,"logPrefix");this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??Zg,this.alpha=t.alpha??tf,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,r={}){if(!this.running)throw new Error("QueryManager not started");if(r.signal==null){const c=AbortSignal.timeout(vT);r={...r,signal:c}}const s=new AbortController,i=Yr([this.shutDownController.signal,s.signal,r.signal]);s.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+ie(e,"base58btc"));let a=!1;try{r.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial query-self query before continuing"),await Ds(this.initialQuerySelfHasRun.promise,i),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await oa(e),l=this.routingTable.closestPeers(c),u=l.slice(0,Math.min(this.disjointPaths,l.length));if(l.length===0){o.error("Running query with no peers");return}const d=new Gr,f=u.map((m,y)=>XT({...r,key:e,startingPeer:m,ourPeerId:this.peerId,signal:i,query:t,pathIndex:y,numPaths:u.length,alpha:this.alpha,queryFuncTimeout:r.queryFuncTimeout,log:o,peersSeen:d,onProgress:r.onProgress,connectionManager:this.connectionManager}));for await(const m of ia(...f)){if(m.name==="QUERY_ERROR"&&o.error("query error",m.error),m.name==="PEER_RESPONSE")for(const y of[...m.closer,...m.providers])await this.connectionManager.isDialable(y.multiaddrs)&&await this.routingTable.add(y.id);yield m}a=!0}catch(c){if(!(!this.running&&c.name==="QueryAbortedError"))throw c}finally{a||(o("query exited early"),s.abort()),i.clear(),o("query:done")}}}function ZT(n){return n[Symbol.asyncIterator]!=null}function i7(n){if(ZT(n))return(async()=>{let e=0;for await(const t of n)e++;return e})();{let e=0;for(const t of n)e++;return e}}const eI=n=>{const e=n.addEventListener||n.on||n.addListener,t=n.removeEventListener||n.off||n.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(n),removeListener:t.bind(n)}};function tI(n,e,t){let r;const s=new Promise((i,o)=>{var m;if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");(m=t.signal)==null||m.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:u}=eI(n),d=(...y)=>{const b=t.multiArgs?y:y[0];t.filter&&!t.filter(b)||(c.push(b),t.count===c.length&&(r(),i(c)))},f=y=>{r(),o(y)};r=()=>{for(const y of a)u(y,d);for(const y of t.rejectionEvents)u(y,f)};for(const y of a)l(y,d);for(const y of t.rejectionEvents)l(y,f);t.signal&&t.signal.addEventListener("abort",()=>{f(t.signal.reason)},{once:!0}),t.resolveImmediately&&i(c)});if(s.cancel=r,typeof t.timeout=="number"){const i=Od(s,{milliseconds:t.timeout});return i.cancel=r,i}return s}function rI(n,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const r=tI(n,e,t),s=r.then(i=>i[0]);return s.cancel=r.cancel,s}class nI{constructor(e,t){p(this,"log");p(this,"peerId");p(this,"peerRouting");p(this,"routingTable");p(this,"count");p(this,"interval");p(this,"initialInterval");p(this,"queryTimeout");p(this,"running");p(this,"timeoutId");p(this,"controller");p(this,"initialQuerySelfHasRun");p(this,"querySelfPromise");this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.running=!1,this.peerRouting=t.peerRouting,this.routingTable=t.routingTable,this.count=t.count??Zg,this.interval=t.interval??pT,this.initialInterval=t.initialInterval??gT,this.queryTimeout=t.queryTimeout??mT,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=s7(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=St(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const r=AbortSignal.timeout(this.queryTimeout);e.push(r)}const t=Yr(e);this.controller.signal;try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await rI(this.routingTable,"peer:add",{signal:t,filter:i=>!this.peerId.equals(i.detail)}),this.log("routing table has peers, continuing with query")),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const r=Date.now(),s=await g0(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),i=>p1(i,this.count),async i=>i7(i));this.log("self-query found %d peers in %dms",s,Date.now()-r)}catch(r){this.log.error("self-query error",r)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class sI extends gn{constructor(t,r){super();p(this,"log");p(this,"reprovideQueue");p(this,"maxQueueSize");p(this,"datastore");p(this,"timeout");p(this,"reprovideTimeout");p(this,"running");p(this,"shutdownController");p(this,"reprovideThreshold");p(this,"contentRouting");p(this,"datastorePrefix");p(this,"addressManager");p(this,"validity");p(this,"interval");p(this,"lock");p(this,"peerId");this.log=t.logger.forComponent(`${r.logPrefix}:reprovider`),this.peerId=t.peerId,this.reprovideQueue=new l0({concurrency:r.concurrency??hT,metrics:t.metrics,metricName:`${r.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new sa({...r.timeout??{},metrics:t.metrics,metricName:`${r.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=t.datastore,this.addressManager=t.addressManager,this.datastorePrefix=`${r.datastorePrefix}/provider`,this.reprovideThreshold=r.threshold??uT,this.maxQueueSize=r.maxQueueSize??dT,this.validity=r.validity??lT,this.interval=r.interval??fT,this.contentRouting=r.contentRouting,this.lock=r.lock,this.running=!1,this.reprovide=s7(this.reprovide.bind(this),r.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp().catch(t=>{this.log.error("error running reprovide/cleanup - %e",t)})},this.interval))}stop(){var t;this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),(t=this.shutdownController)==null||t.abort()}async cleanUp(){const t=await this.lock.writeLock();try{this.safeDispatchEvent("reprovide:start");for await(const r of this.datastore.query({prefix:this.datastorePrefix}))try{const{cid:s,peerId:i}=r7(r.key),o=n7(r.value).getTime(),a=o+this.validity,c=Date.now(),l=c>a;this.log.trace("comparing: %d < %d = %s %s",o,c-this.validity,l,l?"(expired)":""),l&&await this.datastore.delete(r.key),this.peerId.equals(i)&&c-a<this.reprovideThreshold&&this.queueReprovide(s).catch(u=>{this.log.error("could not reprovide %c - %e",s,u)})}catch(s){this.log.error("error processing datastore key %s - %e",r.key,s.message)}this.log("reprovide/cleanup successful")}finally{t(),this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp().catch(r=>{this.log.error("error running re-provide - %e",r)})},this.interval))}}async queueReprovide(t){var s;if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",t),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize);const r=this.reprovideQueue.queue.find(i=>i.options.cid.equals(t));if(r!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",t),r.join();this.log.trace("adding %c to re-provide queue",t),this.reprovideQueue.add(async i=>{var a;if((a=i.signal)==null||a.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",t);const o=this.reprovideTimeout.getTimeoutSignal(i);try{await this.reprovide(i.cid,i)}finally{this.reprovideTimeout.cleanUp(o)}this.log.trace("re-provided %c",t)},{signal:(s=this.shutdownController)==null?void 0:s.signal,cid:t}).catch(i=>{this.log.error("could not re-provide key %c - %e",t,i)})}async reprovide(t,r){await ra(this.contentRouting.provide(t,this.addressManager.getAddresses(),r))}}const iI=20,oI=5e3,aI="kad-close",cI=50;class lI{constructor(e,t){p(this,"routingTable");p(this,"components");p(this,"closestPeers");p(this,"newPeers");p(this,"refreshInterval");p(this,"peerSetSize");p(this,"timeout");p(this,"closeTagName");p(this,"closeTagValue");p(this,"log");p(this,"running");this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??oI,this.peerSetSize=t.peerSetSize??iI,this.closeTagName=t.closeTagName??aI,this.closeTagValue=t.closeTagValue??cI,this.closestPeers=new Gr,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await Br(this.components.peerId);this.newPeers=new nf(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){var t;(t=this.newPeers)==null||t.add({id:e.detail,multiaddrs:[]}).catch(r=>{this.log.error("error adding peer to distance list - %e",r)})}async updatePeerTags(){var s;const e=new Gr((s=this.newPeers)==null?void 0:s.peers.map(i=>i.id)),t=e.difference(this.closestPeers),r=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async i=>{await this.components.peerStore.merge(i,{tags:{[this.closeTagName]:{value:this.closeTagValue},[m3]:{value:1}}})}),...[...r].map(async i=>{await this.components.peerStore.merge(i,{tags:{[this.closeTagName]:void 0,[m3]:void 0}})})])}}function Zc(n){return Array.isArray(n==null?void 0:n.peers)}class uI{constructor(e){p(this,"root");p(this,"localPeer");p(this,"prefixLength");p(this,"splitThreshold");p(this,"kBucketSize");p(this,"numberOfNodesToPing");p(this,"lastPingThreshold");p(this,"ping");p(this,"verify");p(this,"onAdd");p(this,"onRemove");p(this,"onMove");p(this,"addingPeerMap");this.prefixLength=e.prefixLength??fI,this.kBucketSize=e.kBucketSize??o7,this.splitThreshold=e.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=e.numberOfOldContactsToPing??mI,this.lastPingThreshold=e.lastPingThreshold??bI,this.ping=e.ping,this.verify=e.verify,this.onAdd=e.onAdd,this.onRemove=e.onRemove,this.addingPeerMap=new Fa,this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e){this.localPeer={peerId:e,kadId:await Br(e),lastPing:Date.now()}}async add(e,t){const r={peerId:e,kadId:await Br(e),lastPing:0},s=this.addingPeerMap.get(e);if(s!=null)return s;try{const i=this._add(r,t);this.addingPeerMap.set(e,i),await i}finally{this.addingPeerMap.delete(e)}}async _add(e,t){var o;const r=this._determineBucket(e.kadId);if(this._indexOf(r,e.kadId)>-1)return;if(r.peers.length===this.splitThreshold&&r.depth<this.prefixLength){await this._split(r),await this._add(e,t);return}if(r.peers.length<this.kBucketSize){if(!dI(e,this.lastPingThreshold)){r.peers.push(e),await((o=this.onAdd)==null?void 0:o.call(this,e,r));return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const s=r.peers.filter(a=>{var c;return!(a.peerId.equals((c=this.localPeer)==null?void 0:c.peerId)||a.lastPing>Date.now()-this.lastPingThreshold)}).sort((a,c)=>a.lastPing<c.lastPing?-1:a.lastPing>c.lastPing?1:0).slice(0,this.numberOfNodesToPing);let i=!1;for await(const a of this.ping(s,t))i=!0,await this.remove(a.kadId);i&&await this._add(e,t)}*closest(e,t=this.kBucketSize){const r=new nf(e,t);for(const s of this.toIterable())r.addWithKadId({id:s.peerId,multiaddrs:[]},s.kadId);yield*p0(r.peers,s=>s.id)}count(){function e(t){if(Zc(t))return t.peers.length;let r=0;return t.left!=null&&(r+=e(t.left)),t.right!=null&&(r+=e(t.right)),r}return e(this.root)}get(e){const t=this._determineBucket(e),r=this._indexOf(t,e);return t.peers[r]}async remove(e){var s;const t=this._determineBucket(e),r=this._indexOf(t,e);if(r>-1){const i=t.peers.splice(r,1)[0];await((s=this.onRemove)==null?void 0:s.call(this,i,t))}}*toIterable(){function*e(t){if(Zc(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+ie(Xn(e,t),"base16"))}_determineBucket(e){const t=ie(e,"base2");function r(s,i=0){return Zc(s)?s:t[i]==="0"?r(s.left,i+1):r(s.right,i+1)}return r(this.root)}_indexOf(e,t){return e.peers.findIndex(r=>Ne(r.kadId,t))}async _split(e){var s,i;const t={prefix:"0",depth:e.depth+1,peers:[]},r={prefix:"1",depth:e.depth+1,peers:[]};for(const o of e.peers)ie(o.kadId,"base2")[e.depth]==="0"?(t.peers.push(o),await((s=this.onMove)==null?void 0:s.call(this,o,e,t))):(r.peers.push(o),await((i=this.onMove)==null?void 0:i.call(this,o,e,r)));hI(e,t,r)}}function hI(n,e,t){return delete n.peers,n.left=e,n.right=t,n.prefix===""&&(delete n.depth,delete n.prefix),!0}function dI(n,e){return n.lastPing<Date.now()-e}const o7=20,fI=6,pI=20,gI=100,mI=3,yI=20,xI=100,E3="kad-peer",vI=1,bI=6e5,wI=!0,_I=1e3;class EI extends gn{constructor(t,r){super();p(this,"kBucketSize");p(this,"kb");p(this,"network");p(this,"closestPeerTagger");p(this,"log");p(this,"components");p(this,"running");p(this,"pingNewContactTimeout");p(this,"pingNewContactQueue");p(this,"pingOldContactTimeout");p(this,"pingOldContactQueue");p(this,"populateFromDatastoreOnStart");p(this,"populateFromDatastoreLimit");p(this,"protocol");p(this,"peerTagName");p(this,"peerTagValue");p(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${r.logPrefix}:routing-table`),this.kBucketSize=r.kBucketSize??o7,this.running=!1,this.protocol=r.protocol,this.network=r.network,this.peerTagName=r.peerTagName??E3,this.peerTagValue=r.peerTagValue??vI,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=r.populateFromDatastoreOnStart??wI,this.populateFromDatastoreLimit=r.populateFromDatastoreLimit??_I,this.pingOldContactQueue=new b1({concurrency:r.pingOldContactConcurrency??yI,metricName:`${r.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:r.pingOldContactMaxQueueSize??xI}),this.pingOldContactTimeout=new sa({...r.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${r.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new b1({concurrency:r.pingNewContactConcurrency??pI,metricName:`${r.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:r.pingNewContactMaxQueueSize??gI}),this.pingNewContactTimeout=new sa({...r.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${r.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new uI({kBucketSize:r.kBucketSize,prefixLength:r.prefixLength,splitThreshold:r.splitThreshold,numberOfOldContactsToPing:r.numberOfOldContactsToPing,lastPingThreshold:r.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved}),this.closestPeerTagger=new lI(this.components,{logPrefix:r.logPrefix,routingTable:this,peerSetSize:r.closestPeerSetSize,refreshInterval:r.closestPeerSetRefreshInterval,closeTagName:r.closeTagName,closeTagValue:r.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${r.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${r.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,await hl(this.closestPeerTagger),await this.kb.addSelfPeer(this.components.peerId))}async afterStart(){Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;let t=0;for(const r of await this.components.peerStore.all({filters:[s=>s.protocols.includes(this.protocol)&&s.tags.has(E3)],limit:this.populateFromDatastoreLimit})){if(!this.running)return;try{await this.add(r.id),t++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(r.id,{tags:{[this.peerTagName]:void 0}})}}this.log("added %d peer store peers to the routing table",t)}).catch(t=>{this.log.error("error adding peer store peers to the routing table %e",t)})}async stop(){this.running=!1,await gd(this.closestPeerTagger),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort()}async peerAdded(t,r){var s;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}}),this.updateMetrics(),(s=this.metrics)==null||s.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:t.peerId})}async peerRemoved(t,r){var s;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:void 0}}),this.updateMetrics(),(s=this.metrics)==null||s.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:t.peerId})}async*pingOldContacts(t,r){var i;if(!this.running)return;const s=[];for(const o of t){if(this.kb.get(o.kadId)==null){this.log("asked to ping contact %p that was not in routing table",o.peerId);continue}(i=this.metrics)==null||i.kadBucketEvents.increment({ping_old_contact:!0}),s.push(async()=>{const a=this.pingOldContactQueue.find(o.peerId);if(a!=null)return this.log("asked to ping contact %p was already being pinged",o.peerId),await a.join(r)?void 0:o;if(!await this.pingOldContactQueue.add(async l=>{var f;const u=this.pingOldContactTimeout.getTimeoutSignal(),d=Yr([u,l==null?void 0:l.signal]);try{return await this.pingContact(o,l)}catch{return(f=this.metrics)==null||f.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(u),d.clear()}},{peerId:o.peerId,signal:r==null?void 0:r.signal}))return o})}for await(const o of u0(s))o!=null&&(yield o)}async verifyNewContact(t,r){var o;const s=this.pingNewContactTimeout.getTimeoutSignal(),i=Yr([s,r==null?void 0:r.signal]);try{const a=this.pingNewContactQueue.find(t.peerId);return a!=null?(this.log("joining existing ping to add new peer %p to routing table",t.peerId),await a.join({signal:i})):await this.pingNewContactQueue.add(async c=>{var l;return(l=this.metrics)==null||l.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",t.peerId),this.pingContact(t,c)},{peerId:t.peerId,signal:i})}catch{return this.log.trace("tried to add peer %p but they were not online",t.peerId),(o=this.metrics)==null||o.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(s),i.clear()}}async pingContact(t,r){try{return this.log("pinging contact %p",t.peerId),await this.components.ping.ping(t.peerId,r),this.log("contact %p ping ok",t.peerId),this.safeDispatchEvent("peer:ping",{detail:t.peerId}),!0}catch(s){return this.log("error pinging old contact %p - %e",t.peerId,s),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(t){var s;const r=await Br(t);return(s=this.kb.get(r))==null?void 0:s.peerId}closestPeer(t){const r=this.closestPeers(t,1);if(r.length>0)return r[0]}closestPeers(t,r=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(t,r)]}async add(t,r){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(t,r)}async remove(t){if(this.kb==null)throw new Error("RoutingTable is not started");const r=await Br(t);await this.kb.remove(r)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,r=0,s=0,i=20,o=0;function a(c){if(Zc(c)){c.depth>s&&(s=c.depth),r++,t+=c.peers.length,c.peers.length<i&&(i=c.peers.length),c.peers.length>o&&(o=c.peers.length);return}a(c.left),a(c.right)}a(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(r),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/r)),this.metrics.routingTableKadBucketMinOccupancy.update(i),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(s)}}const AI=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],Ic=15;class CI{constructor(e,t){p(this,"log");p(this,"peerRouting");p(this,"routingTable");p(this,"refreshInterval");p(this,"refreshQueryTimeout");p(this,"commonPrefixLengthRefreshedAt");p(this,"refreshTimeoutId");const{peerRouting:r,routingTable:s,refreshInterval:i,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=r,this.routingTable=s,this.refreshInterval=i??yT,this.refreshQueryTimeout=o??xT,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),r=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${r.map(s=>s.toISOString()).join(", ")} ]`),Promise.all(r.map(async(s,i)=>{try{if(await this._refreshCommonPrefixLength(i,s,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(i+1),r.length-1);for(let a=i+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,s,e)}catch(c){this.log.error(c)}}}catch(o){this.log.error(o)}})).catch(s=>{this.log.error(s)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(s=>{this.log.error(s)})}async _refreshCommonPrefixLength(e,t,r){if(!r&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const s=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,s,this.routingTable.size);const i=AbortSignal.timeout(this.refreshQueryTimeout),o=await i7(this.peerRouting.getClosestPeers(s.toMultihash().bytes,{signal:i}));this.log(`found ${o} peers that were close to imaginary peer %p`,s),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,s,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>Ic&&(e=Ic);const t=[];for(let r=0;r<=e;r++)t[r]=this.commonPrefixLengthRefreshedAt[r]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=Bd(2),r=(t[1]<<8)+t[0],s=await this._makePeerId(this.routingTable.kb.localPeer.kadId,r,e),i=cr(s);return vn(i)}async _makePeerId(e,t,r){if(r>Ic)throw new Error(`Cannot generate peer ID for common prefix length greater than ${Ic}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>r,a=65535<<16-(r+1),c=o&a|t&~a,l=AI[c],u=new ArrayBuffer(34),d=new DataView(u,0,u.byteLength);return d.setUint8(0,Xt.code),d.setUint8(1,32),d.setUint32(2,l,!1),new Uint8Array(d.buffer,d.byteOffset,d.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const r of this._prefixLengths())r===e&&t++;return t}*_prefixLengths(){var e;if(((e=this.routingTable.kb)==null?void 0:e.localPeer)!=null)for(const{kadId:t}of this.routingTable.kb.toIterable()){const r=Xn(this.routingTable.kb.localPeer.kadId,t);let s=0;for(const i of r)if(i===0)s++;else break;yield s}}}class SI{constructor(e,t){p(this,"peerId");p(this,"providers");p(this,"peerStore");p(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new pn("Missing key");let r;try{r=Ce.decode(t.key)}catch{throw new pn("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,r),await Promise.all(t.providers.map(async s=>{const i=cr(s.id),o=vn(i),a=s.multiaddrs.map(c=>qe(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",s.id,e);return}if(s.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,r,a),await this.providers.addProvider(r,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class TI{constructor(e,t){p(this,"peerRouting");p(this,"peerInfoMapper");p(this,"peerId");p(this,"addressManager");p(this,"log");const{peerRouting:r,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=r,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new pn("Invalid FIND_NODE message received - key was missing");const r=await this.peerRouting.getCloserPeersOffline(t.key,e);Ne(this.peerId.toMultihash().bytes,t.key)&&r.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(i=>i.decapsulateCode(Ve("p2p").code))});const s={type:je.FIND_NODE,clusterLevel:t.clusterLevel,closer:r.map(this.peerInfoMapper).filter(({multiaddrs:i})=>i.length).map(i=>({id:i.id.toMultihash().bytes,multiaddrs:i.multiaddrs.map(o=>o.bytes)})),providers:[]};return s.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),s}}class II{constructor(e,t){p(this,"peerId");p(this,"peerRouting");p(this,"providers");p(this,"peerStore");p(this,"peerInfoMapper");p(this,"log");const{peerRouting:r,providers:s,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=r,this.providers=s,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new pn("Invalid GET_PROVIDERS message received - key was missing");let r;try{r=Ce.decode(t.key)}catch{throw new pn("Invalid CID")}this.log("%p asking for providers for %s",e,r);const[s,i]=await Promise.all([Tl(p0(await this.providers.getProviders(r),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:u})=>u)}})),this.peerRouting.getCloserPeersOffline(t.key,this.peerId)]),o={type:je.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class kI{constructor(e,t){p(this,"peerStore");p(this,"datastore");p(this,"peerRouting");p(this,"log");p(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const r=t.key;if(this.log("%p asked for key %b",e,r),r==null||r.length===0)throw new pn("Invalid key");const s={type:je.GET_VALUE,key:r,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(LT(r)){this.log("is public key");const a=MT(r);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new Wn("No public key found in key book");c=Hn(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),s.record=new _r(r,c,new Date).serialize(),s}const[i,o]=await Promise.all([this._checkLocalDatastore(r),this.peerRouting.getCloserPeersOffline(r,e)]);return i!=null&&(this.log("had record for %b in local datastore",r),s.record=i.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),s.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),s}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=Fo(this.datastorePrefix,e);let r;try{r=await this.datastore.get(t)}catch(i){if(i.name==="NotFoundError")return;throw i}const s=_r.deserialize(r);if(s.timeReceived==null||Date.now()-s.timeReceived.getTime()>aT){await this.datastore.delete(t);return}return s}}class PI{constructor(e,t){p(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class DI{constructor(e,t){p(this,"components");p(this,"validators");p(this,"log");p(this,"datastorePrefix");const{validators:r}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=r}async handle(e,t){const r=t.key;if(this.log("%p asked us to store value for key %b",e,r),t.record==null){const s=`Empty record from: ${e.toString()}`;throw this.log.error(s),new pn(s)}try{const s=_r.deserialize(t.record);await rf(this.validators,s),s.timeReceived=new Date;const i=Fo(this.datastorePrefix,s.key);await this.components.datastore.put(i,s.serialize().subarray()),this.log("put record for %b into datastore under key %k",r,i)}catch(s){this.log("did not put record for key %b into datastore %o",r,s)}return t}}class RI{constructor(e,t){p(this,"handlers");p(this,"routingTable");p(this,"log");p(this,"metrics");var r,s;this.metrics={operations:(r=e.metrics)==null?void 0:r.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:(s=e.metrics)==null?void 0:s.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`)},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.routingTable=t.routingTable,this.handlers={[je.GET_VALUE.toString()]:new kI(e,t),[je.PUT_VALUE.toString()]:new DI(e,t),[je.FIND_NODE.toString()]:new TI(e,t),[je.ADD_PROVIDER.toString()]:new SI(e,t),[je.GET_PROVIDERS.toString()]:new II(e,t),[je.PING.toString()]:new PI(e,t)}}async handleMessage(e,t){var s,i;const r=this.handlers[t.type];if(r==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return(s=this.metrics.operations)==null||s.increment({[t.type]:!0}),await r.handle(e,t)}catch{(i=this.metrics.errors)==null||i.increment({[t.type]:!0})}}onIncomingStream(e){let t="unknown";Promise.resolve().then(async()=>{const{stream:r,connection:s}=e,i=s.remotePeer,o=this;await g0(r,a=>w1(a),async function*(a){for await(const c of a){const l=Es.decode(c);t=l.type,o.log("incoming %s from %p",l.type,i);const u=await o.handleMessage(i,l);u!=null&&(yield Es.encode(u))}},a=>Jd(a),r)}).catch(r=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,r)})}}class BI extends gn{constructor(t,r){super();p(this,"log");p(this,"components");p(this,"protocol");p(this,"running");p(this,"registrarId");const{protocol:s,logPrefix:i}=r;this.components=t,this.log=t.logger.forComponent(`${i}:topology-listener`),this.running=!1,this.protocol=s}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class FI{constructor(e){p(this,"dht");this.dht=e}async provide(e,t={}){await ra(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const r of this.dht.findProviders(e,t))r.name==="PROVIDER"&&(yield*r.providers)}async put(e,t,r){await ra(this.dht.put(e,t,r))}async get(e,t){for await(const r of this.dht.get(e,t))if(r.name==="VALUE")return r.value;throw new Wn("Could not find value for key")}}class NI{constructor(e){p(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const r of this.dht.findPeer(e,t))if(r.name==="FINAL_PEER")return r.peer;throw new Wn("Peer not found")}async*getClosestPeers(e,t={}){for await(const r of this.dht.getClosestPeers(e,t))r.name==="FINAL_PEER"&&(yield r.peer)}}const LI=32,MI=64;var q6,z6,K6;class OI extends gn{constructor(t,r={}){var u,d,f,m;super();p(this,"protocol");p(this,"routingTable");p(this,"providers");p(this,"network");p(this,"peerRouting");p(this,"components");p(this,"log");p(this,"running");p(this,"kBucketSize");p(this,"clientMode");p(this,"validators");p(this,"selectors");p(this,"queryManager");p(this,"contentFetching");p(this,"contentRouting");p(this,"routingTableRefresh");p(this,"rpc");p(this,"topologyListener");p(this,"querySelf");p(this,"maxInboundStreams");p(this,"maxOutboundStreams");p(this,"dhtContentRouting");p(this,"dhtPeerRouting");p(this,"peerInfoMapper");p(this,"reprovider");p(this,K6,"@libp2p/kad-dht");p(this,z6,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"]);p(this,q6,["@libp2p/identify","@libp2p/ping"]);const s=r.logPrefix??"libp2p:kad-dht",i=r.datastorePrefix??"/dht",o=r.metricsPrefix??"libp2p_kad_dht",a={queries:(u=t.metrics)==null?void 0:u.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:(d=t.metrics)==null?void 0:d.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:(f=t.metrics)==null?void 0:f.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:(m=t.metrics)==null?void 0:m.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=t,this.log=t.logger.forComponent(s),this.protocol=r.protocol??cT,this.kBucketSize=r.kBucketSize??20,this.clientMode=r.clientMode??!0,this.maxInboundStreams=r.maxInboundStreams??LI,this.maxOutboundStreams=r.maxOutboundStreams??MI,this.peerInfoMapper=r.peerInfoMapper??FT;const c=xg();this.providers=new YT(t,{...r.providers,logPrefix:s,datastorePrefix:i,lock:c}),this.validators={...RT,...r.validators},this.selectors={...PT,...r.selectors},this.network=new WT(t,{protocol:this.protocol,logPrefix:s,metricsPrefix:o}),this.routingTable=new EI(t,{kBucketSize:r.kBucketSize,pingOldContactTimeout:r.pingOldContactTimeout,pingOldContactConcurrency:r.pingOldContactConcurrency,pingOldContactMaxQueueSize:r.pingOldContactMaxQueueSize,pingNewContactTimeout:r.pingNewContactTimeout,pingNewContactConcurrency:r.pingNewContactConcurrency,pingNewContactMaxQueueSize:r.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:s,metricsPrefix:o,prefixLength:r.prefixLength,splitThreshold:r.kBucketSplitThreshold,network:this.network});const l=St();r.allowQueryWithZeroPeers===!0&&l.resolve(),this.queryManager=new JT(t,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:s,metricsPrefix:o,initialQuerySelfHasRun:l,routingTable:this.routingTable}),this.peerRouting=new QT(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:s}),this.contentFetching=new KT(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:s,datastorePrefix:i}),this.contentRouting=new GT(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:s}),this.routingTableRefresh=new CI(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:s}),this.rpc=new RI(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:s,metricsPrefix:o,datastorePrefix:i,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new BI(t,{protocol:this.protocol,logPrefix:s}),this.querySelf=new nI(t,{peerRouting:this.peerRouting,interval:r.querySelfInterval,initialInterval:r.initialQuerySelfInterval,logPrefix:s,initialQuerySelfHasRun:l,routingTable:this.routingTable,operationMetrics:a}),this.reprovider=new sI(t,{...r.reprovide,logPrefix:s,metricsPrefix:o,datastorePrefix:i,contentRouting:this.contentRouting,lock:c,operationMetrics:a}),this.network.addEventListener("peer",y=>{const b=y.detail;this.onPeerConnect(b).catch(x=>{this.log.error("could not add %p to routing table",b.id,x)}),this.dispatchEvent(new CustomEvent("peer",{detail:b}))}),this.topologyListener.addEventListener("peer",y=>{const b=y.detail;Promise.resolve().then(async()=>{const x=await this.components.peerStore.get(b),D={id:b,multiaddrs:x.addresses.map(({multiaddr:S})=>S),protocols:x.protocols};await this.onPeerConnect(D)}).catch(x=>{this.log.error("could not add %p to routing table - %e",b,x)})}),this.dhtPeerRouting=new NI(this),this.dhtContentRouting=new FI(this),r.clientMode==null&&t.events.addEventListener("self:peer:update",y=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const b=y.detail.peer.addresses.some(({multiaddr:D})=>zT(D)),x=this.getMode();b&&x==="client"?await this.setMode("server"):x==="server"&&!b&&await this.setMode("client")}).catch(b=>{this.log.error("error setting dht server mode",b)})}),this.get=ei(this.get.bind(this),a,"GET_VALUE"),this.findProviders=ei(this.findProviders.bind(this),a,"FIND_PROVIDERS"),this.findPeer=ei(this.findPeer.bind(this),a,"FIND_PEER"),this.getClosestPeers=ei(this.getClosestPeers.bind(this),a,"GET_CLOSEST_PEERS"),this.provide=ei(this.provide.bind(this),a,"PROVIDE"),this.put=ei(this.put.bind(this),a,"PUT_VALUE")}get[(K6=Symbol.toStringTag,z6=dl,q6=zh,$h)](){return this.dhtContentRouting}get[qh](){return this.dhtPeerRouting}get[Hh](){return this}async onPeerConnect(t){if(this.log.trace("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(r=>r.toString()));return}try{await this.routingTable.add(t.id)}catch(r){this.log.error("could not add %p to routing table",t.id,r)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t,r=!1){if(t===this.getMode()&&!r){this.log("already in %s mode",t);return}if(await this.components.registrar.unhandle(this.protocol),t===this.getMode()&&!r){this.log("already in %s mode",t);return}t==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",!0),await hl(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await hl(this.querySelf))}async stop(){this.running=!1,await gd(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(t,r,s={}){yield*this.contentFetching.put(t,r,s)}async*get(t,r={}){yield*this.contentFetching.get(t,r)}async*provide(t,r={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),r)}async cancelReprovide(t){await this.providers.removeProvider(t,this.components.peerId)}async*findProviders(t,r={}){yield*this.contentRouting.findProviders(t,r)}async*findPeer(t,r={}){yield*this.peerRouting.findPeer(t,r)}async*getClosestPeers(t,r={}){yield*this.peerRouting.getClosestPeers(t,r)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var A3;(function(n){n[n.SEND_QUERY=0]="SEND_QUERY",n[n.PEER_RESPONSE=1]="PEER_RESPONSE",n[n.FINAL_PEER=2]="FINAL_PEER",n[n.QUERY_ERROR=3]="QUERY_ERROR",n[n.PROVIDER=4]="PROVIDER",n[n.VALUE=5]="VALUE",n[n.ADD_PEER=6]="ADD_PEER",n[n.DIAL_PEER=7]="DIAL_PEER"})(A3||(A3={}));function VI(n={}){return e=>new OI(e,n)}var a7={exports:{}};function UI(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Nu={exports:{}};const $I={},HI=Object.freeze(Object.defineProperty({__proto__:null,default:$I},Symbol.toStringTag,{value:"Module"})),qI=Xy(HI);var C3;function me(){return C3||(C3=1,function(n,e){(function(t,r){n.exports=r()})(fe,function(){var t=t||function(r,s){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof fe<"u"&&fe.crypto&&(i=fe.crypto),!i&&typeof UI=="function")try{i=qI}catch{}var o=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function S(){}return function(_){var E;return S.prototype=_,E=new S,S.prototype=null,E}}(),c={},l=c.lib={},u=l.Base=function(){return{extend:function(S){var _=a(this);return S&&_.mixIn(S),(!_.hasOwnProperty("init")||this.init===_.init)&&(_.init=function(){_.$super.init.apply(this,arguments)}),_.init.prototype=_,_.$super=this,_},create:function(){var S=this.extend();return S.init.apply(S,arguments),S},init:function(){},mixIn:function(S){for(var _ in S)S.hasOwnProperty(_)&&(this[_]=S[_]);S.hasOwnProperty("toString")&&(this.toString=S.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),d=l.WordArray=u.extend({init:function(S,_){S=this.words=S||[],_!=s?this.sigBytes=_:this.sigBytes=S.length*4},toString:function(S){return(S||m).stringify(this)},concat:function(S){var _=this.words,E=S.words,B=this.sigBytes,F=S.sigBytes;if(this.clamp(),B%4)for(var A=0;A<F;A++){var w=E[A>>>2]>>>24-A%4*8&255;_[B+A>>>2]|=w<<24-(B+A)%4*8}else for(var k=0;k<F;k+=4)_[B+k>>>2]=E[k>>>2];return this.sigBytes+=F,this},clamp:function(){var S=this.words,_=this.sigBytes;S[_>>>2]&=4294967295<<32-_%4*8,S.length=r.ceil(_/4)},clone:function(){var S=u.clone.call(this);return S.words=this.words.slice(0),S},random:function(S){for(var _=[],E=0;E<S;E+=4)_.push(o());return new d.init(_,S)}}),f=c.enc={},m=f.Hex={stringify:function(S){for(var _=S.words,E=S.sigBytes,B=[],F=0;F<E;F++){var A=_[F>>>2]>>>24-F%4*8&255;B.push((A>>>4).toString(16)),B.push((A&15).toString(16))}return B.join("")},parse:function(S){for(var _=S.length,E=[],B=0;B<_;B+=2)E[B>>>3]|=parseInt(S.substr(B,2),16)<<24-B%8*4;return new d.init(E,_/2)}},y=f.Latin1={stringify:function(S){for(var _=S.words,E=S.sigBytes,B=[],F=0;F<E;F++){var A=_[F>>>2]>>>24-F%4*8&255;B.push(String.fromCharCode(A))}return B.join("")},parse:function(S){for(var _=S.length,E=[],B=0;B<_;B++)E[B>>>2]|=(S.charCodeAt(B)&255)<<24-B%4*8;return new d.init(E,_)}},b=f.Utf8={stringify:function(S){try{return decodeURIComponent(escape(y.stringify(S)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(S){return y.parse(unescape(encodeURIComponent(S)))}},x=l.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(S){typeof S=="string"&&(S=b.parse(S)),this._data.concat(S),this._nDataBytes+=S.sigBytes},_process:function(S){var _,E=this._data,B=E.words,F=E.sigBytes,A=this.blockSize,w=A*4,k=F/w;S?k=r.ceil(k):k=r.max((k|0)-this._minBufferSize,0);var C=k*A,I=r.min(C*4,F);if(C){for(var R=0;R<C;R+=A)this._doProcessBlock(B,R);_=B.splice(0,C),E.sigBytes-=I}return new d.init(_,I)},clone:function(){var S=u.clone.call(this);return S._data=this._data.clone(),S},_minBufferSize:0});l.Hasher=x.extend({cfg:u.extend(),init:function(S){this.cfg=this.cfg.extend(S),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(S){return this._append(S),this._process(),this},finalize:function(S){S&&this._append(S);var _=this._doFinalize();return _},blockSize:16,_createHelper:function(S){return function(_,E){return new S.init(E).finalize(_)}},_createHmacHelper:function(S){return function(_,E){return new D.HMAC.init(S,E).finalize(_)}}});var D=c.algo={};return c}(Math);return t})}(Nu)),Nu.exports}var Lu={exports:{}},S3;function m0(){return S3||(S3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){return function(r){var s=t,i=s.lib,o=i.Base,a=i.WordArray,c=s.x64={};c.Word=o.extend({init:function(l,u){this.high=l,this.low=u}}),c.WordArray=o.extend({init:function(l,u){l=this.words=l||[],u!=r?this.sigBytes=u:this.sigBytes=l.length*8},toX32:function(){for(var l=this.words,u=l.length,d=[],f=0;f<u;f++){var m=l[f];d.push(m.high),d.push(m.low)}return a.create(d,this.sigBytes)},clone:function(){for(var l=o.clone.call(this),u=l.words=this.words.slice(0),d=u.length,f=0;f<d;f++)u[f]=u[f].clone();return l}})}(),t})}(Lu)),Lu.exports}var Mu={exports:{}},T3;function zI(){return T3||(T3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){return function(){if(typeof ArrayBuffer=="function"){var r=t,s=r.lib,i=s.WordArray,o=i.init,a=i.init=function(c){if(c instanceof ArrayBuffer&&(c=new Uint8Array(c)),(c instanceof Int8Array||typeof Uint8ClampedArray<"u"&&c instanceof Uint8ClampedArray||c instanceof Int16Array||c instanceof Uint16Array||c instanceof Int32Array||c instanceof Uint32Array||c instanceof Float32Array||c instanceof Float64Array)&&(c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),c instanceof Uint8Array){for(var l=c.byteLength,u=[],d=0;d<l;d++)u[d>>>2]|=c[d]<<24-d%4*8;o.call(this,u,l)}else o.apply(this,arguments)};a.prototype=i}}(),t.lib.WordArray})}(Mu)),Mu.exports}var Ou={exports:{}},I3;function KI(){return I3||(I3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.enc;o.Utf16=o.Utf16BE={stringify:function(c){for(var l=c.words,u=c.sigBytes,d=[],f=0;f<u;f+=2){var m=l[f>>>2]>>>16-f%4*8&65535;d.push(String.fromCharCode(m))}return d.join("")},parse:function(c){for(var l=c.length,u=[],d=0;d<l;d++)u[d>>>1]|=c.charCodeAt(d)<<16-d%2*16;return i.create(u,l*2)}},o.Utf16LE={stringify:function(c){for(var l=c.words,u=c.sigBytes,d=[],f=0;f<u;f+=2){var m=a(l[f>>>2]>>>16-f%4*8&65535);d.push(String.fromCharCode(m))}return d.join("")},parse:function(c){for(var l=c.length,u=[],d=0;d<l;d++)u[d>>>1]|=a(c.charCodeAt(d)<<16-d%2*16);return i.create(u,l*2)}};function a(c){return c<<8&4278255360|c>>>8&16711935}}(),t.enc.Utf16})}(Ou)),Ou.exports}var Vu={exports:{}},k3;function Ms(){return k3||(k3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.enc;o.Base64={stringify:function(c){var l=c.words,u=c.sigBytes,d=this._map;c.clamp();for(var f=[],m=0;m<u;m+=3)for(var y=l[m>>>2]>>>24-m%4*8&255,b=l[m+1>>>2]>>>24-(m+1)%4*8&255,x=l[m+2>>>2]>>>24-(m+2)%4*8&255,D=y<<16|b<<8|x,S=0;S<4&&m+S*.75<u;S++)f.push(d.charAt(D>>>6*(3-S)&63));var _=d.charAt(64);if(_)for(;f.length%4;)f.push(_);return f.join("")},parse:function(c){var l=c.length,u=this._map,d=this._reverseMap;if(!d){d=this._reverseMap=[];for(var f=0;f<u.length;f++)d[u.charCodeAt(f)]=f}var m=u.charAt(64);if(m){var y=c.indexOf(m);y!==-1&&(l=y)}return a(c,l,d)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function a(c,l,u){for(var d=[],f=0,m=0;m<l;m++)if(m%4){var y=u[c.charCodeAt(m-1)]<<m%4*2,b=u[c.charCodeAt(m)]>>>6-m%4*2,x=y|b;d[f>>>2]|=x<<24-f%4*8,f++}return i.create(d,f)}}(),t.enc.Base64})}(Vu)),Vu.exports}var Uu={exports:{}},P3;function jI(){return P3||(P3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.enc;o.Base64url={stringify:function(c,l){l===void 0&&(l=!0);var u=c.words,d=c.sigBytes,f=l?this._safe_map:this._map;c.clamp();for(var m=[],y=0;y<d;y+=3)for(var b=u[y>>>2]>>>24-y%4*8&255,x=u[y+1>>>2]>>>24-(y+1)%4*8&255,D=u[y+2>>>2]>>>24-(y+2)%4*8&255,S=b<<16|x<<8|D,_=0;_<4&&y+_*.75<d;_++)m.push(f.charAt(S>>>6*(3-_)&63));var E=f.charAt(64);if(E)for(;m.length%4;)m.push(E);return m.join("")},parse:function(c,l){l===void 0&&(l=!0);var u=c.length,d=l?this._safe_map:this._map,f=this._reverseMap;if(!f){f=this._reverseMap=[];for(var m=0;m<d.length;m++)f[d.charCodeAt(m)]=m}var y=d.charAt(64);if(y){var b=c.indexOf(y);b!==-1&&(u=b)}return a(c,u,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"};function a(c,l,u){for(var d=[],f=0,m=0;m<l;m++)if(m%4){var y=u[c.charCodeAt(m-1)]<<m%4*2,b=u[c.charCodeAt(m)]>>>6-m%4*2,x=y|b;d[f>>>2]|=x<<24-f%4*8,f++}return i.create(d,f)}}(),t.enc.Base64url})}(Uu)),Uu.exports}var $u={exports:{}},D3;function Os(){return D3||(D3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.algo,l=[];(function(){for(var b=0;b<64;b++)l[b]=r.abs(r.sin(b+1))*4294967296|0})();var u=c.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(b,x){for(var D=0;D<16;D++){var S=x+D,_=b[S];b[S]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360}var E=this._hash.words,B=b[x+0],F=b[x+1],A=b[x+2],w=b[x+3],k=b[x+4],C=b[x+5],I=b[x+6],R=b[x+7],T=b[x+8],G=b[x+9],H=b[x+10],z=b[x+11],W=b[x+12],K=b[x+13],O=b[x+14],q=b[x+15],N=E[0],M=E[1],V=E[2],U=E[3];N=d(N,M,V,U,B,7,l[0]),U=d(U,N,M,V,F,12,l[1]),V=d(V,U,N,M,A,17,l[2]),M=d(M,V,U,N,w,22,l[3]),N=d(N,M,V,U,k,7,l[4]),U=d(U,N,M,V,C,12,l[5]),V=d(V,U,N,M,I,17,l[6]),M=d(M,V,U,N,R,22,l[7]),N=d(N,M,V,U,T,7,l[8]),U=d(U,N,M,V,G,12,l[9]),V=d(V,U,N,M,H,17,l[10]),M=d(M,V,U,N,z,22,l[11]),N=d(N,M,V,U,W,7,l[12]),U=d(U,N,M,V,K,12,l[13]),V=d(V,U,N,M,O,17,l[14]),M=d(M,V,U,N,q,22,l[15]),N=f(N,M,V,U,F,5,l[16]),U=f(U,N,M,V,I,9,l[17]),V=f(V,U,N,M,z,14,l[18]),M=f(M,V,U,N,B,20,l[19]),N=f(N,M,V,U,C,5,l[20]),U=f(U,N,M,V,H,9,l[21]),V=f(V,U,N,M,q,14,l[22]),M=f(M,V,U,N,k,20,l[23]),N=f(N,M,V,U,G,5,l[24]),U=f(U,N,M,V,O,9,l[25]),V=f(V,U,N,M,w,14,l[26]),M=f(M,V,U,N,T,20,l[27]),N=f(N,M,V,U,K,5,l[28]),U=f(U,N,M,V,A,9,l[29]),V=f(V,U,N,M,R,14,l[30]),M=f(M,V,U,N,W,20,l[31]),N=m(N,M,V,U,C,4,l[32]),U=m(U,N,M,V,T,11,l[33]),V=m(V,U,N,M,z,16,l[34]),M=m(M,V,U,N,O,23,l[35]),N=m(N,M,V,U,F,4,l[36]),U=m(U,N,M,V,k,11,l[37]),V=m(V,U,N,M,R,16,l[38]),M=m(M,V,U,N,H,23,l[39]),N=m(N,M,V,U,K,4,l[40]),U=m(U,N,M,V,B,11,l[41]),V=m(V,U,N,M,w,16,l[42]),M=m(M,V,U,N,I,23,l[43]),N=m(N,M,V,U,G,4,l[44]),U=m(U,N,M,V,W,11,l[45]),V=m(V,U,N,M,q,16,l[46]),M=m(M,V,U,N,A,23,l[47]),N=y(N,M,V,U,B,6,l[48]),U=y(U,N,M,V,R,10,l[49]),V=y(V,U,N,M,O,15,l[50]),M=y(M,V,U,N,C,21,l[51]),N=y(N,M,V,U,W,6,l[52]),U=y(U,N,M,V,w,10,l[53]),V=y(V,U,N,M,H,15,l[54]),M=y(M,V,U,N,F,21,l[55]),N=y(N,M,V,U,T,6,l[56]),U=y(U,N,M,V,q,10,l[57]),V=y(V,U,N,M,I,15,l[58]),M=y(M,V,U,N,K,21,l[59]),N=y(N,M,V,U,k,6,l[60]),U=y(U,N,M,V,z,10,l[61]),V=y(V,U,N,M,A,15,l[62]),M=y(M,V,U,N,G,21,l[63]),E[0]=E[0]+N|0,E[1]=E[1]+M|0,E[2]=E[2]+V|0,E[3]=E[3]+U|0},_doFinalize:function(){var b=this._data,x=b.words,D=this._nDataBytes*8,S=b.sigBytes*8;x[S>>>5]|=128<<24-S%32;var _=r.floor(D/4294967296),E=D;x[(S+64>>>9<<4)+15]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,x[(S+64>>>9<<4)+14]=(E<<8|E>>>24)&16711935|(E<<24|E>>>8)&4278255360,b.sigBytes=(x.length+1)*4,this._process();for(var B=this._hash,F=B.words,A=0;A<4;A++){var w=F[A];F[A]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360}return B},clone:function(){var b=a.clone.call(this);return b._hash=this._hash.clone(),b}});function d(b,x,D,S,_,E,B){var F=b+(x&D|~x&S)+_+B;return(F<<E|F>>>32-E)+x}function f(b,x,D,S,_,E,B){var F=b+(x&S|D&~S)+_+B;return(F<<E|F>>>32-E)+x}function m(b,x,D,S,_,E,B){var F=b+(x^D^S)+_+B;return(F<<E|F>>>32-E)+x}function y(b,x,D,S,_,E,B){var F=b+(D^(x|~S))+_+B;return(F<<E|F>>>32-E)+x}s.MD5=a._createHelper(u),s.HmacMD5=a._createHmacHelper(u)}(Math),t.MD5})}($u)),$u.exports}var Hu={exports:{}},R3;function c7(){return R3||(R3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=s.Hasher,a=r.algo,c=[],l=a.SHA1=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(u,d){for(var f=this._hash.words,m=f[0],y=f[1],b=f[2],x=f[3],D=f[4],S=0;S<80;S++){if(S<16)c[S]=u[d+S]|0;else{var _=c[S-3]^c[S-8]^c[S-14]^c[S-16];c[S]=_<<1|_>>>31}var E=(m<<5|m>>>27)+D+c[S];S<20?E+=(y&b|~y&x)+1518500249:S<40?E+=(y^b^x)+1859775393:S<60?E+=(y&b|y&x|b&x)-1894007588:E+=(y^b^x)-899497514,D=x,x=b,b=y<<30|y>>>2,y=m,m=E}f[0]=f[0]+m|0,f[1]=f[1]+y|0,f[2]=f[2]+b|0,f[3]=f[3]+x|0,f[4]=f[4]+D|0},_doFinalize:function(){var u=this._data,d=u.words,f=this._nDataBytes*8,m=u.sigBytes*8;return d[m>>>5]|=128<<24-m%32,d[(m+64>>>9<<4)+14]=Math.floor(f/4294967296),d[(m+64>>>9<<4)+15]=f,u.sigBytes=d.length*4,this._process(),this._hash},clone:function(){var u=o.clone.call(this);return u._hash=this._hash.clone(),u}});r.SHA1=o._createHelper(l),r.HmacSHA1=o._createHmacHelper(l)}(),t.SHA1})}(Hu)),Hu.exports}var qu={exports:{}},B3;function sf(){return B3||(B3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.algo,l=[],u=[];(function(){function m(D){for(var S=r.sqrt(D),_=2;_<=S;_++)if(!(D%_))return!1;return!0}function y(D){return(D-(D|0))*4294967296|0}for(var b=2,x=0;x<64;)m(b)&&(x<8&&(l[x]=y(r.pow(b,1/2))),u[x]=y(r.pow(b,1/3)),x++),b++})();var d=[],f=c.SHA256=a.extend({_doReset:function(){this._hash=new o.init(l.slice(0))},_doProcessBlock:function(m,y){for(var b=this._hash.words,x=b[0],D=b[1],S=b[2],_=b[3],E=b[4],B=b[5],F=b[6],A=b[7],w=0;w<64;w++){if(w<16)d[w]=m[y+w]|0;else{var k=d[w-15],C=(k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3,I=d[w-2],R=(I<<15|I>>>17)^(I<<13|I>>>19)^I>>>10;d[w]=C+d[w-7]+R+d[w-16]}var T=E&B^~E&F,G=x&D^x&S^D&S,H=(x<<30|x>>>2)^(x<<19|x>>>13)^(x<<10|x>>>22),z=(E<<26|E>>>6)^(E<<21|E>>>11)^(E<<7|E>>>25),W=A+z+T+u[w]+d[w],K=H+G;A=F,F=B,B=E,E=_+W|0,_=S,S=D,D=x,x=W+K|0}b[0]=b[0]+x|0,b[1]=b[1]+D|0,b[2]=b[2]+S|0,b[3]=b[3]+_|0,b[4]=b[4]+E|0,b[5]=b[5]+B|0,b[6]=b[6]+F|0,b[7]=b[7]+A|0},_doFinalize:function(){var m=this._data,y=m.words,b=this._nDataBytes*8,x=m.sigBytes*8;return y[x>>>5]|=128<<24-x%32,y[(x+64>>>9<<4)+14]=r.floor(b/4294967296),y[(x+64>>>9<<4)+15]=b,m.sigBytes=y.length*4,this._process(),this._hash},clone:function(){var m=a.clone.call(this);return m._hash=this._hash.clone(),m}});s.SHA256=a._createHelper(f),s.HmacSHA256=a._createHmacHelper(f)}(Math),t.SHA256})}(qu)),qu.exports}var zu={exports:{}},F3;function GI(){return F3||(F3=1,function(n,e){(function(t,r,s){n.exports=r(me(),sf())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=r.algo,a=o.SHA256,c=o.SHA224=a.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var l=a._doFinalize.call(this);return l.sigBytes-=4,l}});r.SHA224=a._createHelper(c),r.HmacSHA224=a._createHmacHelper(c)}(),t.SHA224})}(zu)),zu.exports}var Ku={exports:{}},N3;function l7(){return N3||(N3=1,function(n,e){(function(t,r,s){n.exports=r(me(),m0())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.Hasher,o=r.x64,a=o.Word,c=o.WordArray,l=r.algo;function u(){return a.create.apply(a,arguments)}var d=[u(1116352408,3609767458),u(1899447441,602891725),u(3049323471,3964484399),u(3921009573,2173295548),u(961987163,4081628472),u(1508970993,3053834265),u(2453635748,2937671579),u(2870763221,3664609560),u(3624381080,2734883394),u(310598401,1164996542),u(607225278,1323610764),u(1426881987,3590304994),u(1925078388,4068182383),u(2162078206,991336113),u(2614888103,633803317),u(3248222580,3479774868),u(3835390401,2666613458),u(4022224774,944711139),u(264347078,2341262773),u(604807628,2007800933),u(770255983,1495990901),u(1249150122,1856431235),u(1555081692,3175218132),u(1996064986,2198950837),u(2554220882,3999719339),u(2821834349,766784016),u(2952996808,2566594879),u(3210313671,3203337956),u(3336571891,1034457026),u(3584528711,2466948901),u(113926993,3758326383),u(338241895,168717936),u(666307205,1188179964),u(773529912,1546045734),u(1294757372,1522805485),u(1396182291,2643833823),u(1695183700,2343527390),u(1986661051,1014477480),u(2177026350,1206759142),u(2456956037,344077627),u(2730485921,1290863460),u(2820302411,3158454273),u(3259730800,3505952657),u(3345764771,106217008),u(3516065817,3606008344),u(3600352804,1432725776),u(4094571909,1467031594),u(275423344,851169720),u(430227734,3100823752),u(506948616,1363258195),u(659060556,3750685593),u(883997877,3785050280),u(958139571,3318307427),u(1322822218,3812723403),u(1537002063,2003034995),u(1747873779,3602036899),u(1955562222,1575990012),u(2024104815,1125592928),u(2227730452,2716904306),u(2361852424,442776044),u(2428436474,593698344),u(2756734187,3733110249),u(3204031479,2999351573),u(3329325298,3815920427),u(3391569614,3928383900),u(3515267271,566280711),u(3940187606,3454069534),u(4118630271,4000239992),u(116418474,1914138554),u(174292421,2731055270),u(289380356,3203993006),u(460393269,320620315),u(685471733,587496836),u(852142971,1086792851),u(1017036298,365543100),u(1126000580,2618297676),u(1288033470,3409855158),u(1501505948,4234509866),u(1607167915,987167468),u(1816402316,1246189591)],f=[];(function(){for(var y=0;y<80;y++)f[y]=u()})();var m=l.SHA512=i.extend({_doReset:function(){this._hash=new c.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(y,b){for(var x=this._hash.words,D=x[0],S=x[1],_=x[2],E=x[3],B=x[4],F=x[5],A=x[6],w=x[7],k=D.high,C=D.low,I=S.high,R=S.low,T=_.high,G=_.low,H=E.high,z=E.low,W=B.high,K=B.low,O=F.high,q=F.low,N=A.high,M=A.low,V=w.high,U=w.low,ee=k,ne=C,ae=I,re=R,Be=T,Fe=G,Ge=H,Le=z,Ee=W,Te=K,ut=O,pt=q,Zr=N,en=M,_n=V,Cr=U,Pt=0;Pt<80;Pt++){var Jt,xr,En=f[Pt];if(Pt<16)xr=En.high=y[b+Pt*2]|0,Jt=En.low=y[b+Pt*2+1]|0;else{var ro=f[Pt-15],We=ro.high,st=ro.low,Hs=(We>>>1|st<<31)^(We>>>8|st<<24)^We>>>7,no=(st>>>1|We<<31)^(st>>>8|We<<24)^(st>>>7|We<<25),so=f[Pt-2],An=so.high,Sr=so.low,ja=(An>>>19|Sr<<13)^(An<<3|Sr>>>29)^An>>>6,io=(Sr>>>19|An<<13)^(Sr<<3|An>>>29)^(Sr>>>6|An<<26),qs=f[Pt-7],N0=qs.high,L0=qs.low,zs=f[Pt-16],Ga=zs.high,oo=zs.low;Jt=no+L0,xr=Hs+N0+(Jt>>>0<no>>>0?1:0),Jt=Jt+io,xr=xr+ja+(Jt>>>0<io>>>0?1:0),Jt=Jt+oo,xr=xr+Ga+(Jt>>>0<oo>>>0?1:0),En.high=xr,En.low=Jt}var as=Ee&ut^~Ee&Zr,Ks=Te&pt^~Te&en,ao=ee&ae^ee&Be^ae&Be,tn=ne&re^ne&Fe^re&Fe,Wa=(ee>>>28|ne<<4)^(ee<<30|ne>>>2)^(ee<<25|ne>>>7),cs=(ne>>>28|ee<<4)^(ne<<30|ee>>>2)^(ne<<25|ee>>>7),Qa=(Ee>>>14|Te<<18)^(Ee>>>18|Te<<14)^(Ee<<23|Te>>>9),ls=(Te>>>14|Ee<<18)^(Te>>>18|Ee<<14)^(Te<<23|Ee>>>9),co=d[Pt],bt=co.high,lo=co.low,ht=Cr+ls,Zt=_n+Qa+(ht>>>0<Cr>>>0?1:0),ht=ht+Ks,Zt=Zt+as+(ht>>>0<Ks>>>0?1:0),ht=ht+lo,Zt=Zt+bt+(ht>>>0<lo>>>0?1:0),ht=ht+Jt,Zt=Zt+xr+(ht>>>0<Jt>>>0?1:0),Ya=cs+tn,M0=Wa+ao+(Ya>>>0<cs>>>0?1:0);_n=Zr,Cr=en,Zr=ut,en=pt,ut=Ee,pt=Te,Te=Le+ht|0,Ee=Ge+Zt+(Te>>>0<Le>>>0?1:0)|0,Ge=Be,Le=Fe,Be=ae,Fe=re,ae=ee,re=ne,ne=ht+Ya|0,ee=Zt+M0+(ne>>>0<ht>>>0?1:0)|0}C=D.low=C+ne,D.high=k+ee+(C>>>0<ne>>>0?1:0),R=S.low=R+re,S.high=I+ae+(R>>>0<re>>>0?1:0),G=_.low=G+Fe,_.high=T+Be+(G>>>0<Fe>>>0?1:0),z=E.low=z+Le,E.high=H+Ge+(z>>>0<Le>>>0?1:0),K=B.low=K+Te,B.high=W+Ee+(K>>>0<Te>>>0?1:0),q=F.low=q+pt,F.high=O+ut+(q>>>0<pt>>>0?1:0),M=A.low=M+en,A.high=N+Zr+(M>>>0<en>>>0?1:0),U=w.low=U+Cr,w.high=V+_n+(U>>>0<Cr>>>0?1:0)},_doFinalize:function(){var y=this._data,b=y.words,x=this._nDataBytes*8,D=y.sigBytes*8;b[D>>>5]|=128<<24-D%32,b[(D+128>>>10<<5)+30]=Math.floor(x/4294967296),b[(D+128>>>10<<5)+31]=x,y.sigBytes=b.length*4,this._process();var S=this._hash.toX32();return S},clone:function(){var y=i.clone.call(this);return y._hash=this._hash.clone(),y},blockSize:1024/32});r.SHA512=i._createHelper(m),r.HmacSHA512=i._createHmacHelper(m)}(),t.SHA512})}(Ku)),Ku.exports}var ju={exports:{}},L3;function WI(){return L3||(L3=1,function(n,e){(function(t,r,s){n.exports=r(me(),m0(),l7())})(fe,function(t){return function(){var r=t,s=r.x64,i=s.Word,o=s.WordArray,a=r.algo,c=a.SHA512,l=a.SHA384=c.extend({_doReset:function(){this._hash=new o.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var u=c._doFinalize.call(this);return u.sigBytes-=16,u}});r.SHA384=c._createHelper(l),r.HmacSHA384=c._createHmacHelper(l)}(),t.SHA384})}(ju)),ju.exports}var Gu={exports:{}},M3;function QI(){return M3||(M3=1,function(n,e){(function(t,r,s){n.exports=r(me(),m0())})(fe,function(t){return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.x64,l=c.Word,u=s.algo,d=[],f=[],m=[];(function(){for(var x=1,D=0,S=0;S<24;S++){d[x+5*D]=(S+1)*(S+2)/2%64;var _=D%5,E=(2*x+3*D)%5;x=_,D=E}for(var x=0;x<5;x++)for(var D=0;D<5;D++)f[x+5*D]=D+(2*x+3*D)%5*5;for(var B=1,F=0;F<24;F++){for(var A=0,w=0,k=0;k<7;k++){if(B&1){var C=(1<<k)-1;C<32?w^=1<<C:A^=1<<C-32}B&128?B=B<<1^113:B<<=1}m[F]=l.create(A,w)}})();var y=[];(function(){for(var x=0;x<25;x++)y[x]=l.create()})();var b=u.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var x=this._state=[],D=0;D<25;D++)x[D]=new l.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(x,D){for(var S=this._state,_=this.blockSize/2,E=0;E<_;E++){var B=x[D+2*E],F=x[D+2*E+1];B=(B<<8|B>>>24)&16711935|(B<<24|B>>>8)&4278255360,F=(F<<8|F>>>24)&16711935|(F<<24|F>>>8)&4278255360;var A=S[E];A.high^=F,A.low^=B}for(var w=0;w<24;w++){for(var k=0;k<5;k++){for(var C=0,I=0,R=0;R<5;R++){var A=S[k+5*R];C^=A.high,I^=A.low}var T=y[k];T.high=C,T.low=I}for(var k=0;k<5;k++)for(var G=y[(k+4)%5],H=y[(k+1)%5],z=H.high,W=H.low,C=G.high^(z<<1|W>>>31),I=G.low^(W<<1|z>>>31),R=0;R<5;R++){var A=S[k+5*R];A.high^=C,A.low^=I}for(var K=1;K<25;K++){var C,I,A=S[K],O=A.high,q=A.low,N=d[K];N<32?(C=O<<N|q>>>32-N,I=q<<N|O>>>32-N):(C=q<<N-32|O>>>64-N,I=O<<N-32|q>>>64-N);var M=y[f[K]];M.high=C,M.low=I}var V=y[0],U=S[0];V.high=U.high,V.low=U.low;for(var k=0;k<5;k++)for(var R=0;R<5;R++){var K=k+5*R,A=S[K],ee=y[K],ne=y[(k+1)%5+5*R],ae=y[(k+2)%5+5*R];A.high=ee.high^~ne.high&ae.high,A.low=ee.low^~ne.low&ae.low}var A=S[0],re=m[w];A.high^=re.high,A.low^=re.low}},_doFinalize:function(){var x=this._data,D=x.words;this._nDataBytes*8;var S=x.sigBytes*8,_=this.blockSize*32;D[S>>>5]|=1<<24-S%32,D[(r.ceil((S+1)/_)*_>>>5)-1]|=128,x.sigBytes=D.length*4,this._process();for(var E=this._state,B=this.cfg.outputLength/8,F=B/8,A=[],w=0;w<F;w++){var k=E[w],C=k.high,I=k.low;C=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360,I=(I<<8|I>>>24)&16711935|(I<<24|I>>>8)&4278255360,A.push(I),A.push(C)}return new o.init(A,B)},clone:function(){for(var x=a.clone.call(this),D=x._state=this._state.slice(0),S=0;S<25;S++)D[S]=D[S].clone();return x}});s.SHA3=a._createHelper(b),s.HmacSHA3=a._createHmacHelper(b)}(Math),t.SHA3})}(Gu)),Gu.exports}var Wu={exports:{}},O3;function YI(){return O3||(O3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){/** @preserve
			(c) 2012 by Cédric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/return function(r){var s=t,i=s.lib,o=i.WordArray,a=i.Hasher,c=s.algo,l=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),u=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),d=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),f=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),m=o.create([0,1518500249,1859775393,2400959708,2840853838]),y=o.create([1352829926,1548603684,1836072691,2053994217,0]),b=c.RIPEMD160=a.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(F,A){for(var w=0;w<16;w++){var k=A+w,C=F[k];F[k]=(C<<8|C>>>24)&16711935|(C<<24|C>>>8)&4278255360}var I=this._hash.words,R=m.words,T=y.words,G=l.words,H=u.words,z=d.words,W=f.words,K,O,q,N,M,V,U,ee,ne,ae;V=K=I[0],U=O=I[1],ee=q=I[2],ne=N=I[3],ae=M=I[4];for(var re,w=0;w<80;w+=1)re=K+F[A+G[w]]|0,w<16?re+=x(O,q,N)+R[0]:w<32?re+=D(O,q,N)+R[1]:w<48?re+=S(O,q,N)+R[2]:w<64?re+=_(O,q,N)+R[3]:re+=E(O,q,N)+R[4],re=re|0,re=B(re,z[w]),re=re+M|0,K=M,M=N,N=B(q,10),q=O,O=re,re=V+F[A+H[w]]|0,w<16?re+=E(U,ee,ne)+T[0]:w<32?re+=_(U,ee,ne)+T[1]:w<48?re+=S(U,ee,ne)+T[2]:w<64?re+=D(U,ee,ne)+T[3]:re+=x(U,ee,ne)+T[4],re=re|0,re=B(re,W[w]),re=re+ae|0,V=ae,ae=ne,ne=B(ee,10),ee=U,U=re;re=I[1]+q+ne|0,I[1]=I[2]+N+ae|0,I[2]=I[3]+M+V|0,I[3]=I[4]+K+U|0,I[4]=I[0]+O+ee|0,I[0]=re},_doFinalize:function(){var F=this._data,A=F.words,w=this._nDataBytes*8,k=F.sigBytes*8;A[k>>>5]|=128<<24-k%32,A[(k+64>>>9<<4)+14]=(w<<8|w>>>24)&16711935|(w<<24|w>>>8)&4278255360,F.sigBytes=(A.length+1)*4,this._process();for(var C=this._hash,I=C.words,R=0;R<5;R++){var T=I[R];I[R]=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360}return C},clone:function(){var F=a.clone.call(this);return F._hash=this._hash.clone(),F}});function x(F,A,w){return F^A^w}function D(F,A,w){return F&A|~F&w}function S(F,A,w){return(F|~A)^w}function _(F,A,w){return F&w|A&~w}function E(F,A,w){return F^(A|~w)}function B(F,A){return F<<A|F>>>32-A}s.RIPEMD160=a._createHelper(b),s.HmacRIPEMD160=a._createHmacHelper(b)}(),t.RIPEMD160})}(Wu)),Wu.exports}var Qu={exports:{}},V3;function of(){return V3||(V3=1,function(n,e){(function(t,r){n.exports=r(me())})(fe,function(t){(function(){var r=t,s=r.lib,i=s.Base,o=r.enc,a=o.Utf8,c=r.algo;c.HMAC=i.extend({init:function(l,u){l=this._hasher=new l.init,typeof u=="string"&&(u=a.parse(u));var d=l.blockSize,f=d*4;u.sigBytes>f&&(u=l.finalize(u)),u.clamp();for(var m=this._oKey=u.clone(),y=this._iKey=u.clone(),b=m.words,x=y.words,D=0;D<d;D++)b[D]^=1549556828,x[D]^=909522486;m.sigBytes=y.sigBytes=f,this.reset()},reset:function(){var l=this._hasher;l.reset(),l.update(this._iKey)},update:function(l){return this._hasher.update(l),this},finalize:function(l){var u=this._hasher,d=u.finalize(l);u.reset();var f=u.finalize(this._oKey.clone().concat(d));return f}})})()})}(Qu)),Qu.exports}var Yu={exports:{}},U3;function XI(){return U3||(U3=1,function(n,e){(function(t,r,s){n.exports=r(me(),sf(),of())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.Base,o=s.WordArray,a=r.algo,c=a.SHA256,l=a.HMAC,u=a.PBKDF2=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:25e4}),init:function(d){this.cfg=this.cfg.extend(d)},compute:function(d,f){for(var m=this.cfg,y=l.create(m.hasher,d),b=o.create(),x=o.create([1]),D=b.words,S=x.words,_=m.keySize,E=m.iterations;D.length<_;){var B=y.update(f).finalize(x);y.reset();for(var F=B.words,A=F.length,w=B,k=1;k<E;k++){w=y.finalize(w),y.reset();for(var C=w.words,I=0;I<A;I++)F[I]^=C[I]}b.concat(B),S[0]++}return b.sigBytes=_*4,b}});r.PBKDF2=function(d,f,m){return u.create(m).compute(d,f)}}(),t.PBKDF2})}(Yu)),Yu.exports}var Xu={exports:{}},$3;function is(){return $3||($3=1,function(n,e){(function(t,r,s){n.exports=r(me(),c7(),of())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.Base,o=s.WordArray,a=r.algo,c=a.MD5,l=a.EvpKDF=i.extend({cfg:i.extend({keySize:128/32,hasher:c,iterations:1}),init:function(u){this.cfg=this.cfg.extend(u)},compute:function(u,d){for(var f,m=this.cfg,y=m.hasher.create(),b=o.create(),x=b.words,D=m.keySize,S=m.iterations;x.length<D;){f&&y.update(f),f=y.update(u).finalize(d),y.reset();for(var _=1;_<S;_++)f=y.finalize(f),y.reset();b.concat(f)}return b.sigBytes=D*4,b}});r.EvpKDF=function(u,d,f){return l.create(f).compute(u,d)}}(),t.EvpKDF})}(Xu)),Xu.exports}var Ju={exports:{}},H3;function vt(){return H3||(H3=1,function(n,e){(function(t,r,s){n.exports=r(me(),is())})(fe,function(t){t.lib.Cipher||function(r){var s=t,i=s.lib,o=i.Base,a=i.WordArray,c=i.BufferedBlockAlgorithm,l=s.enc;l.Utf8;var u=l.Base64,d=s.algo,f=d.EvpKDF,m=i.Cipher=c.extend({cfg:o.extend(),createEncryptor:function(C,I){return this.create(this._ENC_XFORM_MODE,C,I)},createDecryptor:function(C,I){return this.create(this._DEC_XFORM_MODE,C,I)},init:function(C,I,R){this.cfg=this.cfg.extend(R),this._xformMode=C,this._key=I,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(C){return this._append(C),this._process()},finalize:function(C){C&&this._append(C);var I=this._doFinalize();return I},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function C(I){return typeof I=="string"?k:F}return function(I){return{encrypt:function(R,T,G){return C(T).encrypt(I,R,T,G)},decrypt:function(R,T,G){return C(T).decrypt(I,R,T,G)}}}}()});i.StreamCipher=m.extend({_doFinalize:function(){var C=this._process(!0);return C},blockSize:1});var y=s.mode={},b=i.BlockCipherMode=o.extend({createEncryptor:function(C,I){return this.Encryptor.create(C,I)},createDecryptor:function(C,I){return this.Decryptor.create(C,I)},init:function(C,I){this._cipher=C,this._iv=I}}),x=y.CBC=function(){var C=b.extend();C.Encryptor=C.extend({processBlock:function(R,T){var G=this._cipher,H=G.blockSize;I.call(this,R,T,H),G.encryptBlock(R,T),this._prevBlock=R.slice(T,T+H)}}),C.Decryptor=C.extend({processBlock:function(R,T){var G=this._cipher,H=G.blockSize,z=R.slice(T,T+H);G.decryptBlock(R,T),I.call(this,R,T,H),this._prevBlock=z}});function I(R,T,G){var H,z=this._iv;z?(H=z,this._iv=r):H=this._prevBlock;for(var W=0;W<G;W++)R[T+W]^=H[W]}return C}(),D=s.pad={},S=D.Pkcs7={pad:function(C,I){for(var R=I*4,T=R-C.sigBytes%R,G=T<<24|T<<16|T<<8|T,H=[],z=0;z<T;z+=4)H.push(G);var W=a.create(H,T);C.concat(W)},unpad:function(C){var I=C.words[C.sigBytes-1>>>2]&255;C.sigBytes-=I}};i.BlockCipher=m.extend({cfg:m.cfg.extend({mode:x,padding:S}),reset:function(){var C;m.reset.call(this);var I=this.cfg,R=I.iv,T=I.mode;this._xformMode==this._ENC_XFORM_MODE?C=T.createEncryptor:(C=T.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==C?this._mode.init(this,R&&R.words):(this._mode=C.call(T,this,R&&R.words),this._mode.__creator=C)},_doProcessBlock:function(C,I){this._mode.processBlock(C,I)},_doFinalize:function(){var C,I=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(I.pad(this._data,this.blockSize),C=this._process(!0)):(C=this._process(!0),I.unpad(C)),C},blockSize:128/32});var _=i.CipherParams=o.extend({init:function(C){this.mixIn(C)},toString:function(C){return(C||this.formatter).stringify(this)}}),E=s.format={},B=E.OpenSSL={stringify:function(C){var I,R=C.ciphertext,T=C.salt;return T?I=a.create([1398893684,1701076831]).concat(T).concat(R):I=R,I.toString(u)},parse:function(C){var I,R=u.parse(C),T=R.words;return T[0]==1398893684&&T[1]==1701076831&&(I=a.create(T.slice(2,4)),T.splice(0,4),R.sigBytes-=16),_.create({ciphertext:R,salt:I})}},F=i.SerializableCipher=o.extend({cfg:o.extend({format:B}),encrypt:function(C,I,R,T){T=this.cfg.extend(T);var G=C.createEncryptor(R,T),H=G.finalize(I),z=G.cfg;return _.create({ciphertext:H,key:R,iv:z.iv,algorithm:C,mode:z.mode,padding:z.padding,blockSize:C.blockSize,formatter:T.format})},decrypt:function(C,I,R,T){T=this.cfg.extend(T),I=this._parse(I,T.format);var G=C.createDecryptor(R,T).finalize(I.ciphertext);return G},_parse:function(C,I){return typeof C=="string"?I.parse(C,this):C}}),A=s.kdf={},w=A.OpenSSL={execute:function(C,I,R,T,G){if(T||(T=a.random(64/8)),G)var H=f.create({keySize:I+R,hasher:G}).compute(C,T);else var H=f.create({keySize:I+R}).compute(C,T);var z=a.create(H.words.slice(I),R*4);return H.sigBytes=I*4,_.create({key:H,iv:z,salt:T})}},k=i.PasswordBasedCipher=F.extend({cfg:F.cfg.extend({kdf:w}),encrypt:function(C,I,R,T){T=this.cfg.extend(T);var G=T.kdf.execute(R,C.keySize,C.ivSize,T.salt,T.hasher);T.iv=G.iv;var H=F.encrypt.call(this,C,I,G.key,T);return H.mixIn(G),H},decrypt:function(C,I,R,T){T=this.cfg.extend(T),I=this._parse(I,T.format);var G=T.kdf.execute(R,C.keySize,C.ivSize,I.salt,T.hasher);T.iv=G.iv;var H=F.decrypt.call(this,C,I,G.key,T);return H}})}()})}(Ju)),Ju.exports}var Zu={exports:{}},q3;function JI(){return q3||(q3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return t.mode.CFB=function(){var r=t.lib.BlockCipherMode.extend();r.Encryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize;s.call(this,i,o,c,a),this._prevBlock=i.slice(o,o+c)}}),r.Decryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize,l=i.slice(o,o+c);s.call(this,i,o,c,a),this._prevBlock=l}});function s(i,o,a,c){var l,u=this._iv;u?(l=u.slice(0),this._iv=void 0):l=this._prevBlock,c.encryptBlock(l,0);for(var d=0;d<a;d++)i[o+d]^=l[d]}return r}(),t.mode.CFB})}(Zu)),Zu.exports}var eh={exports:{}},z3;function ZI(){return z3||(z3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return t.mode.CTR=function(){var r=t.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize,l=this._iv,u=this._counter;l&&(u=this._counter=l.slice(0),this._iv=void 0);var d=u.slice(0);a.encryptBlock(d,0),u[c-1]=u[c-1]+1|0;for(var f=0;f<c;f++)i[o+f]^=d[f]}});return r.Decryptor=s,r}(),t.mode.CTR})}(eh)),eh.exports}var th={exports:{}},K3;function ek(){return K3||(K3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){/** @preserve
 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
 * derived from CryptoJS.mode.CTR
 * Jan Hruby jhruby.web@gmail.com
 */return t.mode.CTRGladman=function(){var r=t.lib.BlockCipherMode.extend();function s(a){if((a>>24&255)===255){var c=a>>16&255,l=a>>8&255,u=a&255;c===255?(c=0,l===255?(l=0,u===255?u=0:++u):++l):++c,a=0,a+=c<<16,a+=l<<8,a+=u}else a+=1<<24;return a}function i(a){return(a[0]=s(a[0]))===0&&(a[1]=s(a[1])),a}var o=r.Encryptor=r.extend({processBlock:function(a,c){var l=this._cipher,u=l.blockSize,d=this._iv,f=this._counter;d&&(f=this._counter=d.slice(0),this._iv=void 0),i(f);var m=f.slice(0);l.encryptBlock(m,0);for(var y=0;y<u;y++)a[c+y]^=m[y]}});return r.Decryptor=o,r}(),t.mode.CTRGladman})}(th)),th.exports}var rh={exports:{}},j3;function tk(){return j3||(j3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return t.mode.OFB=function(){var r=t.lib.BlockCipherMode.extend(),s=r.Encryptor=r.extend({processBlock:function(i,o){var a=this._cipher,c=a.blockSize,l=this._iv,u=this._keystream;l&&(u=this._keystream=l.slice(0),this._iv=void 0),a.encryptBlock(u,0);for(var d=0;d<c;d++)i[o+d]^=u[d]}});return r.Decryptor=s,r}(),t.mode.OFB})}(rh)),rh.exports}var nh={exports:{}},G3;function rk(){return G3||(G3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return t.mode.ECB=function(){var r=t.lib.BlockCipherMode.extend();return r.Encryptor=r.extend({processBlock:function(s,i){this._cipher.encryptBlock(s,i)}}),r.Decryptor=r.extend({processBlock:function(s,i){this._cipher.decryptBlock(s,i)}}),r}(),t.mode.ECB})}(nh)),nh.exports}var sh={exports:{}},W3;function nk(){return W3||(W3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return t.pad.AnsiX923={pad:function(r,s){var i=r.sigBytes,o=s*4,a=o-i%o,c=i+a-1;r.clamp(),r.words[c>>>2]|=a<<24-c%4*8,r.sigBytes+=a},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},t.pad.Ansix923})}(sh)),sh.exports}var ih={exports:{}},Q3;function sk(){return Q3||(Q3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return t.pad.Iso10126={pad:function(r,s){var i=s*4,o=i-r.sigBytes%i;r.concat(t.lib.WordArray.random(o-1)).concat(t.lib.WordArray.create([o<<24],1))},unpad:function(r){var s=r.words[r.sigBytes-1>>>2]&255;r.sigBytes-=s}},t.pad.Iso10126})}(ih)),ih.exports}var oh={exports:{}},Y3;function ik(){return Y3||(Y3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return t.pad.Iso97971={pad:function(r,s){r.concat(t.lib.WordArray.create([2147483648],1)),t.pad.ZeroPadding.pad(r,s)},unpad:function(r){t.pad.ZeroPadding.unpad(r),r.sigBytes--}},t.pad.Iso97971})}(oh)),oh.exports}var ah={exports:{}},X3;function ok(){return X3||(X3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return t.pad.ZeroPadding={pad:function(r,s){var i=s*4;r.clamp(),r.sigBytes+=i-(r.sigBytes%i||i)},unpad:function(r){for(var s=r.words,i=r.sigBytes-1,i=r.sigBytes-1;i>=0;i--)if(s[i>>>2]>>>24-i%4*8&255){r.sigBytes=i+1;break}}},t.pad.ZeroPadding})}(ah)),ah.exports}var ch={exports:{}},J3;function ak(){return J3||(J3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return t.pad.NoPadding={pad:function(){},unpad:function(){}},t.pad.NoPadding})}(ch)),ch.exports}var lh={exports:{}},Z3;function ck(){return Z3||(Z3=1,function(n,e){(function(t,r,s){n.exports=r(me(),vt())})(fe,function(t){return function(r){var s=t,i=s.lib,o=i.CipherParams,a=s.enc,c=a.Hex,l=s.format;l.Hex={stringify:function(u){return u.ciphertext.toString(c)},parse:function(u){var d=c.parse(u);return o.create({ciphertext:d})}}}(),t.format.Hex})}(lh)),lh.exports}var uh={exports:{}},ep;function lk(){return ep||(ep=1,function(n,e){(function(t,r,s){n.exports=r(me(),Ms(),Os(),is(),vt())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.BlockCipher,o=r.algo,a=[],c=[],l=[],u=[],d=[],f=[],m=[],y=[],b=[],x=[];(function(){for(var _=[],E=0;E<256;E++)E<128?_[E]=E<<1:_[E]=E<<1^283;for(var B=0,F=0,E=0;E<256;E++){var A=F^F<<1^F<<2^F<<3^F<<4;A=A>>>8^A&255^99,a[B]=A,c[A]=B;var w=_[B],k=_[w],C=_[k],I=_[A]*257^A*16843008;l[B]=I<<24|I>>>8,u[B]=I<<16|I>>>16,d[B]=I<<8|I>>>24,f[B]=I;var I=C*16843009^k*65537^w*257^B*16843008;m[A]=I<<24|I>>>8,y[A]=I<<16|I>>>16,b[A]=I<<8|I>>>24,x[A]=I,B?(B=w^_[_[_[C^w]]],F^=_[_[F]]):B=F=1}})();var D=[0,1,2,4,8,16,32,64,128,27,54],S=o.AES=i.extend({_doReset:function(){var _;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var E=this._keyPriorReset=this._key,B=E.words,F=E.sigBytes/4,A=this._nRounds=F+6,w=(A+1)*4,k=this._keySchedule=[],C=0;C<w;C++)C<F?k[C]=B[C]:(_=k[C-1],C%F?F>6&&C%F==4&&(_=a[_>>>24]<<24|a[_>>>16&255]<<16|a[_>>>8&255]<<8|a[_&255]):(_=_<<8|_>>>24,_=a[_>>>24]<<24|a[_>>>16&255]<<16|a[_>>>8&255]<<8|a[_&255],_^=D[C/F|0]<<24),k[C]=k[C-F]^_);for(var I=this._invKeySchedule=[],R=0;R<w;R++){var C=w-R;if(R%4)var _=k[C];else var _=k[C-4];R<4||C<=4?I[R]=_:I[R]=m[a[_>>>24]]^y[a[_>>>16&255]]^b[a[_>>>8&255]]^x[a[_&255]]}}},encryptBlock:function(_,E){this._doCryptBlock(_,E,this._keySchedule,l,u,d,f,a)},decryptBlock:function(_,E){var B=_[E+1];_[E+1]=_[E+3],_[E+3]=B,this._doCryptBlock(_,E,this._invKeySchedule,m,y,b,x,c);var B=_[E+1];_[E+1]=_[E+3],_[E+3]=B},_doCryptBlock:function(_,E,B,F,A,w,k,C){for(var I=this._nRounds,R=_[E]^B[0],T=_[E+1]^B[1],G=_[E+2]^B[2],H=_[E+3]^B[3],z=4,W=1;W<I;W++){var K=F[R>>>24]^A[T>>>16&255]^w[G>>>8&255]^k[H&255]^B[z++],O=F[T>>>24]^A[G>>>16&255]^w[H>>>8&255]^k[R&255]^B[z++],q=F[G>>>24]^A[H>>>16&255]^w[R>>>8&255]^k[T&255]^B[z++],N=F[H>>>24]^A[R>>>16&255]^w[T>>>8&255]^k[G&255]^B[z++];R=K,T=O,G=q,H=N}var K=(C[R>>>24]<<24|C[T>>>16&255]<<16|C[G>>>8&255]<<8|C[H&255])^B[z++],O=(C[T>>>24]<<24|C[G>>>16&255]<<16|C[H>>>8&255]<<8|C[R&255])^B[z++],q=(C[G>>>24]<<24|C[H>>>16&255]<<16|C[R>>>8&255]<<8|C[T&255])^B[z++],N=(C[H>>>24]<<24|C[R>>>16&255]<<16|C[T>>>8&255]<<8|C[G&255])^B[z++];_[E]=K,_[E+1]=O,_[E+2]=q,_[E+3]=N},keySize:256/32});r.AES=i._createHelper(S)}(),t.AES})}(uh)),uh.exports}var hh={exports:{}},tp;function uk(){return tp||(tp=1,function(n,e){(function(t,r,s){n.exports=r(me(),Ms(),Os(),is(),vt())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.WordArray,o=s.BlockCipher,a=r.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],l=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],u=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],d=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],f=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],m=a.DES=o.extend({_doReset:function(){for(var D=this._key,S=D.words,_=[],E=0;E<56;E++){var B=c[E]-1;_[E]=S[B>>>5]>>>31-B%32&1}for(var F=this._subKeys=[],A=0;A<16;A++){for(var w=F[A]=[],k=u[A],E=0;E<24;E++)w[E/6|0]|=_[(l[E]-1+k)%28]<<31-E%6,w[4+(E/6|0)]|=_[28+(l[E+24]-1+k)%28]<<31-E%6;w[0]=w[0]<<1|w[0]>>>31;for(var E=1;E<7;E++)w[E]=w[E]>>>(E-1)*4+3;w[7]=w[7]<<5|w[7]>>>27}for(var C=this._invSubKeys=[],E=0;E<16;E++)C[E]=F[15-E]},encryptBlock:function(D,S){this._doCryptBlock(D,S,this._subKeys)},decryptBlock:function(D,S){this._doCryptBlock(D,S,this._invSubKeys)},_doCryptBlock:function(D,S,_){this._lBlock=D[S],this._rBlock=D[S+1],y.call(this,4,252645135),y.call(this,16,65535),b.call(this,2,858993459),b.call(this,8,16711935),y.call(this,1,1431655765);for(var E=0;E<16;E++){for(var B=_[E],F=this._lBlock,A=this._rBlock,w=0,k=0;k<8;k++)w|=d[k][((A^B[k])&f[k])>>>0];this._lBlock=A,this._rBlock=F^w}var C=this._lBlock;this._lBlock=this._rBlock,this._rBlock=C,y.call(this,1,1431655765),b.call(this,8,16711935),b.call(this,2,858993459),y.call(this,16,65535),y.call(this,4,252645135),D[S]=this._lBlock,D[S+1]=this._rBlock},keySize:64/32,ivSize:64/32,blockSize:64/32});function y(D,S){var _=(this._lBlock>>>D^this._rBlock)&S;this._rBlock^=_,this._lBlock^=_<<D}function b(D,S){var _=(this._rBlock>>>D^this._lBlock)&S;this._lBlock^=_,this._rBlock^=_<<D}r.DES=o._createHelper(m);var x=a.TripleDES=o.extend({_doReset:function(){var D=this._key,S=D.words;if(S.length!==2&&S.length!==4&&S.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var _=S.slice(0,2),E=S.length<4?S.slice(0,2):S.slice(2,4),B=S.length<6?S.slice(0,2):S.slice(4,6);this._des1=m.createEncryptor(i.create(_)),this._des2=m.createEncryptor(i.create(E)),this._des3=m.createEncryptor(i.create(B))},encryptBlock:function(D,S){this._des1.encryptBlock(D,S),this._des2.decryptBlock(D,S),this._des3.encryptBlock(D,S)},decryptBlock:function(D,S){this._des3.decryptBlock(D,S),this._des2.encryptBlock(D,S),this._des1.decryptBlock(D,S)},keySize:192/32,ivSize:64/32,blockSize:64/32});r.TripleDES=o._createHelper(x)}(),t.TripleDES})}(hh)),hh.exports}var dh={exports:{}},rp;function hk(){return rp||(rp=1,function(n,e){(function(t,r,s){n.exports=r(me(),Ms(),Os(),is(),vt())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.StreamCipher,o=r.algo,a=o.RC4=i.extend({_doReset:function(){for(var u=this._key,d=u.words,f=u.sigBytes,m=this._S=[],y=0;y<256;y++)m[y]=y;for(var y=0,b=0;y<256;y++){var x=y%f,D=d[x>>>2]>>>24-x%4*8&255;b=(b+m[y]+D)%256;var S=m[y];m[y]=m[b],m[b]=S}this._i=this._j=0},_doProcessBlock:function(u,d){u[d]^=c.call(this)},keySize:256/32,ivSize:0});function c(){for(var u=this._S,d=this._i,f=this._j,m=0,y=0;y<4;y++){d=(d+1)%256,f=(f+u[d])%256;var b=u[d];u[d]=u[f],u[f]=b,m|=u[(u[d]+u[f])%256]<<24-y*8}return this._i=d,this._j=f,m}r.RC4=i._createHelper(a);var l=o.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var u=this.cfg.drop;u>0;u--)c.call(this)}});r.RC4Drop=i._createHelper(l)}(),t.RC4})}(dh)),dh.exports}var fh={exports:{}},np;function dk(){return np||(np=1,function(n,e){(function(t,r,s){n.exports=r(me(),Ms(),Os(),is(),vt())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.StreamCipher,o=r.algo,a=[],c=[],l=[],u=o.Rabbit=i.extend({_doReset:function(){for(var f=this._key.words,m=this.cfg.iv,y=0;y<4;y++)f[y]=(f[y]<<8|f[y]>>>24)&16711935|(f[y]<<24|f[y]>>>8)&4278255360;var b=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],x=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var y=0;y<4;y++)d.call(this);for(var y=0;y<8;y++)x[y]^=b[y+4&7];if(m){var D=m.words,S=D[0],_=D[1],E=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,B=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,F=E>>>16|B&4294901760,A=B<<16|E&65535;x[0]^=E,x[1]^=F,x[2]^=B,x[3]^=A,x[4]^=E,x[5]^=F,x[6]^=B,x[7]^=A;for(var y=0;y<4;y++)d.call(this)}},_doProcessBlock:function(f,m){var y=this._X;d.call(this),a[0]=y[0]^y[5]>>>16^y[3]<<16,a[1]=y[2]^y[7]>>>16^y[5]<<16,a[2]=y[4]^y[1]>>>16^y[7]<<16,a[3]=y[6]^y[3]>>>16^y[1]<<16;for(var b=0;b<4;b++)a[b]=(a[b]<<8|a[b]>>>24)&16711935|(a[b]<<24|a[b]>>>8)&4278255360,f[m+b]^=a[b]},blockSize:128/32,ivSize:64/32});function d(){for(var f=this._X,m=this._C,y=0;y<8;y++)c[y]=m[y];m[0]=m[0]+1295307597+this._b|0,m[1]=m[1]+3545052371+(m[0]>>>0<c[0]>>>0?1:0)|0,m[2]=m[2]+886263092+(m[1]>>>0<c[1]>>>0?1:0)|0,m[3]=m[3]+1295307597+(m[2]>>>0<c[2]>>>0?1:0)|0,m[4]=m[4]+3545052371+(m[3]>>>0<c[3]>>>0?1:0)|0,m[5]=m[5]+886263092+(m[4]>>>0<c[4]>>>0?1:0)|0,m[6]=m[6]+1295307597+(m[5]>>>0<c[5]>>>0?1:0)|0,m[7]=m[7]+3545052371+(m[6]>>>0<c[6]>>>0?1:0)|0,this._b=m[7]>>>0<c[7]>>>0?1:0;for(var y=0;y<8;y++){var b=f[y]+m[y],x=b&65535,D=b>>>16,S=((x*x>>>17)+x*D>>>15)+D*D,_=((b&4294901760)*b|0)+((b&65535)*b|0);l[y]=S^_}f[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,f[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,f[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,f[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,f[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,f[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,f[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,f[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}r.Rabbit=i._createHelper(u)}(),t.Rabbit})}(fh)),fh.exports}var ph={exports:{}},sp;function fk(){return sp||(sp=1,function(n,e){(function(t,r,s){n.exports=r(me(),Ms(),Os(),is(),vt())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.StreamCipher,o=r.algo,a=[],c=[],l=[],u=o.RabbitLegacy=i.extend({_doReset:function(){var f=this._key.words,m=this.cfg.iv,y=this._X=[f[0],f[3]<<16|f[2]>>>16,f[1],f[0]<<16|f[3]>>>16,f[2],f[1]<<16|f[0]>>>16,f[3],f[2]<<16|f[1]>>>16],b=this._C=[f[2]<<16|f[2]>>>16,f[0]&4294901760|f[1]&65535,f[3]<<16|f[3]>>>16,f[1]&4294901760|f[2]&65535,f[0]<<16|f[0]>>>16,f[2]&4294901760|f[3]&65535,f[1]<<16|f[1]>>>16,f[3]&4294901760|f[0]&65535];this._b=0;for(var x=0;x<4;x++)d.call(this);for(var x=0;x<8;x++)b[x]^=y[x+4&7];if(m){var D=m.words,S=D[0],_=D[1],E=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,B=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,F=E>>>16|B&4294901760,A=B<<16|E&65535;b[0]^=E,b[1]^=F,b[2]^=B,b[3]^=A,b[4]^=E,b[5]^=F,b[6]^=B,b[7]^=A;for(var x=0;x<4;x++)d.call(this)}},_doProcessBlock:function(f,m){var y=this._X;d.call(this),a[0]=y[0]^y[5]>>>16^y[3]<<16,a[1]=y[2]^y[7]>>>16^y[5]<<16,a[2]=y[4]^y[1]>>>16^y[7]<<16,a[3]=y[6]^y[3]>>>16^y[1]<<16;for(var b=0;b<4;b++)a[b]=(a[b]<<8|a[b]>>>24)&16711935|(a[b]<<24|a[b]>>>8)&4278255360,f[m+b]^=a[b]},blockSize:128/32,ivSize:64/32});function d(){for(var f=this._X,m=this._C,y=0;y<8;y++)c[y]=m[y];m[0]=m[0]+1295307597+this._b|0,m[1]=m[1]+3545052371+(m[0]>>>0<c[0]>>>0?1:0)|0,m[2]=m[2]+886263092+(m[1]>>>0<c[1]>>>0?1:0)|0,m[3]=m[3]+1295307597+(m[2]>>>0<c[2]>>>0?1:0)|0,m[4]=m[4]+3545052371+(m[3]>>>0<c[3]>>>0?1:0)|0,m[5]=m[5]+886263092+(m[4]>>>0<c[4]>>>0?1:0)|0,m[6]=m[6]+1295307597+(m[5]>>>0<c[5]>>>0?1:0)|0,m[7]=m[7]+3545052371+(m[6]>>>0<c[6]>>>0?1:0)|0,this._b=m[7]>>>0<c[7]>>>0?1:0;for(var y=0;y<8;y++){var b=f[y]+m[y],x=b&65535,D=b>>>16,S=((x*x>>>17)+x*D>>>15)+D*D,_=((b&4294901760)*b|0)+((b&65535)*b|0);l[y]=S^_}f[0]=l[0]+(l[7]<<16|l[7]>>>16)+(l[6]<<16|l[6]>>>16)|0,f[1]=l[1]+(l[0]<<8|l[0]>>>24)+l[7]|0,f[2]=l[2]+(l[1]<<16|l[1]>>>16)+(l[0]<<16|l[0]>>>16)|0,f[3]=l[3]+(l[2]<<8|l[2]>>>24)+l[1]|0,f[4]=l[4]+(l[3]<<16|l[3]>>>16)+(l[2]<<16|l[2]>>>16)|0,f[5]=l[5]+(l[4]<<8|l[4]>>>24)+l[3]|0,f[6]=l[6]+(l[5]<<16|l[5]>>>16)+(l[4]<<16|l[4]>>>16)|0,f[7]=l[7]+(l[6]<<8|l[6]>>>24)+l[5]|0}r.RabbitLegacy=i._createHelper(u)}(),t.RabbitLegacy})}(ph)),ph.exports}var gh={exports:{}},ip;function pk(){return ip||(ip=1,function(n,e){(function(t,r,s){n.exports=r(me(),Ms(),Os(),is(),vt())})(fe,function(t){return function(){var r=t,s=r.lib,i=s.BlockCipher,o=r.algo;const a=16,c=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],l=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var u={pbox:[],sbox:[]};function d(x,D){let S=D>>24&255,_=D>>16&255,E=D>>8&255,B=D&255,F=x.sbox[0][S]+x.sbox[1][_];return F=F^x.sbox[2][E],F=F+x.sbox[3][B],F}function f(x,D,S){let _=D,E=S,B;for(let F=0;F<a;++F)_=_^x.pbox[F],E=d(x,_)^E,B=_,_=E,E=B;return B=_,_=E,E=B,E=E^x.pbox[a],_=_^x.pbox[a+1],{left:_,right:E}}function m(x,D,S){let _=D,E=S,B;for(let F=a+1;F>1;--F)_=_^x.pbox[F],E=d(x,_)^E,B=_,_=E,E=B;return B=_,_=E,E=B,E=E^x.pbox[1],_=_^x.pbox[0],{left:_,right:E}}function y(x,D,S){for(let A=0;A<4;A++){x.sbox[A]=[];for(let w=0;w<256;w++)x.sbox[A][w]=l[A][w]}let _=0;for(let A=0;A<a+2;A++)x.pbox[A]=c[A]^D[_],_++,_>=S&&(_=0);let E=0,B=0,F=0;for(let A=0;A<a+2;A+=2)F=f(x,E,B),E=F.left,B=F.right,x.pbox[A]=E,x.pbox[A+1]=B;for(let A=0;A<4;A++)for(let w=0;w<256;w+=2)F=f(x,E,B),E=F.left,B=F.right,x.sbox[A][w]=E,x.sbox[A][w+1]=B;return!0}var b=o.Blowfish=i.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var x=this._keyPriorReset=this._key,D=x.words,S=x.sigBytes/4;y(u,D,S)}},encryptBlock:function(x,D){var S=f(u,x[D],x[D+1]);x[D]=S.left,x[D+1]=S.right},decryptBlock:function(x,D){var S=m(u,x[D],x[D+1]);x[D]=S.left,x[D+1]=S.right},blockSize:64/32,keySize:128/32,ivSize:64/32});r.Blowfish=i._createHelper(b)}(),t.Blowfish})}(gh)),gh.exports}(function(n,e){(function(t,r,s){n.exports=r(me(),m0(),zI(),KI(),Ms(),jI(),Os(),c7(),sf(),GI(),l7(),WI(),QI(),YI(),of(),XI(),is(),vt(),JI(),ZI(),ek(),tk(),rk(),nk(),sk(),ik(),ok(),ak(),ck(),lk(),uk(),hk(),dk(),fk(),pk())})(fe,function(t){return t})})(a7);var gk=a7.exports;const Pe=qi(gk),mk={apiKey:"AIzaSyBrdrwvY-lPObZgortEgw7YWycUOGsBlyM",authDomain:"dcrypt-edb9c.firebaseapp.com",projectId:"dcrypt-edb9c",storageBucket:"dcrypt-edb9c.firebasestorage.app",messagingSenderId:"952133736604",appId:"1:952133736604:web:32d799360f200bce84f559",measurementId:"G-7KCDLQ6JNH"},af=Oy(mk),yk=My(af),xk=Dy(af),u7=Ny(af),vk=Object.freeze(Object.defineProperty({__proto__:null,auth:xk,db:u7,storage:yk},Symbol.toStringTag,{value:"Module"})),bk=()=>{};var op={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h7=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},wk=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],o=n[t++],a=n[t++],c=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const i=n[t++],o=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},d7={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],o=s+1<n.length,a=o?n[s+1]:0,c=s+2<n.length,l=c?n[s+2]:0,u=i>>2,d=(i&3)<<4|a>>4;let f=(a&15)<<2|l>>6,m=l&63;c||(m=64,o||(f=64)),r.push(t[u],t[d],t[f],t[m])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(h7(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):wk(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const l=s<n.length?t[n.charAt(s)]:64;++s;const d=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||a==null||l==null||d==null)throw new _k;const f=i<<2|a>>4;if(r.push(f),l!==64){const m=a<<4&240|l>>2;if(r.push(m),d!==64){const y=l<<6&192|d;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class _k extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ek=function(n){const e=h7(n);return d7.encodeByteArray(e,!0)},f7=function(n){return Ek(n).replace(/\./g,"")},Ak=function(n){try{return d7.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ck(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk=()=>Ck().__FIREBASE_DEFAULTS__,Tk=()=>{if(typeof process>"u"||typeof op>"u")return;const n=op.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ik=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Ak(n[1]);return e&&JSON.parse(e)},kk=()=>{try{return bk()||Sk()||Tk()||Ik()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pk(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Dk(){var n;const e=(n=kk())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Rk(){return!Dk()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Bk(){try{return typeof indexedDB=="object"}catch{return!1}}function Fk(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk="FirebaseError";class Wi extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Nk,Object.setPrototypeOf(this,Wi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,p7.prototype.create)}}class p7{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?Lk(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Wi(s,a,r)}}function Lk(n,e){return n.replace(Mk,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const Mk=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ok(n){return n&&n._delegate?n._delegate:n}class Ml{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var xe;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(xe||(xe={}));const Vk={debug:xe.DEBUG,verbose:xe.VERBOSE,info:xe.INFO,warn:xe.WARN,error:xe.ERROR,silent:xe.SILENT},Uk=xe.INFO,$k={[xe.DEBUG]:"log",[xe.VERBOSE]:"log",[xe.INFO]:"info",[xe.WARN]:"warn",[xe.ERROR]:"error"},Hk=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=$k[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class g7{constructor(e){this.name=e,this._logLevel=Uk,this._logHandler=Hk,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in xe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Vk[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,xe.DEBUG,...e),this._logHandler(this,xe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,xe.VERBOSE,...e),this._logHandler(this,xe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,xe.INFO,...e),this._logHandler(this,xe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,xe.WARN,...e),this._logHandler(this,xe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,xe.ERROR,...e),this._logHandler(this,xe.ERROR,...e)}}const qk=(n,e)=>e.some(t=>n instanceof t);let ap,cp;function zk(){return ap||(ap=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Kk(){return cp||(cp=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const m7=new WeakMap,S1=new WeakMap,y7=new WeakMap,mh=new WeakMap,cf=new WeakMap;function jk(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(zn(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&m7.set(t,n)}).catch(()=>{}),cf.set(e,n),e}function Gk(n){if(S1.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});S1.set(n,e)}let T1={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return S1.get(n);if(e==="objectStoreNames")return n.objectStoreNames||y7.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return zn(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Wk(n){T1=n(T1)}function Qk(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(yh(this),e,...t);return y7.set(r,e.sort?e.sort():[e]),zn(r)}:Kk().includes(n)?function(...e){return n.apply(yh(this),e),zn(m7.get(this))}:function(...e){return zn(n.apply(yh(this),e))}}function Yk(n){return typeof n=="function"?Qk(n):(n instanceof IDBTransaction&&Gk(n),qk(n,zk())?new Proxy(n,T1):n)}function zn(n){if(n instanceof IDBRequest)return jk(n);if(mh.has(n))return mh.get(n);const e=Yk(n);return e!==n&&(mh.set(n,e),cf.set(e,n)),e}const yh=n=>cf.get(n);function Xk(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=zn(o);return r&&o.addEventListener("upgradeneeded",c=>{r(zn(o.result),c.oldVersion,c.newVersion,zn(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const Jk=["get","getKey","getAll","getAllKeys","count"],Zk=["put","add","delete","clear"],xh=new Map;function lp(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(xh.get(e))return xh.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=Zk.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Jk.includes(t)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[t](...a),s&&c.done]))[0]};return xh.set(e,i),i}Wk(n=>({...n,get:(e,t,r)=>lp(e,t)||n.get(e,t,r),has:(e,t)=>!!lp(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eP{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(tP(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function tP(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const I1="@firebase/app",up="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yn=new g7("@firebase/app"),rP="@firebase/app-compat",nP="@firebase/analytics-compat",sP="@firebase/analytics",iP="@firebase/app-check-compat",oP="@firebase/app-check",aP="@firebase/auth",cP="@firebase/auth-compat",lP="@firebase/database",uP="@firebase/data-connect",hP="@firebase/database-compat",dP="@firebase/functions",fP="@firebase/functions-compat",pP="@firebase/installations",gP="@firebase/installations-compat",mP="@firebase/messaging",yP="@firebase/messaging-compat",xP="@firebase/performance",vP="@firebase/performance-compat",bP="@firebase/remote-config",wP="@firebase/remote-config-compat",_P="@firebase/storage",EP="@firebase/storage-compat",AP="@firebase/firestore",CP="@firebase/vertexai",SP="@firebase/firestore-compat",TP="firebase",IP="11.4.0",kP={[I1]:"fire-core",[rP]:"fire-core-compat",[sP]:"fire-analytics",[nP]:"fire-analytics-compat",[oP]:"fire-app-check",[iP]:"fire-app-check-compat",[aP]:"fire-auth",[cP]:"fire-auth-compat",[lP]:"fire-rtdb",[uP]:"fire-data-connect",[hP]:"fire-rtdb-compat",[dP]:"fire-fn",[fP]:"fire-fn-compat",[pP]:"fire-iid",[gP]:"fire-iid-compat",[mP]:"fire-fcm",[yP]:"fire-fcm-compat",[xP]:"fire-perf",[vP]:"fire-perf-compat",[bP]:"fire-rc",[wP]:"fire-rc-compat",[_P]:"fire-gcs",[EP]:"fire-gcs-compat",[AP]:"fire-fst",[SP]:"fire-fst-compat",[CP]:"fire-vertex","fire-js":"fire-js",[TP]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP=new Map,DP=new Map,hp=new Map;function dp(n,e){try{n.container.addComponent(e)}catch(t){yn.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Ol(n){const e=n.name;if(hp.has(e))return yn.debug(`There were multiple attempts to register component ${e}.`),!1;hp.set(e,n);for(const t of PP.values())dp(t,n);for(const t of DP.values())dp(t,n);return!0}function RP(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},lf=new p7("app","Firebase",BP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FP=IP;function No(n,e,t){var r;let s=(r=kP[n])!==null&&r!==void 0?r:n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const a=[`Unable to register library "${s}" with version "${e}":`];i&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),yn.warn(a.join(" "));return}Ol(new Ml(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NP="firebase-heartbeat-database",LP=1,ca="firebase-heartbeat-store";let vh=null;function x7(){return vh||(vh=Xk(NP,LP,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(ca)}catch(t){console.warn(t)}}}}).catch(n=>{throw lf.create("idb-open",{originalErrorMessage:n.message})})),vh}async function MP(n){try{const t=(await x7()).transaction(ca),r=await t.objectStore(ca).get(v7(n));return await t.done,r}catch(e){if(e instanceof Wi)yn.warn(e.message);else{const t=lf.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});yn.warn(t.message)}}}async function fp(n,e){try{const r=(await x7()).transaction(ca,"readwrite");await r.objectStore(ca).put(e,v7(n)),await r.done}catch(t){if(t instanceof Wi)yn.warn(t.message);else{const r=lf.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});yn.warn(r.message)}}}function v7(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OP=1024,VP=30;class UP{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new HP(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=pp();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>VP){const o=qP(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){yn.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=pp(),{heartbeatsToSend:r,unsentEntries:s}=$P(this._heartbeatsCache.heartbeats),i=f7(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return yn.warn(t),""}}}function pp(){return new Date().toISOString().substring(0,10)}function $P(n,e=OP){const t=[];let r=n.slice();for(const s of n){const i=t.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),gp(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),gp(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class HP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Bk()?Fk().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await MP(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return fp(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return fp(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function gp(n){return f7(JSON.stringify({version:2,heartbeats:n})).length}function qP(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zP(n){Ol(new Ml("platform-logger",e=>new eP(e),"PRIVATE")),Ol(new Ml("heartbeat",e=>new UP(e),"PRIVATE")),No(I1,up,n),No(I1,up,"esm2017"),No("fire-js","")}zP("");var mp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Kn,b7;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(A,w){function k(){}k.prototype=w.prototype,A.D=w.prototype,A.prototype=new k,A.prototype.constructor=A,A.C=function(C,I,R){for(var T=Array(arguments.length-2),G=2;G<arguments.length;G++)T[G-2]=arguments[G];return w.prototype[I].apply(C,T)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(A,w,k){k||(k=0);var C=Array(16);if(typeof w=="string")for(var I=0;16>I;++I)C[I]=w.charCodeAt(k++)|w.charCodeAt(k++)<<8|w.charCodeAt(k++)<<16|w.charCodeAt(k++)<<24;else for(I=0;16>I;++I)C[I]=w[k++]|w[k++]<<8|w[k++]<<16|w[k++]<<24;w=A.g[0],k=A.g[1],I=A.g[2];var R=A.g[3],T=w+(R^k&(I^R))+C[0]+3614090360&4294967295;w=k+(T<<7&4294967295|T>>>25),T=R+(I^w&(k^I))+C[1]+3905402710&4294967295,R=w+(T<<12&4294967295|T>>>20),T=I+(k^R&(w^k))+C[2]+606105819&4294967295,I=R+(T<<17&4294967295|T>>>15),T=k+(w^I&(R^w))+C[3]+3250441966&4294967295,k=I+(T<<22&4294967295|T>>>10),T=w+(R^k&(I^R))+C[4]+4118548399&4294967295,w=k+(T<<7&4294967295|T>>>25),T=R+(I^w&(k^I))+C[5]+1200080426&4294967295,R=w+(T<<12&4294967295|T>>>20),T=I+(k^R&(w^k))+C[6]+2821735955&4294967295,I=R+(T<<17&4294967295|T>>>15),T=k+(w^I&(R^w))+C[7]+4249261313&4294967295,k=I+(T<<22&4294967295|T>>>10),T=w+(R^k&(I^R))+C[8]+1770035416&4294967295,w=k+(T<<7&4294967295|T>>>25),T=R+(I^w&(k^I))+C[9]+2336552879&4294967295,R=w+(T<<12&4294967295|T>>>20),T=I+(k^R&(w^k))+C[10]+4294925233&4294967295,I=R+(T<<17&4294967295|T>>>15),T=k+(w^I&(R^w))+C[11]+2304563134&4294967295,k=I+(T<<22&4294967295|T>>>10),T=w+(R^k&(I^R))+C[12]+1804603682&4294967295,w=k+(T<<7&4294967295|T>>>25),T=R+(I^w&(k^I))+C[13]+4254626195&4294967295,R=w+(T<<12&4294967295|T>>>20),T=I+(k^R&(w^k))+C[14]+2792965006&4294967295,I=R+(T<<17&4294967295|T>>>15),T=k+(w^I&(R^w))+C[15]+1236535329&4294967295,k=I+(T<<22&4294967295|T>>>10),T=w+(I^R&(k^I))+C[1]+4129170786&4294967295,w=k+(T<<5&4294967295|T>>>27),T=R+(k^I&(w^k))+C[6]+3225465664&4294967295,R=w+(T<<9&4294967295|T>>>23),T=I+(w^k&(R^w))+C[11]+643717713&4294967295,I=R+(T<<14&4294967295|T>>>18),T=k+(R^w&(I^R))+C[0]+3921069994&4294967295,k=I+(T<<20&4294967295|T>>>12),T=w+(I^R&(k^I))+C[5]+3593408605&4294967295,w=k+(T<<5&4294967295|T>>>27),T=R+(k^I&(w^k))+C[10]+38016083&4294967295,R=w+(T<<9&4294967295|T>>>23),T=I+(w^k&(R^w))+C[15]+3634488961&4294967295,I=R+(T<<14&4294967295|T>>>18),T=k+(R^w&(I^R))+C[4]+3889429448&4294967295,k=I+(T<<20&4294967295|T>>>12),T=w+(I^R&(k^I))+C[9]+568446438&4294967295,w=k+(T<<5&4294967295|T>>>27),T=R+(k^I&(w^k))+C[14]+3275163606&4294967295,R=w+(T<<9&4294967295|T>>>23),T=I+(w^k&(R^w))+C[3]+4107603335&4294967295,I=R+(T<<14&4294967295|T>>>18),T=k+(R^w&(I^R))+C[8]+1163531501&4294967295,k=I+(T<<20&4294967295|T>>>12),T=w+(I^R&(k^I))+C[13]+2850285829&4294967295,w=k+(T<<5&4294967295|T>>>27),T=R+(k^I&(w^k))+C[2]+4243563512&4294967295,R=w+(T<<9&4294967295|T>>>23),T=I+(w^k&(R^w))+C[7]+1735328473&4294967295,I=R+(T<<14&4294967295|T>>>18),T=k+(R^w&(I^R))+C[12]+2368359562&4294967295,k=I+(T<<20&4294967295|T>>>12),T=w+(k^I^R)+C[5]+4294588738&4294967295,w=k+(T<<4&4294967295|T>>>28),T=R+(w^k^I)+C[8]+2272392833&4294967295,R=w+(T<<11&4294967295|T>>>21),T=I+(R^w^k)+C[11]+1839030562&4294967295,I=R+(T<<16&4294967295|T>>>16),T=k+(I^R^w)+C[14]+4259657740&4294967295,k=I+(T<<23&4294967295|T>>>9),T=w+(k^I^R)+C[1]+2763975236&4294967295,w=k+(T<<4&4294967295|T>>>28),T=R+(w^k^I)+C[4]+1272893353&4294967295,R=w+(T<<11&4294967295|T>>>21),T=I+(R^w^k)+C[7]+4139469664&4294967295,I=R+(T<<16&4294967295|T>>>16),T=k+(I^R^w)+C[10]+3200236656&4294967295,k=I+(T<<23&4294967295|T>>>9),T=w+(k^I^R)+C[13]+681279174&4294967295,w=k+(T<<4&4294967295|T>>>28),T=R+(w^k^I)+C[0]+3936430074&4294967295,R=w+(T<<11&4294967295|T>>>21),T=I+(R^w^k)+C[3]+3572445317&4294967295,I=R+(T<<16&4294967295|T>>>16),T=k+(I^R^w)+C[6]+76029189&4294967295,k=I+(T<<23&4294967295|T>>>9),T=w+(k^I^R)+C[9]+3654602809&4294967295,w=k+(T<<4&4294967295|T>>>28),T=R+(w^k^I)+C[12]+3873151461&4294967295,R=w+(T<<11&4294967295|T>>>21),T=I+(R^w^k)+C[15]+530742520&4294967295,I=R+(T<<16&4294967295|T>>>16),T=k+(I^R^w)+C[2]+3299628645&4294967295,k=I+(T<<23&4294967295|T>>>9),T=w+(I^(k|~R))+C[0]+4096336452&4294967295,w=k+(T<<6&4294967295|T>>>26),T=R+(k^(w|~I))+C[7]+1126891415&4294967295,R=w+(T<<10&4294967295|T>>>22),T=I+(w^(R|~k))+C[14]+2878612391&4294967295,I=R+(T<<15&4294967295|T>>>17),T=k+(R^(I|~w))+C[5]+4237533241&4294967295,k=I+(T<<21&4294967295|T>>>11),T=w+(I^(k|~R))+C[12]+1700485571&4294967295,w=k+(T<<6&4294967295|T>>>26),T=R+(k^(w|~I))+C[3]+2399980690&4294967295,R=w+(T<<10&4294967295|T>>>22),T=I+(w^(R|~k))+C[10]+4293915773&4294967295,I=R+(T<<15&4294967295|T>>>17),T=k+(R^(I|~w))+C[1]+2240044497&4294967295,k=I+(T<<21&4294967295|T>>>11),T=w+(I^(k|~R))+C[8]+1873313359&4294967295,w=k+(T<<6&4294967295|T>>>26),T=R+(k^(w|~I))+C[15]+4264355552&4294967295,R=w+(T<<10&4294967295|T>>>22),T=I+(w^(R|~k))+C[6]+2734768916&4294967295,I=R+(T<<15&4294967295|T>>>17),T=k+(R^(I|~w))+C[13]+1309151649&4294967295,k=I+(T<<21&4294967295|T>>>11),T=w+(I^(k|~R))+C[4]+4149444226&4294967295,w=k+(T<<6&4294967295|T>>>26),T=R+(k^(w|~I))+C[11]+3174756917&4294967295,R=w+(T<<10&4294967295|T>>>22),T=I+(w^(R|~k))+C[2]+718787259&4294967295,I=R+(T<<15&4294967295|T>>>17),T=k+(R^(I|~w))+C[9]+3951481745&4294967295,A.g[0]=A.g[0]+w&4294967295,A.g[1]=A.g[1]+(I+(T<<21&4294967295|T>>>11))&4294967295,A.g[2]=A.g[2]+I&4294967295,A.g[3]=A.g[3]+R&4294967295}r.prototype.u=function(A,w){w===void 0&&(w=A.length);for(var k=w-this.blockSize,C=this.B,I=this.h,R=0;R<w;){if(I==0)for(;R<=k;)s(this,A,R),R+=this.blockSize;if(typeof A=="string"){for(;R<w;)if(C[I++]=A.charCodeAt(R++),I==this.blockSize){s(this,C),I=0;break}}else for(;R<w;)if(C[I++]=A[R++],I==this.blockSize){s(this,C),I=0;break}}this.h=I,this.o+=w},r.prototype.v=function(){var A=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);A[0]=128;for(var w=1;w<A.length-8;++w)A[w]=0;var k=8*this.o;for(w=A.length-8;w<A.length;++w)A[w]=k&255,k/=256;for(this.u(A),A=Array(16),w=k=0;4>w;++w)for(var C=0;32>C;C+=8)A[k++]=this.g[w]>>>C&255;return A};function i(A,w){var k=a;return Object.prototype.hasOwnProperty.call(k,A)?k[A]:k[A]=w(A)}function o(A,w){this.h=w;for(var k=[],C=!0,I=A.length-1;0<=I;I--){var R=A[I]|0;C&&R==w||(k[I]=R,C=!1)}this.g=k}var a={};function c(A){return-128<=A&&128>A?i(A,function(w){return new o([w|0],0>w?-1:0)}):new o([A|0],0>A?-1:0)}function l(A){if(isNaN(A)||!isFinite(A))return d;if(0>A)return x(l(-A));for(var w=[],k=1,C=0;A>=k;C++)w[C]=A/k|0,k*=4294967296;return new o(w,0)}function u(A,w){if(A.length==0)throw Error("number format error: empty string");if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(A.charAt(0)=="-")return x(u(A.substring(1),w));if(0<=A.indexOf("-"))throw Error('number format error: interior "-" character');for(var k=l(Math.pow(w,8)),C=d,I=0;I<A.length;I+=8){var R=Math.min(8,A.length-I),T=parseInt(A.substring(I,I+R),w);8>R?(R=l(Math.pow(w,R)),C=C.j(R).add(l(T))):(C=C.j(k),C=C.add(l(T)))}return C}var d=c(0),f=c(1),m=c(16777216);n=o.prototype,n.m=function(){if(b(this))return-x(this).m();for(var A=0,w=1,k=0;k<this.g.length;k++){var C=this.i(k);A+=(0<=C?C:4294967296+C)*w,w*=4294967296}return A},n.toString=function(A){if(A=A||10,2>A||36<A)throw Error("radix out of range: "+A);if(y(this))return"0";if(b(this))return"-"+x(this).toString(A);for(var w=l(Math.pow(A,6)),k=this,C="";;){var I=E(k,w).g;k=D(k,I.j(w));var R=((0<k.g.length?k.g[0]:k.h)>>>0).toString(A);if(k=I,y(k))return R+C;for(;6>R.length;)R="0"+R;C=R+C}},n.i=function(A){return 0>A?0:A<this.g.length?this.g[A]:this.h};function y(A){if(A.h!=0)return!1;for(var w=0;w<A.g.length;w++)if(A.g[w]!=0)return!1;return!0}function b(A){return A.h==-1}n.l=function(A){return A=D(this,A),b(A)?-1:y(A)?0:1};function x(A){for(var w=A.g.length,k=[],C=0;C<w;C++)k[C]=~A.g[C];return new o(k,~A.h).add(f)}n.abs=function(){return b(this)?x(this):this},n.add=function(A){for(var w=Math.max(this.g.length,A.g.length),k=[],C=0,I=0;I<=w;I++){var R=C+(this.i(I)&65535)+(A.i(I)&65535),T=(R>>>16)+(this.i(I)>>>16)+(A.i(I)>>>16);C=T>>>16,R&=65535,T&=65535,k[I]=T<<16|R}return new o(k,k[k.length-1]&-2147483648?-1:0)};function D(A,w){return A.add(x(w))}n.j=function(A){if(y(this)||y(A))return d;if(b(this))return b(A)?x(this).j(x(A)):x(x(this).j(A));if(b(A))return x(this.j(x(A)));if(0>this.l(m)&&0>A.l(m))return l(this.m()*A.m());for(var w=this.g.length+A.g.length,k=[],C=0;C<2*w;C++)k[C]=0;for(C=0;C<this.g.length;C++)for(var I=0;I<A.g.length;I++){var R=this.i(C)>>>16,T=this.i(C)&65535,G=A.i(I)>>>16,H=A.i(I)&65535;k[2*C+2*I]+=T*H,S(k,2*C+2*I),k[2*C+2*I+1]+=R*H,S(k,2*C+2*I+1),k[2*C+2*I+1]+=T*G,S(k,2*C+2*I+1),k[2*C+2*I+2]+=R*G,S(k,2*C+2*I+2)}for(C=0;C<w;C++)k[C]=k[2*C+1]<<16|k[2*C];for(C=w;C<2*w;C++)k[C]=0;return new o(k,0)};function S(A,w){for(;(A[w]&65535)!=A[w];)A[w+1]+=A[w]>>>16,A[w]&=65535,w++}function _(A,w){this.g=A,this.h=w}function E(A,w){if(y(w))throw Error("division by zero");if(y(A))return new _(d,d);if(b(A))return w=E(x(A),w),new _(x(w.g),x(w.h));if(b(w))return w=E(A,x(w)),new _(x(w.g),w.h);if(30<A.g.length){if(b(A)||b(w))throw Error("slowDivide_ only works with positive integers.");for(var k=f,C=w;0>=C.l(A);)k=B(k),C=B(C);var I=F(k,1),R=F(C,1);for(C=F(C,2),k=F(k,2);!y(C);){var T=R.add(C);0>=T.l(A)&&(I=I.add(k),R=T),C=F(C,1),k=F(k,1)}return w=D(A,I.j(w)),new _(I,w)}for(I=d;0<=A.l(w);){for(k=Math.max(1,Math.floor(A.m()/w.m())),C=Math.ceil(Math.log(k)/Math.LN2),C=48>=C?1:Math.pow(2,C-48),R=l(k),T=R.j(w);b(T)||0<T.l(A);)k-=C,R=l(k),T=R.j(w);y(R)&&(R=f),I=I.add(R),A=D(A,T)}return new _(I,A)}n.A=function(A){return E(this,A).h},n.and=function(A){for(var w=Math.max(this.g.length,A.g.length),k=[],C=0;C<w;C++)k[C]=this.i(C)&A.i(C);return new o(k,this.h&A.h)},n.or=function(A){for(var w=Math.max(this.g.length,A.g.length),k=[],C=0;C<w;C++)k[C]=this.i(C)|A.i(C);return new o(k,this.h|A.h)},n.xor=function(A){for(var w=Math.max(this.g.length,A.g.length),k=[],C=0;C<w;C++)k[C]=this.i(C)^A.i(C);return new o(k,this.h^A.h)};function B(A){for(var w=A.g.length+1,k=[],C=0;C<w;C++)k[C]=A.i(C)<<1|A.i(C-1)>>>31;return new o(k,A.h)}function F(A,w){var k=w>>5;w%=32;for(var C=A.g.length-k,I=[],R=0;R<C;R++)I[R]=0<w?A.i(R+k)>>>w|A.i(R+k+1)<<32-w:A.i(R+k);return new o(I,A.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,b7=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=u,Kn=o}).apply(typeof mp<"u"?mp:typeof self<"u"?self:typeof window<"u"?window:{});var kc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var w7,To,_7,el,k1,E7,A7,C7;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(h,g,v){return h==Array.prototype||h==Object.prototype||(h[g]=v.value),h};function t(h){h=[typeof globalThis=="object"&&globalThis,h,typeof window=="object"&&window,typeof self=="object"&&self,typeof kc=="object"&&kc];for(var g=0;g<h.length;++g){var v=h[g];if(v&&v.Math==Math)return v}throw Error("Cannot find global object")}var r=t(this);function s(h,g){if(g)e:{var v=r;h=h.split(".");for(var P=0;P<h.length-1;P++){var L=h[P];if(!(L in v))break e;v=v[L]}h=h[h.length-1],P=v[h],g=g(P),g!=P&&g!=null&&e(v,h,{configurable:!0,writable:!0,value:g})}}function i(h,g){h instanceof String&&(h+="");var v=0,P=!1,L={next:function(){if(!P&&v<h.length){var $=v++;return{value:g($,h[$]),done:!1}}return P=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}s("Array.prototype.values",function(h){return h||function(){return i(this,function(g,v){return v})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function c(h){var g=typeof h;return g=g!="object"?g:h?Array.isArray(h)?"array":g:"null",g=="array"||g=="object"&&typeof h.length=="number"}function l(h){var g=typeof h;return g=="object"&&h!=null||g=="function"}function u(h,g,v){return h.call.apply(h.bind,arguments)}function d(h,g,v){if(!h)throw Error();if(2<arguments.length){var P=Array.prototype.slice.call(arguments,2);return function(){var L=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(L,P),h.apply(g,L)}}return function(){return h.apply(g,arguments)}}function f(h,g,v){return f=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?u:d,f.apply(null,arguments)}function m(h,g){var v=Array.prototype.slice.call(arguments,1);return function(){var P=v.slice();return P.push.apply(P,arguments),h.apply(this,P)}}function y(h,g){function v(){}v.prototype=g.prototype,h.aa=g.prototype,h.prototype=new v,h.prototype.constructor=h,h.Qb=function(P,L,$){for(var Q=Array(arguments.length-2),Oe=2;Oe<arguments.length;Oe++)Q[Oe-2]=arguments[Oe];return g.prototype[L].apply(P,Q)}}function b(h){const g=h.length;if(0<g){const v=Array(g);for(let P=0;P<g;P++)v[P]=h[P];return v}return[]}function x(h,g){for(let v=1;v<arguments.length;v++){const P=arguments[v];if(c(P)){const L=h.length||0,$=P.length||0;h.length=L+$;for(let Q=0;Q<$;Q++)h[L+Q]=P[Q]}else h.push(P)}}class D{constructor(g,v){this.i=g,this.j=v,this.h=0,this.g=null}get(){let g;return 0<this.h?(this.h--,g=this.g,this.g=g.next,g.next=null):g=this.i(),g}}function S(h){return/^[\s\xa0]*$/.test(h)}function _(){var h=a.navigator;return h&&(h=h.userAgent)?h:""}function E(h){return E[" "](h),h}E[" "]=function(){};var B=_().indexOf("Gecko")!=-1&&!(_().toLowerCase().indexOf("webkit")!=-1&&_().indexOf("Edge")==-1)&&!(_().indexOf("Trident")!=-1||_().indexOf("MSIE")!=-1)&&_().indexOf("Edge")==-1;function F(h,g,v){for(const P in h)g.call(v,h[P],P,h)}function A(h,g){for(const v in h)g.call(void 0,h[v],v,h)}function w(h){const g={};for(const v in h)g[v]=h[v];return g}const k="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function C(h,g){let v,P;for(let L=1;L<arguments.length;L++){P=arguments[L];for(v in P)h[v]=P[v];for(let $=0;$<k.length;$++)v=k[$],Object.prototype.hasOwnProperty.call(P,v)&&(h[v]=P[v])}}function I(h){var g=1;h=h.split(":");const v=[];for(;0<g&&h.length;)v.push(h.shift()),g--;return h.length&&v.push(h.join(":")),v}function R(h){a.setTimeout(()=>{throw h},0)}function T(){var h=O;let g=null;return h.g&&(g=h.g,h.g=h.g.next,h.g||(h.h=null),g.next=null),g}class G{constructor(){this.h=this.g=null}add(g,v){const P=H.get();P.set(g,v),this.h?this.h.next=P:this.g=P,this.h=P}}var H=new D(()=>new z,h=>h.reset());class z{constructor(){this.next=this.g=this.h=null}set(g,v){this.h=g,this.g=v,this.next=null}reset(){this.next=this.g=this.h=null}}let W,K=!1,O=new G,q=()=>{const h=a.Promise.resolve(void 0);W=()=>{h.then(N)}};var N=()=>{for(var h;h=T();){try{h.h.call(h.g)}catch(v){R(v)}var g=H;g.j(h),100>g.h&&(g.h++,h.next=g.g,g.g=h)}K=!1};function M(){this.s=this.s,this.C=this.C}M.prototype.s=!1,M.prototype.ma=function(){this.s||(this.s=!0,this.N())},M.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function V(h,g){this.type=h,this.g=this.target=g,this.defaultPrevented=!1}V.prototype.h=function(){this.defaultPrevented=!0};var U=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var h=!1,g=Object.defineProperty({},"passive",{get:function(){h=!0}});try{const v=()=>{};a.addEventListener("test",v,g),a.removeEventListener("test",v,g)}catch{}return h}();function ee(h,g){if(V.call(this,h?h.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,h){var v=this.type=h.type,P=h.changedTouches&&h.changedTouches.length?h.changedTouches[0]:null;if(this.target=h.target||h.srcElement,this.g=g,g=h.relatedTarget){if(B){e:{try{E(g.nodeName);var L=!0;break e}catch{}L=!1}L||(g=null)}}else v=="mouseover"?g=h.fromElement:v=="mouseout"&&(g=h.toElement);this.relatedTarget=g,P?(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0):(this.clientX=h.clientX!==void 0?h.clientX:h.pageX,this.clientY=h.clientY!==void 0?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0),this.button=h.button,this.key=h.key||"",this.ctrlKey=h.ctrlKey,this.altKey=h.altKey,this.shiftKey=h.shiftKey,this.metaKey=h.metaKey,this.pointerId=h.pointerId||0,this.pointerType=typeof h.pointerType=="string"?h.pointerType:ne[h.pointerType]||"",this.state=h.state,this.i=h,h.defaultPrevented&&ee.aa.h.call(this)}}y(ee,V);var ne={2:"touch",3:"pen",4:"mouse"};ee.prototype.h=function(){ee.aa.h.call(this);var h=this.i;h.preventDefault?h.preventDefault():h.returnValue=!1};var ae="closure_listenable_"+(1e6*Math.random()|0),re=0;function Be(h,g,v,P,L){this.listener=h,this.proxy=null,this.src=g,this.type=v,this.capture=!!P,this.ha=L,this.key=++re,this.da=this.fa=!1}function Fe(h){h.da=!0,h.listener=null,h.proxy=null,h.src=null,h.ha=null}function Ge(h){this.src=h,this.g={},this.h=0}Ge.prototype.add=function(h,g,v,P,L){var $=h.toString();h=this.g[$],h||(h=this.g[$]=[],this.h++);var Q=Ee(h,g,P,L);return-1<Q?(g=h[Q],v||(g.fa=!1)):(g=new Be(g,this.src,$,!!P,L),g.fa=v,h.push(g)),g};function Le(h,g){var v=g.type;if(v in h.g){var P=h.g[v],L=Array.prototype.indexOf.call(P,g,void 0),$;($=0<=L)&&Array.prototype.splice.call(P,L,1),$&&(Fe(g),h.g[v].length==0&&(delete h.g[v],h.h--))}}function Ee(h,g,v,P){for(var L=0;L<h.length;++L){var $=h[L];if(!$.da&&$.listener==g&&$.capture==!!v&&$.ha==P)return L}return-1}var Te="closure_lm_"+(1e6*Math.random()|0),ut={};function pt(h,g,v,P,L){if(Array.isArray(g)){for(var $=0;$<g.length;$++)pt(h,g[$],v,P,L);return null}return v=ro(v),h&&h[ae]?h.K(g,v,l(P)?!!P.capture:!1,L):Zr(h,g,v,!1,P,L)}function Zr(h,g,v,P,L,$){if(!g)throw Error("Invalid event type");var Q=l(L)?!!L.capture:!!L,Oe=xr(h);if(Oe||(h[Te]=Oe=new Ge(h)),v=Oe.add(g,v,P,Q,$),v.proxy)return v;if(P=en(),v.proxy=P,P.src=h,P.listener=v,h.addEventListener)U||(L=Q),L===void 0&&(L=!1),h.addEventListener(g.toString(),P,L);else if(h.attachEvent)h.attachEvent(Pt(g.toString()),P);else if(h.addListener&&h.removeListener)h.addListener(P);else throw Error("addEventListener and attachEvent are unavailable.");return v}function en(){function h(v){return g.call(h.src,h.listener,v)}const g=Jt;return h}function _n(h,g,v,P,L){if(Array.isArray(g))for(var $=0;$<g.length;$++)_n(h,g[$],v,P,L);else P=l(P)?!!P.capture:!!P,v=ro(v),h&&h[ae]?(h=h.i,g=String(g).toString(),g in h.g&&($=h.g[g],v=Ee($,v,P,L),-1<v&&(Fe($[v]),Array.prototype.splice.call($,v,1),$.length==0&&(delete h.g[g],h.h--)))):h&&(h=xr(h))&&(g=h.g[g.toString()],h=-1,g&&(h=Ee(g,v,P,L)),(v=-1<h?g[h]:null)&&Cr(v))}function Cr(h){if(typeof h!="number"&&h&&!h.da){var g=h.src;if(g&&g[ae])Le(g.i,h);else{var v=h.type,P=h.proxy;g.removeEventListener?g.removeEventListener(v,P,h.capture):g.detachEvent?g.detachEvent(Pt(v),P):g.addListener&&g.removeListener&&g.removeListener(P),(v=xr(g))?(Le(v,h),v.h==0&&(v.src=null,g[Te]=null)):Fe(h)}}}function Pt(h){return h in ut?ut[h]:ut[h]="on"+h}function Jt(h,g){if(h.da)h=!0;else{g=new ee(g,this);var v=h.listener,P=h.ha||h.src;h.fa&&Cr(h),h=v.call(P,g)}return h}function xr(h){return h=h[Te],h instanceof Ge?h:null}var En="__closure_events_fn_"+(1e9*Math.random()>>>0);function ro(h){return typeof h=="function"?h:(h[En]||(h[En]=function(g){return h.handleEvent(g)}),h[En])}function We(){M.call(this),this.i=new Ge(this),this.M=this,this.F=null}y(We,M),We.prototype[ae]=!0,We.prototype.removeEventListener=function(h,g,v,P){_n(this,h,g,v,P)};function st(h,g){var v,P=h.F;if(P)for(v=[];P;P=P.F)v.push(P);if(h=h.M,P=g.type||g,typeof g=="string")g=new V(g,h);else if(g instanceof V)g.target=g.target||h;else{var L=g;g=new V(P,h),C(g,L)}if(L=!0,v)for(var $=v.length-1;0<=$;$--){var Q=g.g=v[$];L=Hs(Q,P,!0,g)&&L}if(Q=g.g=h,L=Hs(Q,P,!0,g)&&L,L=Hs(Q,P,!1,g)&&L,v)for($=0;$<v.length;$++)Q=g.g=v[$],L=Hs(Q,P,!1,g)&&L}We.prototype.N=function(){if(We.aa.N.call(this),this.i){var h=this.i,g;for(g in h.g){for(var v=h.g[g],P=0;P<v.length;P++)Fe(v[P]);delete h.g[g],h.h--}}this.F=null},We.prototype.K=function(h,g,v,P){return this.i.add(String(h),g,!1,v,P)},We.prototype.L=function(h,g,v,P){return this.i.add(String(h),g,!0,v,P)};function Hs(h,g,v,P){if(g=h.i.g[String(g)],!g)return!0;g=g.concat();for(var L=!0,$=0;$<g.length;++$){var Q=g[$];if(Q&&!Q.da&&Q.capture==v){var Oe=Q.listener,wt=Q.ha||Q.src;Q.fa&&Le(h.i,Q),L=Oe.call(wt,P)!==!1&&L}}return L&&!P.defaultPrevented}function no(h,g,v){if(typeof h=="function")v&&(h=f(h,v));else if(h&&typeof h.handleEvent=="function")h=f(h.handleEvent,h);else throw Error("Invalid listener argument");return 2147483647<Number(g)?-1:a.setTimeout(h,g||0)}function so(h){h.g=no(()=>{h.g=null,h.i&&(h.i=!1,so(h))},h.l);const g=h.h;h.h=null,h.m.apply(null,g)}class An extends M{constructor(g,v){super(),this.m=g,this.l=v,this.h=null,this.i=!1,this.g=null}j(g){this.h=arguments,this.g?this.i=!0:so(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Sr(h){M.call(this),this.h=h,this.g={}}y(Sr,M);var ja=[];function io(h){F(h.g,function(g,v){this.g.hasOwnProperty(v)&&Cr(g)},h),h.g={}}Sr.prototype.N=function(){Sr.aa.N.call(this),io(this)},Sr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var qs=a.JSON.stringify,N0=a.JSON.parse,L0=class{stringify(h){return a.JSON.stringify(h,void 0)}parse(h){return a.JSON.parse(h,void 0)}};function zs(){}zs.prototype.h=null;function Ga(h){return h.h||(h.h=h.i())}function oo(){}var as={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ks(){V.call(this,"d")}y(Ks,V);function ao(){V.call(this,"c")}y(ao,V);var tn={},Wa=null;function cs(){return Wa=Wa||new We}tn.La="serverreachability";function Qa(h){V.call(this,tn.La,h)}y(Qa,V);function ls(h){const g=cs();st(g,new Qa(g))}tn.STAT_EVENT="statevent";function co(h,g){V.call(this,tn.STAT_EVENT,h),this.stat=g}y(co,V);function bt(h){const g=cs();st(g,new co(g,h))}tn.Ma="timingevent";function lo(h,g){V.call(this,tn.Ma,h),this.size=g}y(lo,V);function ht(h,g){if(typeof h!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){h()},g)}function Zt(){this.g=!0}Zt.prototype.xa=function(){this.g=!1};function Ya(h,g,v,P,L,$){h.info(function(){if(h.g)if($)for(var Q="",Oe=$.split("&"),wt=0;wt<Oe.length;wt++){var Ae=Oe[wt].split("=");if(1<Ae.length){var Dt=Ae[0];Ae=Ae[1];var Rt=Dt.split("_");Q=2<=Rt.length&&Rt[1]=="type"?Q+(Dt+"="+Ae+"&"):Q+(Dt+"=redacted&")}}else Q=null;else Q=$;return"XMLHTTP REQ ("+P+") [attempt "+L+"]: "+g+`
`+v+`
`+Q})}function M0(h,g,v,P,L,$,Q){h.info(function(){return"XMLHTTP RESP ("+P+") [ attempt "+L+"]: "+g+`
`+v+`
`+$+" "+Q})}function js(h,g,v,P){h.info(function(){return"XMLHTTP TEXT ("+g+"): "+ly(h,v)+(P?" "+P:"")})}function cy(h,g){h.info(function(){return"TIMEOUT: "+g})}Zt.prototype.info=function(){};function ly(h,g){if(!h.g)return g;if(!g)return null;try{var v=JSON.parse(g);if(v){for(h=0;h<v.length;h++)if(Array.isArray(v[h])){var P=v[h];if(!(2>P.length)){var L=P[1];if(Array.isArray(L)&&!(1>L.length)){var $=L[0];if($!="noop"&&$!="stop"&&$!="close")for(var Q=1;Q<L.length;Q++)L[Q]=""}}}}return qs(v)}catch{return g}}var Xa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Yf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},O0;function Ja(){}y(Ja,zs),Ja.prototype.g=function(){return new XMLHttpRequest},Ja.prototype.i=function(){return{}},O0=new Ja;function Cn(h,g,v,P){this.j=h,this.i=g,this.l=v,this.R=P||1,this.U=new Sr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Xf}function Xf(){this.i=null,this.g="",this.h=!1}var Jf={},V0={};function U0(h,g,v){h.L=1,h.v=rc(rn(g)),h.m=v,h.P=!0,Zf(h,null)}function Zf(h,g){h.F=Date.now(),Za(h),h.A=rn(h.v);var v=h.A,P=h.R;Array.isArray(P)||(P=[String(P)]),f2(v.i,"t",P),h.C=0,v=h.j.J,h.h=new Xf,h.g=D2(h.j,v?g:null,!h.m),0<h.O&&(h.M=new An(f(h.Y,h,h.g),h.O)),g=h.U,v=h.g,P=h.ca;var L="readystatechange";Array.isArray(L)||(L&&(ja[0]=L.toString()),L=ja);for(var $=0;$<L.length;$++){var Q=pt(v,L[$],P||g.handleEvent,!1,g.h||g);if(!Q)break;g.g[Q.key]=Q}g=h.H?w(h.H):{},h.m?(h.u||(h.u="POST"),g["Content-Type"]="application/x-www-form-urlencoded",h.g.ea(h.A,h.u,h.m,g)):(h.u="GET",h.g.ea(h.A,h.u,null,g)),ls(),Ya(h.i,h.u,h.A,h.l,h.R,h.m)}Cn.prototype.ca=function(h){h=h.target;const g=this.M;g&&nn(h)==3?g.j():this.Y(h)},Cn.prototype.Y=function(h){try{if(h==this.g)e:{const Rt=nn(this.g);var g=this.g.Ba();const Qs=this.g.Z();if(!(3>Rt)&&(Rt!=3||this.g&&(this.h.h||this.g.oa()||b2(this.g)))){this.J||Rt!=4||g==7||(g==8||0>=Qs?ls(3):ls(2)),$0(this);var v=this.g.Z();this.X=v;t:if(e2(this)){var P=b2(this.g);h="";var L=P.length,$=nn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){us(this),uo(this);var Q="";break t}this.h.i=new a.TextDecoder}for(g=0;g<L;g++)this.h.h=!0,h+=this.h.i.decode(P[g],{stream:!($&&g==L-1)});P.length=0,this.h.g+=h,this.C=0,Q=this.h.g}else Q=this.g.oa();if(this.o=v==200,M0(this.i,this.u,this.A,this.l,this.R,Rt,v),this.o){if(this.T&&!this.K){t:{if(this.g){var Oe,wt=this.g;if((Oe=wt.g?wt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(Oe)){var Ae=Oe;break t}}Ae=null}if(v=Ae)js(this.i,this.l,v,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,H0(this,v);else{this.o=!1,this.s=3,bt(12),us(this),uo(this);break e}}if(this.P){v=!0;let Tr;for(;!this.J&&this.C<Q.length;)if(Tr=uy(this,Q),Tr==V0){Rt==4&&(this.s=4,bt(14),v=!1),js(this.i,this.l,null,"[Incomplete Response]");break}else if(Tr==Jf){this.s=4,bt(15),js(this.i,this.l,Q,"[Invalid Chunk]"),v=!1;break}else js(this.i,this.l,Tr,null),H0(this,Tr);if(e2(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Rt!=4||Q.length!=0||this.h.h||(this.s=1,bt(16),v=!1),this.o=this.o&&v,!v)js(this.i,this.l,Q,"[Invalid Chunked Response]"),us(this),uo(this);else if(0<Q.length&&!this.W){this.W=!0;var Dt=this.j;Dt.g==this&&Dt.ba&&!Dt.M&&(Dt.j.info("Great, no buffering proxy detected. Bytes received: "+Q.length),W0(Dt),Dt.M=!0,bt(11))}}else js(this.i,this.l,Q,null),H0(this,Q);Rt==4&&us(this),this.o&&!this.J&&(Rt==4?T2(this.j,this):(this.o=!1,Za(this)))}else Ty(this.g),v==400&&0<Q.indexOf("Unknown SID")?(this.s=3,bt(12)):(this.s=0,bt(13)),us(this),uo(this)}}}catch{}finally{}};function e2(h){return h.g?h.u=="GET"&&h.L!=2&&h.j.Ca:!1}function uy(h,g){var v=h.C,P=g.indexOf(`
`,v);return P==-1?V0:(v=Number(g.substring(v,P)),isNaN(v)?Jf:(P+=1,P+v>g.length?V0:(g=g.slice(P,P+v),h.C=P+v,g)))}Cn.prototype.cancel=function(){this.J=!0,us(this)};function Za(h){h.S=Date.now()+h.I,t2(h,h.I)}function t2(h,g){if(h.B!=null)throw Error("WatchDog timer not null");h.B=ht(f(h.ba,h),g)}function $0(h){h.B&&(a.clearTimeout(h.B),h.B=null)}Cn.prototype.ba=function(){this.B=null;const h=Date.now();0<=h-this.S?(cy(this.i,this.A),this.L!=2&&(ls(),bt(17)),us(this),this.s=2,uo(this)):t2(this,this.S-h)};function uo(h){h.j.G==0||h.J||T2(h.j,h)}function us(h){$0(h);var g=h.M;g&&typeof g.ma=="function"&&g.ma(),h.M=null,io(h.U),h.g&&(g=h.g,h.g=null,g.abort(),g.ma())}function H0(h,g){try{var v=h.j;if(v.G!=0&&(v.g==h||q0(v.h,h))){if(!h.K&&q0(v.h,h)&&v.G==3){try{var P=v.Da.g.parse(g)}catch{P=null}if(Array.isArray(P)&&P.length==3){var L=P;if(L[0]==0){e:if(!v.u){if(v.g)if(v.g.F+3e3<h.F)cc(v),oc(v);else break e;G0(v),bt(18)}}else v.za=L[1],0<v.za-v.T&&37500>L[2]&&v.F&&v.v==0&&!v.C&&(v.C=ht(f(v.Za,v),6e3));if(1>=s2(v.h)&&v.ca){try{v.ca()}catch{}v.ca=void 0}}else ds(v,11)}else if((h.K||v.g==h)&&cc(v),!S(g))for(L=v.Da.g.parse(g),g=0;g<L.length;g++){let Ae=L[g];if(v.T=Ae[0],Ae=Ae[1],v.G==2)if(Ae[0]=="c"){v.K=Ae[1],v.ia=Ae[2];const Dt=Ae[3];Dt!=null&&(v.la=Dt,v.j.info("VER="+v.la));const Rt=Ae[4];Rt!=null&&(v.Aa=Rt,v.j.info("SVER="+v.Aa));const Qs=Ae[5];Qs!=null&&typeof Qs=="number"&&0<Qs&&(P=1.5*Qs,v.L=P,v.j.info("backChannelRequestTimeoutMs_="+P)),P=v;const Tr=h.g;if(Tr){const uc=Tr.g?Tr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(uc){var $=P.h;$.g||uc.indexOf("spdy")==-1&&uc.indexOf("quic")==-1&&uc.indexOf("h2")==-1||($.j=$.l,$.g=new Set,$.h&&(z0($,$.h),$.h=null))}if(P.D){const Q0=Tr.g?Tr.g.getResponseHeader("X-HTTP-Session-Id"):null;Q0&&(P.ya=Q0,He(P.I,P.D,Q0))}}v.G=3,v.l&&v.l.ua(),v.ba&&(v.R=Date.now()-h.F,v.j.info("Handshake RTT: "+v.R+"ms")),P=v;var Q=h;if(P.qa=P2(P,P.J?P.ia:null,P.W),Q.K){i2(P.h,Q);var Oe=Q,wt=P.L;wt&&(Oe.I=wt),Oe.B&&($0(Oe),Za(Oe)),P.g=Q}else C2(P);0<v.i.length&&ac(v)}else Ae[0]!="stop"&&Ae[0]!="close"||ds(v,7);else v.G==3&&(Ae[0]=="stop"||Ae[0]=="close"?Ae[0]=="stop"?ds(v,7):j0(v):Ae[0]!="noop"&&v.l&&v.l.ta(Ae),v.v=0)}}ls(4)}catch{}}var hy=class{constructor(h,g){this.g=h,this.map=g}};function r2(h){this.l=h||10,a.PerformanceNavigationTiming?(h=a.performance.getEntriesByType("navigation"),h=0<h.length&&(h[0].nextHopProtocol=="hq"||h[0].nextHopProtocol=="h2")):h=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=h?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function n2(h){return h.h?!0:h.g?h.g.size>=h.j:!1}function s2(h){return h.h?1:h.g?h.g.size:0}function q0(h,g){return h.h?h.h==g:h.g?h.g.has(g):!1}function z0(h,g){h.g?h.g.add(g):h.h=g}function i2(h,g){h.h&&h.h==g?h.h=null:h.g&&h.g.has(g)&&h.g.delete(g)}r2.prototype.cancel=function(){if(this.i=o2(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const h of this.g.values())h.cancel();this.g.clear()}};function o2(h){if(h.h!=null)return h.i.concat(h.h.D);if(h.g!=null&&h.g.size!==0){let g=h.i;for(const v of h.g.values())g=g.concat(v.D);return g}return b(h.i)}function dy(h){if(h.V&&typeof h.V=="function")return h.V();if(typeof Map<"u"&&h instanceof Map||typeof Set<"u"&&h instanceof Set)return Array.from(h.values());if(typeof h=="string")return h.split("");if(c(h)){for(var g=[],v=h.length,P=0;P<v;P++)g.push(h[P]);return g}g=[],v=0;for(P in h)g[v++]=h[P];return g}function fy(h){if(h.na&&typeof h.na=="function")return h.na();if(!h.V||typeof h.V!="function"){if(typeof Map<"u"&&h instanceof Map)return Array.from(h.keys());if(!(typeof Set<"u"&&h instanceof Set)){if(c(h)||typeof h=="string"){var g=[];h=h.length;for(var v=0;v<h;v++)g.push(v);return g}g=[],v=0;for(const P in h)g[v++]=P;return g}}}function a2(h,g){if(h.forEach&&typeof h.forEach=="function")h.forEach(g,void 0);else if(c(h)||typeof h=="string")Array.prototype.forEach.call(h,g,void 0);else for(var v=fy(h),P=dy(h),L=P.length,$=0;$<L;$++)g.call(void 0,P[$],v&&v[$],h)}var c2=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function py(h,g){if(h){h=h.split("&");for(var v=0;v<h.length;v++){var P=h[v].indexOf("="),L=null;if(0<=P){var $=h[v].substring(0,P);L=h[v].substring(P+1)}else $=h[v];g($,L?decodeURIComponent(L.replace(/\+/g," ")):"")}}}function hs(h){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,h instanceof hs){this.h=h.h,ec(this,h.j),this.o=h.o,this.g=h.g,tc(this,h.s),this.l=h.l;var g=h.i,v=new po;v.i=g.i,g.g&&(v.g=new Map(g.g),v.h=g.h),l2(this,v),this.m=h.m}else h&&(g=String(h).match(c2))?(this.h=!1,ec(this,g[1]||"",!0),this.o=ho(g[2]||""),this.g=ho(g[3]||"",!0),tc(this,g[4]),this.l=ho(g[5]||"",!0),l2(this,g[6]||"",!0),this.m=ho(g[7]||"")):(this.h=!1,this.i=new po(null,this.h))}hs.prototype.toString=function(){var h=[],g=this.j;g&&h.push(fo(g,u2,!0),":");var v=this.g;return(v||g=="file")&&(h.push("//"),(g=this.o)&&h.push(fo(g,u2,!0),"@"),h.push(encodeURIComponent(String(v)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),v=this.s,v!=null&&h.push(":",String(v))),(v=this.l)&&(this.g&&v.charAt(0)!="/"&&h.push("/"),h.push(fo(v,v.charAt(0)=="/"?yy:my,!0))),(v=this.i.toString())&&h.push("?",v),(v=this.m)&&h.push("#",fo(v,vy)),h.join("")};function rn(h){return new hs(h)}function ec(h,g,v){h.j=v?ho(g,!0):g,h.j&&(h.j=h.j.replace(/:$/,""))}function tc(h,g){if(g){if(g=Number(g),isNaN(g)||0>g)throw Error("Bad port number "+g);h.s=g}else h.s=null}function l2(h,g,v){g instanceof po?(h.i=g,by(h.i,h.h)):(v||(g=fo(g,xy)),h.i=new po(g,h.h))}function He(h,g,v){h.i.set(g,v)}function rc(h){return He(h,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),h}function ho(h,g){return h?g?decodeURI(h.replace(/%25/g,"%2525")):decodeURIComponent(h):""}function fo(h,g,v){return typeof h=="string"?(h=encodeURI(h).replace(g,gy),v&&(h=h.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h):null}function gy(h){return h=h.charCodeAt(0),"%"+(h>>4&15).toString(16)+(h&15).toString(16)}var u2=/[#\/\?@]/g,my=/[#\?:]/g,yy=/[#\?]/g,xy=/[#\?@]/g,vy=/#/g;function po(h,g){this.h=this.g=null,this.i=h||null,this.j=!!g}function Sn(h){h.g||(h.g=new Map,h.h=0,h.i&&py(h.i,function(g,v){h.add(decodeURIComponent(g.replace(/\+/g," ")),v)}))}n=po.prototype,n.add=function(h,g){Sn(this),this.i=null,h=Gs(this,h);var v=this.g.get(h);return v||this.g.set(h,v=[]),v.push(g),this.h+=1,this};function h2(h,g){Sn(h),g=Gs(h,g),h.g.has(g)&&(h.i=null,h.h-=h.g.get(g).length,h.g.delete(g))}function d2(h,g){return Sn(h),g=Gs(h,g),h.g.has(g)}n.forEach=function(h,g){Sn(this),this.g.forEach(function(v,P){v.forEach(function(L){h.call(g,L,P,this)},this)},this)},n.na=function(){Sn(this);const h=Array.from(this.g.values()),g=Array.from(this.g.keys()),v=[];for(let P=0;P<g.length;P++){const L=h[P];for(let $=0;$<L.length;$++)v.push(g[P])}return v},n.V=function(h){Sn(this);let g=[];if(typeof h=="string")d2(this,h)&&(g=g.concat(this.g.get(Gs(this,h))));else{h=Array.from(this.g.values());for(let v=0;v<h.length;v++)g=g.concat(h[v])}return g},n.set=function(h,g){return Sn(this),this.i=null,h=Gs(this,h),d2(this,h)&&(this.h-=this.g.get(h).length),this.g.set(h,[g]),this.h+=1,this},n.get=function(h,g){return h?(h=this.V(h),0<h.length?String(h[0]):g):g};function f2(h,g,v){h2(h,g),0<v.length&&(h.i=null,h.g.set(Gs(h,g),b(v)),h.h+=v.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const h=[],g=Array.from(this.g.keys());for(var v=0;v<g.length;v++){var P=g[v];const $=encodeURIComponent(String(P)),Q=this.V(P);for(P=0;P<Q.length;P++){var L=$;Q[P]!==""&&(L+="="+encodeURIComponent(String(Q[P]))),h.push(L)}}return this.i=h.join("&")};function Gs(h,g){return g=String(g),h.j&&(g=g.toLowerCase()),g}function by(h,g){g&&!h.j&&(Sn(h),h.i=null,h.g.forEach(function(v,P){var L=P.toLowerCase();P!=L&&(h2(this,P),f2(this,L,v))},h)),h.j=g}function wy(h,g){const v=new Zt;if(a.Image){const P=new Image;P.onload=m(Tn,v,"TestLoadImage: loaded",!0,g,P),P.onerror=m(Tn,v,"TestLoadImage: error",!1,g,P),P.onabort=m(Tn,v,"TestLoadImage: abort",!1,g,P),P.ontimeout=m(Tn,v,"TestLoadImage: timeout",!1,g,P),a.setTimeout(function(){P.ontimeout&&P.ontimeout()},1e4),P.src=h}else g(!1)}function _y(h,g){const v=new Zt,P=new AbortController,L=setTimeout(()=>{P.abort(),Tn(v,"TestPingServer: timeout",!1,g)},1e4);fetch(h,{signal:P.signal}).then($=>{clearTimeout(L),$.ok?Tn(v,"TestPingServer: ok",!0,g):Tn(v,"TestPingServer: server error",!1,g)}).catch(()=>{clearTimeout(L),Tn(v,"TestPingServer: error",!1,g)})}function Tn(h,g,v,P,L){try{L&&(L.onload=null,L.onerror=null,L.onabort=null,L.ontimeout=null),P(v)}catch{}}function Ey(){this.g=new L0}function Ay(h,g,v){const P=v||"";try{a2(h,function(L,$){let Q=L;l(L)&&(Q=qs(L)),g.push(P+$+"="+encodeURIComponent(Q))})}catch(L){throw g.push(P+"type="+encodeURIComponent("_badmap")),L}}function nc(h){this.l=h.Ub||null,this.j=h.eb||!1}y(nc,zs),nc.prototype.g=function(){return new sc(this.l,this.j)},nc.prototype.i=function(h){return function(){return h}}({});function sc(h,g){We.call(this),this.D=h,this.o=g,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(sc,We),n=sc.prototype,n.open=function(h,g){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=h,this.A=g,this.readyState=1,mo(this)},n.send=function(h){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const g={headers:this.u,method:this.B,credentials:this.m,cache:void 0};h&&(g.body=h),(this.D||a).fetch(new Request(this.A,g)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,go(this)),this.readyState=0},n.Sa=function(h){if(this.g&&(this.l=h,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=h.headers,this.readyState=2,mo(this)),this.g&&(this.readyState=3,mo(this),this.g)))if(this.responseType==="arraybuffer")h.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in h){if(this.j=h.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;p2(this)}else h.text().then(this.Ra.bind(this),this.ga.bind(this))};function p2(h){h.j.read().then(h.Pa.bind(h)).catch(h.ga.bind(h))}n.Pa=function(h){if(this.g){if(this.o&&h.value)this.response.push(h.value);else if(!this.o){var g=h.value?h.value:new Uint8Array(0);(g=this.v.decode(g,{stream:!h.done}))&&(this.response=this.responseText+=g)}h.done?go(this):mo(this),this.readyState==3&&p2(this)}},n.Ra=function(h){this.g&&(this.response=this.responseText=h,go(this))},n.Qa=function(h){this.g&&(this.response=h,go(this))},n.ga=function(){this.g&&go(this)};function go(h){h.readyState=4,h.l=null,h.j=null,h.v=null,mo(h)}n.setRequestHeader=function(h,g){this.u.append(h,g)},n.getResponseHeader=function(h){return this.h&&this.h.get(h.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const h=[],g=this.h.entries();for(var v=g.next();!v.done;)v=v.value,h.push(v[0]+": "+v[1]),v=g.next();return h.join(`\r
`)};function mo(h){h.onreadystatechange&&h.onreadystatechange.call(h)}Object.defineProperty(sc.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(h){this.m=h?"include":"same-origin"}});function g2(h){let g="";return F(h,function(v,P){g+=P,g+=":",g+=v,g+=`\r
`}),g}function K0(h,g,v){e:{for(P in v){var P=!1;break e}P=!0}P||(v=g2(v),typeof h=="string"?v!=null&&encodeURIComponent(String(v)):He(h,g,v))}function Je(h){We.call(this),this.headers=new Map,this.o=h||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(Je,We);var Cy=/^https?$/i,Sy=["POST","PUT"];n=Je.prototype,n.Ha=function(h){this.J=h},n.ea=function(h,g,v,P){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+h);g=g?g.toUpperCase():"GET",this.D=h,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():O0.g(),this.v=this.o?Ga(this.o):Ga(O0),this.g.onreadystatechange=f(this.Ea,this);try{this.B=!0,this.g.open(g,String(h),!0),this.B=!1}catch($){m2(this,$);return}if(h=v||"",v=new Map(this.headers),P)if(Object.getPrototypeOf(P)===Object.prototype)for(var L in P)v.set(L,P[L]);else if(typeof P.keys=="function"&&typeof P.get=="function")for(const $ of P.keys())v.set($,P.get($));else throw Error("Unknown input type for opt_headers: "+String(P));P=Array.from(v.keys()).find($=>$.toLowerCase()=="content-type"),L=a.FormData&&h instanceof a.FormData,!(0<=Array.prototype.indexOf.call(Sy,g,void 0))||P||L||v.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[$,Q]of v)this.g.setRequestHeader($,Q);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{v2(this),this.u=!0,this.g.send(h),this.u=!1}catch($){m2(this,$)}};function m2(h,g){h.h=!1,h.g&&(h.j=!0,h.g.abort(),h.j=!1),h.l=g,h.m=5,y2(h),ic(h)}function y2(h){h.A||(h.A=!0,st(h,"complete"),st(h,"error"))}n.abort=function(h){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=h||7,st(this,"complete"),st(this,"abort"),ic(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ic(this,!0)),Je.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?x2(this):this.bb())},n.bb=function(){x2(this)};function x2(h){if(h.h&&typeof o<"u"&&(!h.v[1]||nn(h)!=4||h.Z()!=2)){if(h.u&&nn(h)==4)no(h.Ea,0,h);else if(st(h,"readystatechange"),nn(h)==4){h.h=!1;try{const Q=h.Z();e:switch(Q){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var g=!0;break e;default:g=!1}var v;if(!(v=g)){var P;if(P=Q===0){var L=String(h.D).match(c2)[1]||null;!L&&a.self&&a.self.location&&(L=a.self.location.protocol.slice(0,-1)),P=!Cy.test(L?L.toLowerCase():"")}v=P}if(v)st(h,"complete"),st(h,"success");else{h.m=6;try{var $=2<nn(h)?h.g.statusText:""}catch{$=""}h.l=$+" ["+h.Z()+"]",y2(h)}}finally{ic(h)}}}}function ic(h,g){if(h.g){v2(h);const v=h.g,P=h.v[0]?()=>{}:null;h.g=null,h.v=null,g||st(h,"ready");try{v.onreadystatechange=P}catch{}}}function v2(h){h.I&&(a.clearTimeout(h.I),h.I=null)}n.isActive=function(){return!!this.g};function nn(h){return h.g?h.g.readyState:0}n.Z=function(){try{return 2<nn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(h){if(this.g){var g=this.g.responseText;return h&&g.indexOf(h)==0&&(g=g.substring(h.length)),N0(g)}};function b2(h){try{if(!h.g)return null;if("response"in h.g)return h.g.response;switch(h.H){case"":case"text":return h.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in h.g)return h.g.mozResponseArrayBuffer}return null}catch{return null}}function Ty(h){const g={};h=(h.g&&2<=nn(h)&&h.g.getAllResponseHeaders()||"").split(`\r
`);for(let P=0;P<h.length;P++){if(S(h[P]))continue;var v=I(h[P]);const L=v[0];if(v=v[1],typeof v!="string")continue;v=v.trim();const $=g[L]||[];g[L]=$,$.push(v)}A(g,function(P){return P.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function yo(h,g,v){return v&&v.internalChannelParams&&v.internalChannelParams[h]||g}function w2(h){this.Aa=0,this.i=[],this.j=new Zt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=yo("failFast",!1,h),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=yo("baseRetryDelayMs",5e3,h),this.cb=yo("retryDelaySeedMs",1e4,h),this.Wa=yo("forwardChannelMaxRetries",2,h),this.wa=yo("forwardChannelRequestTimeoutMs",2e4,h),this.pa=h&&h.xmlHttpFactory||void 0,this.Xa=h&&h.Tb||void 0,this.Ca=h&&h.useFetchStreams||!1,this.L=void 0,this.J=h&&h.supportsCrossDomainXhr||!1,this.K="",this.h=new r2(h&&h.concurrentRequestLimit),this.Da=new Ey,this.P=h&&h.fastHandshake||!1,this.O=h&&h.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=h&&h.Rb||!1,h&&h.xa&&this.j.xa(),h&&h.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&h&&h.detectBufferingProxy||!1,this.ja=void 0,h&&h.longPollingTimeout&&0<h.longPollingTimeout&&(this.ja=h.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=w2.prototype,n.la=8,n.G=1,n.connect=function(h,g,v,P){bt(0),this.W=h,this.H=g||{},v&&P!==void 0&&(this.H.OSID=v,this.H.OAID=P),this.F=this.X,this.I=P2(this,null,this.W),ac(this)};function j0(h){if(_2(h),h.G==3){var g=h.U++,v=rn(h.I);if(He(v,"SID",h.K),He(v,"RID",g),He(v,"TYPE","terminate"),xo(h,v),g=new Cn(h,h.j,g),g.L=2,g.v=rc(rn(v)),v=!1,a.navigator&&a.navigator.sendBeacon)try{v=a.navigator.sendBeacon(g.v.toString(),"")}catch{}!v&&a.Image&&(new Image().src=g.v,v=!0),v||(g.g=D2(g.j,null),g.g.ea(g.v)),g.F=Date.now(),Za(g)}k2(h)}function oc(h){h.g&&(W0(h),h.g.cancel(),h.g=null)}function _2(h){oc(h),h.u&&(a.clearTimeout(h.u),h.u=null),cc(h),h.h.cancel(),h.s&&(typeof h.s=="number"&&a.clearTimeout(h.s),h.s=null)}function ac(h){if(!n2(h.h)&&!h.s){h.s=!0;var g=h.Ga;W||q(),K||(W(),K=!0),O.add(g,h),h.B=0}}function Iy(h,g){return s2(h.h)>=h.h.j-(h.s?1:0)?!1:h.s?(h.i=g.D.concat(h.i),!0):h.G==1||h.G==2||h.B>=(h.Va?0:h.Wa)?!1:(h.s=ht(f(h.Ga,h,g),I2(h,h.B)),h.B++,!0)}n.Ga=function(h){if(this.s)if(this.s=null,this.G==1){if(!h){this.U=Math.floor(1e5*Math.random()),h=this.U++;const L=new Cn(this,this.j,h);let $=this.o;if(this.S&&($?($=w($),C($,this.S)):$=this.S),this.m!==null||this.O||(L.H=$,$=null),this.P)e:{for(var g=0,v=0;v<this.i.length;v++){t:{var P=this.i[v];if("__data__"in P.map&&(P=P.map.__data__,typeof P=="string")){P=P.length;break t}P=void 0}if(P===void 0)break;if(g+=P,4096<g){g=v;break e}if(g===4096||v===this.i.length-1){g=v+1;break e}}g=1e3}else g=1e3;g=A2(this,L,g),v=rn(this.I),He(v,"RID",h),He(v,"CVER",22),this.D&&He(v,"X-HTTP-Session-Id",this.D),xo(this,v),$&&(this.O?g="headers="+encodeURIComponent(String(g2($)))+"&"+g:this.m&&K0(v,this.m,$)),z0(this.h,L),this.Ua&&He(v,"TYPE","init"),this.P?(He(v,"$req",g),He(v,"SID","null"),L.T=!0,U0(L,v,null)):U0(L,v,g),this.G=2}}else this.G==3&&(h?E2(this,h):this.i.length==0||n2(this.h)||E2(this))};function E2(h,g){var v;g?v=g.l:v=h.U++;const P=rn(h.I);He(P,"SID",h.K),He(P,"RID",v),He(P,"AID",h.T),xo(h,P),h.m&&h.o&&K0(P,h.m,h.o),v=new Cn(h,h.j,v,h.B+1),h.m===null&&(v.H=h.o),g&&(h.i=g.D.concat(h.i)),g=A2(h,v,1e3),v.I=Math.round(.5*h.wa)+Math.round(.5*h.wa*Math.random()),z0(h.h,v),U0(v,P,g)}function xo(h,g){h.H&&F(h.H,function(v,P){He(g,P,v)}),h.l&&a2({},function(v,P){He(g,P,v)})}function A2(h,g,v){v=Math.min(h.i.length,v);var P=h.l?f(h.l.Na,h.l,h):null;e:{var L=h.i;let $=-1;for(;;){const Q=["count="+v];$==-1?0<v?($=L[0].g,Q.push("ofs="+$)):$=0:Q.push("ofs="+$);let Oe=!0;for(let wt=0;wt<v;wt++){let Ae=L[wt].g;const Dt=L[wt].map;if(Ae-=$,0>Ae)$=Math.max(0,L[wt].g-100),Oe=!1;else try{Ay(Dt,Q,"req"+Ae+"_")}catch{P&&P(Dt)}}if(Oe){P=Q.join("&");break e}}}return h=h.i.splice(0,v),g.D=h,P}function C2(h){if(!h.g&&!h.u){h.Y=1;var g=h.Fa;W||q(),K||(W(),K=!0),O.add(g,h),h.v=0}}function G0(h){return h.g||h.u||3<=h.v?!1:(h.Y++,h.u=ht(f(h.Fa,h),I2(h,h.v)),h.v++,!0)}n.Fa=function(){if(this.u=null,S2(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var h=2*this.R;this.j.info("BP detection timer enabled: "+h),this.A=ht(f(this.ab,this),h)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,bt(10),oc(this),S2(this))};function W0(h){h.A!=null&&(a.clearTimeout(h.A),h.A=null)}function S2(h){h.g=new Cn(h,h.j,"rpc",h.Y),h.m===null&&(h.g.H=h.o),h.g.O=0;var g=rn(h.qa);He(g,"RID","rpc"),He(g,"SID",h.K),He(g,"AID",h.T),He(g,"CI",h.F?"0":"1"),!h.F&&h.ja&&He(g,"TO",h.ja),He(g,"TYPE","xmlhttp"),xo(h,g),h.m&&h.o&&K0(g,h.m,h.o),h.L&&(h.g.I=h.L);var v=h.g;h=h.ia,v.L=1,v.v=rc(rn(g)),v.m=null,v.P=!0,Zf(v,h)}n.Za=function(){this.C!=null&&(this.C=null,oc(this),G0(this),bt(19))};function cc(h){h.C!=null&&(a.clearTimeout(h.C),h.C=null)}function T2(h,g){var v=null;if(h.g==g){cc(h),W0(h),h.g=null;var P=2}else if(q0(h.h,g))v=g.D,i2(h.h,g),P=1;else return;if(h.G!=0){if(g.o)if(P==1){v=g.m?g.m.length:0,g=Date.now()-g.F;var L=h.B;P=cs(),st(P,new lo(P,v)),ac(h)}else C2(h);else if(L=g.s,L==3||L==0&&0<g.X||!(P==1&&Iy(h,g)||P==2&&G0(h)))switch(v&&0<v.length&&(g=h.h,g.i=g.i.concat(v)),L){case 1:ds(h,5);break;case 4:ds(h,10);break;case 3:ds(h,6);break;default:ds(h,2)}}}function I2(h,g){let v=h.Ta+Math.floor(Math.random()*h.cb);return h.isActive()||(v*=2),v*g}function ds(h,g){if(h.j.info("Error code "+g),g==2){var v=f(h.fb,h),P=h.Xa;const L=!P;P=new hs(P||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||ec(P,"https"),rc(P),L?wy(P.toString(),v):_y(P.toString(),v)}else bt(2);h.G=0,h.l&&h.l.sa(g),k2(h),_2(h)}n.fb=function(h){h?(this.j.info("Successfully pinged google.com"),bt(2)):(this.j.info("Failed to ping google.com"),bt(1))};function k2(h){if(h.G=0,h.ka=[],h.l){const g=o2(h.h);(g.length!=0||h.i.length!=0)&&(x(h.ka,g),x(h.ka,h.i),h.h.i.length=0,b(h.i),h.i.length=0),h.l.ra()}}function P2(h,g,v){var P=v instanceof hs?rn(v):new hs(v);if(P.g!="")g&&(P.g=g+"."+P.g),tc(P,P.s);else{var L=a.location;P=L.protocol,g=g?g+"."+L.hostname:L.hostname,L=+L.port;var $=new hs(null);P&&ec($,P),g&&($.g=g),L&&tc($,L),v&&($.l=v),P=$}return v=h.D,g=h.ya,v&&g&&He(P,v,g),He(P,"VER",h.la),xo(h,P),P}function D2(h,g,v){if(g&&!h.J)throw Error("Can't create secondary domain capable XhrIo object.");return g=h.Ca&&!h.pa?new Je(new nc({eb:v})):new Je(h.pa),g.Ha(h.J),g}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function R2(){}n=R2.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function lc(){}lc.prototype.g=function(h,g){return new ur(h,g)};function ur(h,g){We.call(this),this.g=new w2(g),this.l=h,this.h=g&&g.messageUrlParams||null,h=g&&g.messageHeaders||null,g&&g.clientProtocolHeaderRequired&&(h?h["X-Client-Protocol"]="webchannel":h={"X-Client-Protocol":"webchannel"}),this.g.o=h,h=g&&g.initMessageHeaders||null,g&&g.messageContentType&&(h?h["X-WebChannel-Content-Type"]=g.messageContentType:h={"X-WebChannel-Content-Type":g.messageContentType}),g&&g.va&&(h?h["X-WebChannel-Client-Profile"]=g.va:h={"X-WebChannel-Client-Profile":g.va}),this.g.S=h,(h=g&&g.Sb)&&!S(h)&&(this.g.m=h),this.v=g&&g.supportsCrossDomainXhr||!1,this.u=g&&g.sendRawJson||!1,(g=g&&g.httpSessionIdParam)&&!S(g)&&(this.g.D=g,h=this.h,h!==null&&g in h&&(h=this.h,g in h&&delete h[g])),this.j=new Ws(this)}y(ur,We),ur.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ur.prototype.close=function(){j0(this.g)},ur.prototype.o=function(h){var g=this.g;if(typeof h=="string"){var v={};v.__data__=h,h=v}else this.u&&(v={},v.__data__=qs(h),h=v);g.i.push(new hy(g.Ya++,h)),g.G==3&&ac(g)},ur.prototype.N=function(){this.g.l=null,delete this.j,j0(this.g),delete this.g,ur.aa.N.call(this)};function B2(h){Ks.call(this),h.__headers__&&(this.headers=h.__headers__,this.statusCode=h.__status__,delete h.__headers__,delete h.__status__);var g=h.__sm__;if(g){e:{for(const v in g){h=v;break e}h=void 0}(this.i=h)&&(h=this.i,g=g!==null&&h in g?g[h]:void 0),this.data=g}else this.data=h}y(B2,Ks);function F2(){ao.call(this),this.status=1}y(F2,ao);function Ws(h){this.g=h}y(Ws,R2),Ws.prototype.ua=function(){st(this.g,"a")},Ws.prototype.ta=function(h){st(this.g,new B2(h))},Ws.prototype.sa=function(h){st(this.g,new F2)},Ws.prototype.ra=function(){st(this.g,"b")},lc.prototype.createWebChannel=lc.prototype.g,ur.prototype.send=ur.prototype.o,ur.prototype.open=ur.prototype.m,ur.prototype.close=ur.prototype.close,C7=function(){return new lc},A7=function(){return cs()},E7=tn,k1={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Xa.NO_ERROR=0,Xa.TIMEOUT=8,Xa.HTTP_ERROR=6,el=Xa,Yf.COMPLETE="complete",_7=Yf,oo.EventType=as,as.OPEN="a",as.CLOSE="b",as.ERROR="c",as.MESSAGE="d",We.prototype.listen=We.prototype.K,To=oo,Je.prototype.listenOnce=Je.prototype.L,Je.prototype.getLastError=Je.prototype.Ka,Je.prototype.getLastErrorCode=Je.prototype.Ba,Je.prototype.getStatus=Je.prototype.Z,Je.prototype.getResponseJson=Je.prototype.Oa,Je.prototype.getResponseText=Je.prototype.oa,Je.prototype.send=Je.prototype.ea,Je.prototype.setWithCredentials=Je.prototype.Ha,w7=Je}).apply(typeof kc<"u"?kc:typeof self<"u"?self:typeof window<"u"?window:{});const yp="@firebase/firestore",xp="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}tr.UNAUTHENTICATED=new tr(null),tr.GOOGLE_CREDENTIALS=new tr("google-credentials-uid"),tr.FIRST_PARTY=new tr("first-party-uid"),tr.MOCK_USER=new tr("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qi="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rs=new g7("@firebase/firestore");function ti(){return Rs.logLevel}function Z(n,...e){if(Rs.logLevel<=xe.DEBUG){const t=e.map(uf);Rs.debug(`Firestore (${Qi}): ${n}`,...t)}}function xn(n,...e){if(Rs.logLevel<=xe.ERROR){const t=e.map(uf);Rs.error(`Firestore (${Qi}): ${n}`,...t)}}function la(n,...e){if(Rs.logLevel<=xe.WARN){const t=e.map(uf);Rs.warn(`Firestore (${Qi}): ${n}`,...t)}}function uf(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function de(n="Unexpected state"){const e=`FIRESTORE (${Qi}) INTERNAL ASSERTION FAILED: `+n;throw xn(e),new Error(e)}function Qe(n,e){n||de()}function we(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ce extends Wi{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class jP{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(tr.UNAUTHENTICATED))}shutdown(){}}class GP{constructor(e){this.t=e,this.currentUser=tr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Qe(this.o===void 0);let r=this.i;const s=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let i=new As;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new As,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=i;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{Z("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(Z("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new As)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(Z("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Qe(typeof r.accessToken=="string"),new KP(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Qe(e===null||typeof e=="string"),new tr(e)}}class WP{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=tr.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class QP{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new WP(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(tr.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class vp{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class YP{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,RP(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){Qe(this.o===void 0);const r=i=>{i.error!=null&&Z("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.R;return this.R=i.token,Z("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{Z("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):Z("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new vp(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Qe(typeof t.token=="string"),this.R=t.token,new vp(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XP(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=XP(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function ve(n,e){return n<e?-1:n>e?1:0}function Fi(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bp=-62135596800,wp=1e6;class ir{static now(){return ir.fromMillis(Date.now())}static fromDate(e){return ir.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*wp);return new ir(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new ce(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new ce(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<bp)throw new ce(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ce(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/wp}_compareTo(e){return this.seconds===e.seconds?ve(this.nanoseconds,e.nanoseconds):ve(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-bp;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{static fromTimestamp(e){return new he(e)}static min(){return new he(new ir(0,0))}static max(){return new he(new ir(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _p="__name__";class $r{constructor(e,t,r){t===void 0?t=0:t>e.length&&de(),r===void 0?r=e.length-t:r>e.length-t&&de(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return $r.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $r?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=$r.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return Math.sign(e.length-t.length)}static compareSegments(e,t){const r=$r.isNumericId(e),s=$r.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?$r.extractNumericId(e).compare($r.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Kn.fromString(e.substring(4,e.length-2))}}class tt extends $r{construct(e,t,r){return new tt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new ce(Y.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new tt(t)}static emptyPath(){return new tt([])}}const ZP=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Gt extends $r{construct(e,t,r){return new Gt(e,t,r)}static isValidIdentifier(e){return ZP.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Gt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===_p}static keyField(){return new Gt([_p])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ce(Y.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new ce(Y.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new ce(Y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new ce(Y.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Gt(t)}static emptyPath(){return new Gt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e){this.path=e}static fromPath(e){return new ue(tt.fromString(e))}static fromName(e){return new ue(tt.fromString(e).popFirst(5))}static empty(){return new ue(tt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&tt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return tt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ue(new tt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ua=-1;function eD(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=he.fromTimestamp(r===1e9?new ir(t+1,0):new ir(t,r));return new Jn(s,ue.empty(),e)}function tD(n){return new Jn(n.readTime,n.key,ua)}class Jn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Jn(he.min(),ue.empty(),ua)}static max(){return new Jn(he.max(),ue.empty(),ua)}}function rD(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=ue.comparator(n.documentKey,e.documentKey),t!==0?t:ve(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nD="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sD{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y0(n){if(n.code!==Y.FAILED_PRECONDITION||n.message!==nD)throw n;Z("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&de(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new j((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof j?t:j.resolve(t)}catch(t){return j.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):j.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):j.reject(t)}static resolve(e){return new j((t,r)=>{t(e)})}static reject(e){return new j((t,r)=>{r(e)})}static waitFor(e){return new j((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},c=>r(c))}),o=!0,i===s&&t()})}static or(e){let t=j.resolve(!1);for(const r of e)t=t.next(s=>s?j.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new j((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let c=0;c<i;c++){const l=c;t(e[l]).next(u=>{o[l]=u,++a,a===i&&r(o)},u=>s(u))}})}static doWhile(e,t){return new j((r,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):r()};i()})}}function iD(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Yi(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.oe(r),this._e=r=>t.writeSequenceNumber(r))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}x0.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD=-1;function v0(n){return n==null}function P1(n){return n===0&&1/n==-1/0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S7="";function aD(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Ep(e)),e=cD(n.get(t),e);return Ep(e)}function cD(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case S7:t+="";break;default:t+=i}}return t}function Ep(n){return n+S7+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ap(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Oa(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function lD(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e,t){this.comparator=e,this.root=t||At.EMPTY}insert(e,t){return new at(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,At.BLACK,null,null))}remove(e){return new at(this.comparator,this.root.remove(e,this.comparator).copy(null,null,At.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pc(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pc(this.root,e,this.comparator,!0)}}class Pc{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class At{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??At.RED,this.left=s??At.EMPTY,this.right=i??At.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new At(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return At.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return At.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,At.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,At.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw de();const e=this.left.check();if(e!==this.right.check())throw de();return e+(this.isRed()?0:1)}}At.EMPTY=null,At.RED=!0,At.BLACK=!1;At.EMPTY=new class{constructor(){this.size=0}get key(){throw de()}get value(){throw de()}get color(){throw de()}get left(){throw de()}get right(){throw de()}copy(e,t,r,s,i){return this}insert(e,t,r){return new At(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e){this.comparator=e,this.data=new at(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Cp(this.data.getIterator())}getIteratorFrom(e){return new Cp(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ft)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ft(this.comparator);return t.data=e,t}}class Cp{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e){this.fields=e,e.sort(Gt.comparator)}static empty(){return new Vn([])}unionWith(e){let t=new ft(Gt.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Vn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Fi(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T7 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new T7("Invalid base64 string: "+i):i}}(e);return new It(t)}static fromUint8Array(e){const t=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new It(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ve(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}It.EMPTY_BYTE_STRING=new It("");const uD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zn(n){if(Qe(!!n),typeof n=="string"){let e=0;const t=uD.exec(n);if(Qe(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ot(n.seconds),nanos:ot(n.nanos)}}function ot(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function es(n){return typeof n=="string"?It.fromBase64String(n):It.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I7="server_timestamp",k7="__type__",P7="__previous_value__",D7="__local_write_time__";function hf(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[k7])===null||t===void 0?void 0:t.stringValue)===I7}function b0(n){const e=n.mapValue.fields[P7];return hf(e)?b0(e):e}function ha(n){const e=Zn(n.mapValue.fields[D7].timestampValue);return new ir(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hD{constructor(e,t,r,s,i,o,a,c,l){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=l}}const D1="(default)";class da{constructor(e,t){this.projectId=e,this.database=t||D1}static empty(){return new da("","")}get isDefaultDatabase(){return this.database===D1}isEqual(e){return e instanceof da&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dD="__type__",fD="__max__",Dc={mapValue:{}},pD="__vector__",R1="value";function ts(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?hf(n)?4:mD(n)?9007199254740991:gD(n)?10:11:de()}function Xr(n,e){if(n===e)return!0;const t=ts(n);if(t!==ts(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ha(n).isEqual(ha(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=Zn(s.timestampValue),a=Zn(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,i){return es(s.bytesValue).isEqual(es(i.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,i){return ot(s.geoPointValue.latitude)===ot(i.geoPointValue.latitude)&&ot(s.geoPointValue.longitude)===ot(i.geoPointValue.longitude)}(n,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return ot(s.integerValue)===ot(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=ot(s.doubleValue),a=ot(i.doubleValue);return o===a?P1(o)===P1(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return Fi(n.arrayValue.values||[],e.arrayValue.values||[],Xr);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(Ap(o)!==Ap(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Xr(o[c],a[c])))return!1;return!0}(n,e);default:return de()}}function fa(n,e){return(n.values||[]).find(t=>Xr(t,e))!==void 0}function Ni(n,e){if(n===e)return 0;const t=ts(n),r=ts(e);if(t!==r)return ve(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ve(n.booleanValue,e.booleanValue);case 2:return function(i,o){const a=ot(i.integerValue||i.doubleValue),c=ot(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return Sp(n.timestampValue,e.timestampValue);case 4:return Sp(ha(n),ha(e));case 5:return ve(n.stringValue,e.stringValue);case 6:return function(i,o){const a=es(i),c=es(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),c=o.split("/");for(let l=0;l<a.length&&l<c.length;l++){const u=ve(a[l],c[l]);if(u!==0)return u}return ve(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,o){const a=ve(ot(i.latitude),ot(o.latitude));return a!==0?a:ve(ot(i.longitude),ot(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Tp(n.arrayValue,e.arrayValue);case 10:return function(i,o){var a,c,l,u;const d=i.fields||{},f=o.fields||{},m=(a=d[R1])===null||a===void 0?void 0:a.arrayValue,y=(c=f[R1])===null||c===void 0?void 0:c.arrayValue,b=ve(((l=m==null?void 0:m.values)===null||l===void 0?void 0:l.length)||0,((u=y==null?void 0:y.values)===null||u===void 0?void 0:u.length)||0);return b!==0?b:Tp(m,y)}(n.mapValue,e.mapValue);case 11:return function(i,o){if(i===Dc.mapValue&&o===Dc.mapValue)return 0;if(i===Dc.mapValue)return 1;if(o===Dc.mapValue)return-1;const a=i.fields||{},c=Object.keys(a),l=o.fields||{},u=Object.keys(l);c.sort(),u.sort();for(let d=0;d<c.length&&d<u.length;++d){const f=ve(c[d],u[d]);if(f!==0)return f;const m=Ni(a[c[d]],l[u[d]]);if(m!==0)return m}return ve(c.length,u.length)}(n.mapValue,e.mapValue);default:throw de()}}function Sp(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ve(n,e);const t=Zn(n),r=Zn(e),s=ve(t.seconds,r.seconds);return s!==0?s:ve(t.nanos,r.nanos)}function Tp(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Ni(t[s],r[s]);if(i)return i}return ve(t.length,r.length)}function Li(n){return B1(n)}function B1(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Zn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return es(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return ue.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=B1(i);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${B1(t.fields[o])}`;return s+"}"}(n.mapValue):de()}function tl(n){switch(ts(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=b0(n);return e?16+tl(e):16;case 5:return 2*n.stringValue.length;case 6:return es(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+tl(i),0)}(n.arrayValue);case 10:case 11:return function(r){let s=0;return Oa(r.fields,(i,o)=>{s+=i.length+tl(o)}),s}(n.mapValue);default:throw de()}}function F1(n){return!!n&&"integerValue"in n}function df(n){return!!n&&"arrayValue"in n}function Ip(n){return!!n&&"nullValue"in n}function kp(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function bh(n){return!!n&&"mapValue"in n}function gD(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[dD])===null||t===void 0?void 0:t.stringValue)===pD}function Lo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Oa(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Lo(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Lo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function mD(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===fD}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zr{constructor(e){this.value=e}static empty(){return new zr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!bh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Lo(t)}setAll(e){let t=Gt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Lo(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());bh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];bh(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Oa(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new zr(Lo(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ot{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Ot(e,0,he.min(),he.min(),he.min(),zr.empty(),0)}static newFoundDocument(e,t,r,s){return new Ot(e,1,t,he.min(),r,s,0)}static newNoDocument(e,t){return new Ot(e,2,t,he.min(),he.min(),zr.empty(),0)}static newUnknownDocument(e,t){return new Ot(e,3,t,he.min(),he.min(),zr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(he.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=zr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=zr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=he.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ot&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ot(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vl{constructor(e,t){this.position=e,this.inclusive=t}}function Pp(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(i.field.isKeyField()?r=ue.comparator(ue.fromName(o.referenceValue),t.key):r=Ni(o,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function Dp(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xr(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(e,t="asc"){this.field=e,this.dir=t}}function yD(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R7{}class dt extends R7{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new vD(e,t,r):t==="array-contains"?new _D(e,r):t==="in"?new ED(e,r):t==="not-in"?new AD(e,r):t==="array-contains-any"?new CD(e,r):new dt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new bD(e,r):new wD(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ni(t,this.value)):t!==null&&ts(this.value)===ts(t)&&this.matchesComparison(Ni(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return de()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Jr extends R7{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new Jr(e,t)}matches(e){return B7(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function B7(n){return n.op==="and"}function F7(n){return xD(n)&&B7(n)}function xD(n){for(const e of n.filters)if(e instanceof Jr)return!1;return!0}function N1(n){if(n instanceof dt)return n.field.canonicalString()+n.op.toString()+Li(n.value);if(F7(n))return n.filters.map(e=>N1(e)).join(",");{const e=n.filters.map(t=>N1(t)).join(",");return`${n.op}(${e})`}}function N7(n,e){return n instanceof dt?function(r,s){return s instanceof dt&&r.op===s.op&&r.field.isEqual(s.field)&&Xr(r.value,s.value)}(n,e):n instanceof Jr?function(r,s){return s instanceof Jr&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&N7(o,s.filters[a]),!0):!1}(n,e):void de()}function L7(n){return n instanceof dt?function(t){return`${t.field.canonicalString()} ${t.op} ${Li(t.value)}`}(n):n instanceof Jr?function(t){return t.op.toString()+" {"+t.getFilters().map(L7).join(" ,")+"}"}(n):"Filter"}class vD extends dt{constructor(e,t,r){super(e,t,r),this.key=ue.fromName(r.referenceValue)}matches(e){const t=ue.comparator(e.key,this.key);return this.matchesComparison(t)}}class bD extends dt{constructor(e,t){super(e,"in",t),this.keys=M7("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class wD extends dt{constructor(e,t){super(e,"not-in",t),this.keys=M7("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function M7(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>ue.fromName(r.referenceValue))}class _D extends dt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return df(t)&&fa(t.arrayValue,this.value)}}class ED extends dt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&fa(this.value.arrayValue,t)}}class AD extends dt{constructor(e,t){super(e,"not-in",t)}matches(e){if(fa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!fa(this.value.arrayValue,t)}}class CD extends dt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!df(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>fa(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SD{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.le=null}}function Rp(n,e=null,t=[],r=[],s=null,i=null,o=null){return new SD(n,e,t,r,s,i,o)}function ff(n){const e=we(n);if(e.le===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>N1(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),v0(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Li(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Li(r)).join(",")),e.le=t}return e.le}function pf(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!yD(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!N7(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Dp(n.startAt,e.startAt)&&Dp(n.endAt,e.endAt)}function L1(n){return ue.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w0{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=c,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function TD(n,e,t,r,s,i,o,a){return new w0(n,e,t,r,s,i,o,a)}function O7(n){return new w0(n)}function Bp(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function ID(n){return n.collectionGroup!==null}function Mo(n){const e=we(n);if(e.he===null){e.he=[];const t=new Set;for(const i of e.explicitOrderBy)e.he.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ft(Gt.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.he.push(new Ul(i,r))}),t.has(Gt.keyField().canonicalString())||e.he.push(new Ul(Gt.keyField(),r))}return e.he}function Wr(n){const e=we(n);return e.Pe||(e.Pe=kD(e,Mo(n))),e.Pe}function kD(n,e){if(n.limitType==="F")return Rp(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new Ul(s.field,i)});const t=n.endAt?new Vl(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Vl(n.startAt.position,n.startAt.inclusive):null;return Rp(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function M1(n,e,t){return new w0(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function _0(n,e){return pf(Wr(n),Wr(e))&&n.limitType===e.limitType}function V7(n){return`${ff(Wr(n))}|lt:${n.limitType}`}function ri(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(s=>L7(s)).join(", ")}]`),v0(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(s=>Li(s)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(s=>Li(s)).join(",")),`Target(${r})`}(Wr(n))}; limitType=${n.limitType})`}function E0(n,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):ue.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(n,e)&&function(r,s){for(const i of Mo(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(n,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(n,e)&&function(r,s){return!(r.startAt&&!function(o,a,c){const l=Pp(o,a,c);return o.inclusive?l<=0:l<0}(r.startAt,Mo(r),s)||r.endAt&&!function(o,a,c){const l=Pp(o,a,c);return o.inclusive?l>=0:l>0}(r.endAt,Mo(r),s))}(n,e)}function PD(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function U7(n){return(e,t)=>{let r=!1;for(const s of Mo(n)){const i=DD(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function DD(n,e,t){const r=n.field.isKeyField()?ue.comparator(e.key,t.key):function(i,o,a){const c=o.data.field(i),l=a.data.field(i);return c!==null&&l!==null?Ni(c,l):de()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return de()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Oa(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return lD(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RD=new at(ue.comparator);function rs(){return RD}const $7=new at(ue.comparator);function Io(...n){let e=$7;for(const t of n)e=e.insert(t.key,t);return e}function BD(n){let e=$7;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function vs(){return Oo()}function H7(){return Oo()}function Oo(){return new Vs(n=>n.toString(),(n,e)=>n.isEqual(e))}const FD=new ft(ue.comparator);function _e(...n){let e=FD;for(const t of n)e=e.add(t);return e}const ND=new ft(ve);function LD(){return ND}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MD(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:P1(e)?"-0":e}}function OD(n){return{integerValue:""+n}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A0{constructor(){this._=void 0}}function VD(n,e,t){return n instanceof O1?function(s,i){const o={fields:{[k7]:{stringValue:I7},[D7]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&hf(i)&&(i=b0(i)),i&&(o.fields[P7]=i),{mapValue:o}}(t,e):n instanceof $l?q7(n,e):n instanceof Hl?z7(n,e):function(s,i){const o=$D(s,i),a=Fp(o)+Fp(s.Ie);return F1(o)&&F1(s.Ie)?OD(a):MD(s.serializer,a)}(n,e)}function UD(n,e,t){return n instanceof $l?q7(n,e):n instanceof Hl?z7(n,e):t}function $D(n,e){return n instanceof V1?function(r){return F1(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class O1 extends A0{}class $l extends A0{constructor(e){super(),this.elements=e}}function q7(n,e){const t=K7(e);for(const r of n.elements)t.some(s=>Xr(s,r))||t.push(r);return{arrayValue:{values:t}}}class Hl extends A0{constructor(e){super(),this.elements=e}}function z7(n,e){let t=K7(e);for(const r of n.elements)t=t.filter(s=>!Xr(s,r));return{arrayValue:{values:t}}}class V1 extends A0{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Fp(n){return ot(n.integerValue||n.doubleValue)}function K7(n){return df(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function HD(n,e){return n.field.isEqual(e.field)&&function(r,s){return r instanceof $l&&s instanceof $l||r instanceof Hl&&s instanceof Hl?Fi(r.elements,s.elements,Xr):r instanceof V1&&s instanceof V1?Xr(r.Ie,s.Ie):r instanceof O1&&s instanceof O1}(n.transform,e.transform)}class Cs{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Cs}static exists(e){return new Cs(void 0,e)}static updateTime(e){return new Cs(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function rl(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class gf{}function j7(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new zD(n.key,Cs.none()):new mf(n.key,n.data,Cs.none());{const t=n.data,r=zr.empty();let s=new ft(Gt.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);o===null&&i.length>1&&(i=i.popLast(),o=t.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new C0(n.key,r,new Vn(s.toArray()),Cs.none())}}function qD(n,e,t){n instanceof mf?function(s,i,o){const a=s.value.clone(),c=Lp(s.fieldTransforms,i,o.transformResults);a.setAll(c),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof C0?function(s,i,o){if(!rl(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=Lp(s.fieldTransforms,i,o.transformResults),c=i.data;c.setAll(G7(s)),c.setAll(a),i.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Vo(n,e,t,r){return n instanceof mf?function(i,o,a,c){if(!rl(i.precondition,o))return a;const l=i.value.clone(),u=Mp(i.fieldTransforms,c,o);return l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(n,e,t,r):n instanceof C0?function(i,o,a,c){if(!rl(i.precondition,o))return a;const l=Mp(i.fieldTransforms,c,o),u=o.data;return u.setAll(G7(i)),u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(d=>d.field))}(n,e,t,r):function(i,o,a){return rl(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function Np(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Fi(r,s,(i,o)=>HD(i,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class mf extends gf{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class C0 extends gf{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function G7(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Lp(n,e,t){const r=new Map;Qe(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,UD(o,a,t[s]))}return r}function Mp(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,VD(i,o,e))}return r}class zD extends gf{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KD{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&qD(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Vo(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Vo(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=H7();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const c=j7(o,a);c!==null&&r.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(he.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),_e())}isEqual(e){return this.batchId===e.batchId&&Fi(this.mutations,e.mutations,(t,r)=>Np(t,r))&&Fi(this.baseMutations,e.baseMutations,(t,r)=>Np(t,r))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jD{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ct,ye;function W7(n){if(n===void 0)return xn("GRPC error has no .code"),Y.UNKNOWN;switch(n){case ct.OK:return Y.OK;case ct.CANCELLED:return Y.CANCELLED;case ct.UNKNOWN:return Y.UNKNOWN;case ct.DEADLINE_EXCEEDED:return Y.DEADLINE_EXCEEDED;case ct.RESOURCE_EXHAUSTED:return Y.RESOURCE_EXHAUSTED;case ct.INTERNAL:return Y.INTERNAL;case ct.UNAVAILABLE:return Y.UNAVAILABLE;case ct.UNAUTHENTICATED:return Y.UNAUTHENTICATED;case ct.INVALID_ARGUMENT:return Y.INVALID_ARGUMENT;case ct.NOT_FOUND:return Y.NOT_FOUND;case ct.ALREADY_EXISTS:return Y.ALREADY_EXISTS;case ct.PERMISSION_DENIED:return Y.PERMISSION_DENIED;case ct.FAILED_PRECONDITION:return Y.FAILED_PRECONDITION;case ct.ABORTED:return Y.ABORTED;case ct.OUT_OF_RANGE:return Y.OUT_OF_RANGE;case ct.UNIMPLEMENTED:return Y.UNIMPLEMENTED;case ct.DATA_LOSS:return Y.DATA_LOSS;default:return de()}}(ye=ct||(ct={}))[ye.OK=0]="OK",ye[ye.CANCELLED=1]="CANCELLED",ye[ye.UNKNOWN=2]="UNKNOWN",ye[ye.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ye[ye.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ye[ye.NOT_FOUND=5]="NOT_FOUND",ye[ye.ALREADY_EXISTS=6]="ALREADY_EXISTS",ye[ye.PERMISSION_DENIED=7]="PERMISSION_DENIED",ye[ye.UNAUTHENTICATED=16]="UNAUTHENTICATED",ye[ye.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ye[ye.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ye[ye.ABORTED=10]="ABORTED",ye[ye.OUT_OF_RANGE=11]="OUT_OF_RANGE",ye[ye.UNIMPLEMENTED=12]="UNIMPLEMENTED",ye[ye.INTERNAL=13]="INTERNAL",ye[ye.UNAVAILABLE=14]="UNAVAILABLE",ye[ye.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WD(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QD=new Kn([4294967295,4294967295],0);function Op(n){const e=WD().encode(n),t=new b7;return t.update(e),new Uint8Array(t.digest())}function Vp(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Kn([t,r],0),new Kn([s,i],0)]}class yf{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ko(`Invalid padding: ${t}`);if(r<0)throw new ko(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ko(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ko(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=Kn.fromNumber(this.Ee)}Ae(e,t,r){let s=e.add(t.multiply(Kn.fromNumber(r)));return s.compare(QD)===1&&(s=new Kn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const t=Op(e),[r,s]=Vp(t);for(let i=0;i<this.hashCount;i++){const o=this.Ae(r,s,i);if(!this.Re(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new yf(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ee===0)return;const t=Op(e),[r,s]=Vp(t);for(let i=0;i<this.hashCount;i++){const o=this.Ae(r,s,i);this.Ve(o)}}Ve(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ko extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S0{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Va.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new S0(he.min(),s,new at(ve),rs(),_e())}}class Va{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Va(r,t,_e(),_e(),_e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nl{constructor(e,t,r,s){this.me=e,this.removedTargetIds=t,this.key=r,this.fe=s}}class Q7{constructor(e,t){this.targetId=e,this.ge=t}}class Y7{constructor(e,t,r=It.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class Up{constructor(){this.pe=0,this.ye=$p(),this.we=It.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.we=e)}Fe(){let e=_e(),t=_e(),r=_e();return this.ye.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:de()}}),new Va(this.we,this.be,e,t,r)}Me(){this.Se=!1,this.ye=$p()}xe(e,t){this.Se=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.Se=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,Qe(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class YD{constructor(e){this.ke=e,this.qe=new Map,this.Qe=rs(),this.$e=Rc(),this.Ke=Rc(),this.Ue=new at(ve)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{const r=this.He(t);switch(e.state){case 0:this.Je(t)&&r.Ce(e.resumeToken);break;case 1:r.Be(),r.De||r.Me(),r.Ce(e.resumeToken);break;case 2:r.Be(),r.De||this.removeTarget(t);break;case 3:this.Je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),r.Ce(e.resumeToken));break;default:de()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((r,s)=>{this.Je(s)&&t(s)})}Ze(e){const t=e.targetId,r=e.ge.count,s=this.Xe(t);if(s){const i=s.target;if(L1(i))if(r===0){const o=new ue(i.path);this.ze(t,o,Ot.newNoDocument(o,he.min()))}else Qe(r===1);else{const o=this.et(t);if(o!==r){const a=this.tt(e),c=a?this.nt(a,e,o):1;if(c!==0){this.Ye(t);const l=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(t,l)}}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let o,a;try{o=es(r).toUint8Array()}catch(c){if(c instanceof T7)return la("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new yf(o,s,i)}catch(c){return la(c instanceof ko?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Ee===0?null:a}nt(e,t,r){return t.ge.count===r-this.st(e,t.targetId)?0:2}st(e,t){const r=this.ke.getRemoteKeysForTarget(t);let s=0;return r.forEach(i=>{const o=this.ke.it(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.ze(t,i,null),s++)}),s}ot(e){const t=new Map;this.qe.forEach((i,o)=>{const a=this.Xe(o);if(a){if(i.current&&L1(a.target)){const c=new ue(a.target.path);this._t(c).has(o)||this.ut(o,c)||this.ze(o,c,Ot.newNoDocument(c,e))}i.ve&&(t.set(o,i.Fe()),i.Me())}});let r=_e();this.Ke.forEach((i,o)=>{let a=!0;o.forEachWhile(c=>{const l=this.Xe(c);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.Qe.forEach((i,o)=>o.setReadTime(e));const s=new S0(e,t,this.Ue,this.Qe,r);return this.Qe=rs(),this.$e=Rc(),this.Ke=Rc(),this.Ue=new at(ve),s}Ge(e,t){if(!this.Je(e))return;const r=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,r),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ke=this.Ke.insert(t.key,this.ct(t.key).add(e))}ze(e,t,r){if(!this.Je(e))return;const s=this.He(e);this.ut(e,t)?s.xe(t,1):s.Oe(t),this.Ke=this.Ke.insert(t,this.ct(t).delete(e)),this.Ke=this.Ke.insert(t,this.ct(t).add(e)),r&&(this.Qe=this.Qe.insert(t,r))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new Up,this.qe.set(e,t)),t}ct(e){let t=this.Ke.get(e);return t||(t=new ft(ve),this.Ke=this.Ke.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new ft(ve),this.$e=this.$e.insert(e,t)),t}Je(e){const t=this.Xe(e)!==null;return t||Z("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new Up),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function Rc(){return new at(ue.comparator)}function $p(){return new at(ue.comparator)}const XD={asc:"ASCENDING",desc:"DESCENDING"},JD={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ZD={and:"AND",or:"OR"};class eR{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function U1(n,e){return n.useProto3Json||v0(e)?e:{value:e}}function tR(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function rR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function di(n){return Qe(!!n),he.fromTimestamp(function(t){const r=Zn(t);return new ir(r.seconds,r.nanos)}(n))}function nR(n,e){return $1(n,e).canonicalString()}function $1(n,e){const t=function(s){return new tt(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function X7(n){const e=tt.fromString(n);return Qe(r9(e)),e}function wh(n,e){const t=X7(e);if(t.get(1)!==n.databaseId.projectId)throw new ce(Y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new ce(Y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new ue(Z7(t))}function J7(n,e){return nR(n.databaseId,e)}function sR(n){const e=X7(n);return e.length===4?tt.emptyPath():Z7(e)}function Hp(n){return new tt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Z7(n){return Qe(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function iR(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:de()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(l,u){return l.useProto3Json?(Qe(u===void 0||typeof u=="string"),It.fromBase64String(u||"")):(Qe(u===void 0||u instanceof Buffer||u instanceof Uint8Array),It.fromUint8Array(u||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const u=l.code===void 0?Y.UNKNOWN:W7(l.code);return new ce(u,l.message||"")}(o);t=new Y7(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=wh(n,r.document.name),i=di(r.document.updateTime),o=r.document.createTime?di(r.document.createTime):he.min(),a=new zr({mapValue:{fields:r.document.fields}}),c=Ot.newFoundDocument(s,i,o,a),l=r.targetIds||[],u=r.removedTargetIds||[];t=new nl(l,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=wh(n,r.document),i=r.readTime?di(r.readTime):he.min(),o=Ot.newNoDocument(s,i),a=r.removedTargetIds||[];t=new nl([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=wh(n,r.document),i=r.removedTargetIds||[];t=new nl([],i,s,null)}else{if(!("filter"in e))return de();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new GD(s,i),a=r.targetId;t=new Q7(a,o)}}return t}function oR(n,e){return{documents:[J7(n,e.path)]}}function aR(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=J7(n,s);const i=function(l){if(l.length!==0)return t9(Jr.create(l,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const o=function(l){if(l.length!==0)return l.map(u=>function(f){return{field:ni(f.field),direction:uR(f.dir)}}(u))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);const a=U1(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{ht:t,parent:s}}function cR(n){let e=sR(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){Qe(r===1);const u=t.from[0];u.allDescendants?s=u.collectionId:e=e.child(u.collectionId)}let i=[];t.where&&(i=function(d){const f=e9(d);return f instanceof Jr&&F7(f)?f.getFilters():[f]}(t.where));let o=[];t.orderBy&&(o=function(d){return d.map(f=>function(y){return new Ul(si(y.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(f))}(t.orderBy));let a=null;t.limit&&(a=function(d){let f;return f=typeof d=="object"?d.value:d,v0(f)?null:f}(t.limit));let c=null;t.startAt&&(c=function(d){const f=!!d.before,m=d.values||[];return new Vl(m,f)}(t.startAt));let l=null;return t.endAt&&(l=function(d){const f=!d.before,m=d.values||[];return new Vl(m,f)}(t.endAt)),TD(e,s,o,i,a,"F",c,l)}function lR(n,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return de()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function e9(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=si(t.unaryFilter.field);return dt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=si(t.unaryFilter.field);return dt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=si(t.unaryFilter.field);return dt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=si(t.unaryFilter.field);return dt.create(o,"!=",{nullValue:"NULL_VALUE"});default:return de()}}(n):n.fieldFilter!==void 0?function(t){return dt.create(si(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return de()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Jr.create(t.compositeFilter.filters.map(r=>e9(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return de()}}(t.compositeFilter.op))}(n):de()}function uR(n){return XD[n]}function hR(n){return JD[n]}function dR(n){return ZD[n]}function ni(n){return{fieldPath:n.canonicalString()}}function si(n){return Gt.fromServerFormat(n.fieldPath)}function t9(n){return n instanceof dt?function(t){if(t.op==="=="){if(kp(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NAN"}};if(Ip(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(kp(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NAN"}};if(Ip(t.value))return{unaryFilter:{field:ni(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ni(t.field),op:hR(t.op),value:t.value}}}(n):n instanceof Jr?function(t){const r=t.getFilters().map(s=>t9(s));return r.length===1?r[0]:{compositeFilter:{op:dR(t.op),filters:r}}}(n):de()}function r9(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t,r,s,i=he.min(),o=he.min(),a=It.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new Un(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Un(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Un(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Un(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fR{constructor(e){this.Tt=e}}function pR(n){const e=cR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?M1(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(){this.Tn=new mR}addToCollectionParentIndex(e,t){return this.Tn.add(t),j.resolve()}getCollectionParents(e,t){return j.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return j.resolve()}deleteFieldIndex(e,t){return j.resolve()}deleteAllFieldIndexes(e){return j.resolve()}createTargetIndexes(e,t){return j.resolve()}getDocumentsMatchingTarget(e,t){return j.resolve(null)}getIndexType(e,t){return j.resolve(0)}getFieldIndexes(e,t){return j.resolve([])}getNextCollectionGroupToUpdate(e){return j.resolve(null)}getMinOffset(e,t){return j.resolve(Jn.min())}getMinOffsetFromCollectionGroup(e,t){return j.resolve(Jn.min())}updateCollectionGroup(e,t,r){return j.resolve()}updateIndexEntries(e,t){return j.resolve()}}class mR{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ft(tt.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ft(tt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},n9=41943040;class rr{static withCacheSize(e){return new rr(e,rr.DEFAULT_COLLECTION_PERCENTILE,rr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */rr.DEFAULT_COLLECTION_PERCENTILE=10,rr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,rr.DEFAULT=new rr(n9,rr.DEFAULT_COLLECTION_PERCENTILE,rr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),rr.DISABLED=new rr(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new Mi(0)}static Un(){return new Mi(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zp="LruGarbageCollector",yR=1048576;function Kp([n,e],[t,r]){const s=ve(n,t);return s===0?ve(e,r):s}class xR{constructor(e){this.Hn=e,this.buffer=new ft(Kp),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Kp(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class vR{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){Z(zp,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Yi(t)?Z(zp,"Ignoring IndexedDB error during garbage collection: ",t):await y0(t)}await this.er(3e5)})}}class bR{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return j.resolve(x0.ae);const r=new xR(t);return this.tr.forEachTarget(e,s=>r.Zn(s.sequenceNumber)).next(()=>this.tr.rr(e,s=>r.Zn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.tr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(Z("LruGarbageCollector","Garbage collection skipped; disabled"),j.resolve(qp)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(Z("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qp):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let r,s,i,o,a,c,l;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(Z("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),s=this.params.maximumSequenceNumbersToCollect):s=d,o=Date.now(),this.nthSequenceNumber(e,s))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(i=d,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>(l=Date.now(),ti()<=xe.DEBUG&&Z("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(c-a)+`ms
	Removed ${d} documents in `+(l-c)+`ms
Total Duration: ${l-u}ms`),j.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:d})))}}function wR(n,e){return new bR(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _R{constructor(){this.changes=new Vs(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ot.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?j.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ER{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(r!==null&&Vo(r.mutation,s,Vn.empty(),ir.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,_e()).next(()=>r))}getLocalViewOfDocuments(e,t,r=_e()){const s=vs();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Io();return i.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=vs();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,_e()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=rs();const o=Oo(),a=function(){return Oo()}();return t.forEach((c,l)=>{const u=r.get(l.key);s.has(l.key)&&(u===void 0||u.mutation instanceof C0)?i=i.insert(l.key,l):u!==void 0?(o.set(l.key,u.mutation.getFieldMask()),Vo(u.mutation,l,u.mutation.getFieldMask(),ir.now())):o.set(l.key,Vn.empty())}),this.recalculateAndSaveOverlays(e,i).next(c=>(c.forEach((l,u)=>o.set(l,u)),t.forEach((l,u)=>{var d;return a.set(l,new ER(u,(d=o.get(l))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Oo();let s=new at((o,a)=>o-a),i=_e();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const l=t.get(c);if(l===null)return;let u=r.get(c)||Vn.empty();u=a.applyToLocalView(l,u),r.set(c,u);const d=(s.get(a.batchId)||_e()).add(c);s=s.insert(a.batchId,d)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),l=c.key,u=c.value,d=H7();u.forEach(f=>{if(!i.has(f)){const m=j7(t.get(f),r.get(f));m!==null&&d.set(f,m),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,d))}return j.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,s){return function(o){return ue.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ID(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):j.resolve(vs());let a=ua,c=i;return o.next(l=>j.forEach(l,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),i.get(u)?j.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{c=c.insert(u,f)}))).next(()=>this.populateOverlays(e,l,i)).next(()=>this.computeViews(e,c,l,_e())).next(u=>({batchId:a,changes:BD(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ue(t)).next(r=>{let s=Io();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let o=Io();return this.indexManager.getCollectionParents(e,i).next(a=>j.forEach(a,c=>{const l=function(d,f){return new w0(f,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)}(t,c.child(i));return this.getDocumentsMatchingCollectionQuery(e,l,r,s).next(u=>{u.forEach((d,f)=>{o=o.insert(d,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s))).next(o=>{i.forEach((c,l)=>{const u=l.getKey();o.get(u)===null&&(o=o.insert(u,Ot.newInvalidDocument(u)))});let a=Io();return o.forEach((c,l)=>{const u=i.get(c);u!==void 0&&Vo(u.mutation,l,Vn.empty(),ir.now()),E0(t,l)&&(a=a.insert(c,l))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CR{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return j.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:di(s.createTime)}}(t)),j.resolve()}getNamedQuery(e,t){return j.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(s){return{name:s.name,query:pR(s.bundledQuery),readTime:di(s.readTime)}}(t)),j.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SR{constructor(){this.overlays=new at(ue.comparator),this.Rr=new Map}getOverlay(e,t){return j.resolve(this.overlays.get(t))}getOverlays(e,t){const r=vs();return j.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.Et(e,t,i)}),j.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.Rr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Rr.delete(r)),j.resolve()}getOverlaysForCollection(e,t,r){const s=vs(),i=t.length+1,o=new ue(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===i&&c.largestBatchId>r&&s.set(c.getKey(),c)}return j.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new at((l,u)=>l-u);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>r){let u=i.get(l.largestBatchId);u===null&&(u=vs(),i=i.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}const a=vs(),c=i.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=s)););return j.resolve(a)}Et(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Rr.get(s.largestBatchId).delete(r.key);this.Rr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new jD(t,r));let i=this.Rr.get(t);i===void 0&&(i=_e(),this.Rr.set(t,i)),this.Rr.set(t,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(){this.sessionToken=It.EMPTY_BYTE_STRING}getSessionToken(e){return j.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,j.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(){this.Vr=new ft(mt.mr),this.gr=new ft(mt.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const r=new mt(e,t);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.wr(new mt(e,t))}br(e,t){e.forEach(r=>this.removeReference(r,t))}Sr(e){const t=new ue(new tt([])),r=new mt(t,e),s=new mt(t,e+1),i=[];return this.gr.forEachInRange([r,s],o=>{this.wr(o),i.push(o.key)}),i}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new ue(new tt([])),r=new mt(t,e),s=new mt(t,e+1);let i=_e();return this.gr.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new mt(e,0),r=this.Vr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class mt{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return ue.comparator(e.key,t.key)||ve(e.Cr,t.Cr)}static pr(e,t){return ve(e.Cr,t.Cr)||ue.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IR{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new ft(mt.mr)}checkEmpty(e){return j.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new KD(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Mr=this.Mr.add(new mt(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return j.resolve(o)}lookupMutationBatch(e,t){return j.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.Nr(r),i=s<0?0:s;return j.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return j.resolve(this.mutationQueue.length===0?oD:this.Fr-1)}getAllMutationBatches(e){return j.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new mt(t,0),s=new mt(t,Number.POSITIVE_INFINITY),i=[];return this.Mr.forEachInRange([r,s],o=>{const a=this.Or(o.Cr);i.push(a)}),j.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ft(ve);return t.forEach(s=>{const i=new mt(s,0),o=new mt(s,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([i,o],a=>{r=r.add(a.Cr)})}),j.resolve(this.Br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;ue.isDocumentKey(i)||(i=i.child(""));const o=new mt(new ue(i),0);let a=new ft(ve);return this.Mr.forEachWhile(c=>{const l=c.key.path;return!!r.isPrefixOf(l)&&(l.length===s&&(a=a.add(c.Cr)),!0)},o),j.resolve(this.Br(a))}Br(e){const t=[];return e.forEach(r=>{const s=this.Or(r);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){Qe(this.Lr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Mr;return j.forEach(t.mutations,s=>{const i=new mt(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Mr=r})}qn(e){}containsKey(e,t){const r=new mt(t,0),s=this.Mr.firstAfterOrEqual(r);return j.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,j.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kR{constructor(e){this.kr=e,this.docs=function(){return new at(ue.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.kr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return j.resolve(r?r.document.mutableCopy():Ot.newInvalidDocument(t))}getEntries(e,t){let r=rs();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Ot.newInvalidDocument(s))}),j.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=rs();const o=t.path,a=new ue(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:l,value:{document:u}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||rD(tD(u),r)<=0||(s.has(u.key)||E0(t,u))&&(i=i.insert(u.key,u.mutableCopy()))}return j.resolve(i)}getAllFromCollectionGroup(e,t,r,s){de()}qr(e,t){return j.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new PR(this)}getSize(e){return j.resolve(this.size)}}class PR extends _R{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Ir.addEntry(e,s)):this.Ir.removeEntry(r)}),j.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DR{constructor(e){this.persistence=e,this.Qr=new Vs(t=>ff(t),pf),this.lastRemoteSnapshotVersion=he.min(),this.highestTargetId=0,this.$r=0,this.Kr=new xf,this.targetCount=0,this.Ur=Mi.Kn()}forEachTarget(e,t){return this.Qr.forEach((r,s)=>t(s)),j.resolve()}getLastRemoteSnapshotVersion(e){return j.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return j.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),j.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.$r&&(this.$r=t),j.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ur=new Mi(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,j.resolve()}updateTargetData(e,t){return this.zn(t),j.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Kr.Sr(t.targetId),this.targetCount-=1,j.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Qr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Qr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),j.waitFor(i).next(()=>s)}getTargetCount(e){return j.resolve(this.targetCount)}getTargetData(e,t){const r=this.Qr.get(t)||null;return j.resolve(r)}addMatchingKeys(e,t,r){return this.Kr.yr(t,r),j.resolve()}removeMatchingKeys(e,t,r){this.Kr.br(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),j.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Kr.Sr(t),j.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Kr.vr(t);return j.resolve(r)}containsKey(e,t){return j.resolve(this.Kr.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s9{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new x0(0),this.zr=!1,this.zr=!0,this.jr=new TR,this.referenceDelegate=e(this),this.Hr=new DR(this),this.indexManager=new gR,this.remoteDocumentCache=function(s){return new kR(s)}(r=>this.referenceDelegate.Jr(r)),this.serializer=new fR(t),this.Yr=new CR(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new SR,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Wr[e.toKey()];return r||(r=new IR(t,this.referenceDelegate),this.Wr[e.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,r){Z("MemoryPersistence","Starting transaction:",e);const s=new RR(this.Gr.next());return this.referenceDelegate.Zr(),r(s).next(i=>this.referenceDelegate.Xr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}ei(e,t){return j.or(Object.values(this.Wr).map(r=>()=>r.containsKey(e,t)))}}class RR extends sD{constructor(e){super(),this.currentSequenceNumber=e}}class vf{constructor(e){this.persistence=e,this.ti=new xf,this.ni=null}static ri(e){return new vf(e)}get ii(){if(this.ni)return this.ni;throw de()}addReference(e,t,r){return this.ti.addReference(r,t),this.ii.delete(r.toString()),j.resolve()}removeReference(e,t,r){return this.ti.removeReference(r,t),this.ii.add(r.toString()),j.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),j.resolve()}removeTarget(e,t){this.ti.Sr(t.targetId).forEach(s=>this.ii.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.ii.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return j.forEach(this.ii,r=>{const s=ue.fromPath(r);return this.si(e,s).next(i=>{i||t.removeEntry(s,he.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(r=>{r?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return j.or([()=>j.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class ql{constructor(e,t){this.persistence=e,this.oi=new Vs(r=>aD(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=wR(this,t)}static ri(e,t){return new ql(e,t)}Zr(){}Xr(e){return j.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}sr(e){let t=0;return this.rr(e,r=>{t++}).next(()=>t)}rr(e,t){return j.forEach(this.oi,(r,s)=>this.ar(e,r,s).next(i=>i?j.resolve():t(s)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.qr(e,o=>this.ar(e,o,t).next(a=>{a||(r++,i.removeEntry(o,he.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),j.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),j.resolve()}removeReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),j.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),j.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=tl(e.data.value)),t}ar(e,t,r){return j.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.oi.get(t);return j.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bf{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Hi=r,this.Ji=s}static Yi(e,t){let r=_e(),s=_e();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new bf(e,t.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BR{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FR{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return Rk()?8:iD(Pk())>0?6:4}()}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.rs(e,t).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ss(e,t,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new BR;return this._s(e,t,o).next(a=>{if(i.result=a,this.Xi)return this.us(e,t,o,a.size)})}).next(()=>i.result)}us(e,t,r,s){return r.documentReadCount<this.es?(ti()<=xe.DEBUG&&Z("QueryEngine","SDK will not create cache indexes for query:",ri(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),j.resolve()):(ti()<=xe.DEBUG&&Z("QueryEngine","Query:",ri(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.ts*s?(ti()<=xe.DEBUG&&Z("QueryEngine","The SDK decides to create cache indexes for query:",ri(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Wr(t))):j.resolve())}rs(e,t){if(Bp(t))return j.resolve(null);let r=Wr(t);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=M1(t,null,"F"),r=Wr(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=_e(...i);return this.ns.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const l=this.cs(t,a);return this.ls(t,l,o,c.readTime)?this.rs(e,M1(t,null,"F")):this.hs(e,l,t,c)}))})))}ss(e,t,r,s){return Bp(t)||s.isEqual(he.min())?j.resolve(null):this.ns.getDocuments(e,r).next(i=>{const o=this.cs(t,i);return this.ls(t,o,r,s)?j.resolve(null):(ti()<=xe.DEBUG&&Z("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ri(t)),this.hs(e,o,t,eD(s,ua)).next(a=>a))})}cs(e,t){let r=new ft(U7(e));return t.forEach((s,i)=>{E0(e,i)&&(r=r.add(i))}),r}ls(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}_s(e,t,r){return ti()<=xe.DEBUG&&Z("QueryEngine","Using full collection scan to execute query:",ri(t)),this.ns.getDocumentsMatchingQuery(e,t,Jn.min(),r)}hs(e,t,r,s){return this.ns.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wf="LocalStore",NR=3e8;class LR{constructor(e,t,r,s){this.persistence=e,this.Ps=t,this.serializer=s,this.Ts=new at(ve),this.Is=new Vs(i=>ff(i),pf),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(r)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new AR(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}}function MR(n,e,t,r){return new LR(n,e,t,r)}async function i9(n,e){const t=we(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.As(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let c=_e();for(const l of s){o.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}for(const l of i){a.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}return t.localDocuments.getDocuments(r,c).next(l=>({Rs:l,removedBatchIds:o,addedBatchIds:a}))})})}function o9(n){const e=we(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function OR(n,e){const t=we(n),r=e.snapshotVersion;let s=t.Ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.ds.newChangeBuffer({trackRemovals:!0});s=t.Ts;const a=[];e.targetChanges.forEach((u,d)=>{const f=s.get(d);if(!f)return;a.push(t.Hr.removeMatchingKeys(i,u.removedDocuments,d).next(()=>t.Hr.addMatchingKeys(i,u.addedDocuments,d)));let m=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(d)!==null?m=m.withResumeToken(It.EMPTY_BYTE_STRING,he.min()).withLastLimboFreeSnapshotVersion(he.min()):u.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(u.resumeToken,r)),s=s.insert(d,m),function(b,x,D){return b.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-b.snapshotVersion.toMicroseconds()>=NR?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0}(f,m,u)&&a.push(t.Hr.updateTargetData(i,m))});let c=rs(),l=_e();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,u))}),a.push(VR(i,o,e.documentUpdates).next(u=>{c=u.Vs,l=u.fs})),!r.isEqual(he.min())){const u=t.Hr.getLastRemoteSnapshotVersion(i).next(d=>t.Hr.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(u)}return j.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,c,l)).next(()=>c)}).then(i=>(t.Ts=s,i))}function VR(n,e,t){let r=_e(),s=_e();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=rs();return t.forEach((a,c)=>{const l=i.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(he.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):Z(wf,"Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{Vs:o,fs:s}})}function UR(n,e){const t=we(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Hr.getTargetData(r,e).next(i=>i?(s=i,j.resolve(s)):t.Hr.allocateTargetId(r).next(o=>(s=new Un(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Hr.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ts.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ts=t.Ts.insert(r.targetId,r),t.Is.set(e,r.targetId)),r})}async function H1(n,e,t){const r=we(n),s=r.Ts.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Yi(o))throw o;Z(wf,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ts=r.Ts.remove(e),r.Is.delete(s.target)}function jp(n,e,t){const r=we(n);let s=he.min(),i=_e();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,l,u){const d=we(c),f=d.Is.get(u);return f!==void 0?j.resolve(d.Ts.get(f)):d.Hr.getTargetData(l,u)}(r,o,Wr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{i=c})}).next(()=>r.Ps.getDocumentsMatchingQuery(o,e,t?s:he.min(),t?i:_e())).next(a=>($R(r,PD(e),a),{documents:a,gs:i})))}function $R(n,e,t){let r=n.Es.get(e)||he.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Es.set(e,r)}class Gp{constructor(){this.activeTargetIds=LD()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class HR{constructor(){this.ho=new Gp,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,r){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new Gp,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qR{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wp="ConnectivityMonitor";class Qp{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Z(Wp,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){Z(Wp,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bc=null;function q1(){return Bc===null?Bc=function(){return 268435456+Math.round(2147483648*Math.random())}():Bc++,"0x"+Bc.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _h="RestConnection",zR={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class KR{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${r}/databases/${s}`,this.wo=this.databaseId.database===D1?`project_id=${r}`:`project_id=${r}&database_id=${s}`}bo(e,t,r,s,i){const o=q1(),a=this.So(e,t.toUriEncodedString());Z(_h,`Sending RPC '${e}' ${o}:`,a,r);const c={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(c,s,i),this.vo(e,a,c,r).then(l=>(Z(_h,`Received RPC '${e}' ${o}: `,l),l),l=>{throw la(_h,`RPC '${e}' ${o} failed with error: `,l,"url: ",a,"request:",r),l})}Co(e,t,r,s,i,o){return this.bo(e,t,r,s,i)}Do(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Qi}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}So(e,t){const r=zR[e];return`${this.po}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jR{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ft="WebChannelConnection";class GR extends KR{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,r,s){const i=q1();return new Promise((o,a)=>{const c=new w7;c.setWithCredentials(!0),c.listenOnce(_7.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case el.NO_ERROR:const u=c.getResponseJson();Z(Ft,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(u)),o(u);break;case el.TIMEOUT:Z(Ft,`RPC '${e}' ${i} timed out`),a(new ce(Y.DEADLINE_EXCEEDED,"Request time out"));break;case el.HTTP_ERROR:const d=c.getStatus();if(Z(Ft,`RPC '${e}' ${i} failed with status:`,d,"response text:",c.getResponseText()),d>0){let f=c.getResponseJson();Array.isArray(f)&&(f=f[0]);const m=f==null?void 0:f.error;if(m&&m.status&&m.message){const y=function(x){const D=x.toLowerCase().replace(/_/g,"-");return Object.values(Y).indexOf(D)>=0?D:Y.UNKNOWN}(m.status);a(new ce(y,m.message))}else a(new ce(Y.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new ce(Y.UNAVAILABLE,"Connection failed."));break;default:de()}}finally{Z(Ft,`RPC '${e}' ${i} completed.`)}});const l=JSON.stringify(s);Z(Ft,`RPC '${e}' ${i} sending request:`,s),c.send(t,"POST",l,r,15)})}Wo(e,t,r){const s=q1(),i=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=C7(),a=A7(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(c.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Do(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const u=i.join("");Z(Ft,`Creating RPC '${e}' stream ${s}: ${u}`,c);const d=o.createWebChannel(u,c);let f=!1,m=!1;const y=new jR({Fo:x=>{m?Z(Ft,`Not sending because RPC '${e}' stream ${s} is closed:`,x):(f||(Z(Ft,`Opening RPC '${e}' stream ${s} transport.`),d.open(),f=!0),Z(Ft,`RPC '${e}' stream ${s} sending:`,x),d.send(x))},Mo:()=>d.close()}),b=(x,D,S)=>{x.listen(D,_=>{try{S(_)}catch(E){setTimeout(()=>{throw E},0)}})};return b(d,To.EventType.OPEN,()=>{m||(Z(Ft,`RPC '${e}' stream ${s} transport opened.`),y.Qo())}),b(d,To.EventType.CLOSE,()=>{m||(m=!0,Z(Ft,`RPC '${e}' stream ${s} transport closed`),y.Ko())}),b(d,To.EventType.ERROR,x=>{m||(m=!0,la(Ft,`RPC '${e}' stream ${s} transport errored:`,x),y.Ko(new ce(Y.UNAVAILABLE,"The operation could not be completed")))}),b(d,To.EventType.MESSAGE,x=>{var D;if(!m){const S=x.data[0];Qe(!!S);const _=S,E=(_==null?void 0:_.error)||((D=_[0])===null||D===void 0?void 0:D.error);if(E){Z(Ft,`RPC '${e}' stream ${s} received error:`,E);const B=E.status;let F=function(k){const C=ct[k];if(C!==void 0)return W7(C)}(B),A=E.message;F===void 0&&(F=Y.INTERNAL,A="Unknown error status: "+B+" with message "+E.message),m=!0,y.Ko(new ce(F,A)),d.close()}else Z(Ft,`RPC '${e}' stream ${s} received:`,S),y.Uo(S)}}),b(a,E7.STAT_EVENT,x=>{x.stat===k1.PROXY?Z(Ft,`RPC '${e}' stream ${s} detected buffering proxy`):x.stat===k1.NOPROXY&&Z(Ft,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{y.$o()},0),y}}function Eh(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a9(n){return new eR(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c9{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Ti=e,this.timerId=t,this.Go=r,this.zo=s,this.jo=i,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),s=Math.max(0,t-r);s>0&&Z("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,s,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yp="PersistentStream";class WR{constructor(e,t,r,s,i,o,a,c){this.Ti=e,this.n_=r,this.r_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new c9(e,t)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():t&&t.code===Y.RESOURCE_EXHAUSTED?(xn(t.toString()),xn("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===Y.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.i_===t&&this.V_(r,s)},r=>{e(()=>{const s=new ce(Y.UNKNOWN,"Fetching auth token failed: "+r.message);return this.m_(s)})})}V_(e,t){const r=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(s=>{r(()=>this.m_(s))}),this.stream.onMessage(s=>{r(()=>++this.__==1?this.g_(s):this.onNext(s))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return Z(Yp,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(Z(Yp,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class QR extends WR{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=iR(this.serializer,e),r=function(i){if(!("targetChange"in i))return he.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?he.min():o.readTime?di(o.readTime):he.min()}(e);return this.listener.p_(t,r)}y_(e){const t={};t.database=Hp(this.serializer),t.addTarget=function(i,o){let a;const c=o.target;if(a=L1(c)?{documents:oR(i,c)}:{query:aR(i,c).ht},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=rR(i,o.resumeToken);const l=U1(i,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(he.min())>0){a.readTime=tR(i,o.snapshotVersion.toTimestamp());const l=U1(i,o.expectedCount);l!==null&&(a.expectedCount=l)}return a}(this.serializer,e);const r=lR(this.serializer,e);r&&(t.labels=r),this.I_(t)}w_(e){const t={};t.database=Hp(this.serializer),t.removeTarget=e,this.I_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YR{}class XR extends YR{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.F_=!1}M_(){if(this.F_)throw new ce(Y.FAILED_PRECONDITION,"The client has already been terminated.")}bo(e,t,r,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.bo(e,$1(t,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ce(Y.UNKNOWN,i.toString())})}Co(e,t,r,s,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Co(e,$1(t,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ce(Y.UNKNOWN,o.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class JR{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(xn(t),this.N_=!1):Z("OnlineStateTracker",t)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oi="RemoteStore";class ZR{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=i,this.z_.To(o=>{r.enqueueAndForget(async()=>{$a(this)&&(Z(Oi,"Restarting streams for network reachability change."),await async function(c){const l=we(c);l.W_.add(4),await Ua(l),l.j_.set("Unknown"),l.W_.delete(4),await T0(l)}(this))})}),this.j_=new JR(r,s)}}async function T0(n){if($a(n))for(const e of n.G_)await e(!0)}async function Ua(n){for(const e of n.G_)await e(!1)}function l9(n,e){const t=we(n);t.U_.has(e.targetId)||(t.U_.set(e.targetId,e),Cf(t)?Af(t):Xi(t).c_()&&Ef(t,e))}function _f(n,e){const t=we(n),r=Xi(t);t.U_.delete(e),r.c_()&&u9(t,e),t.U_.size===0&&(r.c_()?r.P_():$a(t)&&t.j_.set("Unknown"))}function Ef(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(he.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Xi(n).y_(e)}function u9(n,e){n.H_.Ne(e),Xi(n).w_(e)}function Af(n){n.H_=new YD({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.U_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),Xi(n).start(),n.j_.B_()}function Cf(n){return $a(n)&&!Xi(n).u_()&&n.U_.size>0}function $a(n){return we(n).W_.size===0}function h9(n){n.H_=void 0}async function eB(n){n.j_.set("Online")}async function tB(n){n.U_.forEach((e,t)=>{Ef(n,e)})}async function rB(n,e){h9(n),Cf(n)?(n.j_.q_(e),Af(n)):n.j_.set("Unknown")}async function nB(n,e,t){if(n.j_.set("Online"),e instanceof Y7&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.U_.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.U_.delete(a),s.H_.removeTarget(a))}(n,e)}catch(r){Z(Oi,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Xp(n,r)}else if(e instanceof nl?n.H_.We(e):e instanceof Q7?n.H_.Ze(e):n.H_.je(e),!t.isEqual(he.min()))try{const r=await o9(n.localStore);t.compareTo(r)>=0&&await function(i,o){const a=i.H_.ot(o);return a.targetChanges.forEach((c,l)=>{if(c.resumeToken.approximateByteSize()>0){const u=i.U_.get(l);u&&i.U_.set(l,u.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,l)=>{const u=i.U_.get(c);if(!u)return;i.U_.set(c,u.withResumeToken(It.EMPTY_BYTE_STRING,u.snapshotVersion)),u9(i,c);const d=new Un(u.target,c,l,u.sequenceNumber);Ef(i,d)}),i.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){Z(Oi,"Failed to raise snapshot:",r),await Xp(n,r)}}async function Xp(n,e,t){if(!Yi(e))throw e;n.W_.add(1),await Ua(n),n.j_.set("Offline"),t||(t=()=>o9(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{Z(Oi,"Retrying IndexedDB access"),await t(),n.W_.delete(1),await T0(n)})}async function Jp(n,e){const t=we(n);t.asyncQueue.verifyOperationInProgress(),Z(Oi,"RemoteStore received new credentials");const r=$a(t);t.W_.add(3),await Ua(t),r&&t.j_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.W_.delete(3),await T0(t)}async function sB(n,e){const t=we(n);e?(t.W_.delete(2),await T0(t)):e||(t.W_.add(2),await Ua(t),t.j_.set("Unknown"))}function Xi(n){return n.J_||(n.J_=function(t,r,s){const i=we(t);return i.M_(),new QR(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(n.datastore,n.asyncQueue,{xo:eB.bind(null,n),No:tB.bind(null,n),Lo:rB.bind(null,n),p_:nB.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),Cf(n)?Af(n):n.j_.set("Unknown")):(await n.J_.stop(),h9(n))})),n.J_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new As,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new Sf(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ce(Y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function d9(n,e){if(xn("AsyncQueue",`${e}: ${n}`),Yi(n))return new ce(Y.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{static emptySet(e){return new fi(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||ue.comparator(t.key,r.key):(t,r)=>ue.comparator(t.key,r.key),this.keyedMap=Io(),this.sortedSet=new at(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof fi)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new fi;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(){this.Z_=new at(ue.comparator)}track(e){const t=e.doc.key,r=this.Z_.get(t);r?e.type!==0&&r.type===3?this.Z_=this.Z_.insert(t,e):e.type===3&&r.type!==1?this.Z_=this.Z_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Z_=this.Z_.remove(t):e.type===1&&r.type===2?this.Z_=this.Z_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):de():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Vi{constructor(e,t,r,s,i,o,a,c,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Vi(e,t,fi.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&_0(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iB{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class oB{constructor(){this.queries=e6(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(t,r){const s=we(t),i=s.queries;s.queries=e6(),i.forEach((o,a)=>{for(const c of a.ta)c.onError(r)})})(this,new ce(Y.ABORTED,"Firestore shutting down"))}}function e6(){return new Vs(n=>V7(n),_0)}async function aB(n,e){const t=we(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.na()&&e.ra()&&(r=2):(i=new iB,r=e.ra()?0:1);try{switch(r){case 0:i.ea=await t.onListen(s,!0);break;case 1:i.ea=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(o){const a=d9(o,`Initialization of query '${ri(e.query)}' failed`);return void e.onError(a)}t.queries.set(s,i),i.ta.push(e),e.sa(t.onlineState),i.ea&&e.oa(i.ea)&&Tf(t)}async function cB(n,e){const t=we(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const o=i.ta.indexOf(e);o>=0&&(i.ta.splice(o,1),i.ta.length===0?s=e.ra()?0:1:!i.na()&&e.ra()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function lB(n,e){const t=we(n);let r=!1;for(const s of e){const i=s.query,o=t.queries.get(i);if(o){for(const a of o.ta)a.oa(s)&&(r=!0);o.ea=s}}r&&Tf(t)}function uB(n,e,t){const r=we(n),s=r.queries.get(e);if(s)for(const i of s.ta)i.onError(t);r.queries.delete(e)}function Tf(n){n.ia.forEach(e=>{e.next()})}var z1,t6;(t6=z1||(z1={}))._a="default",t6.Cache="cache";class hB{constructor(e,t,r){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Vi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache||!this.ra())return!0;const r=t!=="Offline";return(!this.options.Ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Pa(e){e=Vi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==z1.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f9{constructor(e){this.key=e}}class p9{constructor(e){this.key=e}}class dB{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=_e(),this.mutatedKeys=_e(),this.ya=U7(e),this.wa=new fi(this.ya)}get ba(){return this.fa}Sa(e,t){const r=t?t.Da:new Zp,s=t?t.wa:this.wa;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,l=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((u,d)=>{const f=s.get(u),m=E0(this.query,d)?d:null,y=!!f&&this.mutatedKeys.has(f.key),b=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let x=!1;f&&m?f.data.isEqual(m.data)?y!==b&&(r.track({type:3,doc:m}),x=!0):this.va(f,m)||(r.track({type:2,doc:m}),x=!0,(c&&this.ya(m,c)>0||l&&this.ya(m,l)<0)&&(a=!0)):!f&&m?(r.track({type:0,doc:m}),x=!0):f&&!m&&(r.track({type:1,doc:f}),x=!0,(c||l)&&(a=!0)),x&&(m?(o=o.add(m),i=b?i.add(u):i.delete(u)):(o=o.delete(u),i=i.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),i=i.delete(u.key),r.track({type:1,doc:u})}return{wa:o,Da:r,ls:a,mutatedKeys:i}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const o=e.Da.X_();o.sort((u,d)=>function(m,y){const b=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return de()}};return b(m)-b(y)}(u.type,d.type)||this.ya(u.doc,d.doc)),this.Ca(r),s=s!=null&&s;const a=t&&!s?this.Fa():[],c=this.pa.size===0&&this.current&&!s?1:0,l=c!==this.ga;return this.ga=c,o.length!==0||l?{snapshot:new Vi(this.query,e.wa,i,o,e.mutatedKeys,c===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ma:a}:{Ma:a}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new Zp,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(t=>this.fa=this.fa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.fa=this.fa.delete(t)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=_e(),this.wa.forEach(r=>{this.xa(r.key)&&(this.pa=this.pa.add(r.key))});const t=[];return e.forEach(r=>{this.pa.has(r)||t.push(new p9(r))}),this.pa.forEach(r=>{e.has(r)||t.push(new f9(r))}),t}Oa(e){this.fa=e.gs,this.pa=_e();const t=this.Sa(e.documents);return this.applyChanges(t,!0)}Na(){return Vi.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const If="SyncEngine";class fB{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class pB{constructor(e){this.key=e,this.Ba=!1}}class gB{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.La={},this.ka=new Vs(a=>V7(a),_0),this.qa=new Map,this.Qa=new Set,this.$a=new at(ue.comparator),this.Ka=new Map,this.Ua=new xf,this.Wa={},this.Ga=new Map,this.za=Mi.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function mB(n,e,t=!0){const r=v9(n);let s;const i=r.ka.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Na()):s=await g9(r,e,t,!0),s}async function yB(n,e){const t=v9(n);await g9(t,e,!0,!1)}async function g9(n,e,t,r){const s=await UR(n.localStore,Wr(e)),i=s.targetId,o=n.sharedClientState.addLocalQueryTarget(i,t);let a;return r&&(a=await xB(n,e,i,o==="current",s.resumeToken)),n.isPrimaryClient&&t&&l9(n.remoteStore,s),a}async function xB(n,e,t,r,s){n.Ha=(d,f,m)=>async function(b,x,D,S){let _=x.view.Sa(D);_.ls&&(_=await jp(b.localStore,x.query,!1).then(({documents:A})=>x.view.Sa(A,_)));const E=S&&S.targetChanges.get(x.targetId),B=S&&S.targetMismatches.get(x.targetId)!=null,F=x.view.applyChanges(_,b.isPrimaryClient,E,B);return n6(b,x.targetId,F.Ma),F.snapshot}(n,d,f,m);const i=await jp(n.localStore,e,!0),o=new dB(e,i.gs),a=o.Sa(i.documents),c=Va.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),l=o.applyChanges(a,n.isPrimaryClient,c);n6(n,t,l.Ma);const u=new fB(e,t,o);return n.ka.set(e,u),n.qa.has(t)?n.qa.get(t).push(e):n.qa.set(t,[e]),l.snapshot}async function vB(n,e,t){const r=we(n),s=r.ka.get(e),i=r.qa.get(s.targetId);if(i.length>1)return r.qa.set(s.targetId,i.filter(o=>!_0(o,e))),void r.ka.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await H1(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),t&&_f(r.remoteStore,s.targetId),K1(r,s.targetId)}).catch(y0)):(K1(r,s.targetId),await H1(r.localStore,s.targetId,!0))}async function bB(n,e){const t=we(n),r=t.ka.get(e),s=t.qa.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),_f(t.remoteStore,r.targetId))}async function m9(n,e){const t=we(n);try{const r=await OR(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.Ka.get(i);o&&(Qe(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Ba=!0:s.modifiedDocuments.size>0?Qe(o.Ba):s.removedDocuments.size>0&&(Qe(o.Ba),o.Ba=!1))}),await x9(t,r,e)}catch(r){await y0(r)}}function r6(n,e,t){const r=we(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.ka.forEach((i,o)=>{const a=o.view.sa(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const c=we(o);c.onlineState=a;let l=!1;c.queries.forEach((u,d)=>{for(const f of d.ta)f.sa(a)&&(l=!0)}),l&&Tf(c)}(r.eventManager,e),s.length&&r.La.p_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function wB(n,e,t){const r=we(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Ka.get(e),i=s&&s.key;if(i){let o=new at(ue.comparator);o=o.insert(i,Ot.newNoDocument(i,he.min()));const a=_e().add(i),c=new S0(he.min(),new Map,new at(ve),o,a);await m9(r,c),r.$a=r.$a.remove(i),r.Ka.delete(e),kf(r)}else await H1(r.localStore,e,!1).then(()=>K1(r,e,t)).catch(y0)}function K1(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.qa.get(e))n.ka.delete(r),t&&n.La.Ja(r,t);n.qa.delete(e),n.isPrimaryClient&&n.Ua.Sr(e).forEach(r=>{n.Ua.containsKey(r)||y9(n,r)})}function y9(n,e){n.Qa.delete(e.path.canonicalString());const t=n.$a.get(e);t!==null&&(_f(n.remoteStore,t),n.$a=n.$a.remove(e),n.Ka.delete(t),kf(n))}function n6(n,e,t){for(const r of t)r instanceof f9?(n.Ua.addReference(r.key,e),_B(n,r)):r instanceof p9?(Z(If,"Document no longer in limbo: "+r.key),n.Ua.removeReference(r.key,e),n.Ua.containsKey(r.key)||y9(n,r.key)):de()}function _B(n,e){const t=e.key,r=t.path.canonicalString();n.$a.get(t)||n.Qa.has(r)||(Z(If,"New document in limbo: "+t),n.Qa.add(r),kf(n))}function kf(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const t=new ue(tt.fromString(e)),r=n.za.next();n.Ka.set(r,new pB(t)),n.$a=n.$a.insert(t,r),l9(n.remoteStore,new Un(Wr(O7(t.path)),r,"TargetPurposeLimboResolution",x0.ae))}}async function x9(n,e,t){const r=we(n),s=[],i=[],o=[];r.ka.isEmpty()||(r.ka.forEach((a,c)=>{o.push(r.Ha(c,e,t).then(l=>{var u;if((l||t)&&r.isPrimaryClient){const d=l?!l.fromCache:(u=t==null?void 0:t.targetChanges.get(c.targetId))===null||u===void 0?void 0:u.current;r.sharedClientState.updateQueryState(c.targetId,d?"current":"not-current")}if(l){s.push(l);const d=bf.Yi(c.targetId,l);i.push(d)}}))}),await Promise.all(o),r.La.p_(s),await async function(c,l){const u=we(c);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",d=>j.forEach(l,f=>j.forEach(f.Hi,m=>u.persistence.referenceDelegate.addReference(d,f.targetId,m)).next(()=>j.forEach(f.Ji,m=>u.persistence.referenceDelegate.removeReference(d,f.targetId,m)))))}catch(d){if(!Yi(d))throw d;Z(wf,"Failed to update sequence numbers: "+d)}for(const d of l){const f=d.targetId;if(!d.fromCache){const m=u.Ts.get(f),y=m.snapshotVersion,b=m.withLastLimboFreeSnapshotVersion(y);u.Ts=u.Ts.insert(f,b)}}}(r.localStore,i))}async function EB(n,e){const t=we(n);if(!t.currentUser.isEqual(e)){Z(If,"User change. New user:",e.toKey());const r=await i9(t.localStore,e);t.currentUser=e,function(i,o){i.Ga.forEach(a=>{a.forEach(c=>{c.reject(new ce(Y.CANCELLED,o))})}),i.Ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await x9(t,r.Rs)}}function AB(n,e){const t=we(n),r=t.Ka.get(e);if(r&&r.Ba)return _e().add(r.key);{let s=_e();const i=t.qa.get(e);if(!i)return s;for(const o of i){const a=t.ka.get(o);s=s.unionWith(a.view.ba)}return s}}function v9(n){const e=we(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=m9.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=AB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=wB.bind(null,e),e.La.p_=lB.bind(null,e.eventManager),e.La.Ja=uB.bind(null,e.eventManager),e}class zl{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=a9(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return MR(this.persistence,new FR,e.initialUser,this.serializer)}Xa(e){return new s9(vf.ri,this.serializer)}Za(e){return new HR}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}zl.provider={build:()=>new zl};class CB extends zl{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){Qe(this.persistence.referenceDelegate instanceof ql);const r=this.persistence.referenceDelegate.garbageCollector;return new vR(r,e.asyncQueue,t)}Xa(e){const t=this.cacheSizeBytes!==void 0?rr.withCacheSize(this.cacheSizeBytes):rr.DEFAULT;return new s9(r=>ql.ri(r,t),this.serializer)}}class j1{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>r6(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=EB.bind(null,this.syncEngine),await sB(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new oB}()}createDatastore(e){const t=a9(e.databaseInfo.databaseId),r=function(i){return new GR(i)}(e.databaseInfo);return function(i,o,a,c){return new XR(i,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,s,i,o,a){return new ZR(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>r6(this.syncEngine,t,0),function(){return Qp.D()?new Qp:new qR}())}createSyncEngine(e,t){return function(s,i,o,a,c,l,u){const d=new gB(s,i,o,a,c,l);return u&&(d.ja=!0),d}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=we(s);Z(Oi,"RemoteStore shutting down."),i.W_.add(5),await Ua(i),i.z_.shutdown(),i.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}j1.provider={build:()=>new j1};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SB{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):xn("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ns="FirestoreClient";class TB{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=tr.UNAUTHENTICATED,this.clientId=JP.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{Z(ns,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(Z(ns,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new As;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=d9(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Ah(n,e){n.asyncQueue.verifyOperationInProgress(),Z(ns,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async s=>{r.isEqual(s)||(await i9(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function s6(n,e){n.asyncQueue.verifyOperationInProgress();const t=await IB(n);Z(ns,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Jp(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Jp(e.remoteStore,s)),n._onlineComponents=e}async function IB(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){Z(ns,"Using user provided OfflineComponentProvider");try{await Ah(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Y.FAILED_PRECONDITION||s.code===Y.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;la("Error using user provided cache. Falling back to memory cache: "+t),await Ah(n,new zl)}}else Z(ns,"Using default OfflineComponentProvider"),await Ah(n,new CB(void 0));return n._offlineComponents}async function kB(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(Z(ns,"Using user provided OnlineComponentProvider"),await s6(n,n._uninitializedComponentsProvider._online)):(Z(ns,"Using default OnlineComponentProvider"),await s6(n,new j1))),n._onlineComponents}async function PB(n){const e=await kB(n),t=e.eventManager;return t.onListen=mB.bind(null,e.syncEngine),t.onUnlisten=vB.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=yB.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=bB.bind(null,e.syncEngine),t}function DB(n,e,t={}){const r=new As;return n.asyncQueue.enqueueAndForget(async()=>function(i,o,a,c,l){const u=new SB({next:f=>{u.su(),o.enqueueAndForget(()=>cB(i,d)),f.fromCache&&c.source==="server"?l.reject(new ce(Y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(f)},error:f=>l.reject(f)}),d=new hB(a,u,{includeMetadataChanges:!0,Ta:!0});return aB(i,d)}(await PB(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function b9(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i6=new Map;function RB(n,e,t,r){if(e===!0&&r===!0)throw new ce(Y.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function o6(n){if(ue.isDocumentKey(n))throw new ce(Y.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function BB(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":de()}function a6(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new ce(Y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=BB(n);throw new ce(Y.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FB="firestore.googleapis.com",c6=!0;class l6{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ce(Y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=FB,this.ssl=c6}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:c6;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=n9;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<yR)throw new ce(Y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}RB("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=b9((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new ce(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new ce(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new ce(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class w9{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new l6({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ce(Y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ce(Y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new l6(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new jP;switch(r.type){case"firstParty":return new QP(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ce(Y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=i6.get(t);r&&(Z("ComponentProvider","Removing Datastore"),i6.delete(t),r.terminate())}(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new I0(this.firestore,e,this._query)}}class Ji{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pi(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ji(this.firestore,e,this._key)}}class pi extends I0{constructor(e,t,r){super(e,t,O7(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ji(this.firestore,null,new ue(e))}withConverter(e){return new pi(this.firestore,e,this._path)}}function NB(n,e,...t){if(n=Ok(n),n instanceof w9){const r=tt.fromString(e,...t);return o6(r),new pi(n,null,r)}{if(!(n instanceof Ji||n instanceof pi))throw new ce(Y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(tt.fromString(e,...t));return o6(r),new pi(n.firestore,null,r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u6="AsyncQueue";class h6{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new c9(this,"async_queue_retry"),this.bu=()=>{const r=Eh();r&&Z(u6,"Visibility state changed to "+r.visibilityState),this.a_.t_()},this.Su=e;const t=Eh();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=Eh();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.bu)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const t=new As;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!Yi(e))throw e;Z(u6,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const t=this.Su.then(()=>(this.pu=!0,e().catch(r=>{this.gu=r,this.pu=!1;const s=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw xn("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.pu=!1,r))));return this.Su=t,t}enqueueAfterDelay(e,t,r){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const s=Sf.createAndSchedule(this,e,t,r,i=>this.Fu(i));return this.fu.push(s),s}Du(){this.gu&&de()}verifyOperationInProgress(){}async Mu(){let e;do e=this.Su,await e;while(e!==this.Su)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.fu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}class _9 extends w9{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new h6,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new h6(e),this._firestoreClient=void 0,await e}}}function LB(n){if(n._terminated)throw new ce(Y.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||MB(n),n._firestoreClient}function MB(n){var e,t,r;const s=n._freezeSettings(),i=function(a,c,l,u){return new hD(a,c,l,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,b9(u.experimentalLongPollingOptions),u.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new TB(n._authCredentials,n._appCheckCredentials,n._queue,i,n._componentsProvider&&function(a){const c=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(c),_online:c}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kl{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Kl(It.fromBase64String(e))}catch(t){throw new ce(Y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Kl(It.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E9{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new ce(Y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Gt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OB{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ce(Y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ce(Y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ve(this._lat,e._lat)||ve(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VB{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}}const UB=new RegExp("[~\\*/\\[\\]]");function $B(n,e,t){if(e.search(UB)>=0)throw d6(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n);try{return new E9(...e.split("."))._internalPath}catch{throw d6(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n)}}function d6(n,e,t,r,s){let i=`Function ${e}() called with invalid data`;i+=". ";let o="";return new ce(Y.INVALID_ARGUMENT,i+n+o)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A9{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ji(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new HB(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(C9("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class HB extends A9{data(){return super.data()}}function C9(n,e){return typeof e=="string"?$B(n,e):e instanceof E9?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qB(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new ce(Y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class zB{convertValue(e,t="none"){switch(ts(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ot(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(es(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw de()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Oa(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertVectorValue(e){var t,r,s;const i=(s=(r=(t=e.fields)===null||t===void 0?void 0:t[R1].arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>ot(o.doubleValue));return new VB(i)}convertGeoPoint(e){return new OB(ot(e.latitude),ot(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=b0(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ha(e));default:return null}}convertTimestamp(e){const t=Zn(e);return new ir(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=tt.fromString(e);Qe(r9(r));const s=new da(r.get(1),r.get(3)),i=new ue(r.popFirst(5));return s.isEqual(t)||xn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class KB extends A9{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new sl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(C9("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class sl extends KB{data(e={}){return super.data(e)}}class jB{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Fc(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new sl(this._firestore,this._userDataWriter,r.key,r,new Fc(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ce(Y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const c=new sl(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Fc(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const c=new sl(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Fc(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let l=-1,u=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:GB(a.type),doc:c,oldIndex:l,newIndex:u}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function GB(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return de()}}class WB extends zB{constructor(e){super(),this.firestore=e}convertBytes(e){return new Kl(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ji(this.firestore,null,t)}}function QB(n){n=a6(n,I0);const e=a6(n.firestore,_9),t=LB(e),r=new WB(e);return qB(n._query),DB(t,n._query).then(s=>new jB(e,r,n,s))}(function(e,t=!0){(function(s){Qi=s})(FP),Ol(new Ml("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new _9(new GP(r.getProvider("auth-internal")),new YP(o,r.getProvider("app-check-internal")),function(l,u){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new ce(Y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new da(l.options.projectId,u)}(o,s),o);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),No(yp,xp,e),No(yp,xp,"esm2017")})();var j6;const jn=(j6=globalThis.crypto)==null?void 0:j6.subtle;if(!jn)throw new Error("Web Crypto API is not available in this environment");function YB(){const n=new Uint8Array(12);for(let e=0;e<12;e++)n[e]=Math.floor(Math.random()*256);return n}function XB(n,e,t,r,s,i,o){return{content:new Uint8Array(n),content_type:e,tags:t||[],is_premium:r,price_usd:s,creator_id:new Uint8Array(i),file_type:o}}function JB(n){return n.content}async function S9(n){const e=await jn.digest("SHA-256",n);return new Uint8Array(e)}function ZB(n){const e=new Uint8Array(new Int32Array([n.index]).buffer),t=new Uint8Array([...n.data,...n.nonce,...e]);return S9(t)}function f6(n){return n.index}function T9(n){return new TextEncoder().encode(n).buffer}async function eF(n,e,t){const r=n.content,s=Math.ceil(r.length/t),i=[];Array.isArray(e)&&(e=e.join(""));const o=await jn.digest("SHA-256",T9(e)),a=await jn.importKey("raw",o,{name:"AES-GCM"},!1,["encrypt"]);for(let c=0;c<t;c++){const l=c*s,u=Math.min(l+s,r.length),d=r.slice(l,u),f=YB(),m=await jn.encrypt({name:"AES-GCM",iv:f},a,d),y={data:new Uint8Array(m),nonce:f,index:c,file_type:n.file_type};i.push(y)}return i}async function tF(n,e){Array.isArray(e)&&(e=e.join(""));const t=await jn.digest("SHA-256",T9(e)),r=await jn.importKey("raw",t,{name:"AES-GCM"},!1,["decrypt"]),s=await jn.decrypt({name:"AES-GCM",iv:n.nonce},r,n.data);return new Uint8Array(s)}function rF(n){return n.file_type}const I9=Symbol.for("@libp2p/peer-id");class Ye extends Error{constructor(t,r,s){super(t);p(this,"code");p(this,"props");this.code=r,this.name=(s==null?void 0:s.name)??"CodeError",this.props=s??{}}}function os(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}const pa=32,Rn=64,jl=32;function nF(){const n=mn.utils.randomPrivateKey(),e=mn.getPublicKey(n);return{privateKey:k9(n,e),publicKey:e}}function sF(n){if(n.length!==jl)throw new TypeError('"seed" must be 32 bytes in length.');if(!(n instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const e=n,t=mn.getPublicKey(e);return{privateKey:k9(e,t),publicKey:t}}function iF(n,e){const t=n.subarray(0,jl);return mn.sign(e instanceof Uint8Array?e:e.subarray(),t)}function oF(n,e,t){return mn.verify(e,t instanceof Uint8Array?t:t.subarray(),n)}function k9(n,e){const t=new Uint8Array(Rn);for(let r=0;r<jl;r++)t[r]=n[r],t[jl+r]=e[r];return t}const Fr={get(n=globalThis){const e=n.crypto;if((e==null?void 0:e.subtle)==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},Ch={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function aF(n){const e="AES-GCM";let t=16;const r=12,s="SHA-256",i=16,o=32767,a=Fr.get();t*=8;async function c(d,f){const m=a.getRandomValues(new Uint8Array(i)),y=a.getRandomValues(new Uint8Array(r)),b={name:e,iv:y};typeof f=="string"&&(f=oe(f));let x;if(f.length===0){x=await a.subtle.importKey("jwk",Ch,{name:"AES-GCM"},!0,["encrypt"]);try{const S={name:"PBKDF2",salt:m,iterations:o,hash:{name:s}},_=await a.subtle.importKey("raw",f,{name:"PBKDF2"},!1,["deriveKey"]);x=await a.subtle.deriveKey(S,_,{name:e,length:t},!0,["encrypt"])}catch{x=await a.subtle.importKey("jwk",Ch,{name:"AES-GCM"},!0,["encrypt"])}}else{const S={name:"PBKDF2",salt:m,iterations:o,hash:{name:s}},_=await a.subtle.importKey("raw",f,{name:"PBKDF2"},!1,["deriveKey"]);x=await a.subtle.deriveKey(S,_,{name:e,length:t},!0,["encrypt"])}const D=await a.subtle.encrypt(b,x,d);return Er([m,b.iv,new Uint8Array(D)])}async function l(d,f){const m=d.subarray(0,i),y=d.subarray(i,i+r),b=d.subarray(i+r),x={name:e,iv:y};typeof f=="string"&&(f=oe(f));let D;if(f.length===0)try{const _={name:"PBKDF2",salt:m,iterations:o,hash:{name:s}},E=await a.subtle.importKey("raw",f,{name:"PBKDF2"},!1,["deriveKey"]);D=await a.subtle.deriveKey(_,E,{name:e,length:t},!0,["decrypt"])}catch{D=await a.subtle.importKey("jwk",Ch,{name:"AES-GCM"},!0,["decrypt"])}else{const _={name:"PBKDF2",salt:m,iterations:o,hash:{name:s}},E=await a.subtle.importKey("raw",f,{name:"PBKDF2"},!1,["deriveKey"]);D=await a.subtle.deriveKey(_,E,{name:e,length:t},!0,["decrypt"])}const S=await a.subtle.decrypt(x,D,b);return new Uint8Array(S)}return{encrypt:c,decrypt:l}}async function Pf(n,e){const r=await aF().encrypt(n,e);return yd.encode(r)}var ar;(function(n){n.RSA="RSA",n.Ed25519="Ed25519",n.Secp256k1="Secp256k1"})(ar||(ar={}));var G1;(function(n){n[n.RSA=0]="RSA",n[n.Ed25519=1]="Ed25519",n[n.Secp256k1=2]="Secp256k1"})(G1||(G1={}));(function(n){n.codec=()=>r0(G1)})(ar||(ar={}));var ga;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),ar.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),s.lengthDelimited!==!1&&r.ldelim()},(t,r)=>{const s={},i=r==null?t.len:t.pos+r;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.Type=ar.codec().decode(t);break;case 2:s.Data=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),n.encode=t=>Ut(t,n.codec()),n.decode=t=>Vt(t,n.codec())})(ga||(ga={}));var ma;(function(n){let e;n.codec=()=>(e==null&&(e=$t((t,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),t.Type!=null&&(r.uint32(8),ar.codec().encode(t.Type,r)),t.Data!=null&&(r.uint32(18),r.bytes(t.Data)),s.lengthDelimited!==!1&&r.ldelim()},(t,r)=>{const s={},i=r==null?t.len:t.pos+r;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.Type=ar.codec().decode(t);break;case 2:s.Data=t.bytes();break;default:t.skipType(o&7);break}}return s})),e),n.encode=t=>Ut(t,n.codec()),n.decode=t=>Vt(t,n.codec())})(ma||(ma={}));class Df{constructor(e){p(this,"_key");this._key=Ui(e,pa)}verify(e,t){return oF(this._key,t,e)}marshal(){return this._key}get bytes(){return ga.encode({Type:ar.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ne(this.bytes,e.bytes)}hash(){const e=Xt.digest(this.bytes);return os(e)?e.then(({bytes:t})=>t):e.bytes}}class ya{constructor(e,t){p(this,"_key");p(this,"_publicKey");this._key=Ui(e,Rn),this._publicKey=Ui(t,pa)}sign(e){return iF(this._key,e)}get public(){return new Df(this._publicKey)}marshal(){return this._key}get bytes(){return ma.encode({Type:ar.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ne(this.bytes,e.bytes)}async hash(){const e=Xt.digest(this.bytes);let t;return os(e)?{bytes:t}=await e:t=e.bytes,t}async id(){const e=Rr.digest(this.public.bytes);return Ke.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return Pf(this.bytes,e);throw new Ye(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function cF(n){if(n.length>Rn){n=Ui(n,Rn+pa);const r=n.subarray(0,Rn),s=n.subarray(Rn,n.length);return new ya(r,s)}n=Ui(n,Rn);const e=n.subarray(0,Rn),t=n.subarray(pa);return new ya(e,t)}function lF(n){return n=Ui(n,pa),new Df(n)}async function uF(){const{privateKey:n,publicKey:e}=nF();return new ya(n,e)}async function hF(n){const{privateKey:e,publicKey:t}=sF(n);return new ya(e,t)}function Ui(n,e){if(n=Uint8Array.from(n??[]),n.length!==e)throw new Ye(`Key must be a Uint8Array of length ${e}, got ${n.length}`,"ERR_INVALID_KEY_TYPE");return n}const dF=Object.freeze(Object.defineProperty({__proto__:null,Ed25519PrivateKey:ya,Ed25519PublicKey:Df,generateKeyPair:uF,generateKeyPairFromSeed:hF,unmarshalEd25519PrivateKey:cF,unmarshalEd25519PublicKey:lF},Symbol.toStringTag,{value:"Module"}));function W1(n){if(isNaN(n)||n<=0)throw new Ye("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return e0(n)}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const fF="[object ArrayBuffer]";class Ue{static isArrayBuffer(e){return Object.prototype.toString.call(e)===fF}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=Ue.toUint8Array(e),s=Ue.toUint8Array(t);if(r.length!==s.byteLength)return!1;for(let i=0;i<r.length;i++)if(r[i]!==s[i])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let r=0;for(const o of t)r+=o.byteLength;const s=new Uint8Array(r);let i=0;for(const o of t){const a=this.toUint8Array(o);s.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(s,e[e.length-1]):s.buffer}}const Sh="string",pF=/^[0-9a-f\s]+$/i,gF=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,mF=/^[a-zA-Z0-9-_]+$/;class p6{static fromString(e){const t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r.buffer}static toString(e){const t=Ue.toUint8Array(e);let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return decodeURIComponent(escape(r))}}class Or{static toString(e,t=!1){const r=Ue.toArrayBuffer(e),s=new DataView(r);let i="";for(let o=0;o<r.byteLength;o+=2){const a=s.getUint16(o,t);i+=String.fromCharCode(a)}return i}static fromString(e,t=!1){const r=new ArrayBuffer(e.length*2),s=new DataView(r);for(let i=0;i<e.length;i++)s.setUint16(i*2,e.charCodeAt(i),t);return r}}class rt{static isHex(e){return typeof e===Sh&&pF.test(e)}static isBase64(e){return typeof e===Sh&&gF.test(e)}static isBase64Url(e){return typeof e===Sh&&mF.test(e)}static ToString(e,t="utf8"){const r=Ue.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return Or.toString(r,!0);case"utf16":case"utf16be":return Or.toString(r);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Or.fromString(e,!0);case"utf16":case"utf16be":return Or.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=Ue.toUint8Array(e);if(typeof btoa<"u"){const r=this.ToString(t,"binary");return btoa(r)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!rt.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!rt.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=rt.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return p6.fromString(e);case"utf16":case"utf16be":return Or.fromString(e);case"utf16le":case"usc2":return Or.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=rt.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return p6.toString(e);case"utf16":case"utf16be":return Or.toString(e);case"utf16le":case"usc2":return Or.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return r.buffer}static ToBinary(e){const t=Ue.toUint8Array(e);let r="";for(let s=0;s<t.length;s++)r+=String.fromCharCode(t[s]);return r}static ToHex(e){const t=Ue.toUint8Array(e);let r="";const s=t.length;for(let i=0;i<s;i++){const o=t[i];o<16&&(r+="0"),r+=o.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!rt.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const r=new Uint8Array(t.length/2);for(let s=0;s<t.length;s=s+2){const i=t.slice(s,s+2);r[s/2]=parseInt(i,16)}return r.buffer}static ToUtf16String(e,t=!1){return Or.toString(e,t)}static FromUtf16String(e,t=!1){return Or.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let r=0;r<t;r++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}rt.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function $i(n,e){let t=0;if(n.length===1)return n[0];for(let r=n.length-1;r>=0;r--)t+=n[n.length-1-r]*Math.pow(2,e*r);return t}function Bs(n,e,t=-1){const r=t;let s=n,i=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(n<o){let c;if(r<0)c=new ArrayBuffer(a),i=a;else{if(r<a)return new ArrayBuffer(0);c=new ArrayBuffer(r),i=r}const l=new Uint8Array(c);for(let u=a-1;u>=0;u--){const d=Math.pow(2,u*e);l[i-u-1]=Math.floor(s/d),s-=l[i-u-1]*d}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function Q1(...n){let e=0,t=0;for(const i of n)e+=i.length;const r=new ArrayBuffer(e),s=new Uint8Array(r);for(const i of n)s.set(i,t),t+=i.length;return s}function P9(){const n=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=n[0]===255&&n[1]&128,c=n[0]===0&&(n[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=n[0]&128;const r=$i(t,8),s=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(s);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=n[a];return i[0]&=127,$i(i,8)-r}function yF(n){const e=n<0?n*-1:n;let t=128;for(let r=1;r<8;r++){if(e<=t){if(n<0){const o=t-e,a=Bs(o,8,r),c=new Uint8Array(a);return c[0]|=128,a}let s=Bs(e,8,r),i=new Uint8Array(s);if(i[0]&128){const o=s.slice(0),a=new Uint8Array(o);s=new ArrayBuffer(s.byteLength+1),i=new Uint8Array(s);for(let c=0;c<o.byteLength;c++)i[c+1]=a[c];i[0]=0}return s}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function xF(n,e){if(n.byteLength!==e.byteLength)return!1;const t=new Uint8Array(n),r=new Uint8Array(e);for(let s=0;s<t.length;s++)if(t[s]!==r[s])return!1;return!0}function dr(n,e){const t=n.toString(10);if(e<t.length)return"";const r=e-t.length,s=new Array(r);for(let o=0;o<r;o++)s[o]="0";return s.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function Gl(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Rf(n){let e=0,t=0;for(let s=0;s<n.length;s++){const i=n[s];e+=i.byteLength}const r=new Uint8Array(e);for(let s=0;s<n.length;s++){const i=n[s];r.set(new Uint8Array(i),t),t+=i.byteLength}return r.buffer}function bn(n,e,t,r){return e instanceof Uint8Array?e.byteLength?t<0?(n.error="Wrong parameter: inputOffset less than zero",!1):r<0?(n.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-r<0?(n.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(n.error="Wrong parameter: inputBuffer has zero length",!1):(n.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class Bf{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Rf(this.items)}}const Ao=[new Uint8Array([1])],g6="0123456789",Zi="",Nr=new ArrayBuffer(0),Ff=new Uint8Array(0),xa="EndOfContent",D9="OCTET STRING",R9="BIT STRING";function wn(n){var e;return e=class extends n{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(r){this.valueHexView=new Uint8Array(r)}constructor(...r){var s;super(...r);const i=r[0]||{};this.isHexOnly=(s=i.isHexOnly)!==null&&s!==void 0?s:!1,this.valueHexView=i.valueHex?Ue.toUint8Array(i.valueHex):Ff}fromBER(r,s,i){const o=r instanceof ArrayBuffer?new Uint8Array(r):r;if(!bn(this,o,s,i))return-1;const a=s+i;return this.valueHexView=o.subarray(s,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),s)}toBER(r=!1){return this.isHexOnly?r?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Nr)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:rt.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class Us{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Zi,warnings:r=[],valueBeforeDecode:s=Ff}={}){this.blockLength=e,this.error=t,this.warnings=r,this.valueBeforeDecodeView=Ue.toUint8Array(s)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:rt.ToHex(this.valueBeforeDecodeView)}}}Us.NAME="baseBlock";class lr extends Us{fromBER(e,t,r){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}lr.NAME="valueBlock";class B9 extends wn(Us){constructor({idBlock:e={}}={}){var t,r,s,i;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?Ue.toUint8Array(e.valueHex):Ff,this.tagClass=(r=e.tagClass)!==null&&r!==void 0?r:-1,this.tagNumber=(s=e.tagNumber)!==null&&s!==void 0?s:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",Nr}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const s=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,t|=i,s[0]=t}return s.buffer}if(!this.isHexOnly){const s=Bs(this.tagNumber,7),i=new Uint8Array(s),o=s.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=i[c]|128;a[o]=i[o-1]}return a.buffer}const r=new Uint8Array(this.valueHexView.byteLength+1);if(r[0]=t|31,!e){const s=this.valueHexView;for(let i=0;i<s.length-1;i++)r[i+1]=s[i]|128;r[this.valueHexView.byteLength]=s[s.length-1]}return r.buffer}fromBER(e,t,r){const s=Ue.toUint8Array(e);if(!bn(this,s,t,r))return-1;const i=s.subarray(t,t+r);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;const a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),u=255;for(;i[c]&128;){if(l[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===u){u+=255;const f=new Uint8Array(u);for(let m=0;m<l.length;m++)f[m]=l[m];l=this.valueHexView=new Uint8Array(u)}}this.blockLength=c+1,l[c-1]=i[c]&127;const d=new Uint8Array(c);for(let f=0;f<c;f++)d[f]=l[f];l=this.valueHexView=new Uint8Array(c),l.set(d),this.blockLength<=9?this.tagNumber=$i(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}B9.NAME="identificationBlock";class F9 extends Us{constructor({lenBlock:e={}}={}){var t,r,s;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(r=e.longFormUsed)!==null&&r!==void 0?r:!1,this.length=(s=e.length)!==null&&s!==void 0?s:0}fromBER(e,t,r){const s=Ue.toUint8Array(e);if(!bn(this,s,t,r))return-1;const i=s.subarray(t,t+r);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,t+this.blockLength;const o=i[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>i.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=s.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=$i(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,r;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=128),t;if(this.longFormUsed){const s=Bs(this.length,8);if(s.byteLength>127)return this.error="Too big length",Nr;if(t=new ArrayBuffer(s.byteLength+1),e)return t;const i=new Uint8Array(s);r=new Uint8Array(t),r[0]=s.byteLength|128;for(let o=0;o<s.byteLength;o++)r[o+1]=i[o];return t}return t=new ArrayBuffer(1),e===!1&&(r=new Uint8Array(t),r[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}F9.NAME="lengthBlock";const J={};class Yt extends Us{constructor({name:e=Zi,optional:t=!1,primitiveSchema:r,...s}={},i){super(s),this.name=e,this.optional=t,r&&(this.primitiveSchema=r),this.idBlock=new B9(s),this.lenBlock=new F9(s),this.valueBlock=i?new i(s):new lr(s)}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}toBER(e,t){const r=t||new Bf;t||N9(this);const s=this.idBlock.toBER(e);if(r.write(s),this.lenBlock.isIndefiniteForm)r.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,r),r.write(new ArrayBuffer(2));else{const i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;const o=this.lenBlock.toBER(e);r.write(o),r.write(i)}return t?Nr:r.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():rt.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=rt.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),r=e.toBER();return xF(t,r)}}Yt.NAME="BaseBlock";function N9(n){var e;if(n instanceof J.Constructed)for(const t of n.valueBlock.value)N9(t)&&(n.lenBlock.isIndefiniteForm=!0);return!!(!((e=n.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class L9 extends Yt{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Zi,...t}={},r){super(t,r),e&&this.fromString(e)}fromBER(e,t,r){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}L9.NAME="BaseStringBlock";class M9 extends wn(lr){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}M9.NAME="PrimitiveValueBlock";var O9;class V9 extends Yt{constructor(e={}){super(e,M9),this.idBlock.isConstructed=!1}}O9=V9;J.Primitive=O9;V9.NAME="PRIMITIVE";function vF(n,e){if(n instanceof e)return n;const t=new e;return t.idBlock=n.idBlock,t.lenBlock=n.lenBlock,t.warnings=n.warnings,t.valueBeforeDecodeView=n.valueBeforeDecodeView,t}function k0(n,e=0,t=n.length){const r=e;let s=new Yt({},lr);const i=new Us;if(!bn(i,n,e,t))return s.error=i.error,{offset:-1,result:s};if(!n.subarray(e,e+t).length)return s.error="Zero buffer length",{offset:-1,result:s};let a=s.idBlock.fromBER(n,e,t);if(s.idBlock.warnings.length&&s.warnings.concat(s.idBlock.warnings),a===-1)return s.error=s.idBlock.error,{offset:-1,result:s};if(e=a,t-=s.idBlock.blockLength,a=s.lenBlock.fromBER(n,e,t),s.lenBlock.warnings.length&&s.warnings.concat(s.lenBlock.warnings),a===-1)return s.error=s.lenBlock.error,{offset:-1,result:s};if(e=a,t-=s.lenBlock.blockLength,!s.idBlock.isConstructed&&s.lenBlock.isIndefiniteForm)return s.error="Indefinite length form used for primitive encoding form",{offset:-1,result:s};let c=Yt;switch(s.idBlock.tagClass){case 1:if(s.idBlock.tagNumber>=37&&s.idBlock.isHexOnly===!1)return s.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:s};switch(s.idBlock.tagNumber){case 0:if(s.idBlock.isConstructed&&s.lenBlock.length>0)return s.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:s};c=J.EndOfContent;break;case 1:c=J.Boolean;break;case 2:c=J.Integer;break;case 3:c=J.BitString;break;case 4:c=J.OctetString;break;case 5:c=J.Null;break;case 6:c=J.ObjectIdentifier;break;case 10:c=J.Enumerated;break;case 12:c=J.Utf8String;break;case 13:c=J.RelativeObjectIdentifier;break;case 14:c=J.TIME;break;case 15:return s.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:s};case 16:c=J.Sequence;break;case 17:c=J.Set;break;case 18:c=J.NumericString;break;case 19:c=J.PrintableString;break;case 20:c=J.TeletexString;break;case 21:c=J.VideotexString;break;case 22:c=J.IA5String;break;case 23:c=J.UTCTime;break;case 24:c=J.GeneralizedTime;break;case 25:c=J.GraphicString;break;case 26:c=J.VisibleString;break;case 27:c=J.GeneralString;break;case 28:c=J.UniversalString;break;case 29:c=J.CharacterString;break;case 30:c=J.BmpString;break;case 31:c=J.DATE;break;case 32:c=J.TimeOfDay;break;case 33:c=J.DateTime;break;case 34:c=J.Duration;break;default:{const l=s.idBlock.isConstructed?new J.Constructed:new J.Primitive;l.idBlock=s.idBlock,l.lenBlock=s.lenBlock,l.warnings=s.warnings,s=l}}break;case 2:case 3:case 4:default:c=s.idBlock.isConstructed?J.Constructed:J.Primitive}return s=vF(s,c),a=s.fromBER(n,e,s.lenBlock.isIndefiniteForm?t:s.lenBlock.length),s.valueBeforeDecodeView=n.subarray(r,r+s.blockLength),{offset:a,result:s}}function U9(n){if(!n.byteLength){const e=new Yt({},lr);return e.error="Input buffer has zero length",{offset:-1,result:e}}return k0(Ue.toUint8Array(n).slice(),0,n.byteLength)}function bF(n,e){return n?1:e}class Gn extends lr{constructor({value:e=[],isIndefiniteForm:t=!1,...r}={}){super(r),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,r){const s=Ue.toUint8Array(e);if(!bn(this,s,t,r))return-1;if(this.valueBeforeDecodeView=s.subarray(t,t+r),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let i=t;for(;bF(this.isIndefiniteForm,r)>0;){const o=k0(s,i,r);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(i=o.offset,this.blockLength+=o.result.blockLength,r-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===xa)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===xa?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){const r=t||new Bf;for(let s=0;s<this.value.length;s++)this.value[s].toBER(e,r);return t?Nr:r.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Gn.NAME="ConstructedValueBlock";var $9;class eo extends Yt{constructor(e={}){super(e,Gn),this.idBlock.isConstructed=!0}fromBER(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){const e=[];for(const r of this.valueBlock.value)e.push(r.toString("ascii").split(`
`).map(s=>`  ${s}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}$9=eo;J.Constructed=$9;eo.NAME="CONSTRUCTED";class H9 extends lr{fromBER(e,t,r){return t}toBER(e){return Nr}}H9.override="EndOfContentValueBlock";var q9;class z9 extends Yt{constructor(e={}){super(e,H9),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}q9=z9;J.EndOfContent=q9;z9.NAME=xa;var K9;class va extends Yt{constructor(e={}){super(e,lr),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}toBER(e,t){const r=new ArrayBuffer(2);if(!e){const s=new Uint8Array(r);s[0]=5,s[1]=0}return t&&t.write(r),r}onAsciiEncoding(){return`${this.constructor.NAME}`}}K9=va;J.Null=K9;va.NAME="NULL";class j9 extends wn(lr){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=Ue.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,r){const s=Ue.toUint8Array(e);return bn(this,s,t,r)?(this.valueHexView=s.subarray(t,t+r),r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,P9.call(this),this.blockLength=r,t+r):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}j9.NAME="BooleanValueBlock";var G9;let W9=class extends Yt{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,j9),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};G9=W9;J.Boolean=G9;W9.NAME="BOOLEAN";class Q9 extends wn(Gn){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,r){let s=0;if(this.isConstructed){if(this.isHexOnly=!1,s=Gn.prototype.fromBER.call(this,e,t,r),s===-1)return s;for(let i=0;i<this.value.length;i++){const o=this.value[i].constructor.NAME;if(o===xa){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==D9)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,s=super.fromBER(e,t,r),this.blockLength=r;return s}toBER(e,t){return this.isConstructed?Gn.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}Q9.NAME="OctetStringValueBlock";var Nf;class oi extends Yt{constructor({idBlock:e={},lenBlock:t={},...r}={}){var s,i;(s=r.isConstructed)!==null&&s!==void 0||(r.isConstructed=!!(!((i=r.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Q9),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,r){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,r===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+r);try{if(i.byteLength){const o=k0(i,0,i.byteLength);o.offset!==-1&&o.offset===r&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return eo.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=rt.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Nf&&e.push(t.valueBlock.valueHexView);return Ue.concat(e)}}Nf=oi;J.OctetString=Nf;oi.NAME=D9;class Y9 extends wn(Gn){constructor({unusedBits:e=0,isConstructed:t=!1,...r}={}){super(r),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,r){if(!r)return t;let s=-1;if(this.isConstructed){if(s=Gn.prototype.fromBER.call(this,e,t,r),s===-1)return s;for(const a of this.value){const c=a.constructor.NAME;if(c===xa){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==R9)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return s}const i=Ue.toUint8Array(e);if(!bn(this,i,t,r))return-1;const o=i.subarray(t,t+r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=k0(a,0,a.byteLength);c.offset!==-1&&c.offset===r-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+r}toBER(e,t){if(this.isConstructed)return Gn.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Nr;const r=new Uint8Array(this.valueHexView.length+1);return r[0]=this.unusedBits,r.set(this.valueHexView,1),r.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}Y9.NAME="BitStringValueBlock";var X9;class Lf extends Yt{constructor({idBlock:e={},lenBlock:t={},...r}={}){var s,i;(s=r.isConstructed)!==null&&s!==void 0||(r.isConstructed=!!(!((i=r.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:r.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!r.isIndefiniteForm},...r},Y9),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,r){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,r)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return eo.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const r=e.join(""),s=this.constructor.NAME,i=r.substring(0,r.length-this.valueBlock.unusedBits);return`${s} : ${i}`}}}X9=Lf;J.BitString=X9;Lf.NAME=R9;var J9;function wF(n,e){const t=new Uint8Array([0]),r=new Uint8Array(n),s=new Uint8Array(e);let i=r.slice(0);const o=i.length-1,a=s.slice(0),c=a.length-1;let l=0;const u=c<o?o:c;let d=0;for(let f=u;f>=0;f--,d++){switch(!0){case d<a.length:l=i[o-d]+a[c-d]+t[0];break;default:l=i[o-d]+t[0]}switch(t[0]=l/10,!0){case d>=i.length:i=Q1(new Uint8Array([l%10]),i);break;default:i[o-d]=l%10}}return t[0]>0&&(i=Q1(t,i)),i}function m6(n){if(n>=Ao.length)for(let e=Ao.length;e<=n;e++){const t=new Uint8Array([0]);let r=Ao[e-1].slice(0);for(let s=r.length-1;s>=0;s--){const i=new Uint8Array([(r[s]<<1)+t[0]]);t[0]=i[0]/10,r[s]=i[0]%10}t[0]>0&&(r=Q1(t,r)),Ao.push(r)}return Ao[n]}function _F(n,e){let t=0;const r=new Uint8Array(n),s=new Uint8Array(e),i=r.slice(0),o=i.length-1,a=s.slice(0),c=a.length-1;let l,u=0;for(let d=c;d>=0;d--,u++)switch(l=i[o-u]-a[c-u]-t,!0){case l<0:t=1,i[o-u]=l+10;break;default:t=0,i[o-u]=l}if(t>0)for(let d=o-c+1;d>=0;d--,u++)if(l=i[o-u]-t,l<0)t=1,i[o-u]=l+10;else{t=0,i[o-u]=l;break}return i.slice()}class Mf extends wn(lr){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=P9.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(yF(e))}get valueDec(){return this._valueDec}fromDER(e,t,r,s=0){const i=this.fromBER(e,t,r);if(i===-1)return i;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):s!==0&&o.length<s&&(s-o.length>1&&(s=o.length+1),this.valueHexView=o.subarray(s-o.length)),i}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const r=new Uint8Array(this.valueHexView.length+1);r[0]=0,r.set(t,1),this.valueHexView=r}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,r){const s=super.fromBER(e,t,r);return s===-1||this.setValueHex(),s}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),r=0,s;const i=this.valueHexView;let o="",a=!1;for(let c=i.byteLength-1;c>=0;c--){s=i[c];for(let l=0;l<8;l++){if((s&1)===1)switch(r){case e:t=_F(m6(r),t),o="-";break;default:t=wF(t,m6(r))}r++,s>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=g6.charAt(t[c]));return a===!1&&(o+=g6.charAt(0)),o}}J9=Mf;Mf.NAME="IntegerValueBlock";Object.defineProperty(J9.prototype,"valueHex",{set:function(n){this.valueHexView=new Uint8Array(n),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var Uo;class Et extends Yt{constructor(e={}){super(e,Mf),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return Gl(),BigInt(this.valueBlock.toString())}static fromBigInt(e){Gl();const t=BigInt(e),r=new Bf,s=t.toString(16).replace(/^-/,""),i=new Uint8Array(rt.FromHex(s));if(t<0){const a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${rt.ToHex(a)}`)+t,u=Ue.toUint8Array(rt.FromHex(l.toString(16)));u[0]|=128,r.write(u)}else i[0]&128&&r.write(new Uint8Array([0])),r.write(i);return new Uo({valueHex:r.final()})}convertToDER(){const e=new Uo({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Uo({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}Uo=Et;J.Integer=Uo;Et.NAME="INTEGER";var Z9;class em extends Et{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}Z9=em;J.Enumerated=Z9;em.NAME="ENUMERATED";class Y1 extends wn(lr){constructor({valueDec:e=-1,isFirstSid:t=!1,...r}={}){super(r),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,r){if(!r)return t;const s=Ue.toUint8Array(e);if(!bn(this,s,t,r))return-1;const i=s.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let a=0;a<r&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=$i(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){Gl();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const r=new Uint8Array(t.length/7);for(let s=0;s<r.length;s++)r[s]=parseInt(t.slice(s*7,s*7+7),2)+(s+1<r.length?128:0);this.fromBER(r.buffer,0,r.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}const t=Bs(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Nr;const r=new Uint8Array(t.byteLength);if(!e){const s=new Uint8Array(t),i=t.byteLength-1;for(let o=0;o<i;o++)r[o]=s[o]|128;r[i]=s[i]}return r}toString(){let e="";if(this.isHexOnly)e=rt.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Y1.NAME="sidBlock";class tm extends lr{constructor({value:e=Zi,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let s=t;for(;r>0;){const i=new Y1;if(s=i.fromBER(e,s,r),s===-1)return this.blockLength=0,this.error=i.error,s;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return s}toBER(e){const t=[];for(let r=0;r<this.value.length;r++){const s=this.value[r].toBER(e);if(s.byteLength===0)return this.error=this.value[r].error,Nr;t.push(s)}return Rf(t)}fromString(e){this.value=[];let t=0,r=0,s="",i=!1;do if(r=e.indexOf(".",t),r===-1?s=e.substring(t):s=e.substring(t,r),t=r+1,i){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(s,10);if(isNaN(c))return;o.valueDec=c+a,i=!1}else{const o=new Y1;if(s>Number.MAX_SAFE_INTEGER){Gl();const a=BigInt(s);o.valueBigInt=a}else if(o.valueDec=parseInt(s,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,i=!0),this.value.push(o)}while(r!==-1)}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let s=this.value[r].toString();r!==0&&(e=`${e}.`),t?(s=`{${s}}`,this.value[r].isFirstSid?e=`2.{${s} - 80}`:e+=s):e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}tm.NAME="ObjectIdentifierValueBlock";var rm;class Nn extends Yt{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,tm),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}rm=Nn;J.ObjectIdentifier=rm;Nn.NAME="OBJECT IDENTIFIER";class X1 extends wn(Us){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,r){if(r===0)return t;const s=Ue.toUint8Array(e);if(!bn(this,s,t,r))return-1;const i=s.subarray(t,t+r);this.valueHexView=new Uint8Array(r);for(let a=0;a<r&&(this.valueHexView[a]=i[a]&127,this.blockLength++,!!(i[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,i[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=$i(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}const t=Bs(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Nr;const r=new Uint8Array(t.byteLength);if(!e){const s=new Uint8Array(t),i=t.byteLength-1;for(let o=0;o<i;o++)r[o]=s[o]|128;r[i]=s[i]}return r.buffer}toString(){let e="";return this.isHexOnly?e=rt.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}X1.NAME="relativeSidBlock";class nm extends lr{constructor({value:e=Zi,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,r){let s=t;for(;r>0;){const i=new X1;if(s=i.fromBER(e,s,r),s===-1)return this.blockLength=0,this.error=i.error,s;this.blockLength+=i.blockLength,r-=i.blockLength,this.value.push(i)}return s}toBER(e,t){const r=[];for(let s=0;s<this.value.length;s++){const i=this.value[s].toBER(e);if(i.byteLength===0)return this.error=this.value[s].error,Nr;r.push(i)}return Rf(r)}fromString(e){this.value=[];let t=0,r=0,s="";do{r=e.indexOf(".",t),r===-1?s=e.substring(t):s=e.substring(t,r),t=r+1;const i=new X1;if(i.valueDec=parseInt(s,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(r!==-1);return!0}toString(){let e="",t=!1;for(let r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;let s=this.value[r].toString();r!==0&&(e=`${e}.`),t&&(s=`{${s}}`),e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}nm.NAME="RelativeObjectIdentifierValueBlock";var sm;class im extends Yt{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,nm),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}sm=im;J.RelativeObjectIdentifier=sm;im.NAME="RelativeObjectIdentifier";var om;class jt extends eo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}om=jt;J.Sequence=om;jt.NAME="SEQUENCE";var am;let cm=class extends eo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};am=cm;J.Set=am;cm.NAME="SET";class lm extends wn(lr){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Zi}toJSON(){return{...super.toJSON(),value:this.value}}}lm.NAME="StringValueBlock";class um extends lm{}um.NAME="SimpleStringValueBlock";class yr extends L9{constructor({...e}={}){super(e,um)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,Ue.toUint8Array(e))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);this.valueBlock.value=e}}yr.NAME="SIMPLE STRING";class hm extends yr{fromBuffer(e){this.valueBlock.valueHexView=Ue.toUint8Array(e);try{this.valueBlock.value=rt.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=rt.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(rt.FromUtf8String(e)),this.valueBlock.value=e}}hm.NAME="Utf8StringValueBlock";var dm;class $s extends hm{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}dm=$s;J.Utf8String=dm;$s.NAME="UTF8String";class fm extends yr{fromBuffer(e){this.valueBlock.value=rt.ToUtf16String(e),this.valueBlock.valueHexView=Ue.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(rt.FromUtf16String(e))}}fm.NAME="BmpStringValueBlock";var pm;class gm extends fm{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}pm=gm;J.BmpString=pm;gm.NAME="BMPString";class mm extends yr{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),r=new Uint8Array(t);for(let s=0;s<r.length;s+=4)r[s]=r[s+3],r[s+1]=r[s+2],r[s+2]=0,r[s+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,r=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let s=0;s<t;s++){const i=Bs(e.charCodeAt(s),8),o=new Uint8Array(i);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)r[s*4+c+a]=o[c]}this.valueBlock.value=e}}mm.NAME="UniversalStringValueBlock";var ym;class xm extends mm{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}ym=xm;J.UniversalString=ym;xm.NAME="UniversalString";var vm;class bm extends yr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}vm=bm;J.NumericString=vm;bm.NAME="NumericString";var wm;class _m extends yr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}wm=_m;J.PrintableString=wm;_m.NAME="PrintableString";var Em;class Am extends yr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}Em=Am;J.TeletexString=Em;Am.NAME="TeletexString";var Cm;class Sm extends yr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}Cm=Sm;J.VideotexString=Cm;Sm.NAME="VideotexString";var Tm;class Im extends yr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}Tm=Im;J.IA5String=Tm;Im.NAME="IA5String";var km;class Pm extends yr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}km=Pm;J.GraphicString=km;Pm.NAME="GraphicString";var Dm;class Of extends yr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}Dm=Of;J.VisibleString=Dm;Of.NAME="VisibleString";var Rm;class Bm extends yr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Rm=Bm;J.GeneralString=Rm;Bm.NAME="GeneralString";var Fm;class Nm extends yr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}Fm=Nm;J.CharacterString=Fm;Nm.NAME="CharacterString";var Lm;class Vf extends Of{constructor({value:e,valueDate:t,...r}={}){if(super(r),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let s=0;s<e.length;s++)this.valueBlock.valueHexView[s]=e.charCodeAt(s)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,Ue.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const r=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(r===null){this.error="Wrong input string for conversion";return}const s=parseInt(r[1],10);s>=50?this.year=1900+s:this.year=2e3+s,this.month=parseInt(r[2],10),this.day=parseInt(r[3],10),this.hour=parseInt(r[4],10),this.minute=parseInt(r[5],10),this.second=parseInt(r[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=dr(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=dr(this.month,2),t[2]=dr(this.day,2),t[3]=dr(this.hour,2),t[4]=dr(this.minute,2),t[5]=dr(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Lm=Vf;J.UTCTime=Lm;Vf.NAME="UTCTime";var Mm;class Om extends Vf{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,r="",s="",i=0,o,a=0,c=0;if(e[e.length-1]==="Z")r=e.substring(0,e.length-1),t=!0;else{const d=new Number(e[e.length-1]);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");r=e}if(t){if(r.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(r.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let d=1,f=r.indexOf("+"),m="";if(f===-1&&(f=r.indexOf("-"),d=-1),f!==-1){if(m=r.substring(f+1),r=r.substring(0,f),m.length!==2&&m.length!==4)throw new Error("Wrong input string for conversion");let y=parseInt(m.substring(0,2),10);if(isNaN(y.valueOf()))throw new Error("Wrong input string for conversion");if(a=d*y,m.length===4){if(y=parseInt(m.substring(2,4),10),isNaN(y.valueOf()))throw new Error("Wrong input string for conversion");c=d*y}}}let l=r.indexOf(".");if(l===-1&&(l=r.indexOf(",")),l!==-1){const d=new Number(`0${r.substring(l)}`);if(isNaN(d.valueOf()))throw new Error("Wrong input string for conversion");i=d.valueOf(),s=r.substring(0,l)}else s=r;switch(!0){case s.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case s.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case s.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case s.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const d=1e3*i;this.millisecond=Math.floor(d)}break;default:throw new Error("Wrong input string for conversion")}const u=o.exec(s);if(u===null)throw new Error("Wrong input string for conversion");for(let d=1;d<u.length;d++)switch(d){case 1:this.year=parseInt(u[d],10);break;case 2:this.month=parseInt(u[d],10);break;case 3:this.day=parseInt(u[d],10);break;case 4:this.hour=parseInt(u[d],10)+a;break;case 5:this.minute=parseInt(u[d],10)+c;break;case 6:this.second=parseInt(u[d],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=d.getUTCFullYear(),this.month=d.getUTCMonth(),this.day=d.getUTCDay(),this.hour=d.getUTCHours(),this.minute=d.getUTCMinutes(),this.second=d.getUTCSeconds(),this.millisecond=d.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(dr(this.year,4)),t.push(dr(this.month,2)),t.push(dr(this.day,2)),t.push(dr(this.hour,2)),t.push(dr(this.minute,2)),t.push(dr(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(dr(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}Mm=Om;J.GeneralizedTime=Mm;Om.NAME="GeneralizedTime";var Vm;class Um extends $s{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}Vm=Um;J.DATE=Vm;Um.NAME="DATE";var $m;class Hm extends $s{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}$m=Hm;J.TimeOfDay=$m;Hm.NAME="TimeOfDay";var qm;class zm extends $s{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}qm=zm;J.DateTime=qm;zm.NAME="DateTime";var Km;class jm extends $s{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}Km=jm;J.Duration=Km;jm.NAME="Duration";var Gm;class Wm extends $s{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}Gm=Wm;J.TIME=Gm;Wm.NAME="TIME";function EF(n){const{result:e}=U9(n),t=e.valueBlock.value;return{n:ie(Vr(t[1].toBigInt()),"base64url"),e:ie(Vr(t[2].toBigInt()),"base64url"),d:ie(Vr(t[3].toBigInt()),"base64url"),p:ie(Vr(t[4].toBigInt()),"base64url"),q:ie(Vr(t[5].toBigInt()),"base64url"),dp:ie(Vr(t[6].toBigInt()),"base64url"),dq:ie(Vr(t[7].toBigInt()),"base64url"),qi:ie(Vr(t[8].toBigInt()),"base64url"),kty:"RSA",alg:"RS256"}}function AF(n){if(n.n==null||n.e==null||n.d==null||n.p==null||n.q==null||n.dp==null||n.dq==null||n.qi==null)throw new Ye("JWK was missing components","ERR_INVALID_PARAMETERS");const t=new jt({value:[new Et({value:0}),Et.fromBigInt(Ur(oe(n.n,"base64url"))),Et.fromBigInt(Ur(oe(n.e,"base64url"))),Et.fromBigInt(Ur(oe(n.d,"base64url"))),Et.fromBigInt(Ur(oe(n.p,"base64url"))),Et.fromBigInt(Ur(oe(n.q,"base64url"))),Et.fromBigInt(Ur(oe(n.dp,"base64url"))),Et.fromBigInt(Ur(oe(n.dq,"base64url"))),Et.fromBigInt(Ur(oe(n.qi,"base64url")))]}).toBER();return new Uint8Array(t,0,t.byteLength)}function CF(n){const{result:e}=U9(n),t=e.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:ie(Vr(t[0].toBigInt()),"base64url"),e:ie(Vr(t[1].toBigInt()),"base64url")}}function SF(n){if(n.n==null||n.e==null)throw new Ye("JWK was missing components","ERR_INVALID_PARAMETERS");const t=new jt({value:[new jt({value:[new Nn({value:"1.2.840.113549.1.1.1"}),new va]}),new Lf({valueHex:new jt({value:[Et.fromBigInt(Ur(oe(n.n,"base64url"))),Et.fromBigInt(Ur(oe(n.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(t,0,t.byteLength)}function Vr(n){let e=n.toString(16);e.length%2>0&&(e=`0${e}`);const t=e.length/2,r=new Uint8Array(t);let s=0,i=0;for(;s<t;)r[s]=parseInt(e.slice(i,i+2),16),s+=1,i+=2;return r}function Ur(n){const e=[];return n.forEach(function(t){let r=t.toString(16);r.length%2>0&&(r=`0${r}`),e.push(r)}),BigInt("0x"+e.join(""))}const TF=16,y6=32,x6=1e4;async function IF(n,e){const t=Fr.get(),s=new jt({value:[new Et({value:0}),new jt({value:[new Nn({value:"1.2.840.113549.1.1.1"}),new va]}),new oi({valueHex:n.marshal()})]}).toBER(),i=new Uint8Array(s,0,s.byteLength),o=W1(TF),a=await IE(kE,e,o,{c:x6,dkLen:y6}),c=W1(16),l=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),u=await t.subtle.encrypt({name:"AES-CBC",iv:c},l,i),d=new jt({value:[new oi({valueHex:o}),new Et({value:x6}),new Et({value:y6}),new jt({value:[new Nn({value:"1.2.840.113549.2.11"}),new va]})]}),f=new jt({value:[new Nn({value:"1.2.840.113549.1.5.13"}),new jt({value:[new jt({value:[new Nn({value:"1.2.840.113549.1.5.12"}),d]}),new jt({value:[new Nn({value:"2.16.840.1.101.3.4.1.42"}),new oi({valueHex:c})]})]})]}),y=new jt({value:[f,new oi({valueHex:u})]}).toBER(),b=new Uint8Array(y,0,y.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...ie(b,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function kF(n){const e=await Fr.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:n,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await Ym(e);return{privateKey:t[0],publicKey:t[1]}}async function Qm(n){const t=[await Fr.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await RF(n)],r=await Ym({privateKey:t[0],publicKey:t[1]});return{privateKey:r[0],publicKey:r[1]}}async function PF(n,e){const t=await Fr.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await Fr.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(r,0,r.byteLength)}async function DF(n,e,t){const r=await Fr.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Fr.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,e,t instanceof Uint8Array?t:t.subarray())}async function Ym(n){if(n.privateKey==null||n.publicKey==null)throw new Ye("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Fr.get().subtle.exportKey("jwk",n.privateKey),Fr.get().subtle.exportKey("jwk",n.publicKey)])}async function RF(n){return Fr.get().subtle.importKey("jwk",{kty:n.kty,n:n.n,e:n.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function Uf(n){if(n.kty!=="RSA")throw new Ye("invalid key type","ERR_INVALID_KEY_TYPE");if(n.n==null)throw new Ye("invalid key modulus","ERR_INVALID_KEY_MODULUS");return oe(n.n,"base64url").length*8}const Ha=8192;class $f{constructor(e){p(this,"_key");this._key=e}verify(e,t){return DF(this._key,t,e)}marshal(){return SF(this._key)}get bytes(){return ga.encode({Type:ar.RSA,Data:this.marshal()}).subarray()}equals(e){return Ne(this.bytes,e.bytes)}hash(){const e=Xt.digest(this.bytes);return os(e)?e.then(({bytes:t})=>t):e.bytes}}class P0{constructor(e,t){p(this,"_key");p(this,"_publicKey");this._key=e,this._publicKey=t}genSecret(){return W1(16)}sign(e){return PF(this._key,e)}get public(){if(this._publicKey==null)throw new Ye("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new $f(this._publicKey)}marshal(){return AF(this._key)}get bytes(){return ma.encode({Type:ar.RSA,Data:this.marshal()}).subarray()}equals(e){return Ne(this.bytes,e.bytes)}hash(){const e=Xt.digest(this.bytes);return os(e)?e.then(({bytes:t})=>t):e.bytes}async id(){const e=await this.public.hash();return ie(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8")return IF(this,e);if(t==="libp2p-key")return Pf(this.bytes,e);throw new Ye(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}async function BF(n){const e=EF(n);if(Uf(e)>Ha)throw new Ye("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await Qm(e);return new P0(t.privateKey,t.publicKey)}function FF(n){const e=CF(n);if(Uf(e)>Ha)throw new Ye("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new $f(e)}async function NF(n){if(Uf(n)>Ha)throw new Ye("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await Qm(n);return new P0(e.privateKey,e.publicKey)}async function LF(n){if(n>Ha)throw new Ye("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await kF(n);return new P0(e.privateKey,e.publicKey)}const MF=Object.freeze(Object.defineProperty({__proto__:null,MAX_RSA_KEY_SIZE:Ha,RsaPrivateKey:P0,RsaPublicKey:$f,fromJwk:NF,generateKeyPair:LF,unmarshalRsaPrivateKey:BF,unmarshalRsaPublicKey:FF},Symbol.toStringTag,{value:"Module"}));function OF(){return gr.utils.randomPrivateKey()}function VF(n,e){const t=Xt.digest(e instanceof Uint8Array?e:e.subarray());if(os(t))return t.then(({digest:r})=>gr.sign(r,n).toDERRawBytes()).catch(r=>{throw new Ye(String(r),"ERR_INVALID_INPUT")});try{return gr.sign(t.digest,n).toDERRawBytes()}catch(r){throw new Ye(String(r),"ERR_INVALID_INPUT")}}function UF(n,e,t){const r=Xt.digest(t instanceof Uint8Array?t:t.subarray());if(os(r))return r.then(({digest:s})=>gr.verify(e,s,n)).catch(s=>{throw new Ye(String(s),"ERR_INVALID_INPUT")});try{return gr.verify(e,r.digest,n)}catch(s){throw new Ye(String(s),"ERR_INVALID_INPUT")}}function $F(n){return gr.ProjectivePoint.fromHex(n).toRawBytes(!0)}function HF(n){try{gr.getPublicKey(n,!0)}catch(e){throw new Ye(String(e),"ERR_INVALID_PRIVATE_KEY")}}function Xm(n){try{gr.ProjectivePoint.fromHex(n)}catch(e){throw new Ye(String(e),"ERR_INVALID_PUBLIC_KEY")}}function qF(n){try{return gr.getPublicKey(n,!0)}catch(e){throw new Ye(String(e),"ERR_INVALID_PRIVATE_KEY")}}class Hf{constructor(e){p(this,"_key");Xm(e),this._key=e}verify(e,t){return UF(this._key,t,e)}marshal(){return $F(this._key)}get bytes(){return ga.encode({Type:ar.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ne(this.bytes,e.bytes)}async hash(){const e=Xt.digest(this.bytes);let t;return os(e)?{bytes:t}=await e:t=e.bytes,t}}class qf{constructor(e,t){p(this,"_key");p(this,"_publicKey");this._key=e,this._publicKey=t??qF(e),HF(this._key),Xm(this._publicKey)}sign(e){return VF(this._key,e)}get public(){return new Hf(this._publicKey)}marshal(){return this._key}get bytes(){return ma.encode({Type:ar.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ne(this.bytes,e.bytes)}hash(){const e=Xt.digest(this.bytes);return os(e)?e.then(({bytes:t})=>t):e.bytes}async id(){const e=await this.public.hash();return ie(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return Pf(this.bytes,e);throw new Ye(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function zF(n){return new qf(n)}function KF(n){return new Hf(n)}async function jF(){const n=OF();return new qf(n)}const GF=Object.freeze(Object.defineProperty({__proto__:null,Secp256k1PrivateKey:qf,Secp256k1PublicKey:Hf,generateKeyPair:jF,unmarshalSecp256k1PrivateKey:zF,unmarshalSecp256k1PublicKey:KF},Symbol.toStringTag,{value:"Module"})),Jm={rsa:MF,ed25519:dF,secp256k1:GF};function WF(n){const e=Object.keys(Jm).join(" / ");return new Ye(`invalid or unsupported key type ${n}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function zf(n){if(n=n.toLowerCase(),n==="rsa"||n==="ed25519"||n==="secp256k1")return Jm[n];throw WF(n)}async function QF(n,e){return zf(n).generateKeyPair(2048)}function YF(n,e){return e=(e??"rsa").toLowerCase(),zf(e),n.bytes}function XF(n,e){return e=(e??"rsa").toLowerCase(),zf(e),n.bytes}const Zm=Symbol.for("nodejs.util.inspect.custom"),JF=Object.values(Jo).map(n=>n.decoder).reduce((n,e)=>n.or(e),Jo.identity.decoder),ey=114,Kf=36,jf=37;var G6;class Gf{constructor(e){p(this,"type");p(this,"multihash");p(this,"privateKey");p(this,"publicKey");p(this,"string");p(this,G6,!0);this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Ke.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Ce.createV1(ey,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return Ne(this.multihash.bytes,e);if(typeof e=="string")return eN(e).equals(this);if(((t=e==null?void 0:e.multihash)==null?void 0:t.bytes)!=null)return Ne(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[(G6=I9,Zm)](){return`PeerId(${this.toString()})`}}class D0 extends Gf{constructor(t){super({...t,type:"RSA"});p(this,"type","RSA");p(this,"publicKey");this.publicKey=t.publicKey}}class R0 extends Gf{constructor(t){super({...t,type:"Ed25519"});p(this,"type","Ed25519");p(this,"publicKey");this.publicKey=t.multihash.digest}}class B0 extends Gf{constructor(t){super({...t,type:"secp256k1"});p(this,"type","secp256k1");p(this,"publicKey");this.publicKey=t.multihash.digest}}const J1=2336;var W6,Q6;class ZF{constructor(e){p(this,"type","url");p(this,"multihash");p(this,"privateKey");p(this,"publicKey");p(this,"url");p(this,W6,!0);this.url=e.toString(),this.multihash=Rr.digest(oe(this.url))}[(Q6=Zm,W6=I9,Q6)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toCID(){return Ce.createV1(J1,this.multihash)}toBytes(){return this.toCID().bytes}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=ie(e)),e.toString()===this.toString())}}function eN(n,e){if(n.charAt(0)==="1"||n.charAt(0)==="Q"){const t=cr(Ke.decode(`z${n}`));return n.startsWith("12D")?new R0({multihash:t}):n.startsWith("16U")?new B0({multihash:t}):new D0({multihash:t})}return tN(JF.decode(n))}function tN(n){try{const e=cr(n);if(e.code===Rr.code){if(e.digest.length===Kf)return new R0({multihash:e});if(e.digest.length===jf)return new B0({multihash:e})}if(e.code===Xt.code)return new D0({multihash:e})}catch{return rN(Ce.decode(n))}throw new Error("Supplied PeerID CID is invalid")}function rN(n){if((n==null?void 0:n.multihash)==null||n.version==null||n.version===1&&n.code!==ey&&n.code!==J1)throw new Error("Supplied PeerID CID is invalid");if(n.code===J1){const t=ie(n.multihash.digest);return new ZF(new URL(t))}const e=n.multihash;if(e.code===Xt.code)return new D0({multihash:n.multihash});if(e.code===Rr.code){if(e.digest.length===Kf)return new R0({multihash:n.multihash});if(e.digest.length===jf)return new B0({multihash:n.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function nN(n,e){return n.length===Kf?new R0({multihash:Ss(Rr.code,n),privateKey:e}):n.length===jf?new B0({multihash:Ss(Rr.code,n),privateKey:e}):new D0({multihash:await Xt.digest(n),publicKey:n,privateKey:e})}const sN=async()=>{const n=await QF("Ed25519"),e=await ty(n);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)};async function ty(n){return nN(YF(n.public),XF(n))}class iN{constructor(e){this.peer=e,this.connections=new Map}async dial(e){const t=e.getPeerId();if(!t)throw new Error("No peer ID in multiaddr");const r=this.peer.connect(t,{reliable:!0});return new Promise((s,i)=>{r.on("open",()=>{this.connections.set(t,r),s({id:t,remotePeer:t,remoteAddr:e,close:()=>r.close(),abort:()=>r.close(),getStreams:()=>[{id:`stream-${t}`,protocol:"/webrtc/1.0.0",read:o=>{r.on("data",a=>o(null,a)),r.on("close",()=>o(new Error("Connection closed")))},write:o=>r.send(o),close:()=>r.close(),abort:()=>r.close()}]})}),r.on("error",i)})}createListener(e){return{listen:t=>{this.peer.on("connection",r=>{var s;this.connections.set(r.peer,r),(s=e.onConnection)==null||s.call(e,{id:r.peer,remotePeer:r.peer,remoteAddr:t,close:()=>r.close(),abort:()=>r.close(),getStreams:()=>[{id:`stream-${r.peer}`,protocol:"/webrtc/1.0.0",read:i=>{r.on("data",o=>i(null,o)),r.on("close",()=>i(new Error("Connection closed")))},write:i=>r.send(i),close:()=>r.close(),abort:()=>r.close()}]})})},close:()=>this.peer.destroy(),getAddrs:()=>[qe(`/webrtc/p2p/${this.peer.id}`)]}}filter(e){return e.filter(t=>t.protoNames().includes("webrtc"))}}class ry{constructor(e,t=!1){this.peers=new Map,this.knownObjects=new Map,this.chunkToPeerMap=new Map,this.pendingRequests=new Map,this.db=null,this.keypair=e,this.activeNodes=new Set,this.nodes=new Set,this.offlineQueue=[],this.isNode=t,this.peerId=null,this.peer=null,this.libp2p=null,this.kadDht=null,this.connectionAttempts=new Map,this.maxConnectionAttempts=3,this.connectionRetryDelay=5e3,this.averageLatency=0,this.bootstrapNodes=new Set,this.nodeLatencies=new Map,this.peerId=this.isNode?`node-${this.keypair}`:e;const r=Pe.SHA256(this.peerId).toString(Pe.enc.Hex);this.kademliaId=r.substring(0,40),console.log("DHT initialized with keypair:",e,"isNode:",t),this.initializeKnownNodes()}async initializeLibp2p(){if(!this.isNode)return;this.peer=new G2(this.peerId,{host:"0.peerjs.com",port:443,path:"/",secure:!0,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}]},debug:3}),await new Promise((t,r)=>{this.peer.on("open",t),this.peer.on("error",r)});let e;try{const t=this.base64UrlToUint8Array(this.keypair);if(e=await ty(t),Pe.SHA256(e.toString()).toString(Pe.enc.Hex).substring(0,40)!==this.kademliaId)throw console.warn("Derived PeerId does not match kademliaId, generating new PeerId"),new Error("PeerId mismatch")}catch(t){console.warn("Failed to create PeerId from keypair, generating new Ed25519 PeerId:",t),e=await sN(),this.kademliaId=Pe.SHA256(e.toString()).toString(Pe.enc.Hex).substring(0,40),this.peerId=this.isNode?`node-${this.uint8ArrayToBase64Url(e.privateKey)}`:this.uint8ArrayToBase64Url(e.privateKey)}this.libp2p=await oT({peerId:e,transports:[new iN(this.peer)],addresses:{listen:[`/webrtc/p2p/${this.peerId}`]},services:{dht:VI({kBucketSize:20,clientMode:!1})}}),this.kadDht=this.libp2p.services.dht,console.log("libp2p and kad-dht initialized with PeerId:",e.toString())}async initializeKnownNodes(){const e=async()=>{try{const t=await QB(NB(u7,"nodes"));if(this.nodes.clear(),t.forEach(r=>this.nodes.add(`node-${r.id}`)),console.log("Fetched nodes:",Array.from(this.nodes)),this.nodes.size>0){const r=await this.selectBootstrapNode();r&&(this.bootstrapNodes.add(r),await this.queryBootstrapNode(r))}}catch(t){console.error("Failed to fetch nodes from Firestore:",t),this.nodes.clear()}};await e(),setInterval(e,5*60*1e3),this.isNode&&(await this.initializeLibp2p(),setInterval(()=>this.refreshRoutingTable(),10*60*1e3),setInterval(()=>this.republishData(),6*60*60*1e3),setInterval(()=>this.cleanupDHTStore(),24*60*60*1e3))}async selectBootstrapNode(){const e=Array.from(this.nodes).filter(s=>s!==this.peerId);if(e.length===0)return null;let t=1/0,r=null;for(const s of e.slice(0,5)){const i=await this.measureLatencyToPeer(s);i!==null&&i<t&&(t=i,r=s)}return r||(r=e[Math.floor(Math.random()*e.length)]),r}async queryBootstrapNode(e){try{await this.connectToPeer(e);const t=this.peers.get(e);if(t&&t.connected&&t.conn){const r=`${e}-getKnownNodes-${Date.now()}`;return t.conn.send({type:"getKnownNodes",requestId:r,peerId:this.peerId}),new Promise((s,i)=>{this.pendingRequests.set(r,{resolve:o=>{o.forEach(a=>{if(a!==this.peerId&&(this.bootstrapNodes.add(a),this.isNode)){const c=Pe.SHA256(a).toString(Pe.enc.Hex).substring(0,40);this.kadDht.addPeer(c,[qe(`/webrtc/p2p/${a}`)]),this.nodeLatencies.set(c,1/0)}}),console.log("Received known nodes from bootstrap:",o),s()},reject:i}),setTimeout(()=>{this.pendingRequests.has(r)&&(this.pendingRequests.delete(r),i(new Error("Bootstrap query timed out")))},1e4)})}}catch(t){console.error("Failed to query bootstrap node:",t)}}async measureLatencyToPeer(e){const t=this.peers.get(e);if(t&&t.connected&&t.conn){const r=Date.now();try{await new Promise((i,o)=>{const a=`${e}-ping-${Date.now()}`;t.conn.send({type:"ping",requestId:a}),this.pendingRequests.set(a,{resolve:i,reject:o}),setTimeout(()=>{this.pendingRequests.has(a)&&(this.pendingRequests.delete(a),o(new Error("Ping timeout")))},2e3)});const s=Date.now()-r;if(this.isNode){const i=Pe.SHA256(e).toString(Pe.enc.Hex).substring(0,40);this.nodeLatencies.set(i,s)}return s}catch(s){return console.warn(`Failed to measure latency for peer ${e}:`,s),null}}return null}async measureLatency(){const e=[],t=Array.from(this.activeNodes).slice(0,5);for(const r of t){const s=await this.measureLatencyToPeer(r);s!==null&&e.push(s)}this.averageLatency=e.length>0?e.reduce((r,s)=>r+s,0)/e.length:0,console.log(`Average latency: ${this.averageLatency} ms`)}async refreshRoutingTable(){if(this.isNode)try{const e=Pe.SHA256(String(Math.random())).toString(Pe.enc.Hex).substring(0,40),t=await this.kadDht.getClosestPeers(e);for(const r of t)await this.connectToPeer(r.id.toString());console.log("Refreshed routing table")}catch(e){console.error("Failed to refresh routing table:",e)}}async initDB(){return new Promise((e,t)=>{const s=indexedDB.open("dcrypt_db",6);let i;s.onupgradeneeded=o=>{i=s.result,i.objectStoreNames.contains("store")||i.createObjectStore("store",{keyPath:"id"}),i.objectStoreNames.contains("transactions")||i.createObjectStore("transactions",{keyPath:"id",autoIncrement:!0}),i.objectStoreNames.contains("offlineQueue")||i.createObjectStore("offlineQueue",{keyPath:"id",autoIncrement:!0}),i.objectStoreNames.contains("chunkCache")||i.createObjectStore("chunkCache",{keyPath:"id"}),i.objectStoreNames.contains("dhtStore")||i.createObjectStore("dhtStore",{keyPath:"id"}),console.log("DHT database upgraded to version",6)},s.onsuccess=()=>{this.db=s.result,console.log("DHT IndexedDB opened at version",this.db.version),e()},s.onerror=o=>t(new Error(`Failed to open IndexedDB: ${o.target.error.message}`))})}async loadKnownObjects(){if(!this.db)throw new Error("IndexedDB not initialized");try{const r=this.db.transaction("store","readonly").objectStore("store").getAll();r.onsuccess=()=>{r.result.forEach(s=>{if(s.id!=="dcrypt_identity")try{const{metadata:i,chunks:o}=JSON.parse(s.value);this.knownObjects.set(s.id,{metadata:i,chunks:o})}catch(i){console.error("Failed to parse known object:",s.id,i)}}),console.log("Loaded known objects from IndexedDB")}}catch(e){console.error("Failed to load known objects:",e)}}async syncUserData(){if(!this.db)throw new Error("IndexedDB not initialized");try{await this.dbPut("store",{id:"dcrypt_identity",value:this.keypair}),await this.updateBalance(),this.activeNodes.size>0&&await this.processOfflineQueue();const e={type:"userData",peerId:this.peerId,keypair:this.keypair,balance:await this.getBalance(this.keypair),timestamp:Date.now()};this.broadcast(e),console.log("User data synced successfully")}catch(e){throw console.error("Sync failed:",e),e}}async saveUserData(){if(!this.db)throw new Error("IndexedDB not initialized");try{await this.dbPut("store",{id:"dcrypt_identity",value:this.keypair}),await this.updateBalance(),console.log("User data saved to IndexedDB")}catch(e){throw console.error("Save failed:",e),e}}async initSwarm(){try{return this.isNode?void 0:(console.log("Initializing PeerJS with Peer ID:",this.peerId),this.peer=new G2(this.peerId,{host:"0.peerjs.com",port:443,path:"/",secure:!0,config:{iceServers:[{urls:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=tcp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}]},debug:3}),await new Promise((e,t)=>{this.peer.on("open",r=>{console.log(`PeerJS connection opened with ID: ${r}`),this.activeNodes.add(this.peerId),this.peer.on("connection",s=>this.handleConnection(s)),this.peer.on("error",s=>{var i;if(console.error("PeerJS error:",s.type,s.message),s.type==="peer-unavailable"){const o=(i=s.message.match(/Peer (.+) is unavailable/))==null?void 0:i[1];o&&this.handlePeerDisconnect(o)}}),this.peer.on("disconnected",()=>{console.log("PeerJS disconnected. Attempting to reconnect..."),this.peer.reconnect()}),window.addEventListener("beforeunload",()=>{this.peer&&!this.peer.destroyed&&(this.peer.destroy(),console.log("PeerJS peer destroyed on page unload"))}),setInterval(()=>this.discoverPeers(),3e3),setInterval(()=>this.measureLatency(),6e4),e()}),this.peer.on("error",r=>t(r))}))}catch(e){throw console.error("initSwarm failed:",e),e}}async discoverPeers(){console.log("Discovering peers...");const e=[...Array.from(this.nodes),...Array.from(this.bootstrapNodes),...Array.from(this.activeNodes)].filter(t=>t!==this.peerId);if(e.length===0){console.warn("No known peers to connect to.");return}if(this.isNode){const t=await this.kadDht.getClosestPeers(this.kademliaId);e.push(...t.map(r=>r.id.toString()))}e.forEach(t=>{this.peers.has(t)?this.peers.get(t).connected||this.connectToPeer(t):(this.peers.set(t,{connected:!1,conn:null}),console.log("Discovered peer:",t),this.connectToPeer(t))}),this.peers.size>50&&Array.from(this.peers.entries()).filter(([r,s])=>!s.connected).sort((r,s)=>(this.connectionAttempts.get(s[0])||0)-(this.connectionAttempts.get(r[0])||0)).slice(0,this.peers.size-50).forEach(([r])=>{if(this.peers.delete(r),this.connectionAttempts.delete(r),this.activeNodes.delete(r),this.isNode){const s=Pe.SHA256(r).toString(Pe.enc.Hex).substring(0,40);this.kadDht.removePeer(s)}})}async connectToPeer(e,t=1){var s;if((s=this.peers.get(e))!=null&&s.connected)return;console.log(`Connecting to peer: ${e} (Attempt ${t}/3)`);const r=this.peer.connect(e,{reliable:!0});r.on("open",()=>{if(console.log(`Connection opened with peer: ${e}`),this.peers.set(e,{connected:!0,conn:r}),this.activeNodes.add(e),this.isNode){const i=Pe.SHA256(e).toString(Pe.enc.Hex).substring(0,40);this.kadDht.addPeer(i,[qe(`/webrtc/p2p/${e}`)]),this.nodeLatencies.set(i,1/0)}r.send({type:"handshake",peerId:this.peerId})}),r.on("data",i=>{console.log(`Received data from peer ${e}:`,i),this.handlePeerData(i,e)}),r.on("close",()=>{console.log(`Connection closed with peer ${e}`),this.handlePeerDisconnect(e)}),r.on("error",i=>{console.error(`Connection error with peer ${e}:`,i),t<3?setTimeout(()=>this.connectToPeer(e,t+1),5e3*t):(console.log(`Max attempts reached for peer ${e}. Marking as unreachable.`),this.handlePeerDisconnect(e))})}handleConnection(e){const t=e.peer;console.log(`Incoming connection from peer: ${t} at ${Date.now()}`),e.on("open",()=>{if(console.log(`Connection opened with peer: ${t}`),this.peers.set(t,{connected:!0,conn:e}),this.activeNodes.add(t),this.isNode){const r=Pe.SHA256(t).toString(Pe.enc.Hex).substring(0,40);this.kadDht.addPeer(r,[qe(`/webrtc/p2p/${t}`)]),this.nodeLatencies.set(r,1/0)}}),e.on("data",r=>{console.log(`Received data from peer ${t}:`,r),this.handlePeerData(r,t)}),e.on("close",()=>{console.log(`Connection closed with peer ${t}`),this.handlePeerDisconnect(t)}),e.on("error",r=>{console.error(`Connection error with peer ${t}:`,r),this.handlePeerDisconnect(t)})}handlePeerDisconnect(e){const t=this.peers.get(e);if(t){if(t.connected=!1,t.conn=null,this.activeNodes.delete(e),this.isNode){const r=Pe.SHA256(e).toString(Pe.enc.Hex).substring(0,40);this.kadDht.removePeer(r),this.nodeLatencies.delete(r)}console.log(`Peer disconnected: ${e}. Will reconnect on next discovery.`)}}handlePeerData(e,t){switch(console.log(`Received data from peer ${t}:`,e),e.type){case"handshake":console.log(`Handshake from peer: ${t}`),this.activeNodes.add(t);break;case"chunk":this.chunkToPeerMap.set(e.chunkHash,new Set([...this.chunkToPeerMap.get(e.chunkHash)||[],t])),console.log(`Updated chunkToPeerMap for chunk ${e.chunkHash} with peer ${t}`);break;case"ip":this.knownObjects.set(e.ipHash,{metadata:e.metadata,chunks:e.chunkHashes}),this.dbPut("store",{id:e.ipHash,value:JSON.stringify({metadata:e.metadata,chunks:e.chunkHashes})}),console.log(`Received IP ${e.ipHash} from peer ${t}`);break;case"chunkRequest":this.handleChunkRequest(e,t);break;case"chunkResponse":this.handleChunkResponse(e);break;case"metadataRequest":this.handleMetadataRequest(e,t);break;case"metadataResponse":this.handleMetadataResponse(e);break;case"userData":console.log(`Received user data from peer ${t}:`,e);break;case"storeChunk":this.storeChunkFromPeer(e.chunkHash,e.chunkData,t);break;case"ping":peer=this.peers.get(t),peer&&peer.connected&&peer.conn&&peer.conn.send({type:"pong",requestId:e.requestId});break;case"pong":const r=this.pendingRequests.get(e.requestId);r&&(r.resolve(),this.pendingRequests.delete(e.requestId));break;case"commission":console.log(`Received commission of ${e.amount}. New balance: ${e.newBalance}`);break;case"getKnownNodes":if(peer=this.peers.get(t),peer&&peer.connected&&peer.conn){const o=Array.from(this.activeNodes);peer.conn.send({type:"knownNodesResponse",requestId:e.requestId,nodes:o,peerId:this.peerId})}break;case"knownNodesResponse":const s=this.pendingRequests.get(e.requestId);s&&(s.resolve(e.nodes),this.pendingRequests.delete(e.requestId));break;case"storeDHT":this.storeDHTFromPeer(e.key,e.value,e.ttl,t);break;case"findDHT":this.handleFindDHT(e,t);break;case"findDHTResponse":const i=this.pendingRequests.get(e.requestId);i&&(i.resolve({value:e.value,nodes:e.nodes}),this.pendingRequests.delete(e.requestId));break;default:console.warn(`Unknown data type from peer ${t}:`,e.type)}}async storeDHT(e,t,r=864e5){try{const s=Pe.SHA256(e).toString(Pe.enc.Hex).substring(0,40);let i=[];if(this.isNode)i=(await this.kadDht.getClosestPeers(s)).map(a=>({id:a.id.toString()})).slice(0,20);else{const o=Array.from(this.bootstrapNodes)[0];if(!o)throw new Error("No bootstrap node available");i=await this.requestNodesFromPeer(o,s)}for(const o of i){const a=o.id||o.address,c=this.peers.get(a);c&&c.connected&&c.conn&&c.conn.send({type:"storeDHT",key:e,value:t,ttl:r,peerId:this.peerId})}this.isNode&&(await this.storeDHTFromPeer(e,t,r,this.peerId),await this.kadDht.put(Buffer.from(s),Buffer.from(t))),console.log(`Stored DHT key ${e} on ${i.length} nodes`)}catch(s){throw console.error("Failed to store DHT key:",s),s}}async storeDHTFromPeer(e,t,r,s){if(this.isNode)try{await this.dbPut("dhtStore",{id:e,value:t,ttl:r,timestamp:Date.now()});const i=Pe.SHA256(e).toString(Pe.enc.Hex).substring(0,40);await this.kadDht.put(Buffer.from(i),Buffer.from(t)),console.log(`Stored DHT key ${e} from peer ${s}`)}catch(i){console.error(`Failed to store DHT key ${e} from peer ${s}:`,i)}}async findDHT(e){try{const t=Pe.SHA256(e).toString(Pe.enc.Hex).substring(0,40);if(this.isNode){if(await this.kadDht.get(Buffer.from(t))){const i=await this.dbGet("dhtStore",e);if(i&&i.timestamp+i.ttl>Date.now())return i.value}const s=await this.kadDht.getClosestPeers(t);for(const i of s){const o=await this.requestDHTFromPeer(i.id.toString(),e);if(o)return o}}else{const r=Array.from(this.bootstrapNodes)[0];if(!r)throw new Error("No bootstrap node available");const s=await this.requestDHTFromPeer(r,e);if(s)return s}throw new Error(`DHT key ${e} not found`)}catch(t){throw console.error("Failed to find DHT key:",t),t}}async requestNodesFromPeer(e,t){const r=this.peers.get(e);if(!r||!r.connected||!r.conn)throw new Error(`Peer ${e} is not connected`);const s=`${e}-findNodes-${Date.now()}`;return r.conn.send({type:"findDHT",key:t,requestId:s,peerId:this.peerId}),new Promise((i,o)=>{this.pendingRequests.set(s,{resolve:({nodes:a})=>i(a.map(c=>({id:c}))),reject:o}),setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),o(new Error(`Request for nodes for key ${t} timed out`)))},1e4)})}async requestDHTFromPeer(e,t){const r=this.peers.get(e);if(!r||!r.connected||!r.conn)throw new Error(`Peer ${e} is not connected`);const s=`${e}-findDHT-${Date.now()}`;return r.conn.send({type:"findDHT",key:t,requestId:s,peerId:this.peerId}),new Promise((i,o)=>{this.pendingRequests.set(s,{resolve:({value:a,nodes:c})=>i(a||null),reject:o}),setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),o(new Error(`Request for DHT key ${t} timed out`)))},1e4)})}async handleFindDHT(e,t){if(!this.isNode)return;const{key:r,requestId:s}=e,i=this.peers.get(t);if(!i||!i.connected||!i.conn)return;const o=await this.dbGet("dhtStore",r);if(o&&o.timestamp+o.ttl>Date.now())i.conn.send({type:"findDHTResponse",requestId:s,value:o.value,nodes:[],peerId:this.peerId});else{const a=Pe.SHA256(r).toString(Pe.enc.Hex).substring(0,40),c=await this.kadDht.getClosestPeers(a);i.conn.send({type:"findDHTResponse",requestId:s,value:null,nodes:c.map(l=>l.id.toString()),peerId:this.peerId})}}async republishData(){if(this.isNode)try{const e=await this.dbGetAll("dhtStore");for(const t of e)t.timestamp+t.ttl>Date.now()&&await this.storeDHT(t.id,t.value,t.ttl);console.log("Republished DHT data")}catch(e){console.error("Failed to republish DHT data:",e)}}async cleanupDHTStore(){if(this.isNode)try{const t=this.db.transaction("dhtStore","readwrite").objectStore("dhtStore"),r=await new Promise(s=>{t.getAll().onsuccess=i=>s(i.target.result)});for(const s of r)s.timestamp+s.ttl<=Date.now()&&await new Promise(i=>{t.delete(s.id).onsuccess=i});console.log("Cleaned up expired DHT entries")}catch(e){console.error("Failed to clean up DHT store:",e)}}async storeChunkFromPeer(e,t,r){if(this.isNode)try{await this.dbPut("chunkCache",{id:e,value:t});let s=this.chunkToPeerMap.get(e)||new Set;s.add(this.peerId),this.chunkToPeerMap.set(e,s),console.log(`Stored chunk ${e} from peer ${r}`)}catch(s){console.error(`Failed to store chunk ${e} from peer ${r}:`,s)}}async publishChunk(e,t,r,s){if(!this.db)throw new Error("IndexedDB not initialized");try{if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid chunk hash");await this.dbPut("chunkCache",{id:e,value:t});let i=this.chunkToPeerMap.get(e)||new Set;if(i.add(this.peerId),this.chunkToPeerMap.set(e,i),this.activeNodes.size>0){const o=Pe.SHA256(e).toString(Pe.enc.Hex).substring(0,40);let a=[];if(this.isNode)a=(await this.kadDht.getClosestPeers(o)).map(l=>({id:l.id.toString()})).slice(0,3);else{const c=Array.from(this.bootstrapNodes)[0];if(!c)throw new Error("No bootstrap node available");a=await this.requestNodesFromPeer(c,o),a=a.slice(0,3)}a=a.filter(c=>(c.id||c.address).startsWith("node-"));for(const c of a){const l=c.id||c.address,u=this.peers.get(l);u&&u.connected&&u.conn&&(u.conn.send({type:"storeChunk",chunkHash:e,chunkData:t,peerId:this.peerId}),i.add(l),this.chunkToPeerMap.set(e,i),console.log(`Sent chunk ${e} to node ${l}`))}if(r===s-1){const c={};this.chunkToPeerMap.forEach((u,d)=>{c[d]=Array.from(u)});const l=this.chunkToIpHash.get(e)||e;await this.storeDHT(l,JSON.stringify(c))}}else await this.queueOfflineOperation({type:"publishChunk",chunkHash:e,chunkData:t,chunkIndex:r,totalChunks:s});this.broadcastChunk(e)}catch(i){throw console.error("publishChunk failed:",i),i}}broadcastChunk(e){const t={type:"chunk",chunkHash:e,peerId:this.peerId};this.broadcast(t),console.log(`Broadcasted chunk ${e} to ${this.activeNodes.size} peers`)}async publishIP(e,t,r){if(!this.db||!this.keypair)throw new Error("IndexedDB or keypair not initialized");try{const s=Array.isArray(e.tags)?e.tags.map(B=>String(B).trim()).filter(B=>B!==""):[],i=!!e.isPremium,o=i?e.priceUsd||30:0,a=new Uint8Array(t),c=e.content_type||"",l=this.keypair,d=XB(a,c,s,i,o,l,r||"text/plain"),f=JB(d),m=await S9(f),y=this.uint8ArrayToBase64Url(m),b=Array.from(this.activeNodes).filter(B=>B.startsWith("node-")),x=b.length>0?b.length:1,D=await eF(d,this.keypair,x),S=await Promise.all(D.map(B=>ZB(B).then(F=>this.uint8ArrayToBase64Url(F)))),_={...e,chunk_count:D.length,isPremium:i,priceUsd:o,chunks:S},E={metadata:_,chunks:S};this.knownObjects.set(y,E),await this.dbPut("store",{id:y,value:JSON.stringify(E)}),this.chunkToIpHash=new Map,S.forEach(B=>this.chunkToIpHash.set(B,y));for(let B=0;B<D.length;B++)await this.publishChunk(S[B],D[B],B,D.length);return this.activeNodes.size>0?this.broadcastIP(y,_,S):await this.queueOfflineOperation({type:"publishIP",ipHash:y,metadata:_,chunkHashes:S}),y}catch(s){throw console.error("publishIP failed:",s),s}}broadcastIP(e,t,r){const s={type:"ip",ipHash:e,metadata:t,chunkHashes:r,peerId:this.peerId};this.broadcast(s),console.log(`Broadcasted IP ${e} to ${this.activeNodes.size} peers`)}async requestData(e){if(!this.db)throw new Error("IndexedDB not initialized");try{if(!e)throw new Error("IP not found");const t=await this.findDHT(e.metadata.hash||e.chunks[0]),r=JSON.parse(t);this.chunkToPeerMap=new Map,Object.entries(r).forEach(([u,d])=>{this.chunkToPeerMap.set(u,new Set(d))});const s=[];for(const u of e.chunks){const d=await this.dbGet("chunkCache",u);if(d&&d.value){s.push({chunk:d.value,hash:u});continue}const f=this.chunkToPeerMap.get(u);if(!f||f.size===0)throw new Error(`No peers found with chunk ${u}`);const m=Array.from(f).filter(D=>D.startsWith("node-")),y=Array.from(f).filter(D=>!D.startsWith("node-"));let b=!1,x=null;for(const D of[...m,...y])if(this.activeNodes.has(D))try{const S=await this.fetchChunkFromPeer(D,u);await this.dbPut("chunkCache",{id:u,value:S}),s.push({chunk:S,hash:u}),b=!0;break}catch(S){x=S,console.error(`Failed to fetch chunk ${u} from peer ${D}:`,S)}if(!b)throw x||new Error(`No available peer for chunk ${u}`)}const i=s.sort((u,d)=>f6(u.chunk)-f6(d.chunk)),o=await Promise.all(i.map(({chunk:u})=>tF(u,this.keypair))),a=new Uint8Array(o.reduce((u,d)=>u+d.length,0));let c=0;for(const u of o)a.set(u,c),c+=u.length;const l=rF(i[0].chunk);return{data:a,fileType:l}}catch(t){throw console.error("requestData failed:",t),t}}async getIPmetadata(e){try{const t=this.knownObjects.get(e);if(t)return t;const r=await this.findDHT(e),s=JSON.parse(r);this.chunkToPeerMap=new Map,Object.entries(s).forEach(([l,u])=>{this.chunkToPeerMap.set(l,new Set(u))});const i=Array.from(this.activeNodes).find(l=>l.startsWith("node-"));if(!i)throw new Error("No nodes available");const o=i,a=`${o}-${e}-${Date.now()}`,c=this.peers.get(o);if(!c||!c.connected||!c.conn)throw new Error(`Peer ${o} is not connected`);return c.conn.send({type:"metadataRequest",requestId:a,ipHash:e,peerId:this.peerId}),new Promise((l,u)=>{this.pendingRequests.set(a,{resolve:l,reject:u,hash:e}),setTimeout(()=>{this.pendingRequests.has(a)&&(this.pendingRequests.delete(a),u(new Error(`Request for object ${e} from peer timed out`)))},1e4)})}catch(t){throw console.error("getIPmetadata failed:",t),t}}async fetchChunkFromPeer(e,t){const r=this.peers.get(e);if(!r||!r.connected||!r.conn)throw new Error(`Peer ${e} is not connected`);const s=`${e}-${t}-${Date.now()}`,i={type:"chunkRequest",requestId:s,chunkHash:t,peerId:this.peerId};return r.conn.send(i),new Promise((o,a)=>{this.pendingRequests.set(s,{resolve:o,reject:a,hash:t}),setTimeout(()=>{this.pendingRequests.has(s)&&(this.pendingRequests.delete(s),a(new Error(`Request for chunk ${t} from peer ${e} timed out`)))},1e4)})}handleChunkRequest(e,t){const{requestId:r,chunkHash:s}=e;this.dbGet("chunkCache",s).then(i=>{if(i&&i.value){const o=this.peers.get(t);o&&o.connected&&o.conn&&(o.conn.send({type:"chunkResponse",requestId:r,chunkHash:s,chunkData:i.value,peerId:this.peerId}),console.log(`Sent chunk ${s} to peer ${t}`))}else console.warn(`Chunk ${s} not found for peer ${t}`)}).catch(i=>console.error(`Failed to retrieve chunk ${s} for peer ${t}:`,i))}handleMetadataRequest(e,t){const{requestId:r,ipHash:s}=e,i=this.knownObjects.get(s),o=this.peers.get(t);o&&o.connected&&o.conn&&o.conn.send({type:"metadataResponse",requestId:r,ipObject:i,peerId:this.peerId,ipHash:s})}handleMetadataResponse(e){const{requestId:t,ipObject:r,ipHash:s}=e,i=this.pendingRequests.get(t);i&&(s===i.hash&&i.resolve(r),this.pendingRequests.delete(t))}handleChunkResponse(e){const{requestId:t,chunkHash:r,chunkData:s}=e,i=this.pendingRequests.get(t);i&&(i.hash===r?i.resolve(s):i.reject(new Error(`Received chunk hash ${r} does not match requested hash ${i.hash}`)),this.pendingRequests.delete(t))}async distributeCommission(e){const t=Array.from(this.activeNodes).filter(s=>s.startsWith("node-"));if(t.length===0){console.log("No active nodes to distribute commission to.");return}const r=e/t.length;console.log(`Distributing commission of ${e} to ${t.length} nodes (${r} per node)`);for(const s of t){const i=s.replace("node-",""),o=this.base64UrlToUint8Array(i),c=await this.getBalance(o)+r;await this.putBalance(o,c);const l=this.peers.get(s);l&&l.connected&&l.conn&&l.conn.send({type:"commission",amount:r,newBalance:c,peerId:this.peerId})}}async getBalance(e){if(!this.db)throw new Error("IndexedDB not initialized");const t=await this.dbGet("store","balance_"+e);return t&&t.value?parseFloat(t.value):0}async putBalance(e,t){if(!this.db)throw new Error("IndexedDB not initialized");if(typeof t!="number"||t<0)throw new Error("Invalid balance amount");await this.dbPut("store",{id:"balance_"+e,value:t.toString()}),this.activeNodes.size>0&&this.broadcast({type:"userData",peerId:this.peerId,keypair:this.keypair,balance:t,timestamp:Date.now()})}async updateBalance(){if(!this.db)throw new Error("IndexedDB not initialized");const e=await this.getBalance(this.keypair);await this.putBalance(this.keypair,e)}async queueOfflineOperation(e){if(!this.db)throw new Error("IndexedDB not initialized");this.offlineQueue.push(e),await this.dbAdd("offlineQueue",{id:Date.now().toString(),value:e}),console.log("Queued offline operation:",e)}async processOfflineQueue(){if(this.offlineQueue.length===0)return;console.log("Processing offline queue...");const e=[...this.offlineQueue];this.offlineQueue=[];const r=this.db.transaction("offlineQueue","readwrite").objectStore("offlineQueue");await new Promise(s=>r.clear().onsuccess=s);for(const s of e)try{switch(s.type){case"publishChunk":await this.publishChunk(s.chunkHash,s.chunkData,s.chunkIndex,s.totalChunks);break;case"publishIP":await this.broadcastIP(s.ipHash,s.metadata,s.chunkHashes);break;default:console.warn("Unknown offline operation type:",s.type)}}catch(i){console.error(`Failed to process offline operation ${s.type}:`,i),this.offlineQueue.push(s),await this.dbAdd("offlineQueue",{id:Date.now().toString(),value:s})}}async dbPut(e,t){if(!this.db)throw new Error("IndexedDB not initialized");return new Promise((r,s)=>{const a=this.db.transaction(e,"readwrite").objectStore(e).put(t);a.onsuccess=()=>r(),a.onerror=c=>s(new Error(`DB put failed: ${c.target.error.message}`))})}async dbAdd(e,t){if(!this.db)throw new Error("IndexedDB not initialized");return new Promise((r,s)=>{const a=this.db.transaction(e,"readwrite").objectStore(e).add(t);a.onsuccess=()=>r(),a.onerror=c=>s(new Error(`DB add failed: ${c.target.error.message}`))})}async dbGet(e,t){if(!this.db)throw new Error("IndexedDB not initialized");return new Promise((r,s)=>{const a=this.db.transaction(e,"readonly").objectStore(e).get(t);a.onsuccess=()=>r(a.result),a.onerror=c=>s(new Error(`DB get failed: ${c.target.error.message}`))})}async dbGetAll(e){if(!this.db)throw new Error("IndexedDB not initialized");return new Promise((t,r)=>{const o=this.db.transaction(e,"readonly").objectStore(e).getAll();o.onsuccess=()=>t(o.result),o.onerror=a=>r(new Error(`DB getAll failed: ${a.target.error.message}`))})}broadcast(e){this.activeNodes.forEach(t=>{if(t!==this.peerId){const r=this.peers.get(t);r&&r.connected&&r.conn&&r.conn.send(e)}})}uint8ArrayToBase64Url(e){const t=String.fromCharCode(...e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}base64UrlToUint8Array(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";const r=atob(t),s=new Uint8Array(r.length);for(let i=0;i<r.length;i++)s[i]=r.charCodeAt(i);return s}async destroy(){this.peer&&!this.peer.destroyed&&(this.peer.destroy(),console.log("PeerJS peer destroyed")),this.libp2p&&(await this.libp2p.stop(),console.log("libp2p stopped")),this.peers.clear(),this.activeNodes.clear(),this.pendingRequests.clear(),this.bootstrapNodes.clear()}}function ny(n){const e=String.fromCharCode(...n);return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}let xt=null,qt=null,oN=null,se=null,il=!1,bs=0,Th=!1,Ih=!1;async function sy(){console.log("Starting Firebase initialization...");try{const n=await Hy(()=>Promise.resolve().then(()=>vk),void 0);xt=n.auth,qt=n.db,oN=n.storage,await Ry(xt,By),console.log("Firebase services initialized successfully with local persistence")}catch(n){throw console.error("Failed to initialize Firebase services:",n),le("Failed to initialize Firebase. Please try again later.",!0),n}}function aN(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}function to(){return!!(xt!=null&&xt.currentUser)||localStorage.getItem("role")==="node"}function le(n,e=!1){const t=document.getElementById("toast");t&&(t.textContent=n,t.className="toast",e&&t.classList.add("error-toast"),t.style.display="block",setTimeout(()=>{t.style.display="none"},3e3))}function cN(){if(!to()||!se){le("Please sign in and ensure the app is initialized before publishing.",!0);return}try{document.getElementById("publishModal").classList.add("active"),console.log("Opened publish modal")}catch(n){console.error("Failed to open publish modal:",n),le("Failed to open publish modal. Please try again.",!0)}}async function lN(n){let e=se.knownObjects.get(n).metadata;if(window.currentProduct=e.hash,!to()||!se){le("Please sign in and ensure the app is initialized before viewing.",!0);return}try{const t=document.getElementById("buyModal");document.getElementById("snippetTitle").value=e.content_type,document.getElementById("snippetDescription").value=e.description,document.getElementById("snippetPrice").value=e.priceUsd==0?"Free":e.priceUsd,t.classList.add("active")}catch(t){console.error("Failed to open buy/preview modal:",t),le("Failed to open buy/preview modal. Please try again.",!0)}}function $o(){var e,t;const n={publishedItemsTableBody:(e=document.getElementById("publishedItems"))==null?void 0:e.querySelector("tbody"),mySnippetsTableBody:(t=document.getElementById("mySnippets"))==null?void 0:t.querySelector("tbody"),transactionList:document.getElementById("transactionList"),userBalanceElement:document.getElementById("userBalance"),userNameElement:document.getElementById("userName"),userAvatarElement:document.querySelector(".user-avatar"),snippetsPostedElement:document.getElementById("snippetsPosted")};n.publishedItemsTableBody&&(n.publishedItemsTableBody.innerHTML=""),n.mySnippetsTableBody&&(n.mySnippetsTableBody.innerHTML=""),n.transactionList&&(n.transactionList.innerHTML="No transactions yet."),n.userBalanceElement&&(n.userBalanceElement.textContent="Balance: 0 DCT"),n.userNameElement&&(n.userNameElement.textContent="Guest User"),n.userAvatarElement&&(n.userAvatarElement.innerHTML='<i class="fas fa-user text-lg"></i>'),n.snippetsPostedElement&&(n.snippetsPostedElement.textContent="0"),bs=0,localStorage.removeItem("userKeypair"),localStorage.removeItem("peerId"),localStorage.removeItem("dhtInitialized"),console.log("Cleared persisted state from localStorage on sign-out")}async function qa(){const n=document.getElementById("userBalance");if(n){if(!se){n.textContent="Balance: 0 DCT",bs=0;return}try{bs=await se.getBalance(se.keypair)||0,n.textContent=`Balance: ${bs} DCT`}catch(e){console.error("Failed to update balance:",e),n.textContent="Balance: 0 DCT",bs=0}}}async function za(){const n=document.getElementById("transactionList");if(n){if(!se){n.innerHTML="Not initialized.";return}try{const e=await se.dbGetAll("transactions");if(e.length===0){n.innerHTML="No transactions yet.";return}n.innerHTML=e.map(t=>`<p class="py-1">${t.type} - ${t.amount} DCT - ${new Date(t.timestamp).toLocaleString()}</p>`).join("")}catch(e){console.error("Failed to update transaction history:",e),n.innerHTML="Failed to load transactions."}}}async function F0(){var e;const n=(e=document.getElementById("publishedItems"))==null?void 0:e.querySelector("tbody");if(n){n.innerHTML="";try{const t=al(cl(qt,"snippets"));Ly(t,async r=>{const s={};if(r.forEach(i=>{s[i.id]=i.data()}),se){se.knownObjects.clear();for(const[i,o]of Object.entries(s)){const a={content_type:o.title,hash:o.ipHash,description:o.description||"No description",tags:o.tags||[],isPremium:o.isPremium||!1,priceUsd:o.priceUsd||0};se.knownObjects.set(i,{metadata:a,chunks:o.chunks||[]})}se.knownObjects.forEach((i,o)=>{const a=s[o],l=(i.metadata.isPremium||!1)&&i.metadata.priceUsd||0,u=l>0?`${l} DCT`:"Free",d=document.createElement("tr");d.innerHTML=`
            <td class="py-2 px-4">${i.metadata.content_type}</td>
            <td class="py-2 px-4">${i.metadata.tags.join(", ")||"No tags"}</td>
            <td class="py-2 px-4">${a.likes}</td>
            <td class="py-2 px-4">${a.dislikes}</td>
            <td class="py-2 px-4">
            
              <button onclick="window.openBuyModal('${o}')" class="bg-purple-500 text-white rounded hover:bg-purple-600 px-3 py-1 mr-2">Get (${u})</button>
              <button onclick="window.flagSnippet('${o}')" class="bg-red-500 text-white rounded hover:bg-red-600 px-3 py-1">Flag</button>
            </td>
          `,n.appendChild(d)})}},r=>{console.error("Live feed snapshot error:",r),le("Failed to load live feed.",!0)})}catch(t){console.error("Failed to update live feed:",t),le("Failed to load live feed.",!0)}}}async function Wf(){var e,t;const n=(e=document.getElementById("mySnippets"))==null?void 0:e.querySelector("tbody");if(n){n.innerHTML="";try{const r=((t=xt.currentUser)==null?void 0:t.uid)||localStorage.getItem("nodeId");if(!r)return;const s=al(cl(qt,"snippets"),Bh("creatorId","==",r));(await Rh(s)).forEach(o=>{const a=o.data(),c=document.createElement("tr");c.innerHTML=`
        <td class="py-2 px-4">${a.title||"No title"}</td>
        <td class="py-2 px-4">${a.ipHash}</td>
        <td class="py-2 px-4">
          <button onclick="window.copyHash('${a.ipHash}')" class="bg-blue-500 text-white rounded hover:bg-blue-600 px-3 py-1">Copy Hash</button>
        </td>
      `,n.appendChild(c)})}catch(r){console.error("Failed to update my snippets:",r),le("Failed to load your snippets.",!0)}}}async function uN(n){var t;const e=(t=document.getElementById("publishedItems"))==null?void 0:t.querySelector("tbody");if(e){e.innerHTML="";try{const r=n.split(",").map(o=>o.trim().toLowerCase()).filter(o=>o);let s;r.length===0?s=await Rh(al(cl(qt,"snippets"),Bh("reviewStatus","==","active"))):s=await Rh(al(cl(qt,"snippets"),Bh("reviewStatus","==","active")));const i={};if(s.forEach(o=>{i[o.id]=o.data()}),se){se.knownObjects.clear();for(const[o,a]of Object.entries(i)){const c={content_type:a.title,description:a.description||"No description",tags:a.tags||[],isPremium:a.isPremium||!1,priceUsd:a.priceUsd||0};se.knownObjects.set(o,{metadata:c,chunks:a.chunks||[]})}se.knownObjects.forEach((o,a)=>{const c=i[a]||{likes:0,dislikes:0},l=(o.metadata.tags||[]).map(y=>y.toLowerCase());if(r.length>0&&!r.some(y=>l.includes(y)))return;const d=(o.metadata.isPremium||!1)&&o.metadata.priceUsd||0,f=d>0?`${d} DCT`:"Free",m=document.createElement("tr");m.innerHTML=`
          <td class="py-2 px-4">${o.metadata.content_type}</td>
          <td class="py-2 px-4">${o.metadata.description||"No description"}</td>
          <td class="py-2 px-4">${o.metadata.tags.join(", ")||"No tags"}</td>
          <td class="py-2 px-4">${c.likes}</td>
          <td class="py-2 px-4">${c.dislikes}</td>
          <td class="py-2 px-4">
            <button onclick="window.openBuyModal(${a})" class="bg-purple-500 text-white rounded hover:bg-purple-600 px-3 py-1 mr-2">Get (${f})</button>
            <button onclick="window.flagSnippet('${a}')" class="bg-red-500 text-white rounded hover:bg-red-600 px-3 py-1">Flag</button>
          </td>
        `,e.appendChild(m)})}}catch(r){console.error("Failed to search snippets:",r),le("Search failed.",!0)}}}async function Ka(){var e;const n=((e=xt.currentUser)==null?void 0:e.uid)||localStorage.getItem("nodeId");if(n)try{const t=Dr(qt,"users",n),r=se?await se.getBalance(se.keypair):0;await Hi(t,{balance:r,lastUpdated:Date.now()},{merge:!0}),console.log("User data uploaded to Firebase")}catch(t){console.error("Failed to upload user data to Firebase:",t)}}function hN(){const n=document.getElementById("transactionHistory");n&&(n.style.display=n.style.display==="none"?"block":"none")}function dN(n,e,t){const r=document.getElementById("snippetDisplay");if(!r)return;r.innerHTML="";const s=document.createElement("div");s.className="p-4 bg-gray-800 rounded-lg mt-4";const i=document.createElement("h3");if(i.className="text-lg font-semibold mb-2",i.textContent=t||"Snippet Content",s.appendChild(i),e.startsWith("text")){const o=new TextDecoder().decode(n),a=document.createElement("pre");a.className="text-sm text-gray-300 whitespace-pre-wrap",a.textContent=o,s.appendChild(a)}else if(e.startsWith("image")){const o=new Blob([n],{type:e}),a=URL.createObjectURL(o),c=document.createElement("img");c.src=a,c.className="max-w-full h-auto rounded",c.onload=()=>URL.revokeObjectURL(a),s.appendChild(c)}else{const o=new Blob([n],{type:e}),a=URL.createObjectURL(o),c=document.createElement("a");c.href=a,c.download=t||"downloaded_file",c.className="text-blue-400 hover:underline",c.textContent="Download File",c.onclick=()=>setTimeout(()=>URL.revokeObjectURL(a),1e3),s.appendChild(c)}r.appendChild(s)}async function Qf(){return new Promise((e,t)=>{console.log("Starting IndexedDB initialization...");const r=indexedDB.open("dcrypt_db");r.onsuccess=()=>{const s=r.result,i=s.version;console.log("Current IndexedDB version:",i),s.close();const o=indexedDB.open("dcrypt_db",Math.max(i,5));o.onupgradeneeded=a=>{const c=o.result;console.log("Upgrading database to version",5),c.objectStoreNames.contains("store")||(c.createObjectStore("store",{keyPath:"id"}),console.log("Created object store: store")),c.objectStoreNames.contains("transactions")||(c.createObjectStore("transactions",{keyPath:"id",autoIncrement:!0}),console.log("Created object store: transactions")),c.objectStoreNames.contains("offlineQueue")||(c.createObjectStore("offlineQueue",{keyPath:"id",autoIncrement:!0}),console.log("Created object store: offlineQueue")),c.objectStoreNames.contains("chunkCache")||(c.createObjectStore("chunkCache",{keyPath:"id"}),console.log("Created object store: chunkCache")),console.log("Database upgrade completed")},o.onsuccess=()=>{const a=o.result;console.log("IndexedDB opened successfully at version",a.version),e(a)},o.onerror=()=>{console.error("Failed to open IndexedDB:",o.error),t(new Error(`Failed to open IndexedDB: ${o.error.message}`))}},r.onerror=()=>{console.error("Failed to check IndexedDB version:",r.error),t(new Error(`Failed to check IndexedDB version: ${r.error.message}`))}})}async function iy(n){return new Promise((e,t)=>{try{const i=n.transaction("store","readonly").objectStore("store").get("dcrypt_identity");i.onsuccess=()=>{var a;const o=(a=i.result)==null?void 0:a.value;o&&typeof o=="string"?(console.log("Loaded keypair from IndexedDB:",o),e(o)):(console.log("No valid keypair found in IndexedDB."),e(null))},i.onerror=()=>{console.error("Failed to load keypair from IndexedDB:",i.error),t(new Error("Failed to load keypair from IndexedDB"))}}catch(r){console.error('Error accessing "store" object store:',r),t(r)}})}async function v6(n,e){return new Promise((t,r)=>{try{console.log("Storing keypair in IndexedDB:",e);const o=n.transaction("store","readwrite").objectStore("store").put({id:"dcrypt_identity",value:e});o.onsuccess=()=>{console.log("Successfully stored keypair in IndexedDB"),t()},o.onerror=()=>{console.error("Failed to store keypair in IndexedDB:",o.error),r(new Error("Failed to store keypair in IndexedDB"))}}catch(s){console.error('Error storing keypair in "store" object store:',s),r(s)}})}async function b6(n,e){if(Ih){console.log("Initialization already in progress, skipping...");return}Ih=!0,console.log("Initializing app with userId:",n);try{e||(e=await Qf());let t=await iy(e);if(t instanceof Uint8Array&&(t=ny(t)),!t&&n)console.log("No keypair found, using userId as keypair:",n),await v6(e,n),t=n;else if(t)t.length>40&&(console.warn("Existing keypair is unusually large:",t.length,"characters. Overwriting with userId."),t=n,await v6(e,n));else throw new Error("No keypair available and no userId provided to create one");il=await fN(n),console.log(`User is ${il?"":"not "}a node.`),se=new ry(t,il),window.dht=se,await se.initDB(),console.log("DHT database initialized.");let r=3;for(;r>0;)try{await se.initSwarm();break}catch(s){if(s.message.includes("No bootstrap node available")&&r>1)console.warn("No nodes available, retrying...",r),await new Promise(i=>setTimeout(i,5e3)),r--;else throw s}console.log("DHT swarm initialized."),await se.syncUserData(),console.log("User data synced."),await Promise.all([F0(),Wf(),qa(),za()]),console.log("UI updated."),await ay(n)}catch(t){console.error("Error initializing application:",t),t.message.includes("ID conflict")?le("Failed to connect to the network due to an ID conflict. Please try signing out and signing in again.",!0):t.message.includes("No bootstrap node available")?le("No nodes available in the network. Please try again later.",!0):le(`Initialization failed: ${t.message}`,!0),se&&se.destroy(),se=null,window.dht=null,bs=0,$o()}finally{Ih=!1}Ka()}async function fN(n){try{const e=Dr(qt,"nodes",n);return(await nd(e)).exists()}catch(e){return console.error("Failed to check node status:",e),!1}}async function pN(n,e=800,t=800,r=.7){return new Promise((s,i)=>{const o=new Image;o.src=URL.createObjectURL(n),o.onload=()=>{const a=document.createElement("canvas");let c=o.width,l=o.height;c>l?c>e&&(l*=e/c,c=e):l>t&&(c*=t/l,l=t),a.width=c,a.height=l,a.getContext("2d").drawImage(o,0,0,c,l),a.toBlob(d=>s(d),n.type,r)},o.onerror=i})}async function gN(n,e){if(!e)return console.log("No file provided for upload"),null;if(!xt.currentUser||xt.currentUser.uid!==n)return console.error("User not authenticated or ID mismatch"),le("Please sign in to upload a profile image.",!0),null;try{const t=await pN(e),r=new FileReader,i=await new Promise((a,c)=>{r.onload=()=>a(r.result.split(",")[1]),r.onerror=c,r.readAsDataURL(t)}),o=Dr(qt,"users",n);return await Hi(o,{profileImage:i,updatedAt:new Date().toISOString()},{merge:!0}),console.log("Compressed profile image stored in Firestore for user:",n),i}catch(t){return console.error("Failed to store profile image in Firestore:",t),le(`Failed to store profile image: ${t.message}`,!0),null}}async function mN(){if(console.log("handleSignup function called"),Th){console.log("Signup already in progress, ignoring additional clicks");return}Th=!0;const n=document.getElementById("signupButton");n&&(n.disabled=!0,n.textContent="Signing Up...",console.log("Signup button disabled and text updated")),localStorage.setItem("pendingRole","user");try{const e=new Y6,t=await X6(xt,e);console.log("Sign-up successful, user:",t.user);const r=document.getElementById("usernameInput").value,i=document.getElementById("profileImageInput").files[0];console.log(i);const o=i?await gN(t.user.uid,i):null,a=Dr(qt,"users",t.user.uid);await Hi(a,{username:r||t.user.displayName||"Anonymous User",profileImageUrl:o||null,createdAt:Date.now(),snippetsPosted:0},{merge:!0}),console.log("User profile saved to Firestore"),le("Sign-up successful! Redirecting to dashboard..."),window.location.href="/datasharingApp/"}catch(e){console.error("Signup failed:",e),le(`Sign-up failed: ${e.message}`,!0),Th=!1,n&&(n.disabled=!1,n.textContent="Sign Up with Google")}finally{localStorage.removeItem("pendingRole")}}async function yN(n){if(!to()){le("Please sign in to deposit.");return}try{if(!se)throw new Error("DHT not initialized");if(!n||n<=0)throw new Error("Invalid deposit amount");const t=await se.getBalance(se.keypair)+n;await se.putBalance(se.keypair,t),await se.dbAdd("transactions",{type:"deposit",amount:n,timestamp:Date.now()}),le(`Deposited ${n} DCT successfully!`),await Promise.all([za(),qa(),Ka()])}catch(e){console.error("deposit failed:",e),le(`Deposit failed: ${e.message}`,!0)}}async function xN(n){if(!to()){le("Please sign in to withdraw.");return}try{if(!se)throw new Error("DHT not initialized");if(!n||n<=0)throw new Error("Invalid withdrawal amount");const e=await se.getBalance(se.keypair);if(e<n)throw new Error("Insufficient balance");await se.putBalance(se.keypair,e-n),await se.dbAdd("transactions",{type:"withdraw",amount:n,timestamp:Date.now()}),le(`Withdrew ${n} DCT successfully!`),await Promise.all([za(),qa(),Ka()])}catch(e){console.error("withdraw failed:",e),le(`Withdrawal failed: ${e.message}`,!0)}}async function vN(){console.log("signIn function called");try{xt||(console.error("Firebase Auth is not initialized, initializing now..."),await sy());const n=new Y6,e=await X6(xt,n);console.log("Sign-in successful, user:",e.user)}catch(n){console.error("Login failed:",n),le(`Login failed: ${n.message}`,!0)}}async function w6(){console.log("signOutUser function called");try{localStorage.getItem("role")==="node"?(localStorage.removeItem("nodeId"),localStorage.removeItem("role"),le("Node signed out successfully!")):(await Fy(xt),le("Signed out successfully!")),se&&(se.destroy(),se=null,window.dht=null);const t=(await Qf()).transaction("store","readwrite").objectStore("store");await new Promise((r,s)=>{const i=t.delete("dcrypt_identity");i.onsuccess=()=>{console.log("Successfully deleted keypair from IndexedDB"),r()},i.onerror=()=>{console.error("Failed to delete keypair from IndexedDB:",i.error),s(new Error("Failed to delete keypair from IndexedDB"))}}),bs=0,$o()}catch(n){console.error("Sign-out failed:",n),le(`Sign-out failed: ${n.message}`,!0)}}async function bN(n,e,t,r,s){var i,o;if(!to()){le("Please sign in to publish.");return}try{if(!se)throw new Error("DHT not initialized");if(!n)throw new Error("Title is required");let a=r||"",c="text/plain";if((i=s==null?void 0:s.files)!=null&&i.length){const S=s.files[0];c=S.type||"application/octet-stream",a=await new Promise((_,E)=>{const B=new FileReader;B.onload=F=>_(new Uint8Array(F.target.result)),B.onerror=()=>E(new Error("Failed to read file")),B.readAsArrayBuffer(S)})}else a=new TextEncoder().encode(a);const l=document.getElementById("modalPremium").checked,u=document.getElementById("modalPriceInput"),d=l&&u&&parseFloat(u.value)||0,f={content_type:c,title:n,description:e||"",tags:t?t.split(",").map(S=>S.trim()).filter(S=>S.length>0):[],isPremium:l,priceUsd:d},m=await se.publishIP(f,a,c),y=((o=xt.currentUser)==null?void 0:o.uid)||localStorage.getItem("nodeId"),b=Dr(qt,"snippets",m),x={ipHash:m,title:n,description:e||"",tags:f.tags,isPremium:l,priceUsd:d,flagCount:0,likes:0,dislikes:0,createdAt:Date.now(),creatorId:y};console.log("Saving snippet to Firestore: ",x),await Hi(b,x,{merge:!0});const D=Dr(qt,"users",y);await zo(D,{snippetsPosted:ol(1)}),le("Snippet published successfully!"),window.closePublishModal(),await Promise.all([F0(),Wf(),za(),qa(),Ka(),ay(y)])}catch(a){throw console.error("publishSnippet failed:",a),le(`Publish failed: ${a.message}`,!0),a}}async function oy(n){if(!to())return le("Please sign in to buy."),null;try{if(!se)throw new Error("DHT not initialized");if(!n)throw new Error("Hash is required");let e=await se.getIPmetadata(n);console.log("IP Object:",e);const s=(e.metadata.isPremium||!1)&&e.metadata.priceUsd||0;if(s>0){const c=await se.getBalance(se.keypair);if(c<s)throw new Error("Insufficient balance");const l=s*.05;await se.distributeCommission(l),await se.putBalance(se.keypair,c-s),await se.dbAdd("transactions",{type:"buy",amount:s,timestamp:Date.now()})}else console.log("This snippet is free!"),await se.dbAdd("transactions",{type:"buy",amount:0,timestamp:Date.now()});const{data:i,fileType:o}=await se.requestData(e);le("Snippet retrieved successfully!"),await Promise.all([za(),qa(),Ka(),Wf()]);const a=prompt('Do you like this snippet? Type "like" or "dislike":');if(a!==null){const c=a.trim().toLowerCase();c==="like"||c==="dislike"?(await _N(n,c),le(`You ${c}d this snippet!`),await F0()):le('Invalid input. Please type "like" or "dislike".',!0)}return dN(i,o,e.metadata.title||e.metadata.content_type),{data:i,fileType:o}}catch(e){return console.error("buySnippet failed:",e),le(`Purchase failed: ${e.message}`,!0),null}}async function wN(n){var r;const e=n||((r=document.getElementById("buyHashInput"))==null?void 0:r.value.trim());if(!e){le("Please enter a valid hash.",!0);return}await oy(e)&&le("Snippet purchased and displayed below!")}async function _N(n,e){var r;const t=((r=xt.currentUser)==null?void 0:r.uid)||localStorage.getItem("nodeId");if(t)try{const s=Dr(qt,"snippets",n,"feedback",t);await Hi(s,{action:e,timestamp:Date.now()});const i=Dr(qt,"snippets",n);e==="like"?await zo(i,{likes:ol(1)}):e==="dislike"&&await zo(i,{dislikes:ol(1)})}catch(s){console.error("Failed to submit feedback:",s),le(`Failed to submit feedback: ${s.message}`,!0)}}async function EN(n){var t;if(!(((t=xt.currentUser)==null?void 0:t.uid)||localStorage.getItem("nodeId"))){le("Please sign in to flag content.");return}try{const r=Dr(qt,"snippets",n);await zo(r,{flagCount:ol(1)}),((await nd(r)).data().flagCount||0)>=3?(await zo(r,{reviewStatus:"under_review"}),le("Snippet has been flagged and is under review."),await F0()):le("Snippet flagged. It will be reviewed if flagged by more users.")}catch(r){console.error("Failed to flag snippet:",r),le(`Failed to flag snippet: ${r.message}`,!0)}}async function AN(){const n=aN();console.log("Generated nodeId:",n),localStorage.setItem("nodeId",n),localStorage.setItem("role","node");const e=Dr(qt,"nodes",n);if(await Hi(e,{role:"node",createdAt:Date.now(),status:"active"},{merge:!0}),console.log("Node registered in Firestore:",n),!window.location.pathname.includes("node-instructions.html")){console.log("Redirecting to node-instructions.html for node role"),window.location.href="/datasharingApp/node-instructions.html";return}}async function CN(){try{const n=localStorage.getItem("nodeId"),e=localStorage.getItem("role");if(localStorage.removeItem("nodeId"),localStorage.removeItem("role"),sessionStorage.setItem("nodeId",n),sessionStorage.setItem("role",e),console.log("Moved to session storage"),e!=="node"||!n){le("You must be signed in as a node to view this page."),window.location.href="/datasharingApp/signup.html";return}const t=ny(new TextEncoder().encode(CryptoJS.SHA256(n).toString(CryptoJS.enc.Hex).substring(0,40)));se=new ry(t,!0),window.dht=se,await se.initDB(),await se.initSwarm(),await se.syncUserData();const s=(await se.dbGetAll("transactions")).filter(o=>o.type==="commission").reduce((o,a)=>o+(a.amount||0),0),i=document.getElementById("nodeEarnings");i&&(i.textContent=`Total Earnings: ${s.toFixed(2)} DCT`)}catch(n){console.error("Error initializing node instructions:",n),le(`Initialization failed: ${n.message}`,!0)}}async function ay(n){if(n)try{const e=Dr(qt,"users",n),t=await nd(e);if(t.exists()){const r=t.data(),s=document.getElementById("userName"),i=document.querySelector(".user-avatar"),o=document.getElementById("snippetsPosted");s&&(s.textContent=r.username||"Anonymous User"),i&&(r.profileImageUrl?i.innerHTML=`<img src="${r.profileImageUrl}" alt="Profile Image" class="w-12 h-12 rounded-full object-cover">`:i.innerHTML='<i class="fas fa-user text-lg"></i>'),o&&(o.textContent=r.snippetsPosted||0)}}catch(e){console.error("Failed to fetch user profile:",e),le("Failed to load user profile.",!0)}}async function SN(n){try{await navigator.clipboard.writeText(n),le("Hash copied to clipboard!")}catch(e){console.error("Failed to copy hash:",e),le("Failed to copy hash.",!0)}}document.addEventListener("DOMContentLoaded",async()=>{var r,s,i;if(console.log("DOMContentLoaded event fired"),console.log("Current pathname:",window.location.pathname),window.location.pathname.includes("signup")){const o=document.getElementById("userSignupForm");o&&o.addEventListener("submit",async a=>{a.preventDefault(),await window.handleSignup()})}window.location.pathname.includes("node")&&CN();try{await sy()}catch(o){console.error("Firebase initialization failed, aborting setup:",o),le("Firebase initialization failed. Please check your configuration.",!0);return}const n=localStorage.getItem("role"),e=localStorage.getItem("nodeId"),t=!(window.location.pathname.includes("node")||window.location.pathname.includes("signup.html")||window.location.pathname.includes("publish"));if(t&&n==="node"&&e&&(console.log("Node detected on index.html, redirecting to node-instructions.html"),window.location.href="/datasharingApp/node-instructions.html"),t||window.location.pathname.includes("publish")){const o=await Qf(),a=await iy(o);try{await Promise.all([new Promise(c=>{L2(xt,async l=>{if(console.log("onAuthStateChanged triggered"),l)console.log("User is signed in:",l.uid),await b6(l.uid,o);else{console.log("No user is signed in. Checking IndexedDB for keypair...");try{a?(console.log("Found keypair in IndexedDB, initializing app..."),await b6(a,o)):(console.log("No keypair found in IndexedDB."),t&&$o())}catch(u){console.error("Failed to initialize IndexedDB or load keypair:",u),t&&$o()}}c()},l=>{console.error("onAuthStateChanged error:",l),le("Failed to monitor authentication state.",!0),c()})})])}catch(c){console.error("Initialization error:",c),le("An error occurred during initialization.",!0)}}if(t){const o={signupButton:document.getElementById("signupButton"),loginButton:document.getElementById("loginButton"),logoutButton:document.getElementById("logoutButton"),userBalanceElement:document.getElementById("userBalance"),searchButton:document.getElementById("searchButton"),depositButton:document.getElementById("depositButton"),withdrawButton:document.getElementById("withdrawButton"),toggleHistoryButton:document.getElementById("toggleHistoryButton"),transactionHistory:document.getElementById("transactionHistory"),publishedItemsTableBody:(r=document.getElementById("publishedItems"))==null?void 0:r.querySelector("tbody"),buyHashButton:document.getElementById("buyHashButton")};console.log("On index.html, setting up UI and event listeners"),n==="node"&&e&&(il=!0,console.log("Node detected, but should have been redirected already.")),(s=o.loginButton)==null||s.addEventListener("click",c=>{c.preventDefault(),console.log("Login button clicked"),vN()}),(i=o.logoutButton)==null||i.addEventListener("click",c=>{c.preventDefault(),console.log("Logout button clicked"),w6()}),L2(xt,c=>{var l,u,d,f,m,y;c?((l=o.signupButton)==null||l.classList.add("hidden"),(u=o.loginButton)==null||u.classList.add("hidden"),(d=o.logoutButton)==null||d.classList.remove("hidden"),o.searchButton.disabled=!1,o.depositButton.disabled=!1,o.withdrawButton.disabled=!1,o.toggleHistoryButton.disabled=!1,o.buyHashButton.disabled=!1):((f=o.signupButton)==null||f.classList.remove("hidden"),(m=o.loginButton)==null||m.classList.remove("hidden"),(y=o.logoutButton)==null||y.classList.add("hidden"),o.searchButton.disabled=!0,o.depositButton.disabled=!0,o.withdrawButton.disabled=!0,o.toggleHistoryButton.disabled=!0,o.buyHashButton.disabled=!0,$o())});const a=document.getElementById("publishForm");a&&a.addEventListener("submit",async c=>{c.preventDefault();const l=document.getElementById("modalTitleInput").value,u=document.getElementById("modalDescriptionInput").value,d=document.getElementById("modalTagsInput").value,f=document.getElementById("modalContentInput").value,m=document.getElementById("modalFileInput");await window.publishSnippet(l,u,d,f,m)})}else console.log("Not on index.html, skipping index.html-specific setup");window.logout=w6,window.publishSnippet=bN,window.buySnippet=oy,window.buySnippetByHash=wN,window.toggleTransactionHistory=hN,window.flagSnippet=EN,window.handleSignup=mN,window.becomeNode=AN,window.deposit=yN,window.withdraw=xN,window.redirectToPublish=cN,window.searchSnippets=uN,window.copyHash=SN,window.openBuyModal=lN});
